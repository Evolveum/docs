<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="keywords" content="Identity management, IDM, Identity and Access Management, IAM, Identity Governance, Identity Governance and Administration, IGA, Open source, OSS, midPoint, Evolveum">
<meta name="author" content="Radovan Semančík et al.">
<meta name="copyright" content="CC-BY-NC-ND 4.0">
<title>Practical Identity Management With MidPoint</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Practical Identity Management With MidPoint</h1>
<div class="details">
<span id="author" class="author">Radovan Semančík et al.</span><br>
<span id="revnumber">version 2.3,</span>
<span id="revdate">2024-11-19</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_colophon">Colophon</a></li>
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#01-idm-intro">1. Understanding Identity and Access Management</a>
<ul class="sectlevel2">
<li><a href="#_directory_services_and_other_user_databases">Directory Services and Other User Databases</a></li>
<li><a href="#_directory_servers_are_databases">Directory Servers are Databases</a></li>
<li><a href="#_access_management">Access Management</a></li>
<li><a href="#_identity_management">Identity Management</a></li>
<li><a href="#_identity_governance">Identity Governance</a></li>
<li><a href="#_identity_management_and_governance_terminology">Identity Management and Governance Terminology</a></li>
<li><a href="#_complete_identity_and_access_management_solution">Complete Identity and Access Management Solution</a></li>
<li><a href="#_iam_and_security">IAM and Security</a></li>
<li><a href="#_risk_based_approach_to_identity_governance_2">Risk-Based Approach To Identity Governance</a></li>
<li><a href="#_building_identity_and_access_management_solution">Building Identity and Access Management Solution</a></li>
</ul>
</li>
<li><a href="#02-midpoint-overview">2. MidPoint Overview</a>
<ul class="sectlevel2">
<li><a href="#_how_midpoint_works">How MidPoint Works</a></li>
<li><a href="#_case_study">Case Study</a></li>
<li><a href="#_connectors_and_resources">Connectors and Resources</a></li>
<li><a href="#_user_and_accounts">User and Accounts</a></li>
<li><a href="#_initial_import">Initial Import</a></li>
<li><a href="#_assignments_and_projections">Assignments and Projections</a></li>
<li><a href="#_roles">Roles</a></li>
<li><a href="#_there_is_much_more">There Is Much More</a></li>
<li><a href="#_what_midpoint_is_not">What MidPoint Is Not</a></li>
</ul>
</li>
<li><a href="#03-installation">3. Installation and Configuration Principles</a>
<ul class="sectlevel2">
<li><a href="#_requirements">Requirements</a></li>
<li><a href="#_installation">Installation</a></li>
<li><a href="#_docker_compose_installation">Docker Compose Installation</a></li>
<li><a href="#_containerized_book_samples">Containerized Book Samples</a></li>
<li><a href="#_on_line_demo">On-Line Demo</a></li>
<li><a href="#_midpoint_user_interface">MidPoint User Interface</a></li>
<li><a href="#_user_interface_areas">User Interface Areas</a></li>
<li><a href="#_user_interface_concepts">User Interface Concepts</a></li>
<li><a href="#_object_details_page">Object Details Page</a></li>
<li><a href="#_midpoint_configuration_basics">MidPoint Configuration Basics</a></li>
<li><a href="#_configuration_objects">Configuration Objects</a></li>
<li><a href="#_xml_json_and_yaml">XML, JSON and YAML</a></li>
<li><a href="#_maintaining_midpoint_configuration">Maintaining MidPoint Configuration</a></li>
<li><a href="#_midpoint_repository">MidPoint Repository</a></li>
<li><a href="#_midpoint_home_directory">MidPoint Home Directory</a></li>
<li><a href="#_logging">Logging</a></li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul>
</li>
<li><a href="#04-resources-and-mappings">4. Resources and Mappings</a>
<ul class="sectlevel2">
<li><a href="#_identity_resource_definitions">Identity Resource Definitions</a></li>
<li><a href="#_connectors">Connectors</a></li>
<li><a href="#_bundled_and_deployed_connectors">Bundled and Deployed Connectors</a></li>
<li><a href="#_connector_configuration_properties">Connector Configuration Properties</a></li>
<li><a href="#_testing_the_resource">Testing the Resource</a></li>
<li><a href="#_resource_schema">Resource Schema</a></li>
<li><a href="#_accessing_resource_data">Accessing Resource Data</a></li>
<li><a href="#_hub_and_spoke">Hub and Spoke</a></li>
<li><a href="#_schema_handling">Schema Handling</a></li>
<li><a href="#_attribute_handling">Attribute Handling</a></li>
<li><a href="#_mappings">Mappings</a></li>
<li><a href="#_expressions">Expressions</a></li>
<li><a href="#_script_expressions">Script Expressions</a></li>
<li><a href="#_activation">Activation</a></li>
<li><a href="#_credentials">Credentials</a></li>
<li><a href="#_complete_provisioning_example">Complete Provisioning Example</a></li>
<li><a href="#_shadows">Shadows</a></li>
<li><a href="#_conclusion_2">Conclusion</a></li>
</ul>
</li>
<li><a href="#05-synchronization">5. Synchronization</a>
<ul class="sectlevel2">
<li><a href="#_synchronization_in_midpoint">Synchronization in MidPoint</a></li>
<li><a href="#_source_systems_target_systems_and_other_creatures">Source Systems, Target Systems And Other Creatures</a></li>
<li><a href="#_inbound_and_outbound_mappings">Inbound and Outbound Mappings</a></li>
<li><a href="#_correlation">Correlation</a></li>
<li><a href="#_synchronization_situations_and_reactions">Synchronization Situations and Reactions</a></li>
<li><a href="#_synchronization_flow">Synchronization Flow</a></li>
<li><a href="#_synchronization_tasks">Synchronization Tasks</a></li>
<li><a href="#_synchronization_example_hr_feed">Synchronization Example: HR Feed</a></li>
<li><a href="#_hr_feed_recommendations">HR Feed Recommendations</a></li>
<li><a href="#_synchronization_and_provisioning">Synchronization and Provisioning</a></li>
<li><a href="#_mapping_and_expression_tips_and_tricks">Mapping and Expression Tips and Tricks</a></li>
<li><a href="#_resource_capabilities">Resource Capabilities</a></li>
<li><a href="#_synchronization_example_ldap_account_correlation">Synchronization Example: LDAP Account Correlation</a></li>
<li><a href="#_peculiarities_of_reconciliation">Peculiarities of Reconciliation</a></li>
<li><a href="#_usernames">Usernames</a></li>
<li><a href="#_deltas">Deltas</a></li>
<li><a href="#_live_synchronization">Live Synchronization</a></li>
<li><a href="#_live_synchronization_strategies">Live Synchronization Strategies</a></li>
<li><a href="#_conclusion_3">Conclusion</a></li>
</ul>
</li>
<li><a href="#06-schema">6. Schema</a>
<ul class="sectlevel2">
<li><a href="#_midpoint_schema">MidPoint Schema</a></li>
<li><a href="#_data_unification">Data Unification</a></li>
<li><a href="#_basic_user_schema">Basic User Schema</a></li>
<li><a href="#_operational_experimental_and_deprecated_items">Operational, Experimental and Deprecated Items</a></li>
<li><a href="#_lifecycle_and_activation">Lifecycle and Activation</a></li>
<li><a href="#_schema_definition">Schema Definition</a></li>
<li><a href="#_schema_extensibility">Schema Extensibility</a></li>
<li><a href="#_polystring_and_protected_string">PolyString and Protected String</a></li>
<li><a href="#_advanced_schema_concepts">Advanced Schema Concepts</a></li>
<li><a href="#_conclusion_4">Conclusion</a></li>
</ul>
</li>
<li><a href="#07-rbac">7. Role-Based Access Control</a>
<ul class="sectlevel2">
<li><a href="#_reality_vs_policy">Reality vs Policy</a></li>
<li><a href="#_assignment">Assignment</a></li>
<li><a href="#_roles_2">Roles</a></li>
<li><a href="#_roles_and_provisioning">Roles and Provisioning</a></li>
<li><a href="#_roles_accounts_and_attributes">Roles, Accounts and Attributes</a></li>
<li><a href="#_role_hierarchy">Role Hierarchy</a></li>
<li><a href="#_role_universality">Role Universality</a></li>
<li><a href="#_role_engineering">Role Engineering</a></li>
<li><a href="#_assignment_gets_complicated">Assignment Gets Complicated</a></li>
<li><a href="#_dynamic_roles">Dynamic Roles</a></li>
<li><a href="#_metaroles">Metaroles</a></li>
<li><a href="#_rbac_abac_pbac_and_other_wildlife">RBAC, ABAC, PBAC And Other Wildlife</a></li>
<li><a href="#_conclusion_5">Conclusion</a></li>
</ul>
</li>
<li><a href="#08-archetypes">8. Archetypes</a>
<ul class="sectlevel2">
<li><a href="#_focal_objects">Focal Objects</a></li>
<li><a href="#_archetypes">Archetypes</a></li>
<li><a href="#_structural_vs_auxiliary">Structural vs Auxiliary</a></li>
<li><a href="#_pre_configured_archetypes">Pre-configured Archetypes</a></li>
<li><a href="#_life_with_archetypes">Life with Archetypes</a></li>
<li><a href="#_archetypes_as_roles">Archetypes as Roles</a></li>
<li><a href="#_archetypes_as_meta_roles">Archetypes as Meta-roles</a></li>
<li><a href="#_assignment_relation">Assignment Relation</a></li>
<li><a href="#_future_of_archetypes">Future of Archetypes</a></li>
<li><a href="#_conclusion_6">Conclusion</a></li>
</ul>
</li>
<li><a href="#09-focus-processing">9. Focus Processing</a>
<ul class="sectlevel2">
<li><a href="#_object_templates">Object Templates</a></li>
<li><a href="#_automatic_role_assignment">Automatic Role Assignment</a></li>
<li><a href="#_generating_unique_identifiers">Generating Unique Identifiers</a></li>
<li><a href="#_combining_the_ingredients">Combining the Ingredients</a></li>
<li><a href="#_complete_deployment_example">Complete Deployment Example</a></li>
<li><a href="#_conclusion_7">Conclusion</a></li>
</ul>
</li>
<li><a href="#10-orgstruct">10. Organizational Structures</a>
<ul class="sectlevel2">
<li><a href="#_organizational_units">Organizational Units</a></li>
<li><a href="#_organizational_structure_hierarchy">Organizational Structure Hierarchy</a></li>
<li><a href="#_orgs_in_the_database">Orgs in the Database</a></li>
<li><a href="#_orgs_and_roles">Orgs and Roles</a></li>
<li><a href="#_multiple_organizational_structures">Multiple Organizational Structures</a></li>
<li><a href="#_archetypes_2">Archetypes</a></li>
<li><a href="#_managers">Managers</a></li>
<li><a href="#_relation">Relation</a></li>
<li><a href="#_assignment_relation_limitations">Assignment Relation Limitations</a></li>
<li><a href="#_beyond_users">Beyond Users</a></li>
<li><a href="#_organizational_structure_synchronization">Organizational Structure Synchronization</a></li>
<li><a href="#_organizational_structure_provisioning">Organizational Structure Provisioning</a></li>
<li><a href="#_focus_and_projection">Focus and Projection</a></li>
<li><a href="#_conclusion_8">Conclusion</a></li>
</ul>
</li>
<li><a href="#90-troubleshooting">11. Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#_designed_for_visibility">Designed for Visibility</a></li>
<li><a href="#_systematic_approach">Systematic Approach</a></li>
<li><a href="#_error_messages_and_operation_results">Error Messages and Operation Results</a></li>
<li><a href="#_logging_2">Logging</a></li>
<li><a href="#_auditing">Auditing</a></li>
<li><a href="#_troubleshooting_clockwork_and_projector">Troubleshooting Clockwork and Projector</a></li>
<li><a href="#_troubleshooting_mappings_and_expressions">Troubleshooting Mappings and Expressions</a></li>
<li><a href="#_troubleshooting_connectors">Troubleshooting Connectors</a></li>
<li><a href="#_troubleshooting_authorizations">Troubleshooting Authorizations</a></li>
<li><a href="#_reporting_a_bug">Reporting a Bug</a></li>
<li><a href="#_useful_troubleshooting_tips">Useful Troubleshooting Tips</a></li>
</ul>
</li>
<li><a href="#91-devel">12. MidPoint Development, Maintenance and Support</a>
<ul class="sectlevel2">
<li><a href="#_professional_development">Professional Development</a></li>
<li><a href="#_open_source">Open Source</a></li>
<li><a href="#_midpoint_release_cycle">MidPoint Release Cycle</a></li>
<li><a href="#_midpoint_support_and_subscriptions">MidPoint Support and Subscriptions</a></li>
<li><a href="#_midpoint_community">MidPoint Community</a></li>
</ul>
</li>
<li><a href="#92-additional-information">13. Additional Information</a>
<ul class="sectlevel2">
<li><a href="#_midpoint_documentation_site">MidPoint Documentation Site</a></li>
<li><a href="#_samples">Samples</a></li>
<li><a href="#_book_samples">Book Samples</a></li>
<li><a href="#_story_tests">Story Tests</a></li>
<li><a href="#_midpoint_mailing_list">MidPoint Mailing List</a></li>
<li><a href="#_evolveum_video_channel">Evolveum Video Channel</a></li>
<li><a href="#_evolveum_blog">Evolveum Blog</a></li>
<li><a href="#_social_networks">Social Networks</a></li>
</ul>
</li>
<li><a href="#98-to-be-continued">To Be Continued</a></li>
<li><a href="#_conclusion_9">Conclusion</a></li>
<li><a href="#_glossary">Glossary</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_colophon">Colophon</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Practical Identity Management With MidPoint<br>
by Radovan Semančík et al.<br>
Evolveum</p>
</div>
<div class="paragraph">
<p>Book revision: 2.3<br>
Publication date: 2024-11-19<br>
Corresponding midPoint version: 4.8.5</p>
</div>
<div class="paragraph">
<p><strong>© 2015-2024 Radovan Semančík and Evolveum, s.r.o. All rights reserved.</strong></p>
</div>
<div class="paragraph">
<p>This work is licensed under a<br>
<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</p>
</div>
<div class="paragraph">
<p>Major sponsoring for this book was provided by:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/evolveum-web.png" alt="Evolveum">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
It&#8217;s a dangerous business, Frodo, going out your door.
You step onto the road, and if you don&#8217;t keep your feet, there&#8217;s no knowing where you might be swept off to.
</blockquote>
<div class="attribution">
&#8212; Bilbo Baggins<br>
<cite>The Lord of the Rings by J.R.R. Tolkien</cite>
</div>
</div>
<div class="paragraph">
<p>Many years ago we started a project.
Because we had to.
Back then, we didn&#8217;t think too much about business and markets and things like that.
We were focused on technology.
The project started, and it simply went on.
It had its ups and downs – but all the time there was purpose, improvement and pure engineering passion.
The effort brought fruits, and now there is a product like no other: <em>midPoint</em>.</p>
</div>
<div class="paragraph">
<p>MidPoint is an identity governance and administration (IGA) platform.
It is a comprehensive and feature-rich system.
MidPoint can handle identity lifecycle management, identity governance and analytics.
It can speed up the process that create accounts for new employee, student or customer.
MidPoint can automatically disable accounts.
MidPoint manages assignment of roles and entitlements to employees, partners, agents, contractors, customers and students.
MidPoint make sure the policies are continually maintained and enforced.
It governs the processes of access certification (attestations).
It provides auditing and reporting based on the identity data.</p>
</div>
<div class="paragraph">
<p>Moreover, midPoint has one inherent advantage over the competing products: midPoint is completely <em>open source</em> platform.
Open source is the fundamental philosophy of midPoint.
We believe that <em>open source</em> is a critical aspect in the development of quality software.
Open source principles are guiding development of midPoint community: partners, contributors supporters and all the engineers that work with midPoint.
Open source character means that any engineer can completely understand how midPoint works.
It also means that midPoint can be modified as needed, that issues can be fixed quickly, and especially to ensure the continuity of midPoint development.
After all these years with midPoint, we simply cannot imagine using any identity technology which is not open source.</p>
</div>
<div class="paragraph">
<p>There are engineers in our team who have been dealing with identity management deployments since early 2000s.
The term "Identity and Access Management" (IAM) was not even invented back then.
We have seen a lot of IAM solutions during our careers.
Identity management system, such as midPoint, is the core of the vast majority of these solutions.
Identity management platform is the beating heart of IAM deployments.
We have designed midPoint specifically for that role.
When it is used by the right hands, midPoint can do miracles.
Which is exactly what this book is all about: the right use of midPoint to build a <em>practical</em> identity management solutions.</p>
</div>
<div class="paragraph">
<p>This book will tell you <em>how</em> to build and deploy identity management and governance solution.
It will also tell you <em>why</em> to do it in the first place.
The book will explain not just the features and configuration options.
It will also describe the <em>motivation</em> and the underlying <em>principles</em> of identity management.
Understanding the principles is as at least as important as knowing the mechanics of an identity management product.
The book describes <em>how</em> the things work, when they work.
It also tries to describe the limitations, drawbacks and pitfalls.
The limitations are often much more important than the features, especially when designing a new solution on a green field.</p>
</div>
<div class="paragraph">
<p>This book goes for quite a deep dive.
It explains <em>how</em>, it also explains <em>why</em>, it includes a lot of details.
It is meant for people that seek <em>deep understanding</em> of identity and access management.
This is the best way for some people, yet it may be quite challenging.
There may be easier ways to start with midPoint.
There are videos, trainings, and there is a <em>first steps</em> methodology designed especially for easy start with midPoint.
Therefore, if you want to start as quickly as possible, this book may not suit your needs.
However, if you want to really know what you are doing, you are at the right place.</p>
</div>
<div class="paragraph">
<p>The first chapter of this book is an introduction to the basic concepts of Identity and Access Management (IAM).
It is very general, and it does not deal with midPoint at all.
Therefore, if you are familiar with Identity and Access Management, feel free to skip the first chapter.
However, according to our experience, this chapter has some things to tell even to experienced IAM engineers.
This chapter contains important information to put midPoint in broader context.
You will need that information to build a complete IAM solution.</p>
</div>
<div class="paragraph">
<p>The second chapter describes midPoint <em>big picture</em>.
It shows how midPoint looks like from the outside.
It describes how midPoint what midPoint does, how it behaves.
The purpose of this chapter is to familiarize the reader with midPoint workings and basic principles.
It describes how midPoint is <em>used</em>.</p>
</div>
<div class="paragraph">
<p>The third chapter describes basic concepts of midPoint <em>configuration</em>.
It guides the reader through midPoint <em>installation</em>.
It describes how midPoint is customized, to suit the needs of a particular deployment.
However, midPoint customization is a very complex matter, therefore this chapter describes just the basic principles.
It will take most of the book to fill in the details.</p>
</div>
<div class="paragraph">
<p>The fourth chapter describes the concepts of <em>identity resource</em> and <em>mappings</em>.
This is the bread-and-butter of identity management.
This chapter will tell you how to create very basic midPoint deployment, how to connect target systems and how to map and transform the data.</p>
</div>
<div class="paragraph">
<p>The fifth chapter is all about <em>synchronization</em>.
Primary purpose of synchronization is to get the data from the source systems (such as HR system) to midPoint.
However, midPoint synchronization is much more powerful than that, as you will see.
This chapter also expands the explanation of underlying midPoint principles such as mappings and deltas.</p>
</div>
<div class="paragraph">
<p>The sixth chapter talks about midPoint <em>schema</em>.
MidPoint has a built-in identity data model.
Even though this data model is quite rich, it is usually not sufficient to cover all the real-world use cases.
Therefore, the data model is designed to be extensible.
This chapter describes the methods how a new data items can be defined in midPoint schema.</p>
</div>
<div class="paragraph">
<p>The seventh chapter is all about <em>role-based access control</em> (RBAC).
MidPoint role-based model is a very powerful tool to set up complex structures describing job roles, responsibilities, privileges and so on.
The role model, and especially the concept of assignment, are generic mechanisms that are used in almost every part of midPoint.
Organizational structure management and many identity governance features are built on the foundations described in this chapter.</p>
</div>
<div class="paragraph">
<p>The eighth chapter is an introduction to <em>object templates</em>.
Those templates form a basis of an internal data consistency in midPoint.
They can be used to set up simple policies and automation rules.
Object templates are a basic workhorse that is used in almost all midPoint deployments.</p>
</div>
<div class="paragraph">
<p>The ninth chapter describes <em>organizational structures</em>.
MidPoint organizational structure mechanisms are generic and very powerful.
They can be used to model traditional organizational hierarchies, arbitrary trees, and even structures that are not exactly trees.
The same mechanism can be used to set up projects, teams, workgroups, classes or almost any conceivable grouping concept.
This chapter describes how organizational structures are synchronized with the outer world.
The concept of <em>generic synchronization</em> can be applied to synchronize midPoint objects with almost any external data structure.</p>
</div>
<div class="paragraph">
<p>The tenth chapter is about <em>troubleshooting</em>.
To err is human.
Given all the flexibility of midPoint mechanisms, configuration mistakes just happen, and it may not be easy to figure out the root cause of problems.
Therefore, this chapter provides an overview of midPoint diagnostic facilities and recommendations for their use.</p>
</div>
<div class="paragraph">
<p>The eleventh chapter provides overview of midPoint <em>development</em> process and overall approach.
It is also explained how midPoint development is funded and how midPoint subscriptions work.</p>
</div>
<div class="paragraph">
<p>The twelfth chapter is a collection of pointers to <em>additional information</em>.
This includes a pointer to sample files that accompany this book.</p>
</div>
<div class="paragraph">
<p>Finally, there is a <em>glossary</em>, explaining all the strange and confusing terms used in identity management and governance field.</p>
</div>
<div class="paragraph">
<p>The other chapters are not written yet.
The description of policies, entitlements, authorizations, archetypes, deployment practices and all the other advanced topics is missing.
This book is not finished yet.
Just like midPoint itself, this book is written in an incremental and iterative way.
Writing a good book is a huge task in itself, and it takes a lot of time.
We cannot dedicate that much time to writing the book in one huge chunk.
Obviously, a book like this is needed for midPoint community.
Therefore, we have decided not to wait until the book is complete.
We will be continuously publishing those chapters that are reasonably well finished.
It is better to have something than to have nothing, isn’t it?
Please be patient.
The whole book will be finished eventually.
As always, your support, contributions and sponsoring may considerably speed up things here</p>
</div>
<div class="paragraph">
<p>Even though the first version of this book was published in 2015, we are regularly updating the book to reflect new midPoint versions as well as changes in IT environment and trends.
Similarly to midPoint itself, the book has to be kept up-to-date to deliver value.
The book is usually reviewed at the time new long-term-support (LTS) version of midPoint is released.</p>
</div>
<div class="paragraph">
<p>We would like to thank all the midPoint developers, contributors and supporters.
There was a lot of people involved in midPoint during all these years.
All these people pushed midPoint forward.
Most of all, we would like to thank the people that were there when the midPoint project was young, people that set midPoint on its path.
We would like to thank Katka Stanovská, Katka Bolemant (née Valaliková), Igor Farinič, Ivan Noris, Vilo Repáň, Pavol Mederly and Radovan Semančík.</p>
</div>
<div class="paragraph">
<p>Anything that is stated in this book are the opinions of the authors.
We have tried really hard to remain objective.
However, as hard as we might try, some points of view are difficult to change.
We work for Evolveum – a company that is also an independent software vendor.
Therefore, our opinions may be slightly biased.
We have honestly tried to avoid any biases and follow proper engineering practices.
You are the judge and the jury in this matter.
You, the reader, will decide whether we have succeeded or not.
You have free access to all the necessary information to do that: this book is freely available as is all the midPoint documentation and the source code.
We are not hiding anything.
Unlike many other vendors, we do not want or need to hide any aspect of the software we are producing.</p>
</div>
<div class="paragraph">
<p>This work is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License (CC&#160;BY-NC-ND).
This essentially means that you can freely use this book for a personal use.
You can retrieve and distribute it at no cost.
You can use this book freely to learn about midPoint.
However, you are not allowed to sell it, modify it or use any parts of this book in commercial projects.
You can point to this book by URL, but you are not allowed to pass this book to the customer as a part of product documentation in a commercial project.
You are not allowed to use this book as material during commercial training.
You are not allowed use the book in any way that generates profit.
If you need to use this book in such a way, please contact Evolveum, and you can obtain special license to do this.
The license fees collected in this way will be used to improve midPoint and especially midPoint documentation.
There is no direct profit that we make from this book.
The primary reason for writing this book is spreading knowledge about midPoint.
However, even open source projects such as midPoint need funding.
If you use midPoint in a commercial project that is a source of profit we think it is only fair if you share part of that profit with midPoint authors.
You know as well as we do that this is needed.</p>
</div>
<div class="paragraph">
<p>Following people have worked on the words and images that make up this book:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Radovan Semančík (author and maintainer)</p>
</li>
<li>
<p>Veronika Kolpaščiková (illustrations, corrections)</p>
</li>
<li>
<p>Richard Richter (corrections, suggestions)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Yet there is much more people whose work was needed to make this work happen: midPoint developers, contributors, analysts and deployment engineers, specialists and generalists, theoretical scientists and practical engineers, technical staff and business people, people of Evolveum and the people that work for our partners, our families, friends and all the engineers and scientists for generations and generations past.
We indeed stand on the shoulders of giants.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="01-idm-intro">1. Understanding Identity and Access Management</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
The beginning of knowledge is the discovery of something we do not understand.
</blockquote>
<div class="attribution">
&#8212; Frank Herbert
</div>
</div>
<div class="paragraph">
<p>What is identity and access management?
Answer to that question is both easy and complex.
The easy part is: identity and access management (IAM) is a set of information technologies that deal with identities in the cyberspace.
The complex part of the answer takes the rest of this book.</p>
</div>
<div class="paragraph">
<p>The story of identity and access management starts with information security.
The security requirements dictate the need for authentication and authorization of the users.
Authentication is a mechanism by which the computer checks that the user is really the one they pretend to be.
Authorization is a related mechanism by which the computer determines whether to allow or deny the user a specific action.
Almost every computer system has some means of authentication and authorization.</p>
</div>
<div class="paragraph">
<p>Perhaps the most widespread form of authentication is a password-based "log in" procedure.
The user presents an identifier and a password.
The computer checks whether the password is valid.
For this procedure to work the computer needs access to the database of all valid users and passwords.
Early stand-alone information systems had their own databases that were isolated from the rest of the cyberspace.
The data in the database were maintained manually.
However, the advent of computer networking changed everything.
Users were able to access many systems, and the systems themselves were connected to each other.
Maintaining an isolated user database in each system did not make much sense any longer.
That&#8217;s where the real story of digital identity begins.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Enterprise Identity and Access Management</div>
This book deals mostly with <em>Enterprise Identity and Access Management</em>.
That is identity and access management applied to larger organizations such as enterprises, financial institutions, government agencies, universities, health care organizations, etc.
The focus is on managing employees, contractors, customers, partners, students and other people that cooperate with the organization.
However, many of the mechanisms and principles described in this book can be applied to non-enterprise environments.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_directory_services_and_other_user_databases">Directory Services and Other User Databases</h3>
<div class="paragraph">
<p>The central concept of identity management is a data record which contains information about a person.
This concept has many names: <em>user profile</em>, <em>persona</em>, <em>user record</em>, <em>digital identity</em> and many more.
The most common name in the context of identity management is <em>user account</em>.
Accounts usually hold information that describes the real-world person using a set of attributes such as given name and family name.
However, probably the most important part of the <em>account</em> is the technical information that relates to the operation of an information system for which the account is created.
This includes operational parameters such as location of user&#8217;s home directory, wide variety of permission information such as group and role membership, system resource limits and so on.
User accounts are represented in a wide variety of forms, ranging from relational database records through structured data files to semi-structured text files.
Regardless of the specific method used to store and process the records, the <em>account</em> is undoubtedly one of the most important concepts of IAM field - and so are the databases where the <em>accounts</em> are stored.</p>
</div>
<div class="paragraph">
<p>The account databases are as varied as the account types.
Most account databases in the past were implemented as an integral part of the monolithic information system using the same database technology as the system used.
This is an obvious choice, and it remains quite popular even today.
Therefore, many accounts are stored in relational database tables and similar application data stores.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-01-applications.png" alt="Applications">
</div>
</div>
<div class="paragraph">
<p>Application data stores are usually tightly bound to the application.
Therefore, accounts stored in such databases are difficult to share with other applications.
However, sharing account data across the organization is more than desirable.
It makes very little sense to maintain account data in each database separately – especially if most the accounts are the same in each application.
Therefore, there is a strong motivation to deploy account databases that can be shared by many applications.</p>
</div>
<div class="paragraph">
<p><em>Directory servers</em> are built with the primary purpose to provide shared data storage to applications.
While application databases usually use their own proprietary communication protocol, directory servers implement standardized protocols.
While databases are built for application-specific data model, directory servers usually extend standardized data model, which improves interoperability.
While databases may be heavyweight and expensive to scale, directory servers are designed to be lightweight and provide massive scalability.
That makes directory servers almost ideal candidates for a shared account database.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-02-directory-server.png" alt="Directory server">
</div>
</div>
<div class="paragraph">
<p>Shared identity store is making user management easier.
An account needs to be created and managed in one place only.
Authentication still happens in each application separately.
Yet, as the applications use the same credentials from the shared store, the user may use the same password for all the connected applications.
This is an improvement over setting the password for each application separately.</p>
</div>
<div class="paragraph">
<p>Identity management solutions based on shared directory servers are simple and quite cost-efficient.
Therefore, we have been giving the same advice for many years: if you can connect all your applications to an LDAP directory server, do not think too much about it and just do it.
The problem is that this usually works only for very simple systems.</p>
</div>
<div class="sect3">
<h4 id="_lightweight_directory_access_protocol_ldap">Lightweight Directory Access Protocol (LDAP)</h4>
<div class="paragraph">
<p>Lightweight Directory Access Protocol (LDAP) is a standard protocol for accessing directory services.
It is an old protocol, when judging by Internet age standards.
LDAP roots go as far back as 1980s to a family of telecommunication protocols known as X.500.
Even though LDAP may be old, it is widely used.
It is a very efficient binary protocol that was designed to support massively distributed shared databases.
It has a small set of well-defined simple operations.
The operations and the data meta-model implied by the protocol allow very efficient data replication and horizontal scalability of directory servers.
This simplicity contributes to low latencies and high throughput for read operations.
The horizontal scalability and relative autonomy of directory server instances is supposed to increase the availability of the directory system.
These benefits often come at the expense of slow write operations.
As identity data are often read but seldom modified, slower writes are usually a perfectly acceptable trade-off.
Therefore, LDAP-based directory servers were, and in many places still remain, the most popular databases for identity data.</p>
</div>
<div class="paragraph">
<p>LDAP is one of the precious few established standards in the IAM field.
However, it is far from being perfect.
LDAP was created in 1990s, with roots going back to 1980s.
There are some problems in original LDAP design, that were never fully addressed.
Also, LDAP schema has a distinctive feel of 80s and 90s.
LDAP would deserve a major review, to correct the problems and bring the protocol to 21<sup>st</sup> century.
Sadly, there hasn&#8217;t been a major update to LDAP specifications for decades.</p>
</div>
<div class="paragraph">
<p>Even though LDAP has its problems, it still remains a useful tool.
Most LDAP server vendors provide proprietary solutions to LDAP problems.
Many organizations store identities in LDAP-enabled data stores.
There are many applications that support LDAP, mostly for centralization of password-based authentication.
LDAP still remains a major protocol in Identity and Access Management field.
Therefore, we will be getting back to the LDAP protocol many times in this book.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_directory_servers_are_databases">Directory Servers are Databases</h3>
<div class="paragraph">
<p>Directory servers are just databases that store information.
Nothing more.
The protocols and interfaces (APIs) used to access directory servers are designed as database interfaces.
They are good for <em>storing, searching and retrieving</em> data.
While the <em>user account</em> data often contain entitlement information (permissions, groups, roles, etc.), directory servers are not well-suited to <em>evaluate</em> them.
I.e. directory server can provide information what permissions an account has, but it is not designed to make a <em>decision</em> whether to allow or deny a specific operation.
Also, directory servers do not contain data about user <em>sessions</em>.
Directory servers do not know whether the user is currently logged in or not.
Many directory servers are used for basic authentication and even authorization.
Yet, the directory servers were not designed to do this.
Directory servers provide only the very basic capabilities.
There are plug-ins and extensions that provide partial capabilities to support authentication and authorization.
However, that does not change the fundamental design principles.
Directory servers are databases, not authentication or authorization servers.
Being databases, they should be used as such.</p>
</div>
<div class="paragraph">
<p>However, many applications use directory servers to centralize password authentication.
In fact, this is somehow good and cost-efficient way to centralize password-based authentication, especially if you are just starting with identity and access management.
Nevertheless, you should be aware that this a temporary solution.
It has many limitations.
The right way to do it is to use an <em>authentication server</em> instead of directory server.
Access Management (AM) technologies can provide that.</p>
</div>
<div class="sect3">
<h4 id="_single_directory_server_myth">Single Directory Server Myth</h4>
<div class="paragraph">
<p>Now listen, this is a nice and simple idea: Let&#8217;s keep all our user data in a single directory server.
All our applications can access the data there, all the applications will see the same data.
We even have this "LDAP" thing, standardized protocol to access the database.
Here, all identity management problems are solved!</p>
</div>
<div class="paragraph">
<p>Unfortunately, they are not.
Shared directory server makes user management easier.
However, this is not a complete solution, and there are serious limitations to this approach.
The heterogeneity of information systems makes it nearly impossible to put all required data into a single directory system.</p>
</div>
<div class="paragraph">
<p>The obvious problem is the lack of a single, coherent source of information.
There are usually several sources of information for a single user.
For example, a human resources (HR) system is authoritative for the existence of an employee in the enterprise.
However, the HR system is usually not authoritative for assignment of employee identifier such as <em>username</em>.
There needs to be an algorithm that ensures uniqueness of the username, ensuring uniqueness across all the current and past employees, contractors and partners.
Moreover, there may be additional sources of information.
For example Management information system may be responsible for determination of user&#8217;s roles (e.g. in project-oriented organizational structure).
Inventory management system may be responsible for assigning telephone number to the user.
The groupware system may be an authoritative source of the user&#8217;s e-mail address and other electronic contact data.
There are usually 2 to 20 systems that provide authoritative information for a single user.
Therefore, there is no simple way how to feed and maintain the data in the directory system.</p>
</div>
<div class="paragraph">
<p>Then there are spacial and technological barriers.
Many complex applications need local user database.
They must store the copies of user records in their own databases to operate efficiently.
For example, large billing systems cannot work efficiently with external data (e.g. because of a need to make relational database <em>join</em>).
Therefore, even if directory server is deployed, these applications still need to maintain a local copy of identity data.
Keeping the copy synchronized with the directory data may seem like a simple task.
But it is not.
Additionally, there are legacy systems which usually cannot access the external data at all (e.g. they do not support LDAP protocol at all).</p>
</div>
<div class="paragraph">
<p>Some services need to keep even more state than just a simple database record.
For example file servers usually create home directories for users.
While the account creation can be usually done in on-demand fashion (e.g. create user directory at first user log-on), the modification and deletion of the account is much more difficult.
Directory server will not do that.</p>
</div>
<div class="paragraph">
<p>Perhaps the most painful problem is the complexity of access control policies.
Role names and access control attributes may not have the same meaning in all systems.
Different systems usually have different authorization algorithms that are not mutually compatible.
While this issue can be solved with per-application access control attributes, the maintenance of these attributes is seldom trivial.
If every application has its own set of attributes to control access control policies, then the centralized directory provides only a negligible advantage.
The attributes may as well reside in the applications themselves.
That&#8217;s exactly how most directory deployments end up.
Directory servers contain only the groups, groups that usually roughly approximate low-level RBAC roles.</p>
</div>
<div class="paragraph">
<p>Quite surprisingly, LDAP standards themselves create a significant obstacle to interoperability in this case.
There are at least three or four different - and incompatible - specifications for group definition in LDAP directories.
Moreover, the usual method to manage LDAP groups is not ideal at all.
It is especially problematic when managing big groups.
Therefore, many directory servers provide their own non-standard improvements, which further complicates interoperability.
Yet even these server-specific improvements usually cannot support complex access control policies.
Therefore, access control policies and fine-grained authorizations are usually not centralized in directory servers, they are maintained directly in the application databases.</p>
</div>
<div class="paragraph">
<p>The <em>single directory approach</em> is feasible only in very simple environments or in almost entirely homogeneous environments.
In all other cases there is a need to supplement the solution by other identity management technologies.</p>
</div>
<div class="paragraph">
<p>This does not mean that the directory servers or other shared databases are useless.
Quite the contrary.
They are very useful if they are used correctly.
They just cannot be used alone.
More components are needed to build a complete solution.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_access_management">Access Management</h3>
<div class="paragraph">
<p>While directory systems are not designed to handle complex authentication, <em>access management</em> (AM) systems are built to handle just that.
Access management systems handle all the flavors of authentication, and even some authorization aspects.
The principle of all access management systems is basically the same:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access management system gets between the user and the target application.
This can be done by a variety of mechanisms, the most common method is that the applications themselves redirect the user to the AM system if they do not have existing session.</p>
</li>
<li>
<p>Access management system prompts user for the username and password, interacts with user&#8217;s mobile device or in any other way initiates the authentication procedure.</p>
</li>
<li>
<p>User enters the credentials.</p>
</li>
<li>
<p>Access management system checks the validity of credentials and evaluates access policies.</p>
</li>
<li>
<p>If access is allowed then the AM system redirects user back to the application.
The redirection usually contains an access token: a small piece of information that tells the application that the user is authenticated.</p>
</li>
<li>
<p>Application validates the token, creates a local session and allows the access.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-03-am-flow.png" alt="Access management flow">
</div>
</div>
<div class="paragraph">
<p>After that procedure, the user works with the application normally.
Only the first access goes through the AM server.
This is important for AM system performance and sizing, and it impacts session management functionality.</p>
</div>
<div class="paragraph">
<p>The applications only need to provide the code that integrates with the AM system.
Except for that small integration code, applications do not need to implement any authentication code at all.
It is the AM system that prompts for the password, not the application.
This is a fundamental difference when compared to LDAP-based authentication mechanisms.
In the LDAP case, it is the application that prompts for the password.
In the AM case, the Access Management server does everything.
Many applications do not even care how the user was authenticated.
All they need to know is that he <em>was</em> authenticated and that the authentication was strong enough.
This feature brings a very desirable flexibility to the entire application infrastructure.
The authentication mechanism can be changed at any time without disrupting the applications.
We live in an era when passwords are frowned upon and replaced by stronger authentication mechanisms.
The flexibility that the AM-based approach brings may play a key part in that migration.</p>
</div>
<div class="sect3">
<h4 id="_web_single_sign_on">Web Single Sign-On</h4>
<div class="paragraph">
<p>Single Sign-On (SSO) systems allow user to authenticate once, and access number of different systems re-using that authentication.
There are many SSO systems for web applications, however it looks like these systems are all using the same basic principle of operation.
The general access management flow is described below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Application <code>A</code> redirects the user to the access management server (SSO server).</p>
</li>
<li>
<p>The access management server authenticates the user.</p>
</li>
<li>
<p>The access management server establishes session (SSO session) with the user browser.
This is crucial part of SSO mechanism.</p>
</li>
<li>
<p>User is redirected back to application <code>A</code>.
Application <code>A</code> usually establishes a local session with the user.</p>
</li>
<li>
<p>User interacts with application <code>A</code>.</p>
</li>
<li>
<p>When user tries to access application <code>B</code>, it redirects user to the access management server.</p>
</li>
<li>
<p>The access management server checks for existence of SSO session.
As the user authenticated with the access management server before, there is a valid SSO session.</p>
</li>
<li>
<p>Access management server does not need to authenticate the user again, it immediately redirects user back to application <code>B</code>.</p>
</li>
<li>
<p>Application <code>B</code> establishes a local session with the user and proceeds normally.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The user usually does not even realize that there were any redirects when accessing application <code>B</code>.
There is no interaction between the redirects, and the processing on the access management server is usually very fast.
It looks like the user was logged into the application <code>B</code> all the time.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-04-web-sso-flow.png" alt="Web SSO flow">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authorization_in_access_management">Authorization in Access Management</h4>
<div class="paragraph">
<p>The request of a user accessing an application is directly or indirectly passed through the access management server.
Therefore, the access management server can analyze the request and evaluate whether the user request is authorized or not.
That is a theory.
Unfortunately, the situation is much more complicated in practice.</p>
</div>
<div class="paragraph">
<p>The AM server usually intercepts only the first request to access the application, because it would be a performance impact to intercept all the requests.
After the first request, the application established a local session and proceeds with the operation without any communication with the AM server.
Therefore, the AM server can only enforce authorization during the first request.
This means it can only enforce a very <em>coarse-grained</em> authorization decisions.
In practice, it usually means that the AM server can make only all-or-nothing authorization decisions: whether a particular user can access all parts of a particular application or that he cannot access the application at all.
The AM server usually cannot make any finer-grain decisions just by itself.</p>
</div>
<div class="paragraph">
<p>Some AM systems provide agents that can be deployed to applications, agents that enforce a finer-grain authorization decisions.
Such agents often rely on HTTP communication.
They are making decisions based on the URLs that the user is accessing.
This approach might have worked well in the 1990s, but it has only very limited applicability in the age of single-page web applications and mobile applications.
In such cases the authorization is usually applied to <em>services</em> rather than <em>applications</em>.</p>
</div>
<div class="paragraph">
<p>However, even applying the authorization to service front-ends does not solve the problem entirely.
Sophisticated applications often need to make authorization decisions based on context, which is simply not available in the request or user profile at all.
E.g. an e-banking application may allow or deny a transaction based on the sum of previous transactions that were made earlier that day.
While it may be possible to synchronize all the authorization information into the user profile, it is usually not desirable.
It would be a major burden to keep such information updated and consistent, not to mention security and privacy concerns.
Many authorization schemes rely on a specific business logic, which is very difficult to centralize in an authorization server.</p>
</div>
<div class="paragraph">
<p>Then there are implementation constraints.
In theory, the authorization system should make only allow/deny decisions.
However, this is not enough to implement an efficient application.
The application cannot afford to list all the objects in the database, pass them to authorization server, and then realize that the authorization server denied access to almost all of them.
Authorization has to be processed <em>before</em> the search operation, and additional search filters have to be applied.
Which means that authorization mechanisms need to be integrated deep into the application logic.
This significantly limits the applicability of centralized authorization mechanisms.</p>
</div>
<div class="paragraph">
<p>AM systems often come with a promise to unify authorization across all the applications and to centralize management of organization-wide security policies.
Unfortunately, such broad promises are seldom fulfilled.
The AM system can theoretically evaluate and enforce some authorization statements.
This may work well during demonstrations and even in very simple deployments.
Yet in complex practical deployments, this capability is extremely limited.
The vast majority of the authorization decisions is carried out by each individual application and is completely outside the reach of an AM system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_saml_and_openid_connect">SAML and OpenID Connect</h4>
<div class="paragraph">
<p>Some access management systems use proprietary protocols to communicate with the applications and agents.
This is obviously an interoperability issue – especially when the AM principles are used in the Internet environment.
Indeed, it is the Internet that motivated standardization in this field.</p>
</div>
<div class="paragraph">
<p>The first widespread standardized protocol in this field was Security Assertion Markup Language (SAML).
The original intent of SAML was to allow cross-domain sign-on and identity data sharing across organizations on the Internet.
SAML is both an access management protocol and a security token format.
SAML is quite complex, heavily based on XML standards.
Its specifications are long, divided into several profiles, there are many optional elements and features.
Overall, SAML is not just a protocol, it is a set of very rich and flexible mechanisms.</p>
</div>
<div class="paragraph">
<p>Primary purpose of SAML is transfer of identity information between organizations.
There are big SAML-based federations with hundreds of participating organizations.
Many e-government solutions are based on SAML, there are big partner networks running on SAML, and overall it looks like SAML is a success.
Yet, SAML was a victim of its own flexibility and complexity.
The latest fashion trends are not very favorable to SAML.
XML and SOAP-based web service mechanisms are hopelessly out of fashion, which impacts popularity of SAML.
That has probably motivated the inception of other access management protocols.</p>
</div>
<div class="paragraph">
<p>The latest fashion still favors RESTful services and simpler architectural approaches.
That probably contributed to the development of OpenID Connect protocol (OIDC).
OpenID Connect is based on much simpler mechanisms than SAML, but it is reusing the same basic principles.
OpenID connect has a very eventful history.
It all started with a bunch of homebrew protocols such as LID or SXIP, that are mostly forgotten today.
That was followed by the development of OpenID protocol, which was still very simple.
OpenID gained some attention especially with providers of Internet services.
Despite its simplicity, OpenID was not very well engineered, and it quickly reached its technological limits.
It was obvious that OpenID needs to be significantly improved.
At that time, there was almost unrelated protocol called OAuth, which was designed for management of cross-domain authorizations.
That protocol was developed into something that was almost, but not quite, entirely unlike the original OAuth protocol.
As the new protocol had almost nothing to do with the original OAuth protocol, it is perfectly understandable that it was dubbed OAuth2.
In fact, OAuth2 is not really a protocol at all.
It is rather a vaguely-defined framework to build other protocols.
OAuth2 framework was used to build a cross-domain authentication and user profile protocol.
This new protocol is much more similar to SAML than to the original OpenID, therefore it was an obvious choice to call it <em>OpenID Connect</em>.
Some traditions are just worth maintaining.</p>
</div>
<div class="paragraph">
<p>Now there are two protocols that are using the same principle and doing almost the same thing: SAML and OpenID Connect.
The principle of both protocols is illustrated in the following diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-05-saml-oidc-flow.png" alt="SAML/OIDC flow">
</div>
</div>
<div class="paragraph">
<p>The interaction goes like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>User is accessing a resource.
This can be web page or web application running on the target site.</p>
</li>
<li>
<p>Target site does not have a valid session for the user.
Therefore, it redirects user browser to the source site.
It adds authentication <em>request</em> into that redirect.</p>
</li>
<li>
<p>Browser follows the redirect to the source site.
The source site gets the authentication <em>request</em> and parses it.</p>
</li>
<li>
<p>If the user is not already authenticated with the source site then the authentication happens now.
The source site prompts for the username, password, certificate, one-time password or whatever credential that is required by the policy.
With a bit of luck the authentication succeeds.</p>
</li>
<li>
<p>The source site redirects the browser back to the target site.
The source site adds authentication <em>response</em> to the redirect.
The most important part of the response is a <em>token</em>.
The token directly or indirectly asserts user&#8217;s identity.</p>
</li>
<li>
<p>The target site parses the authentication <em>response</em> and processes the token.
The token may be just a reference (e.g. SAML artifact) pointing to real data, or it may be access key to another service that provides the data (OIDC UserInfo).
In that case the target site makes another request (6a).
This request is usually a direct one and does not use browser redirects.
One way or another, the target site now has claims about user identity.</p>
</li>
<li>
<p>Target site evaluates the identity, processes authorizations and so on.
A local session with the user is usually established at this point to skip the authentication redirects on the next request.
The target site finally provides the content.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Following table compares the terminology and technologies used in SAML and OIDC worlds.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">SAML World</th>
<th class="tableblock halign-left valign-top">OpenID Connect World</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Source site</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identity Provider (IdP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identity Provider (IDP) or OpenID Provider (OP)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Target site</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Provider (SP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relying Party (RP)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Token reference</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAML Assertion (or artifact)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID token, access token</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Token format</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAML Token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON Web Token (JWT)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Intended for</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web applications, web services (SOAP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web applications, mobile applications, REST services</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Based on</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth2</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Data representation</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Cryptography framework</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">XMLenc, XMLdsig</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON Object Signing and Encryption (JOSE)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Careful reader surely noticed the similarity with the web-based access management mechanisms.
That&#8217;s right.
This is the same wheel, reinvented over and over again.
However, to be completely honest, we have limited our description to cover flows intended for web browser only.
Both SAML and OIDC has broader applicability that just web browser flows.
The differences between the two protocols are much more obvious in these extended use cases.
However, the web browser case nicely illustrates the principles and similarities of SAML, OpenID Connect and also the simple web-SSO systems.</p>
</div>
<div class="paragraph">
<p>Maybe the most important differences between SAML, OIDC and web-SSO (also known as <em>Web Access Management</em> or WAM) systems is the intended use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SAML was designed for the web applications and SOAP web services world.
It will handle centralized (single-IDP) scenarios very well, but it can also work in decentralized federations.
Go for SAML if you are using SOAP and WS-Security or if you plan to build big decentralized federation.
On second thought, you should probably forget about SAML anyway.
It is not very fashionable these days.</p>
</li>
<li>
<p>OpenID Connect was designed mostly for use with social networks and similar Internet services.
Its philosophy is still somehow centralized.
It will work well if there is one strong identity provider and many relying parties.
Technologically it will fit into RESTful world much better than SAML.
Current fashion trends are favorable to OIDC.</p>
</li>
<li>
<p>Web-SSO/WAM systems are designed to be used inside a single organization.
This is ideal to implement SSO between several customer-facing applications so the customers will have no idea that they interact with many applications and not just one.
The web-SSO/WAM systems are not designed to work across organizational boundaries.
Which is quite unfortunate in the current "cloudy" IT environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although SAML and OIDC are designed primarily for cross-domain use, it is no big surprise to see them inside a single organization.
There is a clear benefit in using an open standardized protocol instead of a proprietary mechanism.
However, it has to be expected that the SSO system based on SAML or OIDC will have slightly more complicated setup than a simple Web-SSO/WAM system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kerberos_enterprise_sso_and_friends">Kerberos, Enterprise SSO and Friends</h4>
<div class="paragraph">
<p>Many of us would like to think that everything is based on web technologies today, and that non-web mechanisms are things of the past.
Yet, there are still systems that are not web-based and where web-based SSO and AM mechanisms will not work.
There are still some legacy applications, especially in the enterprise environment - applications based on rich clients or even character-based terminal interactions.
Then there are network operating systems such as Windows and numerous UNIX variants and there are network access technologies such as VPN or 802.1X.
There are still many cases where web-based access management and SSO simply won&#8217;t work.
These technologies usually pre-date the web.
Honestly, the centralized authentication and single sign-on are not entirely new ideas.
It is perhaps no big surprise that there are authentication and SSO solutions even for non-web applications.</p>
</div>
<div class="paragraph">
<p>The classic classroom example of non-web SSO system is <em>Kerberos</em>.
The protocol originated at MIT in the 1980s.
It is a single sign-on protocol for operating systems and rich clients based on symmetric cryptography.
Even though it is a cryptographic protocol, it is not too complicated to understand, and it definitely withstood the test of time.
It has been used to this day, especially for authentication and SSO of network operating systems.
It is a part of Windows network domain, and it is often the preferred solution for authentication of UNIX servers.
The most serious limitation of Kerberos is given by its use of symmetric cryptography.
The weakness of symmetric cryptography is key management.
Kerberos key management can be quite difficult especially when Kerberos realm gets very big.
Key management is also one of the reasons why it is not very realistic to use Kerberos in cross-domain scenarios.
However inside a closed organization, Kerberos is still a very useful solution.</p>
</div>
<div class="paragraph">
<p>The major drawback in using Kerberos is that every application and client needs to be "kerberized".
In other words everybody that wants to take part in Kerberos authentication needs to have Kerberos support in one&#8217;s software.
There are kerberized versions of many network utilities so this is usually not a problem for UNIX-based networks.
However, it is a big problem for generic applications.
There is some support for Kerberos in common web browsers which is often referred to as "SPNEGO".
However, this support is usually limited to interoperability with Windows domains.
Even though Kerberos is still useful for operating system SSO, it is not a generic solution for all applications.</p>
</div>
<div class="paragraph">
<p>Many network devices use <em>RADIUS</em> protocol for what network engineers call "Authentication, Authorization and Accounting" (AAA).
However, RADIUS is a back-end protocol.
It does not take care of client interactions.
The goal of RADIUS is that the network device (e.g. WiFi access point, router or VPN gateway) can validate user credentials that it has received as part of other protocol.
The client connecting to VPN or WiFi network does not know anything about RADIUS.
Therefore, RADIUS is similar to the LDAP protocol, and it is not really an access management technology.</p>
</div>
<div class="paragraph">
<p>Obviously there is no simple and elegant solution that can provide SSO for all enterprise applications.
Despite that one technology appeared in the 1990s and early 2000s and promised to deliver universal enterprise SSO solution.
It was called "Enterprise Single Sign-On" (ESSO).
The ESSO approach was to use agents installed on every client device.
The agent detects when login dialog appears on the screen, fills in the username and password and submits the dialog.
If the agent is fast enough the user does not even notice the dialog and this creates the impression of Single Sign-On.
However, there are obvious drawbacks.
The agents need to know all the passwords in a cleartext form.
There are ESSO variations with passwords randomly generated or even single-user passwords which partially alleviates this problem.
In that case there is an additional drawback that the ESSO also needs to be integrated with password management of all the applications, which is not entirely easy.
However, the most serious drawback of ESSO are the agents.
These only work on workstations that are strictly controlled by the enterprise.
Yet the world is different now, enterprise perimeter has efficiently disappeared, and the enterprise cannot really control all the client devices.
Therefore, also ESSO is now mostly a thing of the past.</p>
</div>
</div>
<div class="sect3">
<h4 id="_access_management_and_the_data">Access Management and the Data</h4>
<div class="paragraph">
<p>Access Management servers and identity providers need to know the data about users to work properly.
However, it is quite complicated.
The purpose of access management systems is to manage access of users to the applications.
Which usually means processing authentication, authorization (partially), auditing of the access and so on.
For this to work, the AM system needs access to the database where the user data are stored.
It needs access to usernames, passwords and other credentials, authorization policies, attributes and so on.
The AM systems usually do not store these data themselves.
They rely on external data stores.
In most cases, these data stores are directory services or noSQL databases.
This is an obvious choice: these databases are lightweight, highly available and extremely scalable.
The AM system usually need just simple attributes, therefore the limited capabilities of directories and NoSQL databases are not a limiting factor here.
Marriage of access management and lightweight database is an obvious and very smart match.</p>
</div>
<div class="paragraph">
<p>However, there is one critical issue – especially if the AM system is also used as a single sign-on server.
The data in the directory service and the data in the applications must be consistent.
E.g. it is a huge problem if one user has different usernames in several applications.
Which username should he use to log in?
Which username should be sent to the applications?
There are ways how to handle such situations, but this is usually very cumbersome and expensive.
It is much easier to unify the data before the AM system is deployed.</p>
</div>
<div class="paragraph">
<p>Even though the "M" in AM stands for "management", typical AM system has only a very limited data management capabilities.
The AM systems usually assume that the underlying user database is already properly managed.
E.g. a typical AM system has only a very minimalistic user interface to create, modify and delete user records.
Some AM systems may have self-service functionality (such as password reset), but even that functionality is usually very limited.
Even though the AM relies on the fact that the data in the AM directory service and the data in applications are consistent, there is usually no way how to fully synchronize the data by using the AM system itself.
There may be methods for on-demand or opportunistic data updates, e.g. creating user record in the database when the user logs in for the first time.
However, there are usually no solutions for deleting the records or for updating the records of inactive users.</p>
</div>
<div class="paragraph">
<p>Therefore, the AM systems are usually not deployed alone.
The underlying directory service or NoSQL database is almost always a hard requirement for even humblest AM functionality.
However, for the AM system to really work properly, it needs something to manage and synchronize the data.
Identity Management (IDM) system is usually used for that purpose.
In fact, it is usually strongly recommended to deploy directory and IDM system before the AM system.
The AM system cannot work without the data.
If the AM tries working with data that are not maintained properly, it will not take a long time until it fails.</p>
</div>
</div>
<div class="sect3">
<h4 id="_advantages_and_disadvantages_of_access_management_systems">Advantages and Disadvantages of Access Management Systems</h4>
<div class="paragraph">
<p>Access management systems have significant advantages.
Most of the characteristics are given by the AM principle of centralized authentication.
As the authentication is carried out by a central access management server, it can be easily controlled and audited.
Such centralization can be used to consistently apply authentication policies - and to easily change them when needed.
It also allows better utilization of an investment into authentication technologies.
E.g. multi-factor or adaptive authentication can be quite expensive if it has to be implemented by every application.
When it is implemented in the AM server, it is re-used by all the applications without additional investment.</p>
</div>
<div class="paragraph">
<p>However, there are also drawbacks.
As the access management is centralized, it is obviously a single point of failure.
Nobody is going to log in when the AM server fails.
This obviously means major impact on functionality of all applications.
Therefore, AM servers need to be highly available and scalable.
Which is not always an easy task.
The AM servers need a very careful sizing, as they may easily become a performance bottlenecks.</p>
</div>
<div class="paragraph">
<p>However, perhaps the most severe drawback is the total cost of access management solution.
The cost of the AM server itself is usually not a major issue.
However, the server will not work just by itself.
The server needs to be integrated with every application.
Even though there are standard protocols, the integration is far from being straightforward.
Support for AM standards and protocols in the applications is still not universal.
Especially older enterprise applications need to be modified to switch their authentication subsystem to the AM server.
This is often so costly that the adoption of AM technologies is often limited just to a handful of enterprise applications.
Although recent applications usually have some support for AM protocols, setting it up is still not an easy task.
There are subtle incompatibilities and treacherous details, especially if the integration goes beyond mere authentication into authorization and user profile management.</p>
</div>
<div class="paragraph">
<p>Even though many organizations are planning deployment of an AM system as their first step in the IAM project, this approach seldom succeeds.
Projects usually plans to integrate 50-80% applications into the AM solution.
However, the reality is that only a handful of applications can be easily integrated with the AM system.
The rest of the applications is integrated using an identity management (IDM) system, which is hastily added to the project.
Therefore, it is better to plan ahead: analyze the AM integration effort, prototype the deployment, and make a realistic plan for the AM solution.
Make sure the AM can really bring the promised benefits.
Starting with IDM and adding AM part later is often much more reasonable strategy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_homogeneous_access_management_myth">Homogeneous Access Management Myth</h4>
<div class="paragraph">
<p>There are at least two popular access management protocols for the web.
There are huge identity federations based on SAML.
Cloud services and social networks usually use OpenID Connect or its variations.
There are variations and related protocols to be used for mobile applications and services.
Then there are other SSO protocols, primarily focused on intra-organizational use.
There is no single protocol or mechanism that can solve all the problems in the AM world.</p>
</div>
<div class="paragraph">
<p>Additionally, the redirection approach of AM systems assumes that the user has something that can display authentication prompts and carry out user interaction.
Which is usually a web browser.
Therefore, the original variant of access management mechanisms applies mostly to conventional web-based applications.
Variations of this approach are also applicable to network services and single-page web applications.
However, this approach is usually not directly applicable for applications that use rich clients, operating system authentication and similar "traditional" applications.
Browser is not the primary environment that can be used to carry out the authentication in those cases.
There are some solutions that usually rely on embedded browser, however that does not change the basic fact that the AM technologies are not entirely suitable for this environment.
These applications usually rely on Kerberos as an SSO system or do not integrate with any SSO system at all.</p>
</div>
<div class="paragraph">
<p>Typical IT environment is composed of a wild mix of technologies and not all of them are entirely web-based.
Therefore, it is quite unlikely a single AM system can apply to everything that is deployed in your organization.
Authentication is very tightly bound to the user interaction, therefore it depends on the method how the user interacts with the application.
As the user is using different technologies to interact with the web application, mobile application and operating system then it is obvious that also authentication and SSO methods for these systems will be different.</p>
</div>
<div class="paragraph">
<p>Therefore, it has to be expected that there will be several AM or SSO systems in the organization, each one serving its own technological island.
Each island needs to be managed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_practical_access_management">Practical Access Management</h4>
<div class="paragraph">
<p>Unifying access management system, Single Sign-On, cross-domain identity federation, social login, universally-applicable 2-factor authentication – there are the things that people usually want when they think about Identity and Access Management (IAM).
These are all perfectly valid requirements.
However, everything has its cost.
It is notoriously difficult to estimate the cost of access management solutions, because the majority of the cost is not in the AM software.
Huge part of the total cost is hidden inside existing applications, services and clients.
All of this has to be considered when planning an access management project.</p>
</div>
<div class="paragraph">
<p>Even though the AM is what people usually want, it is usually wise not to start with AM as the first step.
AM deployment has many dependencies: unified user database, managed and continually synchronized data and applications that are flexible enough to be integrated are the very minimum.
Unless your IT infrastructure is extremely homogeneous and simple, it is very unlikely that these dependencies are already satisfied.
Therefore, it is almost certain that an AM project attempted at the beginning of the IAM program will not reach its goals.
It is much more likely for such AM projects to fail miserably.
On the other hand, if the AM project is properly scoped and planned and has realistic goals, there is high chance of success.</p>
</div>
<div class="paragraph">
<p>Perhaps the best way to evaluate an AM project is to ask several questions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do I really need access management for all applications?
Do I need 100% coverage?
Can I afford all the costs?
Maybe it is enough to integrate just a couple of applications that are source of the worst pain.
Do I know which applications are these?
Do I know what my users really use during they workday?
Do I know what they need?</p>
</li>
<li>
<p>What are the real security benefits of AM deployment?
Will I be disabling the native authentication to the applications?
Even for system administrators?
What will I do in case of administration emergencies (e.g. system recovery)?
Would system administrators still be able to circumvent the AM system?
If yes then what is the real security benefit?
If not then what will be the recovery procedure in case the AM system fails?</p>
</li>
<li>
<p>Do I really need SSO for older and rarely used applications?
What is the real problem here?
Is the problem that users are entering the password several times per day?
Or is the real problem that they have to enter a different username or password to different applications, and they keep forgetting the credentials?
Maybe simple data cleanup and password management will solve the worst problems, and I can save a huge amount of money on AM project?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The access management technologies are the most visible part of the IAM program.
However, it is also the most expensive part, and the most difficult piece to set up and maintain.
Therefore, do not underestimate other IAM technologies.
Do not try to solve every problem with AM golden hammer.
Using the right tool for the job is a good approach in every situation.
In IAM program, it is absolutely critical for success.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_identity_management">Identity Management</h3>
<div class="paragraph">
<p><em>Identity management</em> (IDM) is maybe the most overlooked and underestimated technology in the whole identity and access management (IAM) field.
Yet IDM is a crucial part of almost every IAM solution.
It is IDM that can bring substantial benefits to almost any organization.
So, what that mysterious IDM thing really is?</p>
</div>
<div class="paragraph">
<p>Identity management is exactly what the name says: it is all about managing identities.
It is about the processes to create Active Directory accounts and mailboxes for a new employee.
IDM sets up accounts for students at the beginning of each school year.
IDM makes it possible to immediately disable all access to a suspicious user during a security incident.
IDM takes care of adding new privileges and removing old privileges of users during reorganization.
IDM makes sure all the accounts are properly disabled when the employee leaves the company.
IDM automatically sets up privileges for students and staff appropriate for their classes.
IDM records access privileges of temporary workers, partners, support engineers and all the third-party identities that are not maintained in your human resources (HR) system.
IDM automates the processes of role request and approval.
IDM records every change in user privileges in the audit trail.
IDM governs the annual reviews of roles and access privileges.
IDM makes sure the copies of user data that are kept in the applications are synchronized and properly managed.
IDM makes sure data are managed according to data protection rules.
IDM does many other things that are absolutely essential for every organization to operate in an efficient and secure manner.</p>
</div>
<div class="paragraph">
<p>It looks like IDM is the best thing since the sliced bread.
So where&#8217;s the catch?
Oh yes, there is a catch.
At least, there <em>was</em> a catch.
The IDM systems used to be expensive.
Very expensive.
The IDM systems used to be so expensive, it was very difficult to justify the cost even with such substantial and clear benefits.
That time is over now.
Identity management is still not cheap.
However, the benefits clearly outweigh the costs now.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Terminology</div>
The term <em>identity management</em> is often used for the whole identity and access management (IAM) field.
This is somehow confusing because technologies such as single sign-on or access management do not really manage the identities.
Such technologies manage the access to the applications.
Even directory servers do not exactly <em>manage</em> the identities.
Directory servers store the identities and provide access to them.
There is in fact one whole branch of technologies that manage identities.
Those systems are responsible for creating identities and maintaining them.
Those are sometimes referred to as <em>identity provisioning</em>, <em>identity lifecycle management</em> or <em>identity administration systems</em>.
However, given the current state of the technology such names are indeed an understatement.
Those systems can do much more than just provisioning or management of identity lifecycle.
Recently, the term Identity Governance and Administration (IGA) was introduced.
It is supposed to include identity management systems with identity governance capabilities.
We will refer to these systems simply as <em>identity management</em> (IDM) systems.
When we refer to the entire field that contains access management, directory services, identity management and governance we will use the term <em>identity and access management</em> (IAM).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_history_of_identity_management">History of Identity Management</h4>
<div class="paragraph">
<p>Let&#8217;s start at the beginning.
In the 1990s there was no technology that would be clearly identified as "identity management".
Of course, all the problems above had existed almost since the beginning of modern computing.
There had always been some solutions for those problems.
Historically, most of that solutions were based on paperwork and scripting.
That worked quite well - until the big system integration wave spread through the industry in the 1990s and 2000s.
As data and processes in individual applications got integrated, the identity management problems became much more pronounced.
Manual paper-based processes were just too slow for the age of information superhighways.
The scripts were too difficult to maintain in the world where new application is deployed every couple of weeks.
The identity integration effort naturally started with the state-of-the-art identity technology of the day: directory services.
As we have already shown, the directories were not entirely ideal tools for the job.
The directories did not work very well in environment where people though that LDAP is some kind of dangerous disease, where usernames and identifiers were assigned quite randomly and where every application insisted that the only authoritative data are those stored in its own database.</p>
</div>
<div class="paragraph">
<p>The integration problems motivated the inception of identity management technologies in early 2000s.
Early IDM systems were just data synchronization engines that were somehow hard-coded to operate with users and accounts.
Some simple role-based access control (RBAC) engines and administration interfaces were added a bit later.
During mid-2000s there were several more-or-less complete IDM systems.
This was the first generation of real IDM systems.
These systems were able to synchronize identity data between applications and provide some basic management capabilities.
Even such a simple functionality was a huge success at that time.
The IDM systems could synchronize the data without any major modification of the applications, therefore they brought the integration cost to a reasonable level - at the application side.
The problem was that the cost of the IDM systems themselves was quite high.
These systems were still somehow crude, therefore the configuration and customization required a very specialized class of engineers.
IDM engineers were almost exclusively employed by IDM vendors, big system integrators and expensive consulting companies.
This made the deployment of IDM solutions prohibitively expensive for many mid-size and smaller organizations.
Even big organizations often deployed IDM solution with quite limited features to make the cost acceptable.</p>
</div>
<div class="paragraph">
<p>Early IDM systems evolved and improved in time.
There were companion products for identity governance and compliance that augmented the functionality.
Yet, it is often almost impossible to change the original architecture of a product.
Therefore, almost all the first-generation IDM products struggled with limitations of the early product design.
Most of them do not exist today, or are considered to be legacy.</p>
</div>
<div class="paragraph">
<p>All these IDM systems were commercial closed-source software.
However, the closed-source character of the IDM products is itself a huge problem.
Every IDM solution has to be more-or-less customized - which usually means more rather than less.
It has to be the IDM system that adapts, and not the applications.
Requiring each application to adapt to a standardized IDM interface means a lot of changes in a lot of different places, platforms and languages.
The total cost of all necessary modifications adds up to a huge number.
Such approach is tried from time to time, it almost always fails.
While there are many applications in the IT infrastructure, there is just one IDM system.
If the IDM system adapts to applications and business processes, the changes are usually smaller, and they are all in one place, implemented in a single platform.
The IDM system must be able to adapt.
It has to adapt a great deal, and it has to adapt easily and rapidly.
Closed-source software is notoriously bad at adapting to requirements that are difficult to predict.
Which in practice means that the IDM projects based on first-generation products were hard to use, slow to adapt and expensive.</p>
</div>
<div class="paragraph">
<p>Even worse, the closed-source software is prone to vendor lock-in.
Once the IDM system is deployed and integrated, it is extremely difficult to replace it with a competing system.
The closed-source vendor is the only entity that can modify the system, and the system cannot be efficiently replaced.
Which means that the end customer is not in a position to negotiate.
Which means high maintenance costs.
It naturally follows that the first generation of IDM systems was a huge commercial success.
For the vendors, that is.</p>
</div>
<div class="paragraph">
<p>Then the 2000s were suddenly over, with an economic crash at the end.
We can only speculate what were the reasons, but the fact is that around the years 2009-2011 several very interesting new IDM products appeared on the market.
One interesting thing is that all of them were more-or-less <em>open source</em>.
The benefit that open source character brings may be easy to overlook for business-oriented people.
However, the benefits of open source in the identity management are almost impossible to overstate.
As every single IDM engineer knows, understanding of the IDM product, and the ability to adapt the product, are two critical aspects of any IDM project.
Open source is the best way to support both understanding and flexibility.
There is also third important advantage: it is almost impossible to create a vendor lock-in situation with an open source product.
All the open source products are backed by companies that offer professional support services that are equivalent to the services offered by commercial IDM products.
This brings quality assurance for the products and related services.
However, the companies does not really "own" the products, there is no way for them to abuse intellectual property rights against the customers.
Open source brings new and revolutionary approach, both to technology and business.</p>
</div>
<div class="paragraph">
<p>New products appeared since early 2010s, in many areas in identity and access management.
However, it is still a humble identity management platform that forms the core of the solution.
The products have evolved to the point, that the entire field is not called <em>identity governance and administration</em> (IGA).
New functionality was added to the products: identity governance, analytics, policy management, advanced reporting, and many more.
New IGA platforms are much more powerful than ever, yet they are still the heart of IAM solutions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_is_this_identity_management_anyway">What is This Identity Management, Anyway?</h4>
<div class="paragraph">
<p><em>Identity management</em> (IDM) is a simple term which encompasses a very rich and comprehensive functionality.
It contains identity provisioning (and reprovisioning and deprovisioning), synchronization, organizational structure management, role-based access control, data consistency, approval processes, auditing and few dozens of other features.
All of that is thoroughly blended and mixed with a pinch of scripting and other seasoning until there is a smooth IDM solution.
Therefore, it is quite difficult to tell what identity management is just by using a dictionary-like definition.
We would rather describe what identity management is by using a couple of typical usage scenarios.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a fictional company called ExAmPLE, Inc.
This company has few thousand employees, decent partner network, customers and suppliers and all the other things as real-world companies have.
And ExAmPLE company has an IDM system running in its IT infrastructure.</p>
</div>
<div class="paragraph">
<p>ExAmPLE hires a new employee, Alice.
Alice signs an employee contract few days before she starts her employment.
The contract is entered into the human resource (HR) system by the ExAmPLE HR staff.
The IDM system periodically scans the HR records, it discovers the record of a new hire.
The IDM systems pulls in the record and analyzes it.
The IDM system takes user&#8217;s name and employee number from the HR record, it generates a unique username, and based on that information it creates a user record in the IDM system.
The IDM system also gets the organization code of <code>11001</code> from the HR record.
The IDM will look inside its organizational tree and discovers that the code <code>11001</code> belongs to sales department.
Therefore, IDM will automatically assign the user to the sales department.
The IDM will also process the work position code of <code>S007</code> in the HR record.
The IDM policies say that the code <code>S007</code> means sales agent and that anybody with that code should automatically receive <code>Sales Agent</code> role.
Therefore, the IDM assigns that role.
As Alice is a core employee, the IDM system automatically creates an Active Directory account for her together with company mailbox.
The account will be placed into the <code>Sales Department</code> organizational unit.
The <code>Sales Agent</code> role entitles the user to more privileges.
Therefore, the Active Directory account is automatically assigned to sales groups and distribution lists.
The role also gives access to the CRM system, therefore CRM account is also automatically created and assigned to appropriate groups.
All of that happens in a couple of seconds after the new HR record is detected.
It all happens automatically.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-06-example-idm.png" alt="ExAmPLE IDM system">
</div>
</div>
<div class="paragraph">
<p>Alice starts her career, and she is a really efficient employee.
Therefore, she gets more responsibilities.
Alice is going to prepare specialized market analyses based on empirical data gathered in the field.
ExAmPLE is an innovative company, always inventing new ways how to make business operations more efficient.
Therefore, they invented this work position especially to take advantage of Alice&#8217;s skills.
Which means there is no work position code for Alice&#8217;s new job.
However, she needs new privileges in the CRM system to do her work efficiently.
She needs that right now.
Fortunately, the ExAmPLE has a flexible IDM system.
Alice can log into the IDM system, select the privileges that she needs and request them.
The request has to be approved by Alice&#8217;s manager and by the CRM system owner too.
They get the notification about the request, and they can easily approve or reject it in the IDM system.
Once the request is approved, Alice&#8217;s CRM account is automatically added to appropriate CRM groups.
Alice may start working on her analysis minutes or hours after she has requested the privileges.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-07-example-idm-approval.png" alt="ExAmPLE IDM approval">
</div>
</div>
<div class="paragraph">
<p>Alice lives happily ever after.
One day she decides to get married.
Alice, similarly to many other women, has the strange habit of changing her surname after the marriage.
Alice has a really responsible work position now, she has accounts in a dozen information systems.
This is no easy task to change her name in all of them, is it?
In fact, it is very easy because ExAmPLE has its IDM system.
Alice goes to the HR department, and the HR staff changes her surname in the HR system.
The IDM system will pick up the change and propagate that to all the affected systems.
Alice even automatically gets a new e-mail address with her new surname (keeping the old one as an alias).
Alice receives a notification that now she can use her new e-mail address.
The change is fast, clean and effortless.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-08-example-idm-rename.png" alt="ExAmPLE IDM rename">
</div>
</div>
<div class="paragraph">
<p>Later that day Alice discovers that her password is about to expire.
Changing the password in all the applications would be a huge task.
Alice knows exactly what to do.
She logs into the IDM system and changes her password there.
The password change is automatically propagated to each affected system according to policy set up by the IT security office.</p>
</div>
<div class="paragraph">
<p>Something unexpected happens the following month.
There is a security incident.
The security office discovered the incident, and they are investigating it.
It looks like it was an insider job.
The security officers are using the data from the IDM system to focus their investigation on users that had privileges to access affected information assets.
They pinpoint Mallory as a prime suspect.
The interesting thing is that Mallory should not have such powerful privileges at all.
Luckily, the IDM system also keeps an audit trail about every privilege change.
Therefore, security team discovers that it was Mallory&#8217;s colleague Oscar that assigned these privileges to Mallory.
Both men are to be interviewed.
As this incident affects sensitive assets, there are some preventive measures to be executed before any word about the incident spreads.
The security officers use the IDM system to immediately disable all the accounts that Mallory and Oscar have.
It takes just a few seconds for IDM to disable these accounts in all the affected applications.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-09-example-idm-disable.png" alt="ExAmPLE IDM disable">
</div>
</div>
<div class="paragraph">
<p>Later, the investigation reveals that Oscar is mostly innocent.
Mallory misused Oscar&#8217;s trust and tricked him to assign these extra privileges.
Mallory abused the privileges to get sensitive data which he tried to sell.
The decision is that Mallory has to immediately leave the company while Oscar may stay.
However, as Oscar has shown poor judgment in this case, his responsibilities are reduced.
The IDM system is used to permanently disable all Mallory&#8217;s accounts, re-enable Oscar&#8217;s accounts, and also to revoke powerful privileges that are considered too risky for Oscar to have.</p>
</div>
<div class="paragraph">
<p>Few months later, Oscar is still ashamed because of his failure.
He decides not to prolong his employee contract with ExAmPLE, and to leave the company without causing any more trouble.
Oscar&#8217;s contract expires at the end of the month.
This date is recorded in the HR system, and the IDM system takes it from there.
Therefore, at midnight of the last Oscar&#8217;s day at work, the IDM system automatically deletes all Oscar&#8217;s accounts.
Oscar starts a new career as a barman in New York.
He is very successful.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-10-example-idm-termination.png" alt="ExAmPLE IDM termination">
</div>
</div>
<div class="paragraph">
<p>The security office has handled the security incident professionally, and the IDM system provided crucial data to make the security response quick and efficient.
Security team receives praise from the board of directors.
The team always tries to improve.
They try to learn from the incident and reduce the possibility of such a thing happening again.
The team is using data from the IDM system to analyze the privileges assigned to individual users.
The usual job of the IDM system is to create and modify accounts in the applications.
However, the IDM system is using bidirectional communication with the applications.
Therefore, this analysis is far from being yet another pointless spreadsheet exercise.
The analysis is based on real application data processed and unified by the IDM system: the real accounts, to which user they belong, what roles they have, which groups they belong to and so on.
The IDM system can detect accounts that do not have any obvious owner.
The analysis discovers quite a rich collection of testing accounts that were obviously used during the last data center outage half a year ago.
The IT operations staff obviously forgot about these accounts after the outage.
The security staff disables the accounts using the IDM tools and sets up an automated process to watch out for such accounts in the future.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-11-example-idm-orphans.png" alt="ExAmPLE IDM orphan detection">
</div>
</div>
<div class="paragraph">
<p>Based on the IDM data, the security officers suspect that there are users that have too many privileges.
This is most likely a consequence of the request-and-approval process and these privileges simply accumulated over time.
Yet, this is just a suspicion.
It is always difficult for a security staff to assess whether particular user should have certain privilege or should not have it.
This is especially difficult in flexible organizations such as ExAmPLE, where work responsibilities are often cumulated and organizational structures is somehow fuzzy.
Yet there are people that know what each employee should do: the managers.
However, there are many managers on many departments, and it would be a huge task to talk to each one of them and consult the privileges.
The IDM system comes to the rescue once again.
The security officers set up automated <em>access certification</em> campaign.
They sort all users to their managers based on the organizational structure which is maintained in the IDM system.
Each manager receives an interactive list of their users and their privileges.
The manager must confirm (<em>certify</em>) that the user still needs those privileges.
This campaign is executed in a very efficient manner as the work is evenly distributed through the organization.
The campaign is completed in a couple of days.
At the end, the security officers know which privileges are no longer needed and can be revoked.
This reduces the exposure of the assets, which is a very efficient way to reduce residual security risk.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Experienced identity management professionals certainly realized that this description is slightly idealized.
The real world is not a fairy tale and real life with an IDM system is much more complicated that this simple story suggests.
Even though the real life is harder than a story in a book, the IDM system remains an indispensable tool for automation and information security management.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_how_does_the_technology_work">How Does The Technology Work?</h4>
<div class="paragraph">
<p>Obviously identity management systems have a lot of advantages for business, processes, efficiency and all that stuff.
How does it really work on a technological level?
The basic principle is very simple: identity management system is just a sophisticated data synchronization engine at its core.</p>
</div>
<div class="paragraph">
<p>Identity management system takes data from the source systems, such as HR databases.
It is processing the data, mapping and transforming the values as necessary.
It will figure out which records are new.
The IDM engine will do some (usually quite complex) processing on the records.
That usually includes processing policies such as Role-Based Access Control (RBAC), organizational policies, password policies and so on.
The result of this processing is creation or modification of user accounts in other systems such as Active Directory, CRM systems and so on.
So basically it is all about getting the data, changing them and moving them around.
This does not seem very revolutionary, does it?
It is all about the details - the way how the IDM system gathers the data, how it is processing the data and how it is propagating the changes that make all the difference.</p>
</div>
<div class="paragraph">
<p>In addition to that, there are interesting possibilities for analysis and governance of identity data.
The data are synchronized into database of identity management system, transformed, unified, all neatly organized and constantly kept up-to-date.
It would be a real shame to let such attractive data to just sit there.
Such data can be a basis for analysis.
We can watch trends, changes in number of users, number of modifications, monitor application use (e.g. license utilization) and so on.
We can look for patterns, suggest new roles, or detect users that have unusual permission patterns (outliers).
We can also <em>govern</em>, distribute maintenance of data to departments, nominate role owners, set up processes to maintain the policies &#8230;&#8203; we can all sorts of interesting things.</p>
</div>
<div class="paragraph">
<p>However, it all depends on the <em>data</em>.
The <em>data</em> are at the very core of identity management, administration and governance.
We need to have the data, taken from reliable source, transformed, unified, and most importantly, always kept fresh.
This is the most important responsibility of identity management system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_identity_management_connectors">Identity Management Connectors</h4>
<div class="paragraph">
<p>Identity management system must connect to many different applications, databases and information systems.
Typical IDM deployment has tens or even hundreds of such connections.
Therefore, the ease of connecting IDM system with its environment is one of its essential qualities.</p>
</div>
<div class="paragraph">
<p>Current IDM systems use <em>connectors</em> to communicate with all surrounding systems.
These connectors are based on principles similar to database drivers.
On one end, there is unified connector interface that presents that data from all the systems using the same format.
On the other end, there is a native protocol that the application supports.
The connector acts as a translator between common data format and an application-specific protocol.
There are connectors for LDAP and various LDAP variants, SQL protocols and dialects, connectors that are file-based, connectors that invoke REST services and so on.
Every slightly advanced IDM system has tens of different connects.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-12-connectors.png" alt="Connectors">
</div>
</div>
<div class="paragraph">
<p>Connector is usually relatively simple piece of code.
Primary responsibility of a connector is to adapt communication protocols.
Therefore, LDAP connector translates the LDAP protocol messages into data represented using a common connector interface.
The SQL connector does the same thing with SQL-based protocols.
The connector also interprets the operations invoked on the common connector interface by the IDM system.
Therefore, the LDAP protocol executes the "create" operation by sending LDAP "add" message to the LDAP server.
Connectors usually implement the basic set of create-read-update-delete (CRUD) operations.
Therefore, a typical connector is quite a simple piece of code.
Despite its simplicity, the whole connector idea is a clever one.
The IDM system does not need to deal with the communication details.
The core of the IDM system can be built to focus on the generic identity management logic, which is typically quite complex just by itself.
Therefore, any simplification that the connectors provide is more than welcome.</p>
</div>
<div class="paragraph">
<p>Connectors are usually accessing external interfaces (APIs) of source and target systems.
It is natural that the connector authors will choose interfaces that are public, well-documented and based on open standards.
Many newer systems have interfaces like that.
However, there are notorious cases that refuse to provide such an interface.
Despite that, there is almost always some way to build a connector.
The connector may create record directly in the application database.
It may execute a database routine.
It may execute a command-line tool for account management.
It may even do crazy things such as simulation of a user working with text terminal and filling out a form to create new account.
There is almost always a way to do what connector needs to do.
Just some ways are nicer than others.</p>
</div>
<div class="paragraph">
<p>The connector-based <em>architecture</em> is pretty much standard among all advanced IDM systems.
Yet the connector <em>interfaces</em> significantly vary from one IDM system to another.
The connector interfaces are all proprietary.
Therefore, the connectors are not interchangeable between different IDM systems.
The connectors are often used as weapons to somehow artificially increase the profit from IDM solution deployment.
Except for one case.
The <em>ConnId connector framework</em> is the only connector interface that is actively used and developed by several competing IDM systems.
It is perhaps no big surprise that ConnId is an <em>open source</em> framework.</p>
</div>
<div class="paragraph">
<p>Even though connector-based approach is quite widespread, some (mostly older) IDM systems are not using connectors.
Some IDM products use agents instead of connectors.
Agent does a similar job than the connector does.
However, agent is not part of the IDM system instance.
Agents are installed in each connected application, and they communicate with the IDM system using a remote network protocol.
This is a major burden.
The agents need to be installed everywhere.
Then they need to be maintained, upgraded, there may be subtle incompatibilities and so on.
Also, running a third-party code inside every application can be a major security issue.
Overall, the agent-based systems are too cumbersome (and too costly) to operate.
The whole agent idea perhaps originated somewhere in our digital past when applications and databases haven&#8217;t supported any native remote interfaces.
In such a situation the agents are obviously better than connectors.
Fortunately, this is a thing of the past.
Today even old applications have some way to manage identities using a remote interface.
This is typically some REST service that is easy to access from a connector.
Even if the application provides only a command-line interface or interactive terminal session there are connectors that can handle that sufficiently well.
Therefore, today the agent-based identity management systems are generally considered to be obsolete.
However, agents still have one advantage: the agent can reach deep into the system where it is deployed.
The agent can monitor the operations, even enforce additional policies.
For that reason, agents are still used in privileged access management (PAM) systems.
However, it is still a major consideration whether it is worth the trouble of maintaining the agents.</p>
</div>
</div>
<div class="sect3">
<h4 id="_identity_provisioning">Identity Provisioning</h4>
<div class="paragraph">
<p><em>Provisioning</em>, also called <em>fulfilment</em>, is perhaps the most frequently used feature in any IDM system.
In the generic sense, <em>provisioning</em> means maintenance of user accounts in applications, databases and other target systems.
This includes creation of the account, various modifications during the account lifetime, and permanent disable or delete at the end of the lifetime.
The IDM system is using <em>connectors</em> to manipulate the accounts.
In fact, good IDM systems can manage much more than just accounts.
Management of groups and group membership was quite a rare feature in early years of IDM technology.
Yet today, an IDM system that cannot manage groups is almost useless.
Almost all IDM systems work with roles.
However, only few IDM systems can also provision and synchronize the roles (e.g. automatically create LDAP group for each new role).
Good IDM system can also manage, provision and synchronize organizational structures.
However, even this feature is still not entirely common.</p>
</div>
</div>
<div class="sect3">
<h4 id="_synchronization_and_reconciliation">Synchronization and Reconciliation</h4>
<div class="paragraph">
<p>Identity provisioning may be the most important feature of an IDM system.
However, if an IDM system did just the provisioning and nothing else, it would be a quick an utter failure.
It is not enough to create an account when a new employee is hired, or delete that account when an employee leaves.
Reality works in mysterious ways, and it can easily make a big mess in a very short time.
Maybe there was a crash in one of the applications and the data were restored from a backup.
An account that was deleted few hours ago is unexpectedly resurrected.
It stays there, alive, unchecked and dangerous.
Maybe an administrator manually created an account for a new assistant because the HR people were all busy to process the papers.
When the record finally gets to the HR system and it is processed, the IDM system discovers that there is already a conflicting account.
The process stops with an error, waiting for administrator to manually resolve the situation.
Maybe few (hundred) accounts get accidentally deleted by junior system administrator trying out an "innovative" system administration routine.
There are simply too many ways how things can go wrong - and they often do go wrong.
It is not enough for an IDM system to just set things up and then forget about it.
One of the most important features of any self-respecting IDM system is to make sure that everything <em>is right</em>, and also that it <em>stays right</em> all the time.
Identity management is all about <em>continuous</em> maintenance of the identities.
Without that continuity the whole IDM system is pretty much useless.</p>
</div>
<div class="paragraph">
<p>The trick to keep the data in order is to know when they get out of order.
In other words, the IDM system must detect when the data in the application databases change.
If an IDM system detects that there was a change, then it is not that difficult to react to the change and fix it.
The secret ingredient is the ability to detect changes.
However, there&#8217;s a slight issue with that, isn’t it?
We cannot expect that the application will send a notification to the IDM system every time a change happens.
We do not want to modify the applications, otherwise the IDM deployment will be prohibitively expensive.
The application needs to be passive, it is the IDM system that needs to be active.
Fortunately, there are several ways how to do that.</p>
</div>
<div class="paragraph">
<p>Some applications already keep a track of the changes.
Some databases record a timestamp of the last change for each row.
Many directory servers keep a record of recent changes for the purpose of data replication.
Such meta-data can be used by the IDM system.
The IDM system may periodically scan the timestamps or replication logs for new changes.
When the IDM detects a change, it can retrieve the changed objects and react to the change based on its policies.
The scanning for changes based on meta-data is usually very efficient, therefore it can be executed every couple of seconds or minutes.
Therefore, the reaction to the change can be done almost in the real-time.
This method has many names in various IDM systems.
It is called "live synchronization", "active synchronization" or simply just "synchronization".
Sadly, this method is not always available.
Applications do not provide suitable interfaces for real-time synchronization very often.</p>
</div>
<div class="paragraph">
<p>Yet, all is not lost.
Even if the application does not maintain good meta-data that allow near-real-time change detection, there is still one very simple way that works for almost any system.
The IDM system retrieves the list of all accounts in the application.
Then it compares that list with the list of accounts that are <em>supposed</em> to be there.
Therefore, it compares the reality (what <em>is</em> there) with the policy (what <em>should be</em> there).
The IDM system can react to any discrepancies and repair them.
This method is called <em>reconciliation</em>.
It is quite a brutal method, almost barbaric.
Yet it does the job.</p>
</div>
<div class="paragraph">
<p>Listing all accounts and processing each of them may seem as a straightforward job.
However, it can be extremely slow if the number of accounts is high and the policies are complex.
It can take anything from a few minutes to a few days.
Therefore, it cannot be executed frequently.
Running that once per day may be feasible, especially for small and simple systems.
Running it once per week (on weekends) is quite common practice.
Some systems cannot afford to run it more frequently than once per month.</p>
</div>
<div class="paragraph">
<p>There are other methods as well.
However, synchronization and reconciliations are the most frequently used ones.
The drawback of synchronization is that it is not entirely reliable.
The IDM system may miss some changes, e.g. due to change log expiration, system times not being synchronized, network failures or variety of other reasons.
On the other hand, reconciliation is mostly reliable.
However, it is a very demanding task.
Therefore, these two methods are often used together.
Synchronization runs all the time and handles the vast majority of the changes.
Reconciliation runs weekly or monthly and it acts as a safety net to catch the changes that might have escaped during synchronization.</p>
</div>
</div>
<div class="sect3">
<h4 id="_identity_management_and_role_based_access_control">Identity Management and Role-Based Access Control</h4>
<div class="paragraph">
<p>There are a lot of users in our systems, every user needs a specific set of permission to access the applications.
Managing permissions for every user individually becomes very difficult with populations as small as few hundreds of users.
When the number of users goes over a thousand, such individual management of permissions becomes an unbearable burden.
The individual management of permissions is not only a huge amount of work, it is also quite an error-prone routine.
This has been known for decades.
Therefore, many systems unified common combinations of permissions into roles, and the concept of Role-Based Access Control (RBAC) was born.
The roles often represent work positions or responsibilities that are much closer to the "business" than technical permissions.
A role may reflect the concepts of bank teller, website administrator or sales manager.
User has a role, the role contains permissions, permissions are used for authorization - that is the basic principle of RBAC.
The low-level permissions are hidden from the users.
Users are quite happy when they deal with the business-friendly role names.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Terminology</div>
The term <em>RBAC</em> is frequently used in the industry, however the actual meaning of RBAC is not always clear.
The confusion is perhaps caused by the fact that there is a formal RBAC specification known as <em>NIST RBAC model</em>.
When people say "RBAC", some of them mean that specific formal model, others mean anything that is similar to that formal model, and yet others mean anything that deals with roles.
We use the term RBAC in quite a broad sense.
Major identity management systems usually implement a mechanism that is inspired by the formal NIST RBAC model, but the mechanism deviates form the formal model as necessary.
That is what we mean when we use the term RBAC.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Most RBAC systems allow for roles to be placed inside other roles, thus creating role hierarchy.
Top layers of the hierarchy are usually composed of business roles such as <code>Marketing specialist</code>.
Business roles contain a lower-level roles.
These are often application roles such as <code>Website analytics</code> or <code>CMS administrator</code>.
These lower-level roles may contain concrete permissions, or they may contain other roles that are even closer to the underlying technology.
And so on, and so on &#8230;&#8203; there are proverbial turtles all the way down.
Role hierarchy is often a must when the number of permissions and users grows.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-13-role-hierarchy.png" alt="Role hierarchy">
</div>
</div>
<div class="paragraph">
<p>No IDM system can be really complete without RBAC mechanism in place.
Therefore, the vast majority of IDM systems support roles in one way or another.
However, the quality of RBAC support significantly varies.
Some IDM systems support only the bare minimum to claim RBAC support.
Other systems have excellent and very advanced dynamic and parametric RBAC systems.
Most IDM systems are somewhere in between.</p>
</div>
<div class="paragraph">
<p>Role-based mechanism is a very useful management tool.
In fact, the efficiency of role-based mechanism often leads to its overuse.
This is a real danger, especially in bigger and somehow complex environments.
The people that design roles in such environment have a strong motivation to maintain order by dividing the roles to the smallest reusable pieces, and then re-combining them in a form of application and business roles.
This is further amplified by the security best practices, such as the <em>principle of least privilege</em>.
This is understandable and perfectly valid motivation.
However, it requires extreme care to keep such RBAC structure maintainable.
Even though this may seem counter-intuitive, it is quite common that the number of roles exceeds the number of users in the system.
Unfortunately, this approach turns the complex problem of user management to even more complex problem of role management.
This phenomenon is known as <em>role explosion</em>.</p>
</div>
<div class="paragraph">
<p>Role explosion is a real danger, and it is definitely not something that can be avoided easily.
The approach that prevailed in the first-generation IDM deployments was to simply live with the consequences of role explosion.
Some IDM deployments even created tools that were able to automatically generate and (more-or-less successfully) manage hundreds of thousands of roles.
However, this is not a sustainable approach.
The systems have evolved since then.
Current IDM systems bring features that may help to avoid the role explosion in the first place.
Such mechanisms are usually based on the idea to make the roles <em>dynamic</em>.
The roles are no longer just a static set of privileges.
Dynamic roles may contain small pieces of algorithmic logic used to construct the privileges.
Input to these algorithms are parameters that are specified when the role is assigned.
Therefore, the same role can be reused for many related purposes without a need to duplicate the roles.
This can significantly limit the number of roles required to model a complex system.
This is the best weapon against role explosion that we currently have.
Moreover, the roles can be assigned (and unassigned) automatically.
There are rules that specify when a user should have a role.
This approach further simplified and automates role management.
As most of the role management is driven by a policy, we call this approach <em>policy-driven RBAC</em>.</p>
</div>
<div class="paragraph">
<p>Even though the RBAC system has some drawbacks, it is necessary for almost any practical IDM solutions.
There were several attempts to replace the RBAC system with a completely different approach.
Such attempts have some success in the access management and related fields.
However, those alternatives cannot easily replace RBAC in the identity management.
Attribute-based access control (ABAC) and policy-based access control (PBAC) are two popular example, using the same principle.
The basic idea is based on replacing the roles with pure algorithmic policies.
Simply speaking, ABAC/PBAC policy is a set of algorithms that take user attributes as input.
The policy combines that input with the data about operation and context.
Output of the policy is a decision whether an operation should be allowed or denied.
This approach is simple.
It may work reasonably well in the access management world where the AM server knows a lot of details about the operation that just takes place, and the policies tend to be quite consistent and relatively simple.
However, in the identity management field we need to set up the account before the user logs in for the first time.
There are no data about the operation yet, and even contextual data are very limited.
Even more importantly, policies used in the IDM field are usually not entirely "pure".
Identity management is full of special cases, exceptions, subjective decisions and historical baggage.
This is almost impossible to express in a form of an algorithm.
That, together with other issues, makes ABAC/PBAC a very poor choice for an identity management system.
Therefore, whether you like it or not, RBAC is the primary mechanism of any practical IDM solution - and it is here to stay.</p>
</div>
</div>
<div class="sect3">
<h4 id="_identity_management_and_authorizations">Identity Management and Authorizations</h4>
<div class="paragraph">
<p>The basic principle of authorization in the information security is quite straightforward:
take the <em>subject</em> (user), <em>operation</em> and <em>object</em> (the things that user is trying to access).
Evaluate whether the policy allows access for that <em>subject-operation-object triple</em>.
If policy does not allow it, then deny the operation.
This is quite simple, understandable and proven by decades of information security practice.
This principle is rooted very deeply in information security tradition.</p>
</div>
<div class="paragraph">
<p>However, in the identity management field, we need to think quite differently.
We need to work backwards.
The IDM system needs to set up an account for a user before the user initiates any operation.
When user really starts an operation, it happens in the application.
The IDM system will not know anything about it.
Therefore, the concept of authorization is turned completely upside down in the IDM world.</p>
</div>
<div class="paragraph">
<p>IDM system sets up accounts in applications and databases.
However, the IDM system itself does not take any active part when user logs into an application and executes the operations.
Applications do all than by themselves.
Does that mean IDM system cannot do anything about authorizations?
Definitely not.
The IDM system does not <em>enforce</em> authorization decisions.
However, the IDM system can manage the data that determine how the authorization is evaluated.
IDM system can place the account in the correct groups, which will cause certain operations to be allowed and other operations to be denied.
IDM system can set up an access control lists (ACLs) for each account that it manages.
IDM system is not evaluating or enforcing the authorizations directly.
However, it indirectly <em>manages</em> the data that are used to evaluate authorizations.
This is an extremely important feature.</p>
</div>
<div class="paragraph">
<p>Authentication and authorizations are two very prominent concepts of information security.
They are vitally important for any identity and access management solution.
However, authentication is quite simple in principle.
Yes, the user may have several credential types used in adaptive multi-factor authentication.
While that description sounds a bit scary, the actual implemented is not very complicated.
In most cases there is just a couple of policy statements that govern authentication.
Also, authentication is typically quite uniform: most users are authenticating using the same mechanism.
Authentication is not that difficult to centralize (although it may be expensive).
Most applications do not care about authentication at all, they just need to know that the user was authenticated somehow, and know user&#8217;s identifier.
Applications do don care about authentication details.
Which makes <em>authentication</em> relatively easy to manage.</p>
</div>
<div class="paragraph">
<p>However, it is quite a different story for <em>authorization</em>.
Every application has slightly different authorization mechanism.
These mechanisms are not easy to unify.
One of the major obstacles is that every application works with different objects, the objects may have complex relations with other objects and all of them may also have complex relations with the subjects.
The operations are also far from being straightforward, as they may be parametrized.
Then there is <em>context</em>.
There may be per-operation limits, daily limits, operations allowed only during certain times or when system is in certain state.
And so on, and so on.
This is very difficult to centralize.
Also, almost every user has slightly different combination of authorizations.
Which means that there is a great variability and a lot of policies to manage.
Then there are two crucial aspects that add whole new dimension of complexity: performance and scalability.
Authorization decisions are evaluated all the time.
It is not rare to see an authorization evaluated several times for each request.
Authorization processing needs to be fast.
Really fast.
Even a round-trip across a local network may be a performance killer.
Due to complexity and performance reasons the authorization mechanisms are often tightly integrated into the fabric of each individual application.
E.g. it is a common practice that authorization policies are translated to SQL, and they are used as an additional clauses in application-level SQL queries.
This technique is taking advantage of the database engine to quickly filter out the data that the user is not authorized to access.
This method is very efficient, and it is perhaps the only practical option when dealing with large-scale data sets.
However, this approach is tightly bound to the application data model, and it is usually almost impossible to externalize.</p>
</div>
<div class="paragraph">
<p>There are approaches that partially address some parts of authorization problems.
Policy agents (such as Open Policy Agent) are small software components that are placed on the application side.
They integrate with the application, processing authorization policies.
The policies are managed centrally, distributed to the agents and cached by the agents.
The agent can process policies quickly with acceptable latencies.
However, many problems still remain unsolved.
It is still very difficult to consider application concepts, data models and object relations using the agents.
As the agents are generic, they are usually not capable of SQL rewriting, which requires intimate knowledge of application data model and data storage schemas.
Agents can be very useful for some cases, however they are not universal solution, at least not yet.</p>
</div>
<div class="paragraph">
<p>Therefore, it is not realistic to expect that the authorization could be completely centralized anytime soon.
The authorization policies still need to be <em>distributed</em> into the applications.
However, managing partial and distributed policies is no easy task.
Someone has to make sure that the application policies are consistent with the overall security policy of the organization.
Fortunately, the IDM systems are designed especially to handle management and synchronization of data in broad range of systems.
Therefore, the IDM system is the obvious choice when it comes to management of authorization policies.</p>
</div>
</div>
<div class="sect3">
<h4 id="_organizational_structure_roles_services_and_other_wildlife">Organizational Structure, Roles, Services and Other Wildlife</h4>
<div class="paragraph">
<p>Back in the 2000s the IDM was all about managing user accounts.
It was enough to create, disable and delete an account to a have a successful IDM deployment.
The world is a different place now.
Managing the accounts is simply not enough anymore.
Yes, automated account management brings significant benefits, and it is a necessary condition to get at least a minimal level of security.
However, account management is often not enough to justify the cost of an IDM system.
Therefore, current IDM systems can do much more than just a simple account management.</p>
</div>
<div class="paragraph">
<p>There are many things that an advanced IDM system can manage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Accounts.
Obviously.
Many IDM systems can fully manage account attributes, groups membership, privileges, account status (enabled/disabled), validity dates and all the other details.</p>
</li>
<li>
<p>Groups and roles.
Apart from managing the membership of accounts in groups, the IDM system can take care of the whole group life-cycle: create a group, manage it and delete it.</p>
</li>
<li>
<p>Organizational structure.
The IDM system can take organizational structure from its authoritative source (usually HR), use it for governance, and synchronize it to all the applications that need it.
Alternatively, the IDM itself may be used to manually maintain an organizational structure.</p>
</li>
<li>
<p>Servers, services, devices and "things".
While this is not yet IDM mainstream, there are some experimental solutions that use IDM principles to manage concepts that are slightly outside the traditional IDM scope.
E.g. there is an IDM-based solution that can automatically deploy predefined set of virtual machines for each new project.
The new IDM systems are so flexible that they can theoretically manage everything that is at least marginally related to the concept of identity: applications, mobile devices, printers, virtual machines, networks  &#8230;&#8203; almost anything.
This is still quite a unique functionality.
However, it is very likely that we will see more stories about this in the future.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While all these features are interesting, some of them clearly stand out.
The management of groups and organizational structure are those that are absolutely critical for almost any new IDM deployment.
Your organizational structure may be almost flat and project-oriented, or you may have twelve levels of divisions and sections.
Regardless of the size and shape of your organizational structure, it needs to be managed and synchronized across applications in pretty much the same way as identities are synchronized.
You may need to create groups in Active Directory for each of your organizational unit.
You want them to be correctly nested.
You may want to create distribution list for each of your ad-hoc team.
You want this operation to have as little overhead as possible, otherwise the teams cannot really be managed in ad-hoc fashion.
You may want to synchronize the information about projects into your issue tracking system.
You may also want to automatically create a separate wiki space and a new source code repository for each new development project.
The possibilities are endless.
Both the traditional organizations and the new lean and agile companies will benefit from that.</p>
</div>
<div class="paragraph">
<p>Organizational structure management is closely related to group management.
The groups are often bound to workgroups, projects or organizational units.
E.g. and IDM system can automatically maintain several groups for each project (admin and member groups).
Those groups can be used by applications for authorization purposes.
Similarly, an IDM system can automatically maintain application-level roles, access control lists (ACLs) and other data structures that are usually used for authorization.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-14-org-sync.png" alt="Organizational tree synchronization">
</div>
</div>
<div class="paragraph">
<p>While this functionality provides benefits in almost any deployment, organizational structure management is absolutely essential for organizations that are based on tree-like functional organizational structures.
These organizations heavily rely on the information derived from organizational structure.
E.g. direct manager of the document author can review and approve the document in the document management system.
Only the employees in the same division can see the document draft.
Only the employees of a marketing section can see marketing plans.
And so on.
Traditionally, such data are encoded into an incomprehensible set of authorization groups and lists.
That contributes to the fact that reorganizations are a total nightmare for IT administrators.
However, an IDM system can significantly improve the situation.
IDM can create the groups automatically.
It can make sure that the right users are assigned into these groups.
It can synchronize information about the managers into all affected applications.
And so on.
Good IDM system can do all of that using just a handful of configuration objects.</p>
</div>
<div class="paragraph">
<p>This seems to be almost too good to be true, which it somehow is.
It is fair to admit that the quality of organizational management features significantly varies among IDM systems.
Group management and organizational structure management seem to be a very problematic feature.
Only few IDM systems support these concepts at the level that allows practical out-of-box deployment.
Most IDM systems have some support for that, but any practical solution requires heavy customization.
It is not clear why IDM vendors do not pay attention to features that are required for almost any IDM deployment.
Therefore, when it comes to a comprehensive IDM solution there is one crucial advice that we could give: choose the IDM product wisely.</p>
</div>
</div>
<div class="sect3">
<h4 id="_everybody_needs_identity_management">Everybody Needs Identity Management</h4>
<div class="paragraph">
<p>Such a title may look like a huge exaggeration.
In fact, it is very close to the truth.
Every non-trivial system has a need for identity management, even though the system owners may not realize that.
As you are reading this book, chances are that you are one of the few people that can see the need.
In that case it is all mostly about costs/benefits calculation.
Identity management has some inherent complexity.
While even very small systems need IDM, the benefits are likely to be too small to justify the costs.
The cost/benefit ratio is much better for mid-size organizations.
Comprehensive, automated identity management is an absolute necessity for large-scale systems.
There seems to be a rule of thumb that has quite a broad applicability:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Number of users</th>
<th class="tableblock halign-left valign-top">Recommendation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than 200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You may need automated identity management, but the benefits are probably too small to justify the costs.
Managing users accounts manually is probably still a feasible option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200 – 2 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You need automated identity management, and the benefits may be just enough to justify the costs.
However, you still need to look for a very cost-efficient solution.
Automating the most basic and time-consuming tasks is probably just enough.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 000 – 20 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You really need automated identity management.
You cannot manage that crowd manually.
If you implement identity management solution properly, the benefits will be much higher than the costs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">More than 20 000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I can&#8217;t believe that you do not have any automated identity management yet.
Go and get one.
Right now.
You can thank us later.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_identity_governance">Identity Governance</h3>
<div class="paragraph">
<p><em>Identity governance</em> is basically an identity management taken to a higher business level.
The <em>identity management</em> proper, sometimes called <em>identity administration</em>, is focused mainly on technical aspects of identity life-cycle such as automatic provisioning, synchronization, evaluation of the roles and computing attribute values.
On the other hand, <em>identity governance</em> abstracts from the technical details, focusing on policies, roles, business rules, processes and data analysis.
E.g. a governance system may deal with <em>segregation of duties</em> policy.
It may drive the process of <em>access certification</em>.
It may focus on automatic <em>analysis and reporting</em> of the identity, auditing and policy data.
It drives <em>remediation</em> processes to address policy violations.
It manages application of new and changed policies, evaluate how is your system <em>compliant</em> with policies and regulations and so on.
It may evaluate <em>risk</em> levels, modeling overall organizational risk, identifying risk hot-spots.
This field is sometimes referred to as <em>governance, risk management and compliance</em> (GRC).</p>
</div>
<div class="paragraph">
<p>Almost all IDM systems will need at least some governance features to be of any use in practical deployments.
Moreover, many governance features are just refinement of concepts that originated in the IDM field many years ago.
Therefore, the boundary between identity management and identity governance is quite fuzzy.
The boundary is so fuzzy that new terms were invented for the unified field that includes the identity management proper together with identity governance.
<em>Identity governance and administration</em> (IGA) is one of these terms.
For us, the governance is just a natural continuation of identity management evolution.</p>
</div>
<div class="paragraph">
<p>Back in the 2010s, it was a common practice for identity governance features to be implemented by specialized products that are separated from their underlying IDM platforms.
Many IDM and governance solutions are still divided into (at least) two products.
This strategy brings new revenue streams for the vendors.
Yet, it makes almost no sense from customer&#8217;s point of view.
It perhaps comes without saying that reasonable IDM/IGA solutions should offer both the IDM and governance features in one unified and well aligned product.</p>
</div>
<div class="sect3">
<h4 id="_identity_governance_features">Identity Governance Features</h4>
<div class="paragraph">
<p>Below is a list of features that belong to the governance/compliance category.
As the boundary of governance is so fuzzy, there are also features that may be considered governance-related IDM features.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Delegated administration.</strong>
Basic IDM deployments are usually based on the idea of an omnipotent system administrator that can do almost anything.
Then there are end users that can do almost nothing.
While this concept may work in small and simple deployments, it is not sufficient for larger systems.
Large organizations usually need to delegate some administration privileges to other users.
There may be HR personnel, people that are responsible for management of their organizational units, administrator responsible for a particular group of systems, application administrators, and so on.
<em>Delegated administration</em> allow delagation of parts of system administration tasks to other users.
Such delegated privileges are limited in scope.
For example, HR staff can edit selected attributes on all employees, or project managers can add/remove users in their projects.</p>
</li>
<li>
<p><strong>Deputies.</strong>
Delegated administration is very useful, yet it is quite static.
It is specified in policies that are not entirely easy to change.
However, there is often a need for ad-hoc delegation, such as a temporary delegation of privileges during manager’s vacation.
Such a manager could nominate a <em>deputy</em> that would receive some of manager’s privileges for a limited time period.
This is all done on an ad-hoc basis, initiated by an explicit action of the manager.</p>
</li>
<li>
<p><strong>RBAC-related policies</strong>, such as Segregation of Duties (SoD) policy.
Simply speaking SoD policy ensures that conflicting duties cannot be accumulated with a single person.
This is usually implemented by using a role exclusion mechanisms.
However, it may go deeper.
E.g. it may be required that each request is approved by at least two people.</p>
</li>
<li>
<p><strong>Policies related to organizational structure.</strong>
Organizational structure may look like a simple harmless tree, but in reality it is far from being simple or harmless - or even a tree.
In theory, the organizational structure should be managed by business or operations departments such as HR.
Yet the reality is often quite different.
Business departments lack the tools and processes to efficiently manage organizational structure.
Therefore, it is often an IDM system that assumes the responsibility for organizational structure management.
In such cases there is a need to police the organizational structure.
For example, there may be policies that mandate a single manager for each department.
In that case the IDM system may need to handle situations that there is no manager or too many managers.</p>
</li>
<li>
<p><strong>Dynamic approval schemes.</strong>
Approval processes are usually considered to be part of basic identity management functionality, as they were present in early IDM systems back in the 2000s.
The user requests role assignment.
The operation is driven through an approval process before being executed.
Approvals provide a very useful mechanism, especially in case that role assignment cannot be automated, usually due to a non-existent policies.</p>
<div class="paragraph">
<p>Approvals are usually implemented by some kind of general-purpose workflow engine by almost all IDM/governance systems.
However, this is often a source of maintenance problems, especially in deployments that are focused on identity governance functionality.
In such cases, the approval processes are no longer simple quasi-linear workflows.
Approval processes tend to be very dynamic, and their nature is almost entirely determined by the polices rather that process flows.
Workflow engines have a very hard time coping with such a dynamic situation.
IDM system that implement special-purpose policy-based approval engines provide much better solutions.</p>
</div>
<div class="paragraph">
<p>Approval mechanisms are very useful.
However, they also have a dark side.
Approval decisions are often made on a very subjective "looks good" basis.
This obviously opens an opportunity for bad decisions and negligence.
False denial of role assignment is likely to trigger an immediate (and occasionally quite emotional) feedback from the requester.
However, approval of role assignment that should not be assigned is likely to trigger no feedback at all.
Yet, such a decision is likely to cause a security risk, a risk that is very difficult to detect.
This can be partially solved by a multi-level approval processes, especially for sensitive roles.
However, there is trend to "automate" approval decisions based on "artificial intelligence" mechanisms.
This may look like a very useful tool and time-saver.
However, the artificial intelligence is only as good as are the training data.
If the machine is trained using bad decisions, it will also suggest bad decisions.
This is further complicated by a very limited visibility and accountability of such decisions.
Therefore, such mechanisms have to be used with utmost care.
It is perhaps a better idea to replace request-and-approval process with automated policy, which can be validated, reviewed and consistently applied.
Even though the access request process cannot be completely replaced, policies should be applied as broadly as it is possible.</p>
</div>
</li>
<li>
<p><strong>Entitlement management</strong> deals with entitlements of user’s accounts in target systems, such as role or group membership.
However, this process can go both ways.
Governance systems may provide an "entitlement discovery" features that take entitlements as inputs.
This can be used evaluate compliance and policy violations, but it may also be a valuable input for role engineering.</p>
</li>
<li>
<p><strong>Role mining.</strong>
Identity management systems are seldom deployed on a green field.
In the common case, there are existing systems in place, there are application roles, entitlements and privileges.
It is not an easy job to create IDM roles that map to this environment.
This is usually a slow and tedious process.
However, IDM system can retrieve all the existing information and use it to propose role structure.
This is not a fully deterministic process, it requires a lot of user interaction, tuning, and it is often based on a machine learning capabilities.
It is not a replacement for role engineering expertise.
However, machine-assisted role mining can significantly speed up the process.</p>
</li>
<li>
<p><strong>Access certification.</strong>
Assignment of roles is often an easy task.
Request a role, role goes through an approval process, and the role is assigned.
Then everybody forgets about it.
There is a significant incentive to request assignment of a new role.
Yet, there is almost no incentive to request unassignment of a role that is no longer needed.
This leads to accumulation of privileges over time.
Such privilege hoarding may reach dangerous levels for employees with long and rich job transfer history.
Therefore, there are <em>access certification campaigns</em> that are also known as "certification", "re-certification" or "attestation" mechanisms.
The goal of those campaign is to confirm ("certify" or "testify") that the user still needs the privileges that were assigned previously.
Certification campaigns are designed to be conducted on a large number of users in a very efficient manner.
Therefore, there are special processes, and a very specific user interface is provided to conduct such campaigns.
Campaigns are planned certification actions that handle many users at once, distributing the work among many certifiers.
This is usually a huge amount of work.
On the other hand, there are <em>micro-certifications</em>.
These are very small certification actions, usually involving just a single user.
They are triggered automatically, for example as a reaction of re-assigning user to a different organizational unit, or by accumulating dangerous risk level for one user.</p>
<div class="paragraph">
<p>Similarly to approval processes, some identity governance systems offer "artificial intelligence" support for certification processes.
Such assistance can be very attractive, as certification campaigns are often quite intimidating due to a large number of decisions that have to be made in each campaign.
However, the risks of such "automation" is even more pronounced than it is in the approval case.
Certification is often the last defence against dangerous privilege accumulation.
Poorly-trained artificial intelligence may cause a systematic build-up of risk in the organization.
Artificial inteligence support for certification decisions may be very useful.
However, it is essential to understand how the mechanism works before committing to roll it out for all certifications.</p>
</div>
<div class="paragraph">
<p>Yet again, the best way to handle certification effort is to avoid certification altogether.
Policy-based approach relies on roles assigned automatically.
Which also means they are <em>unassigned</em> automatically, and there is no need for case-by-case certification.
Of course, the policy needs to be created, properly maintained and reviewed.
However, the effort to maintain a policy is likely much smaller than certification effort.</p>
</div>
</li>
<li>
<p><strong>Role governance</strong> is usually quite a complex matter.
Typical IDM deployment is likely to have a large number of roles.
It is quite hard to define those roles in the first place.
Then it is even harder to maintain the roles.
Environment is changing all the time, therefore the roles have to change as well.
It is usually beyond the powers of a single administrator to do so.
Therefore, many role <em>owners</em> are usually nominated to take care of role maintenance.
Roles are often grouped into applications, categories, catalogs or functional areas.
The IDM system must make sure that the owners have the right privileges to do their job.
The IDM system should also take care that each role has at least one owner at any given time, that role definitions are periodically reviewed and so on.</p>
</li>
<li>
<p><strong>Role lifecycle management</strong> is a dynamic part of role governance.
Role changes are likely to have a serious impact on overall security of the system.
Therefore, it may not be desirable to simply delegate role management duties.
It may be much more sensible to require that role changes has to be approved before being applied.
New roles are also created all the time and old roles are decommissioned.
The IDM system may need to make sure that a decommissioned role is not assigned to any new user.
Yet, old roles may still be needed in the system during a phase-out period.
IDM system has to keep track of them, to avoid keeping outdated roles in the systems forever.</p>
</li>
<li>
<p><strong>Role modeling.</strong>
A change of a single role often does not make much sense just by itself.
The roles are usually designed in such a way that a set of roles works together and forms a role model.
Therefore, approval of each individual role change may be too annoying, and it may even be harmful.
E.g. there may be an inconsistent situation in case that one change is approved and another is rejected.
Therefore, roles and policies are often grouped into models.
The models are reviewed, versioned and applied in their entirety.</p>
</li>
<li>
<p><strong>Simulation.</strong>
IDM deployments tend to be complex.
There are many relations, interactions and policies.
It is no easy task to predict the effects of a change in a role, policy or organizational structure.
Therefore, some IDM systems provide a simulation features that provide predictions and impact analyses of planed changes.</p>
</li>
<li>
<p><strong>Compliance policies</strong>, reporting and management.
Policies in the identity management world are usually designed to be strictly enforced.
This works fine for fundamental policies that are part of simple IDM deployments.
However, the big problem is how to apply new policies - especially policies that are mandated by regulations, recommendations and best practices.
It is almost certain that significant part of your organization will not be compliant with such new policy.
Applying the policy and immediately enforcing it is likely to cause a major business disruption.
However, it is almost impossible to prepare for new policies and to mitigate their impact without knowing which users and roles are affected.
Therefore, there is a two-step process.
The policies are applied, but they are not enforced yet.
The policies are used to evaluate the compliance impact.
Compliance reports can be used to find the users that are in violation of the policy, in order to remedy the situation.
Compliance reports may also be used to track the extent and progress of compliance.</p>
</li>
<li>
<p><strong>Remediation.</strong>
Good IDM deployments strive for automation.
All the processes and actions that can be automated are automated.
E.g. if a role is unassigned and user does no longer needs an account, such account is automatically deleted or disabled.
However, there are actions that cannot be automated because they require decision of a living and thinking human being.
Approvals are one example of such processes.
However, there are more situations like that.
Many of those require more initiative than a simple yes/no decision.
One such example is organizational structure management.
There is usually a rule that each department must have a manager.
However, what should IDM system do in case that a department manager is fired?
IDM system cannot stop that operation, as there are certainly good reasons to revoke all privileges of that manager.
The manager and all the associated accounts have to go, as soon as possible.
Now there is a department without a manager, and the IDM system itself cannot do anything about it.
That is where remediation comes to the rescue.
Remediation process is started after the operation that removed the manager.
The remediation process will ask a responsible person to nominate a new manager for the department.
There may be a broad variety of remediation processes.
Simple process will ask for yes/no decisions, or it may ask to nominate a user.
Then there are often options to set up generic processes that apply to completely unexpected situations.</p>
</li>
<li>
<p><strong>Risk management automation.</strong>
Information security is not a project, it is a process.
It starts with risk analysis, planning, execution, and then it goes back to analysis and planning and execution, and so on and so on for ever and ever.
Risk analysis is the part of the process that takes a huge amount of time and effort - especially when it comes to analysis of insider threat as there is usually a lot of insiders to analyze.
However, an IDM system can help to reduce the risk analysis effort.
Each role assigned to a user is a risk.
If roles are marked with relative risk levels, IDM system can compute the accumulation of risk for each user.
As each role gives access to a particular set of assets, the IDM system may provide data to evaluate asset exposure to users.</p>
</li>
<li>
<p><strong>Identity analytics and intelligence (IdA)</strong> is mostly an umbrella term.
It usually refers to a composition of several identity governance features, integrated into a holistic, risk-based approach.
Identity analytics and intelligence starts by a look at the data.
The process starts with a very realistic assumption that the data are not in perfect order,
that there are inconsistencies, imperfections, risks and all kinds of other problems.
Various techniques are employed to detect the problems.
Most techniques seems to be based on recognition of anomalies and patters in the data.
<em>Outlier detection</em> mechanisms look for users with privileges that are significantly different from the privileges of their colleagues.
On the other hand, <em>role mining</em> is used to detect similar privileges assigned to similar users, suggesting new roles.
Many of the identity analytics and intelligence techniques are based on risk modeling.
There are mechanisms to <em>identify over-privileged users</em> by analysing risk scores of individual users.
Similar mechanisms can be used to identify high-privilege entitlements assigned to a low-privilege user or similar risk anomalies.</p>
</li>
<li>
<p><strong>Workflow orchestration</strong> is provided by some IGA platforms.
Workflow engines drive processes based on simple algorithms, usually containing many manual steps that need to be carried out by different people of teams.
IGA platforms use workflow automation mostly to implement approval mechanisms.
While use of workflow engine for approvals may look like an obvious choice, workflow engines are perhaps the worst tools possible.
Approval processes are usually dynamic process, their form heavily depends on input (request) and policy settings.
The list of approvers, approval stages and exit conditions depend on the set of requested roles and other factors (e.g. user risk level), which is not an easy thing to handle in high-level business process modeling language.</p>
<div class="paragraph">
<p>Even though workflow orchestration is almost useless for implementation of approval processes, it still has its place in IGA platform.
Workflow automation may be useful for driving on-boarding (enrollment) and off-boarding processes.
It may also be useful for some remediation cases, although remediation tends to be an unstructured or semi-structured activity that is better handled by case management than workflow automation.</p>
</div>
<div class="paragraph">
<p>Almost all IGA platforms that support workflow automation are bringing their own (often proprietary) workflow engine.
This means that the administrators need to learn how to configure the workflows, users need to adapt to new user interface, notifications need to be integrated and so on.
It would be much better to re-use existing workflow engine, an engine that is already used by the organization to drive all its other business processes.
Except for approvals which heavily depend on role structure, other IGA processes tend to be very similar to ordinary business processes in the organization.
Re-use of existing workflow automation and orchestration platform should be a natural choice.
Except for one annoying detail.
Most organizations do not have such a system.
Therefore, even that strange proprietary workflow engine embedded in the IGA platform may still be quite useful.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not all IGA platforms will implement all the features.
Scope and quality of implementation dramatically vary from system to system.
Moreover, individual IGA platforms are using their own terminology, which makes the situation very confusing.
This is further obscured by marketing departments, that try to present even the smallest advantage as revolutionary achievement.
Most IGA platform are closely guarded commercial closed source software, access to the software and documentation is jealously guarded.
This makes comparison of individual IGA platform a very challenging undertaking.
Perhaps the best approach is to know what you need: summarize your requirements and priorities.
Write down your expectations, select a product, and conduct a <em>proof-of-concept</em> test tuned to your specific needs.
That is perhaps the only reliable way to break through the marketing veil.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_identity_management_and_governance_terminology">Identity Management and Governance Terminology</h3>
<div class="paragraph">
<p>Identity professionals, often motivated by marketing needs, like to invent new names and use them to describe the same thing.
Therefore, there are many overlapping, overloaded and similar terms in use.</p>
</div>
<div class="paragraph">
<p><em>Identity management</em> (IDM) is usually used to describe the low-level parts (technology), while <em>identity governance</em> is used to describe the high-level parts (business).
Yet the boundary is very fuzzy and many IDM systems provide governance capabilities, and many governance systems provide low-level functions.
<em>Identity governance and administration</em> (IGA) is a term supposed to describe both parts together.
<em>Governance, risk management and compliance (GRC)</em> is a terms that was mostly used in the past to represent the high-level identity governance functionality, later known simply as <em>identity governance</em>.
<em>Identity security</em> is a marketing term that roughly covers IGA functionality.</p>
</div>
<div class="paragraph">
<p>Overall, the terminology is very fluid.
Vendors use their own terms, often choosing overloaded or confusing terminology.
Industry analysts and consultants also adding their own terms and meanings to existing terms.
Marketing terms are invented faster than the documentation can adapt, making the situation quite confusing.
We have tried to compile the terminology as precisely as we could, while still making the terms understandable.
We have chosen to follow established industry terminology when possible, even though many terms are overloaded and ambiguous.
However, we did not want to increase the confusion by re-inventing the terminology.
We are pointing out the ambiguities in the text as needed.
At the very least, we are trying to use a consistent terminology in this book.
When in doubt, please refer to the <a href="#glossary">glossary</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_complete_identity_and_access_management_solution">Complete Identity and Access Management Solution</h3>
<div class="paragraph">
<p>A comprehensive Identity and Access Management solution cannot be built by using just a single component.
There is no single product or solution that can provide all the necessary features.
As the requirements are so complex and often even contradictory, it is very unlikely that there ever will be any single product that can do it all.</p>
</div>
<div class="paragraph">
<p>A clever combination of several components is needed to build complete solution.
The right mix of ingredients for this IAM soup will always be slightly different, as no two IAM solutions are exactly the same.</p>
</div>
<div class="paragraph">
<p>There are three basic components that are required for any practical IAM deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Directory service</strong> or a similar identity store is the first component.
This is the database that stores user account information.
The accounts are stored there in a "clean" form that can be used by other applications.
This database is then widely shared by applications that are capable to connect to it.
This part of the solution is usually implemented in a form of LDAP server or Active Directory.
However, there is one major limitation: the data model needs to be simple.
Very simple.
Also, the identity store needs to be properly managed.</p>
</li>
<li>
<p><strong>Access management</strong> is a second major component of the solution.
It takes care of authentication and (partially) authorization.
Access management unifies authentication mechanisms.
If an authentication mechanism is implemented in the access management server, then all integrated applications can easily benefit.
It also provides single sign-on (SSO), centralizes access logs and so on.
It is a very useful component.
Of course, there are limitations.
Access management system needs access to identity data.
Therefore, it needs reliable, very scalable and absolutely consistent identity database as a back-end.
This is usually provided by the <em>directory service</em>.
Performance and availability are the obvious obstacles here.
However, there is one more obstacle which is less obvious yet every bit as important: data quality.
The data in the directory service must be correct, up-to-date and properly managed.
However, that is still only a part of the picture.
As most applications store some pieces of identity data locally, these data also need to be synchronized with the directory database.
No access management system can do this well enough.
Moreover, there is no point for access management system to do it at all.
The access management system has a very different architectural responsibilities.
Therefore, yet another component is needed.</p>
</li>
<li>
<p><strong>Identity management</strong> is the last, but in many ways the most important component.
This is the real brain of the solution.
The identity management system maintains the data.
It maintains order in the system.
It makes sure the data are up-to-date and compliant with the policies.
It synchronizes all the pieces of identity data that those pesky little applications always keep creating.
It maintains groups, privileges, roles, organizational structures and all the other things necessary for the directory and the access management to work properly.
It keeps the entire solution from falling apart.
It allows system administrators and security officers to live happily, to breath easily and to keep control over the whole solution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following diagram shows how all these components fit together.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/01-15-iam-arch.png" alt="IAM architecture">
</div>
</div>
<div class="paragraph">
<p>This is truly a composite solution.
There are several components that have vastly different features and characteristics.
When bound together into one solution, the result is something that is much more than just a sum of its part.
The components support each other.
The solution cannot be complete unless all three components are in place.</p>
</div>
<div class="paragraph">
<p>However, building a complete solution may be quite expensive, and it may take a long time.
You have to start somewhere.
If you have resources for just one product, then choose identity management.
It is a good start.
It is not as expensive to deploy and integration as access management system is.
IDM brings good value, even quite early in the IAM program.
Going for open source product will also keep the initial investment down.
Staring with IDM is usually the best choice to start the IAM program.</p>
</div>
</div>
<div class="sect2">
<h3 id="_iam_and_security">IAM and Security</h3>
<div class="paragraph">
<p>Strictly speaking, Identity and Access Management (IAM) does not entirely fit into the information security field.
The IAM goes far beyond information security.
IAM can bring user comfort, reduce operation costs, speed up processes, and generally improve the efficiency of the organization.
This is not what information security is concerned with.
Even though IAM is not strictly part of information security, there is still a huge overlap.
IAM deals with authentication, authorization, auditing, role management and governance of objects that are directly related to the information security.
Therefore, IAM and information security have an intimate and very complicated relationship.</p>
</div>
<div class="paragraph">
<p>It is perhaps not too bold to say that the IAM is a pre-requisite to good information security.
Especially the identity management (IDM) part is absolutely critical - even though this may not be that obvious at the first sight.
Yet, the evidence speaks clearly.
Security studies quite consistency rate the <em>insider threat</em> as one of the most severe threats for an organization.
However, there is not much that the technical security countermeasures can do about the insider threat.
The employee, contractor, partner, serviceman - they all get the access to your systems easily and legally.
They can legally pass through even the strongest encryption and authentication because they have got the keys.
Firewalls and VPNs will not stop them, because those people are meant to pass through them to do their jobs.</p>
</div>
<div class="paragraph">
<p>Vulnerabilities are there, obviously.
With the population of thousands of users there is a good change that there is also an attacker.
Maybe one particular engineer was fired yesterday.
Yet, he still has VPN access and administration rights to the servers.
As he might not be entirely happy about the way how he has been treated, the chances are he might be quite inclined to make your life a bit harder.
Maybe leaking some company records would do the trick.
Now we have a motivated attacker who will not be stopped by any countermeasures, and who can easily access the assets.
Any security officer can predict the result without a need for a comprehensive risk analysis.</p>
</div>
<div class="paragraph">
<p>Information security has no clear answers to the insider threat.
This is no easy issue to solve, as there is obviously a major security trade-off.
The business people wants to access the assets easily to do their jobs, to keep the wheels of an organization turning.
However, security team needs to protect the assets from the very users that are accessing them.
There is no silver bullet to solve this issue.
However, there is a couple of things that can be done to improve the situation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Record who has access to what.</strong>
Each user has accounts in many applications through the enterprise.
Keep track which account belongs to which user.
It is very difficult to do that manually.
Yet, even the worst IDM system can do that.</p>
</li>
<li>
<p><strong>Remove access quickly.</strong>
If there is a security incident, then the access rights need to be removed in order of seconds.
If an employee is fired, then the accounts have to be disabled in order of minutes.
It is not a problem for a system administrator to do that manually.
However, will the administrator be available during a security incident late in the night?
Would you synchronize layoffs with the work time of system administrators?
Wouldn&#8217;t system administrators forget to stop all the processes and background jobs that the user might have left behind?
IDM system can do that easily.
Security team can simply disable all the accounts by using IDM system.
Single click is all that is needed.</p>
</li>
<li>
<p><strong>Enforce policies.</strong>
Keep track about the privileges that were assigned to users.
This usually means managing assignment of roles (and other entitlements) to users.
Make sure that the assignment of sensitive roles is approved before user gets the privileges.
Compare the policies and the reality.
System administrators that create accounts and assign entitlements are not robots.
Mistakes can happen.
Make sure the mistakes are discovered and remediated.
This is the natural best practice.
However, it is almost impossible to do manually.
Yet even an average IDM system can do that without any problems.</p>
</li>
<li>
<p><strong>Remove unnecessary roles.</strong>
Role assignments and entitlements tend to accumulate over time.
Long-time employees often have access to almost any asset simply because they needed the data at some point in their career.
The access to the asset was not removed since.
This is a huge security risk.
It can be mitigated by inventing a paper-based process to review the entitlements.
However, such process is very slow, costly, error-prone, and it has to be repeated in regular intervals.
Yet, advanced IDM systems already support automation of this access certification process.</p>
</li>
<li>
<p><strong>Maintain order.</strong>
If you closely follow the principle of least privilege, then you have probably realized that you have more roles that you have users.
Roles are abstract concepts, and they are constantly evolving.
Even experienced security professionals can easily get lost in the role hierarchies and structures.
The ordinary end users often have absolutely no idea what roles they need.
Yet, it is not that hard to sort the roles to categories if you maintain them in a good IDM system.
This creates a role catalog that is much easier to understand, use and maintain.</p>
</li>
<li>
<p><strong>Keep track.</strong>
Keep an audit record about any privilege change.
This means keeping track of all new accounts, account modifications, deletions, user and account renames, role assignments and unassignments, approvals, role definition changes, policy changes and so on.
This is a huge task to do manually.
It is almost impossible to avoid mistakes.
Yet, a machine can do that easily and reliably.</p>
</li>
<li>
<p><strong>Scan for vulnerabilities.</strong>
Mistakes happen.
System administrators often create testing accounts for troubleshooting purposes.
There is an old tradition to set trivial passwords to such accounts.
These accounts are not always cleaned up after the troubleshooting is done.
Also, there may be worse mistakes.
System administrators may assign privileges to a wrong user.
Help desk may enable account that should be permanently disabled.
Therefore, all the applications have to be permanently scanned for accounts that should not be there and for entitlements that should not be assigned.
This is simply too much work to be done manually.
It is not really feasible unless a machine can scan all the system automatically.
This is called reconciliation, and it is one of the basic functionalities of any decent IDM system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Theoretically all of these things can be done manually.
However, it is not feasible in practice.
The reality is that information security seriously suffers - unless there is and IDM system that brings automation and visibility.
Good information security without an IDM system is hardly possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="_risk_based_approach_to_identity_governance_2">Risk-Based Approach To Identity Governance</h3>
<div class="paragraph">
<p>Risk-based approach to identity management and governance is a very good idea.
In fact, it is an excellent idea, one of the best ideas in decades.
However, as with many great ideas, there are difficulties and drawbacks.</p>
</div>
<div class="paragraph">
<p>But wait a moment, what is this "risk-based" thing all about? To answer that question we have to make a quick road-trip through information security landscape.</p>
</div>
<div class="paragraph">
<p>The concept of <em>risk</em> comes from information security theory.
Security practitioners have realized a long time ago that it is all but impossible to create a perfectly secure system.
As you try to make a system more and more secure, every step is more expensive than the previous one.
Every countermeasure is less efficient than the previous one, it is more intrusive, it is less flexible, harder to adapt to business needs.
Eventually, the system gets to the state where it is practically useless for business, yet the system is still not completely secure.</p>
</div>
<div class="paragraph">
<p>Therefore, the security practitioners came with a concept of <em>risk</em>.
<em>Risk</em> is a measure of danger that a particular <em>asset</em> is subjected to.
An <em>asset</em> such as a customer database can be in <em>risk</em> with respect to particular <em>threat</em>, for example a hacker trying to steal the database to sell it to your competition.
The <em>risk</em> tells about the probability of an <em>asset</em> being compromised.
For example, keeping the database in a form of spreadsheet on decades old Windows machine connected to an open Internet is obviously quite a risky thing to do.
The risk can be addressed using <em>countermeasures</em>.
Countermeasures are all the things that we do to make systems more secure, ranging from operating system updates, through access-control systems up to bomb-proof doors and heavily-armed guards.</p>
</div>
<div class="paragraph">
<p>As it is not practical to completely secure a system, there is always some amount of risk that we have to accept.
This is called <em>residual risk</em>, a risk that we are aware of, yet it is not efficient to reduce or eliminate the risk.
Even though residual risk cannot be completely eliminated, there may be risk <em>mitigation</em> plans.
For example, we may accept that there is a risk of an operating system vulnerability, and no amount of automated software updates, vulnerability database integrations and watchfulness is ever going to eliminate the risk completely.
However, we can <em>mitigate</em> the risk by preparing plans to be executed when we are affected by a zero-day vulnerability.
The plan may include disabling network access to vulnerable services as soon as we learn about the vulnerability, investigation that looks for traces of an attacker exploiting the vulnerability, emergency communication and contingency plans and so on.
Risk mitigation is focused on making the impact of such an attack less painful, reducing the damage.</p>
</div>
<div class="paragraph">
<p>In an ideal situation we are completely aware of the <em>risk</em>, so we can implement <em>countermeasures</em> and prepare risk mitigation plans.
However, we need to know quite a lot about the risk for the countermeasures and mitigation plans to be efficient.
Risk is not just a single number, it is a multi-dimensional and often very complex concept.
The amount of risk is evaluated in a <em>risk assessment</em> process, which is often very tedious and demanding exercise.
Risk assessment process evaluates <em>assets</em>, to determine the value of the data and services.
The process looks at <em>threats</em>, such as skills and motivations of an attacker.
The assessment looks at <em>vulnerabilities</em> that attackers can use to gain access to our systems.
It is also concerned with existing <em>countermeasures</em>, processes, policies and other details.</p>
</div>
<div class="paragraph">
<p>This means that the risk assessment process deals with big and complex data that cannot be processed by a human mind alone.
The data are usually fed into <em>risk models</em> to determine the risk.
Risk models are a set of complex mathematical formulas that transform data on <em>assets</em>, <em>threats</em>, <em>vulnerabilities</em> and all the other inputs into a multi-dimensional representation of risk areas.
In theory, the risk model can tell us that we have a high risk in network security, especially when dealing with customer data - and we should really do something about it!</p>
</div>
<div class="paragraph">
<p>The results of risk assessment are meant to drive the implementation of countermeasures and risk mitigation plans.
There are too many countermeasures and mitigation strategies to choose from, we cannot possibly implement them all.
We want only the really efficient ones.
We do not want to waste time and money on sophisticated encryption of data that are just copies of public information, do we?
The risk assessment is supposed to tell us what is important and what is not.
This is an important principle of efficient and systematic information security process: never guess, never go blind, let the risk guide you.
Base your decisions on data.
Implement countermeasures exactly where they are needed, where they are in a good position to address real risks.</p>
</div>
<div class="paragraph">
<p>However, information systems are not the easiest things to analyze.
They never seem to stand still!
The data are changing, new integration routes are added, systems are re-configured.
Yet, the most annoying of all, user accounts and privileges change pretty much every day.
By the time the risk assessment is done, the results are already out of date!
How are we supposed to evaluate the risk, when everything around us is changing constantly?</p>
</div>
<div class="paragraph">
<p>The answer is, of course, <em>automation</em>.
There are parts of risk assessment that cannot be automated.
For example, there is no magic method to automatically assess business value of your data assets.
However, some parts of risk assessment can be automated.</p>
</div>
<div class="paragraph">
<p>This is where we get back to identity management and governance.
Almost all organizations are affected by <em>insider threat</em>, a threat posed by people that are already part of your organization.
Employees, contractors, support engineers, cloud service providers - they already have access to your data.
They do not need to hack anything, they do not need to overcome any countermeasures.
They are already <em>inside</em>.
All it takes to reveal your trade secrets are a simple copy and paste keystrokes.
One file download is all it takes to sell your customer database.
The proliferation of cloud services make such "exploits" entirely trivial.
There is no technological countermeasure, no perimeter that could stop an insider to use a privilege that he or she already has.</p>
</div>
<div class="paragraph">
<p>This means that identity data heavily affect outcome of risk modeling.
A system where almost all of your employees have unrestricted access to a customer database is very likely to pose much higher risk than all the network-related risks combined.
A single person that has administrator-level access to almost every system in your organization is certainly a very attractive <em>phishing</em> target.
There are high risks hidden in the identity data of almost any organization.
Yet, such risk can be easily reduced by adjusting the access rights.
But how to find such risks?
Identity data are often complex, system-specific, distributed in many directories, cloud systems and application databases.
Any identity practitioner can certainly see where this leads: identity management system, of course.</p>
</div>
<div class="paragraph">
<p>Identity management system is an ideal place for evaluation of risks related to identity and access data.
Essential data are already in the database of identity management system: users, roles, role assignments, role composition, entitlements, everything is there.
Entitlements can be assessed to assign a risk score to them.
Then the data can be fed into a risk model, evaluating how are the entitlements combined in roles, how are teh roles assigned to users, identifying high-risk roles and users.
The model is evaluated by the machine, quickly and efficiently.
The efficiency opens up a whole range of possibilities, that form the essence of a risk-based approach to identity governance.</p>
</div>
<div class="paragraph">
<p>As we can evaluate a risk posed by any individual user, we can easily identify dangerous accumulation of privileges in the hands of a single user.
Then we can focus on addressing this risk, analysing why have the privileges accumulated, whether they are all necessary, removing excess privileges to lower the risk.
Perhaps we can consider changing business processes to divide the responsibilities among several users, lowering the risk even further.
We can evaluate the risk model after each step, checking whether we have reached acceptable risk levels already.</p>
</div>
<div class="paragraph">
<p>The risk model can evaluate risk of each role.
This allows detection of anomalies, such as assignment of a powerful high-risk role to an ordinary user that is supposed to be low-risk.
Such role is likely to be assigned by mistake, or perhaps it was a role assigned during an emergency that was never removed.
Unassignment of such role may be a quick way to reduce the risk.
Smart system could suggest several types of such <em>outliers</em>, where privileges of an individual users stand out from the surrounding.</p>
</div>
<div class="paragraph">
<p>Once we have the concept of risk established in our system, we can use it in security policies.
For example, it makes sense to require stronger password for high-risk users, or even better, automatically set up a multi-factor authentication for them.
It may be desirable to re-certify privileges of high-risk users more frequently than those of low-risk users.
Assignment of new role to a high-risk user may need to pass through additional approval stage.
The policies can take the <em>risk</em> into consideration.
This approach is often referred to as <em>adaptive security</em>.</p>
</div>
<div class="paragraph">
<p>There are even more advantages when the risk-based approach is applied also to other areas of identity and access management field.
For example, it may be a good idea to require strong authentication from high-risk users, while allowing weaker authentication for low-risk users.
This can be achieved in many ways, the easiest is perhaps for identity management system to propagate risk scores to access management user profiles.</p>
</div>
<div class="paragraph">
<p>Risk-based identity management and governance is indeed the right thing to do.
However, the devil is in the details, and the reality is much harder than the glossy marketing brochures dare to admit.
There are hidden dangers and dark corners on this route:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One risk assessment means nothing.
Nothing at all.
The results are out of date as soon as they are produced by the model.
You have to do assessment continually, all the time, since now till eternity.
You take the results of an assessment, plan countermeasures, apply them, only to do all the work over again.
This is called "security process".
It never ends.</p>
</li>
<li>
<p>Risk evaluation is almost always subjective.
When evaluating risk of any individual entitlement, you will probably use subjective terms such as "low", "medium" and "high".
The subjective terms are often hidden behind scores, numbers that may look like they are exact values.
In reality, they are everything but exact.</p>
<div class="paragraph">
<p>Subjective risk assessment is pretty much a standard method.
Objective risk measures are sometimes tries, such as conversion of risk to a monetary value.
However, such "objective" measures are often very misleading, and they are generally frowned upon by information security practitioners.
There is nothing fundamentally wrong with subjective risk assessment as long as you are aware of the limitations.
Perhaps the most important rule is to keep the assessment consistent and proportional.
Entitlements that are assigned "low" risk level should pose approximately the same risk, and it should be significantly lower than all the entitlements marked as "medium" risk.</p>
</div>
</li>
<li>
<p>You need risk model appropriate for your organization and situation.
When it comes to risk models, one size does not fit all.
There are simple risk models appropriate for quick assessments in organizations with low security requirements.
Then there are overly complex risk models that are designed for high-security military setting.
Even if you find a model that fits your needs, you still need to fine-tune it.
You cannot just buy an instant ready-to-serve-in-5-minutes risk model.
Such model will never work for you.</p>
</li>
<li>
<p>Model is not reality.
Model is meant to be an approximation of reality.
However, how well the model approximates reality must not be taken for granted.
Risk model may not for you, and you may not even realize it.
Bad model will get you into a false sense of security, claiming that you are all green while in fact you can be in grave danger.
Do not trust your risk model blindly.
Try to validate the results, try to confront model results with reality as much as you can.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Information security is quite a strange field.
You can clearly prove that your system is <em>insecure</em>, for example by successfully attacking your system.
Yet, you can never completely prove that your system is <em>secure</em>.
This limitation is a major source of confusion, and it also opens up opportunities for charlatans, offering their security snake oil on the market.
As you cannot buy information security process, you cannot buy a ready-made risk-based approach to identity governance.
You have to build it yourself.
Having advanced and smart identity governance platform at your side is unquestionably a great help.
However, such a platform is only a tool.
Even the smartest and most expensive tool will not do all the work.
It will make your work more efficient, but you still need to be the one driving it.
One size does not fit all.
Your organization is different to other organizations.
That is what makes you unique, what gives you competitive edge, what makes you survive on the market.
You cannot expect to buy a model or a process that fits your needs perfectly.
You have to adapt and develop your own models, policies and processes.
Having a starting point that is similar to your needs is a huge advantage.
Starting from industry-specific frameworks, templates and samples will save you a lot of time.
Go for these, whenever they are available.
However, you will have to understand how the frameworks work, you will need to know what you are doing, as you will certainly need to adapt them to your needs.</p>
</div>
<div class="paragraph">
<p>Similarly to information security, "off the shelf" is mostly just an illusion in identity management and governance.
Whatever the bold marketing statements say, you cannot just buy it and run it.
No, not even in the cloud.
You can buy identity governance <em>platform</em> as a service, but you cannot buy identity governance.
You will have to learn a lot of things, you will have to dive deep into policies and models, you will have to do a lot of work yourself.
Set your expectations realistically.</p>
</div>
<div class="sect3">
<h4 id="_zero_trust_approach">Zero-Trust Approach</h4>
<div class="paragraph">
<p><em>Zero-trust</em> is an approach to design network and application systems.
The basic idea is that a system should not implicitly trust any other system, not even systems located on a "secure" corporate network.
Simply speaking, zero-trust approach is mostly about removing <em>security perimeter</em>.</p>
</div>
<div class="paragraph">
<p>For many decades, corporate networks were designed using <em>hard exterior, soft interior</em> approach.
Corporate network was protected from the Internet by an army of specialized security systems and techniques, such as firewalls, de-militarized zones, network traffic analysers, intrusion detection systems, network anti-virus scanners and everything else a booming network security market could provide.
While the castle gates were heavily protected, the interior of corporate network was very <em>soft</em>.
Originally, there were no security measures inside corporate networks at all.
Anyone that got inside could connect to any system.
Of course, basic authentication and authorization mechanisms were usually there, but the network was not segmented, and the traffic was usually not even protected by basic encryption.
This approach created a <em>security perimeter</em> around corporate network.
If you want to keep the data secure, you have to make sure nobody gets into the network.</p>
</div>
<div class="paragraph">
<p>Of course, this approach does not really make much sense in the Internet era.
There is no such thing as a <em>network perimeter</em>, not since the invention of WiFi, mobile data and USB keys, anyway.
It is ridiculously easy to breach the perimeter by connecting a WiFi device to the corporate network.
However, even that was usually not needed, as the data can be copied to USB keys, or easily moved outside the perimeter by using virtual private network (VPN) access.
Corporate security professionals tried to address such threats by strictly controlling user&#8217;s devices, such as disabling USB ports, disabling access to other networks while the device was part of VPN, and so on.
However, none of these countermeasures were really effective, and they were usually very intrusive and inconvenient for the users.
Advent of cloud services and mobile devices was the last drop.
The traditional corporate information security approach is dead.
Even the most traditional security practitioners had to admit what was already obvious: there is no perimeter.</p>
</div>
<div class="paragraph">
<p>The old approach was replaced by a new one: <em>zero trust</em>.
An application should not trust any other application, not even an application on the same corporate network.
Network perimeter was replaced by <em>mutual authentication</em> and <em>network traffic protection</em>.
Each application must authenticate the other end of the connection, whether it is talking to the party it is supposed to talk to.
Network traffic always needs to be encrypted and authenticated (signed), always assuming that it can be passing through an insecure network.
Simply speaking, we treat corporate network in exactly the same way as we are treating public Internet.
The <em>soft interior</em> turned into <em>hard interior</em>, and the <em>perimeter</em> was no longer needed.</p>
</div>
<div class="paragraph">
<p>The concept of zero trust is not new at all.
It was here pretty much since the very beginnings of information security.
Security practitioners are trained not to trust anything or anyone, set up policies, require authentication, deny access by default, encrypt all network traffic, minimize privileges, manage risks, and so on.
Therefore, "zero trust" approach is essentially just a thorough application of proper information security principles.
This approach is here for decades, it just had different names: defence in depth, perimeterless security, network hardening and so on.</p>
</div>
<div class="paragraph">
<p>Even though zero trust approach is not new, it dramatically gained on importance in the era of cloud services and remote access.
Many functions provided by traditional corporate applications are provided by cloud services now.
Such applications need data to work, therefore, the very use of "as a service" applications is by itself a breach of the perimeter.
Cloud applications need to work together with on-premise applications.
Traditional enterprise integration patterns based on <em>soft interior</em> do not work in this brave new world anymore.
All of that is driving the <em>zero trust</em> concepts.</p>
</div>
<div class="paragraph">
<p>Of course, "zero trust" is more a wish rather than a strict rule.
A system that trusts nothing will not be able to work at all.
There is always some amount of <em>trust</em> involved, even in <em>zero trust</em> approach.
The system must trust that the root keys and certificates are authentic.
There is an implicit trust that the developers have not introduced a back door into system code.
Zero trust approach should perhaps be called "minimal trust approach".
However, "zero trust" is much more attractive in glossy magazines and presentations.
Whatever is the approach called, the basic principle remains the same: aggressively minimize implicit trust in the system.</p>
</div>
<div class="paragraph">
<p>Identity permeates everything, therefore the zero trust approach has an impact on identity and access management as well.
Impact on access management technologies is perhaps quite obvious.
Access management deals mostly with authentication.
The applications need to authenticate to each other in this new <em>zero trust</em> world.
Therefore, the access management systems need to handle authentication of non-person identities, such as applications and devices.
Many scenarios do not significantly deviate from the usual authentication, perhaps the only difference is that the authentication needs to be completely non-interactive.
However, there are also more complex authentication scenarios, such as an application authentication on behalf of a user.
Traditional authentication methods (such as password-based authentication) are obviously ill-prepared for such scenarios.
Therefore, the zero trust approach is often combined with introduction of new authentication mechanisms.</p>
</div>
<div class="paragraph">
<p>Impact of zero trust approach on identity management systems is much more subtle.
Zero trust approach requires mutual authentication of communication parties.
Which means that the identity management system needs to manage non-person identities such as applications and devices.
This requirement is not new, therefore most well-maintained identity management products are more than capable in this aspect.
The problematic part is usually the connection between the identities, the <em>relationship</em>.
If two applications have to communicate, both of them need to know about the other one.
API keys, pre-shared secrets, certificates and other cryptographic material needs to be set up before first communication can happen.
The credentials need to be updated, keys must be changed periodically, certificates need to be renewed.
Such application credentials are much more important than passwords ever were, as application credentials are quite literally the keys to the kingdom.
An attacker that gets access to the application keys has access to all the data in cloud applications, which very likely means your payroll data, customer database, internal documents, almost everything that is important to you.
Experienced information security professionals know, that it is not encryption that is the most difficult part of cryptography.
The key management is.
Similarly, it is not the authentication that is the most difficult problem in zero trust approach.
Identity and credential management is much harder.
Today, application identities and credentials are usually configured manually by system administrators.
However, such approach does not scale.
The whole idea of "as a service" applications is to make information systems more flexible, more dynamic, and especially less demanding when it comes to system administration.
Manual management of application identities goes well against that idea.</p>
</div>
<div class="paragraph">
<p>What can an identity management system do for zero trust approach?</p>
</div>
<div class="paragraph">
<p>Firstly, it can do the same thing it normally does.
It can manage user identities.
In zero trust mode, users have to authenticate everywhere, they have to be authorized everywhere, in every application or service.
While authentication can usually be handled by access management or single sign-on systems, authorization is much harder.
Identity management system can do it, it can manage entitlements and privileges, it can de-provision unnecessary accounts and access rights.
This part is relatively easy, it is what identity management systems do for decades.</p>
</div>
<div class="paragraph">
<p>Secondly, identity management system can manage access of one application to other application.
This means management of application accounts, management of application credentials, privileges, de-provisioning the accounts when application is decommissioned.
This may sound simple, but it is all but simple in reality.
The most basic requirement is an <em>application inventory</em>, an authoritative list of applications in an organization.
However, many organizations do not have that at all.
Those organizations that have it, usually have in a form of informal spreadsheet that is not entirely machine-readable.
How is identity management system supposed to even start management of application identities, when there is no authoritative source?
Therefore, the effort should start with building such a source, which may be a manually-maintained information in the identity management system.
Then, application accounts and entitlements (groups) need to be associated with the application.
Applications much have owners, which can be maintained in IDM system.
As application accounts and entitlements are associated with an application, they can be automatically de-provissioned when application is decommissioned.
However, perhaps the most challenging part is credential management.
The credentials should be changed periodically.
However, this change has to be synchronized on both sides of the communication channel (both client and server part), otherwise there will be an outage.
This is difficult to automate, even with the state-of-the-art IDM system.</p>
</div>
<div class="paragraph">
<p>Overall, current identity management and governance platforms are not ready for full management of applications, application accounts and entitlements.
Only a partial functionality is usually available.
Even though the concepts of zero trust approach are quite old, they were never applied systematically at scale.
Therefore, there was not a sufficient demand to implement required features in identity management systems.
The future will tell whether current wave of zero trust hype brings such demand.
However, pretty much all IDM systems much evolve and develop new features.
Therefore, it is crucial to choose and IDM platform that can evolve.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_building_identity_and_access_management_solution">Building Identity and Access Management Solution</h3>
<div class="paragraph">
<p>There is no single identity and access management solution that would suit everybody.
Every deployment has specific needs and characteristics.
Deployment in a big bank will probably focus on governance, role management and security.
Deployment in small enterprise will focus on cost efficiency.
Cloud provider will focus on scalability, user experience and simplicity.
Simply speaking, one size does not fit all.
Almost all IAM solutions use the same principal components.
However, product choice, solution topology and configuration will significantly vary.
Do not expect that you download a product, install it and that it will solve all your problems.
It won&#8217;t.
Customization is the key.</p>
</div>
<div class="paragraph">
<p>We consider identity management to be heart and brain of any IAM solution.
This is one of the reasons why we have started midPoint project.
The rest of this book will focus almost exclusively on identity management and the use of midPoint as the IDM component.
This is the place where theory ends and practice begins.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="02-midpoint-overview">2. MidPoint Overview</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Chaos was the law of nature; Order was the dream of man.
</blockquote>
<div class="attribution">
&#8212; Henry Adams
</div>
</div>
<div class="paragraph">
<p>MidPoint is an open source identity governance and administration (IGA) platform.
It is a very rich and sophisticated system that provides many advanced features.
MidPoint is maintained by Evolveum – a company dedicated to open source development.
All midPoint core developers work for Evolveum.
However, there are also partners and other engineers that are contributing to midPoint development.</p>
</div>
<div class="paragraph">
<p>One of the main differences between midPoint and other IGA systems is that midPoint is designed and implemented with one primary goal in mind: <em>practicality</em>.
This goal goes deep into the very foundations of midPoint.
To be more concrete, we understand <em>practicality</em> as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Things that are simple or frequently used should be easy to configure.
Propagation of password changes, enable/disable of user, account synchronization – these should be as easy as possible.
As simple as flicking a switch, or setting few configuration properties.</p>
</li>
<li>
<p>Things that are more complex or used less frequently may be a bit harder.
Such as editing XML, YAML or JSON file, or writing few lines of Groovy script.</p>
</li>
<li>
<p>Things that are very complex or very unusual should be still possible.
However, these might not be easy.
It may require longer scripts, or implementing some Java classes.
In extreme case, it may even require forking and modifying the source code.
However, it must be possible to do almost anything.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Simply speaking, midPoint is following the Pareto principle: 20% effort brings 80% benefits.
There are many mechanisms that support this approach.
Some are based in midPoint design, some originate from midPoint development practices and some are even supported by the Evolveum business model.</p>
</div>
<div class="paragraph">
<p>Simple solutions which do not deviate from the usual requirements must be easy to implement.
Good identity and access management programs start simple, solving common problems.
The start should be relatively easy, granting benefits early in the project.
The project then proceeds in iterations, each iteration improving upon the previous one.
Each iteration is bringing tangible results.
As the requirements get more complex, the implementation effort may grow.
The project may eventually reach a point where the effort outweighs the benefits.
This is the right place to stop, maybe return to the project later.</p>
</div>
<div class="paragraph">
<p>This is known as <em>iterative and incremental</em> process.
It is proven to be efficient and practical approach many times over.
MidPoint is designed for this process, right from its very beginning.
It is at the core of midPoint development philosophy.</p>
</div>
<div class="paragraph">
<p>MidPoint is an open source system.
Therefore, there is no license cost that would offset the initial costs.
Even small projects are feasible with midPoint.
You can start prototype or proof-of-concept projects today.
There is no need for any paperwork.
Just download midPoint and start.
Right now.
You can see for yourself what midPoint can do.</p>
</div>
<div class="sect2">
<h3 id="_how_midpoint_works">How MidPoint Works</h3>
<div class="paragraph">
<p>MidPoint does what any identity management system is supposed to do: it manages identities.
The very basic functionality of midPoint is the synchronization of identity data that are stored in various applications, databases, directory servers and cloud data stores.
We call all these systems <em>identity resources</em>, or <em>resources</em> for short.
MidPoint is using <em>connectors</em> to reach the identity resources.
MidPoint can propagate a change that happened in one identity resource to other identity resources.
E.g. an employee record appears in the HR system, it is picked up by midPoint, processed, transformed and then new Active Directory and CRM accounts are created.
This is the process that we call <em>synchronization</em>.
It is at the core of everything else that midPoint does.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-01-midpoint.png" alt="midPoint">
</div>
</div>
<div class="paragraph">
<p>MidPoint has a rich graphical user interface (GUI) that can be used to manage the identities.
Changes made by system administrators are automatically propagated to all affected identity resources.
E.g. security officer disables a user by clicking on <b class="button">Disable</b> button in midPoint user interface.
Then MidPoint makes sure that all accounts that belong to the user are immediately disabled.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-02-midpoint-gui.png" alt="midPoint GUI">
</div>
</div>
<div class="paragraph">
<p>This is the essence of midPoint operation.
It sounds simple, because this description is extremely simplified.
The reality is much more complicated.
Most of the important things happen inside midPoint before the changes are applied to target resources.
For each change that midPoint detects it needs to evaluate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Roles:</strong> MidPoint computes where the user <em>should</em> have access.
This is usually given by the roles that the user has.
The role structure is often quite rich and dynamic.
There may be role hierarchies, parameters, expressions and policies to consider.</p>
</li>
<li>
<p><strong>Organizational structure:</strong> Users usually belong to organizational units, projects, teams or groups.
Some of them may give additional privileges to the user, or they may apply policies.</p>
</li>
<li>
<p><strong>Status and life cycle:</strong> Accounts can be created, enabled, disabled, archived or deleted.
There are many situations in the <em>lifecycle</em> that need to be considered.
E.g. we may want to create a disabled account one week before a new employee starts his work, enable the account on his first day, disable the account on his last day and delete it three months after he leaves.</p>
</li>
<li>
<p><strong>Attributes and identifiers:</strong> Simple synchronization scenarios assume that attributes and values should be the same in all the synchronized systems.
That is a nice theory, but it almost never works like that in real world.
In reality there are incompatible attribute names, data formats and conventions to take into consideration.
Attribute names need to be translated, values need to be transformed, data types need to be converted.
This is different for each system, and even for each instance of each system.
Small algorithms in form of scripting expressions are often needed to properly transform the values.</p>
</li>
<li>
<p><strong>Credential management:</strong> Password changes need to be propagated to the target systems.
Sometimes we want to synchronize password with all systems, sometimes we want just a subset of systems.
Password policies need to be evaluated, password history needs to be checked, password may need to be encoded, encrypted and/or hashed before storage.</p>
</li>
<li>
<p><strong>Policy rules:</strong> Policies are evaluated, each rule applied to current situation.
The rules may prohibit illegal situations, such as dangerous combination of roles.
Policy rules may mark the object for later inspection by administrator.
The rules may do almost anything to make sure the system is compliant.</p>
</li>
<li>
<p><strong>Authorizations:</strong> Some users are more powerful than others.
There are midPoint administrators with very powerful privileges, there are delegated administrators that can manage only a small part of the data, and there are end users with access to self-service only.
MidPoint has a very flexible authorization mechanism, allowing thousands shades of privileges to be applied to arbitrary subset of data and operations.
The authorizations need to be evaluated for every operation that midPoint makes.</p>
</li>
<li>
<p><strong>Consistency:</strong> The account in the target application might have changed since midPoint has updated it.
The current change may no longer be applicable to the current state of the account.
The change that midPoint wants to make may conflict with the native change, the change may be partially applied already, the account may have attribute values that it should not have or the account may not exist at all.
MidPoint has to detect such situations and react accordingly, e.g. by re-creating a deleted account before applying the changes.</p>
</li>
<li>
<p><strong>Approvals:</strong> MidPoint determines if any of the changes need to be approved before they are applied.
If that is the case, then midPoint drives the request through an approval process.
There may be multiple stages of approval, approver groups, optional approvers, the request can be escalated if approvers do not take action in time and so on.
Approval process may be quite complicated, the actual steps are computed individually for each request, based on approval policies.</p>
</li>
<li>
<p><strong>Notifications:</strong> MidPoint can notify users when important events happen.
E.g. it notifies the user that he can access a new account, or it notifies the administrator if something goes wrong.</p>
</li>
<li>
<p><strong>Audit:</strong> MidPoint records all the changes into an audit trail.
This can be used by security officers or specialized analytic engines later to investigate past situations and changes.
Audit trails provides <em>accountability</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is a lot of things to process, evaluate and execute.
Some of these steps are quite complex.
Indeed, there are many sophisticated algorithms implemented in midPoint.
There are algorithms that evaluate role structures, organizational structures, temporal constraints, policy rules, password policies and so on.
MidPoint does all that for you.
The only thing that is needed is to configure them properly.</p>
</div>
<div class="paragraph">
<p>However, midPoint does even more than that.
MidPoint does not only manage identities, it can also manage any object that is anyhow related to identity management.
MidPoint can manage roles, role catalogs, organizational structures, groups, projects, teams, services, devices and almost anything else you can imagine.</p>
</div>
<div class="paragraph">
<p>MidPoint is also an <em>identity governance system</em>.
The job of identity management features is to make sure that the policies are consistently applied through the organization.
The governance features assist with the maintenance and evolution of those policies.
MidPoint implements <em>access certification</em> process.
This is a recurring process that asks managers to confirm that the users still need the privileges that they have previously received.
MidPoint contains mechanism to sort roles into hierarchies and categories.
That is necessary to maintain order during role engineering and maintenance of role definitions.
MidPoint has mechanisms for selective enforcement of role which comes very useful during migrations and when new system is connected to midPoint.
MidPoint has support for policy lifecycle, general policy rules and so on.
Even more work in that direction is planned in future midPoint versions.
We fully understand that it is not enough to simply apply the policies.
Policies are living things and they need to evolve.</p>
</div>
<div class="paragraph">
<p>Last, but certainly not least, midPoint provides <em>visibility</em>.
Identity data often look like a huge maze, a labyrinth or users, roles, organizational units, entitlements and policies.
It is too easy to get lost there.
However, there are treasures in that labyrinth.
There are patterns and structures hidden in that huge pile of data.
Roles and policies buried there, as well as risks and dangerous anomalies lurking behind the corners.
MidPoint provides <em>identity analytic</em> capabilities to uncover them.
There are powerful <em>reporting</em> and <em>simulation</em> mechanisms.
Recent midPoint versions introduced <em>role mining</em>, a capability to find role patterns in the data.
MidPoint gives identity professionals capability to see inside identity data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_case_study">Case Study</h3>
<div class="paragraph">
<p>This book is about <em>practical</em> identity management.
Therefore, we will get very close to a practice by demonstrating midPoint features using a case study.
This is a case study of a fictional company ExAmPLE, Inc.
The name stands for "Exemplary Amplified Placeholder Enterprise".
ExAmPLE is a mid-sized financial company.
Its operation heavily relies on information technologies, therefore there is a diverse set of applications and information systems ranging from legacy applications to cloud services.
As ExAmPLE has few thousand employees and there is a good potential for growth, the management has decided to start an identity and access management program.
The first step of the program is deployment of midPoint as the identity governance and administration platform.</p>
</div>
<div class="paragraph">
<p>Eric is an IT engineer at ExAmPLE, Inc.
He has taken the responsibility to install and configure midPoint.
Eric spins up a new container with midPoint in it.
Couple of minutes later, midPoint instance starts up.
Eric logs in to the midPoint user interface.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-03-dashboard.png" alt="Dashboard">
</div>
</div>
<div class="paragraph">
<p>MidPoint instance is almost empty after fresh installation.
It contains only a couple of essential objects.
Luckily, Eric is a smart engineer.
He has already read through this book, and he knows exactly what he needs to do.</p>
</div>
<div class="paragraph">
<p>First thing to do is to populate midPoint with employee data.
The primary source of ExAmPLE employee data is an HR system.
The HR system is quite big and not entirely flexible piece of software.
It is not easy to connect to that system directly.
Fortunately, it is quite easy to get a text export of the employee data in comma-separated (CSV) format.
Eric plans to use this file to get employee data to midPoint.</p>
</div>
</div>
<div class="sect2">
<h3 id="_connectors_and_resources">Connectors and Resources</h3>
<div class="paragraph">
<p>MidPoint communicates with all the source and target systems by the means of <em>connectors</em>.
Connectors are relatively small Java components that are plugged into midPoint.
There is usually one connector for each type of the connected system.
There are connectors for LDAP servers, Active Directory, databases, cloud applications, UNIX operating systems and so on.
The responsibility of a connector is to translate protocols.
E.g. LDAP connector translates midPoint search commands to LDAP search requests.
Database connector translates the requests to SQL language.
Cloud connectors translate midPoint search commands to HTTPS requests for their respective cloud APIs.
The UNIX connector creates an SSH session and translate midPoint create command to the invocation of Linux <code>useradd</code> binary.
And so on.
Each connector talks using its own communication protocol on one side.
On the other side, the connectors translate the information to a common format that is understood by midPoint.</p>
</div>
<div class="paragraph">
<p>There is no distinction between source and target system when it comes to the connector.
The same connectors are used for source and target systems.
The difference is only in midPoint configuration.</p>
</div>
<div class="paragraph">
<p>The connectors are distributed as Java binaries (JAR files).
To deploy them to midPoint you just need to place them in the correct directory.
MidPoint automatically discovers and examines the connectors during start-up.
A handful of frequently-used connectors is even bundled right into midPoint distribution.
These connectors do not need to be deployed, they are automatically available.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-04-connectors-resources.png" alt="Connectors and resources">
</div>
</div>
<div class="paragraph">
<p>Connector of a specific type works for all the systems that communicate by the protocol supported by connector.
E.g. LDAP connector works for all the LDAP-compliant servers.
Connector is a very generic piece of code.
It does not know the hostname, port or passwords that are needed to establish a connection to a particular server.
The configuration that specify connection parameters for individual server is stored in special configuration object called <em>resource</em>.
The term <em>resource</em> in midPoint terminology means <em>identity resource</em>, any system which contains identity data and is connected to a midPoint instance.</p>
</div>
<div class="paragraph">
<p>Therefore, Eric the Engineer needs to define a new <em>resource</em> in midPoint in order to get ExAmPLE employees into midPoint.
This <em>resource</em> represents the CSV file exported from the HR system.
MidPoint distribution contains CSV file connector already, therefore there is no need to deploy the connector binary package.
All that Eric has to do is to create a new <em>resource</em> definition.
There are (at least) two ways to do it.
Firstly, there is a <em>resource configuration wizard</em> in midPoint user interface.
Eric can use the wizard to configure a new resource from scratch.
However, Eric is quite an experienced professional, and he is also a little bit impatient.
Therefore, he decides to use the other approach: start from an example.
There are examples of various resource definitions in the midPoint distribution package, and even more examples are available on-line.
Eric quickly locates an XML file that contains a complete example of a CSV resource.
He edits the file to change the filesystem path to his CSV file and adjusts the names of the columns to match the format of his file.
The very minimal resource configuration specifies just the resource name, connector and connector configuration.
The XML file that Eric creates looks approximately like this (simplified for clarity):</p>
</div>
<div class="listingblock">
<div class="title"><code>resource-csv-hr-bare.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">03c3ceea-78e2-11e6-954d-dfdfa9ace0cf</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>HR System<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectorType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ...<span class="tag">&lt;/connectorRef&gt;</span>
    <span class="tag">&lt;connectorConfiguration&gt;</span>
        <span class="tag">&lt;configurationProperties&gt;</span>
            <span class="tag">&lt;filePath&gt;</span>/opt/midpoint/var/resources/hr.csv<span class="tag">&lt;/filePath&gt;</span>
            <span class="tag">&lt;fieldDelimiter&gt;</span>,<span class="tag">&lt;/fieldDelimiter&gt;</span>
            <span class="tag">&lt;uniqueAttribute&gt;</span>empno<span class="tag">&lt;/uniqueAttribute&gt;</span>
        <span class="tag">&lt;/configurationProperties&gt;</span>
     <span class="tag">&lt;/connectorConfiguration&gt;</span>
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are a hands-on type of engineer you probably want to follow what Eric is doing in your own midPoint instance.
All the files that Eric is using are provided in a form of ready-to-use samples.
Please see <a href="#92-additional-information">Additional Information</a> chapter at the end of this book for the details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then Eric navigates to <b class="menuref">Configuration</b> section of midPoint user interface and imports the XML file into midPoint using <b class="menuref">Import object</b> tool.
Import operation creates new resource definition in midPoint.
Eric now navigates to <span class="menuseq"><b class="menu">Resources</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">All resources</b></span> in <b class="menuref">Administration</b> section of the midPoint user interface.
The new CSV resource is there.
When Eric clicks on the resource name a resource details screen appears.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-05-resource-hr.png" alt="HR resource">
</div>
</div>
<div class="paragraph">
<p>Eric can click on <b class="button">Test connection</b> button to test connection to the resource.
As this is a local CSV file, there is no real connection.
The test checks that the filesystem path is correct, that the file exists and that it can be opened.
The connector reads the CSV file header to discover the structure of the data in the CSV file, and presents the information to midPoint.
This is stored in midPoint as <em>resource schema</em>, which describes structure of accounts in this resource.
The resource is now prepared for use.</p>
</div>
<div class="paragraph">
<p>There is not much that Eric can do with the resource yet.
We need to explain a couple of essential midPoint concepts before moving forward with our case study.</p>
</div>
</div>
<div class="sect2">
<h3 id="_user_and_accounts">User and Accounts</h3>
<div class="paragraph">
<p>The concept of <em>user</em> is perhaps the most important concept in the entire identity management field.
The term <em>user</em> represents physical person: an employee, support engineer, temporary worker, student, teacher, customer, etc.
On the other hand, the term <em>account</em> refers to the data structure that allows the user to access applications.
This may be an account in the operating system, LDAP entry, row in the database table and so on.
Typically, one <em>user</em> has many <em>accounts</em> – usually one account for each resource.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-06-user-account.png" alt="User and accounts">
</div>
</div>
<div class="paragraph">
<p>The data that represent <em>users</em> are stored in midPoint, while the data that represent <em>accounts</em> are stored "on the resource side".
Which means that <em>accounts</em> are stored in the connected applications, databases, directories and operating systems.
<em>Accounts</em> are not stored in midPoint.
Under normal circumstances, MidPoint keeps just account identifiers and some meta-data about the accounts.
All other account attributes are retrieved when needed.
MidPoint is using the <em>connectors</em> to fetch <em>account</em> data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Terminology</div>
We will strictly distinguish the terms <em>user</em> and <em>account</em> in this book.
Such a strong distinction is also made in the midPoint user interface and documentation.
It is very useful to get used to this terminology.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Accounts are <em>linked</em> to users that own the accounts.
MidPoint knows which account belongs to which user.
MidPoint can list all the accounts for any user, it can synchronize the data, it can disable all the accounts of a particular user and so on.
This user-account <em>link</em> is almost always automatically established and maintained by midPoint.</p>
</div>
<div class="paragraph">
<p>MidPoint comes with a built-in data model (<em>schema</em>) for <em>users</em>.
It contains properties that are frequently used to describe users such as full name, e-mail address and telephone number.
There is a reasonable set of properties that should be a good starting point for most deployments.
Of course, as most midPoint objects, the user schema can be extended with custom properties if needed.</p>
</div>
<div class="paragraph">
<p>However, there is no built-in data model for <em>accounts</em>.
Such data model would not be possible.
Every resource may support different account attributes.
Account attributes may have different names, different types and the values may have different meaning.
MidPoint is designed to handle those differences.</p>
</div>
<div class="paragraph">
<p><em>Account schema</em> may significantly differ from resource to resource.
Yet midPoint must be able to synchronize all the accounts from any kind of resource imaginable.
In this case the <em>user schema</em> works as a unifying data model.
The schema of each account is <em>mapped</em> to the user schema.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-07-user-account-mapping.png" alt="User-account mapping">
</div>
</div>
<div class="paragraph">
<p>Schema for resource accounts is dynamically discovered when midPoint connects to the resource for the first time.
MidPoint interprets the schema and automatically adapts to it.
E.g. when midPoint displays information about an account, the user interface fields are dynamically generated from the discovered schema.
MidPoint does that all by itself.
No extra configuration and no coding is necessary.
Except for one thing.
We need to tell midPoint which <em>type</em> of account is the right one.</p>
</div>
<div class="paragraph">
<p>Many systems support variety of object types: accounts, groups, roles, organizational units.
We call such types <em>object classes</em> in midPoint.
Similarly to account attributes, <em>object classes</em> vary from resource to resource.
Therefore, we need to specify which <em>object class</em> is the right one to use for accounts.
Resource definition has <code>schemaHandling</code> section which is designed for this kind of specifications:</p>
</div>
<div class="listingblock">
<div class="title"><code>resource-csv-hr-minimal.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">03c3ceea-78e2-11e6-954d-dfdfa9ace0cf</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>HR System<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectorType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ...<span class="tag">&lt;/connectorRef&gt;</span>
    <span class="tag">&lt;connectorConfiguration&gt;</span>
        <span class="tag">&lt;configurationProperties&gt;</span>
            <span class="tag">&lt;filePath&gt;</span>/opt/midpoint/var/resources/hr.csv<span class="tag">&lt;/filePath&gt;</span>
            <span class="tag">&lt;fieldDelimiter&gt;</span>,<span class="tag">&lt;/fieldDelimiter&gt;</span>
            <span class="tag">&lt;uniqueAttribute&gt;</span>empno<span class="tag">&lt;/uniqueAttribute&gt;</span>
        <span class="tag">&lt;/configurationProperties&gt;</span>
     <span class="tag">&lt;/connectorConfiguration&gt;</span>

    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>HR Record<span class="tag">&lt;/displayName&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>AccountObjectClass<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>

<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is how we tell midPoint that resource supports object type (using <code>objectType</code> clause) that is interesting for us.
This object type should be labeled as <code>HR Record</code> in midPoint user interface.
The connector will use <code>AccountObjectClass</code> object class when dealing with this type of accounts.
MidPoint now knows how to access our HR records in a form of <em>accounts</em> in <code>HR System</code> resource.</p>
</div>
<div class="paragraph">
<p>Getting back to our ExAmPLE story, Eric has an HR resource configured.
Now he can see the "accounts" that the users have in the HR system.
Eric opens the resource detail page in the midPoint GUI and navigates to <b class="menuref">Accounts</b> panel.
There is not much to see yet.
We would like to see all the HR records here.
However, reading all the accounts may be quite a demanding task, therefore midPoint does not do it automatically.
Eric has to click on <b class="button">Reload</b> button to initiate the process for the first time.
The list of accounts appears:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-08-resource-hr-accounts.png" alt="Resource HR accounts">
</div>
</div>
<div class="paragraph">
<p>All that can be seen in this list are just employee numbers, because employee number is set as the primary identifier for the HR system.
Click on the employee number displays more details about the respective "account".
However, these data are not real accounts in this particular case.
These are lines in the CSV file exported from the HR database.
However, they describe some aspects of user&#8217;s <em>identity</em>, therefore midPoint interprets them as <em>accounts</em>.
For midPoint, "account" is a generic term used to describe any resource-side data structure that represents the user.</p>
</div>
</div>
<div class="sect2">
<h3 id="_initial_import">Initial Import</h3>
<div class="paragraph">
<p>The <em>user</em> is a central concept for any identity management system, and midPoint is no exception.
MidPoint needs reliable information about users to work correctly.
The HR system is usually a relatively good source of user information.
Eric needs to get that information from the HR system into midPoint.
He has already set up a resource that connects to the CSV file exported from the HR system.
However, the resource does not do anything interesting by default.
It has to be configured to pull the information from the HR file into midPoint.
What Eric needs is a set of <em>mappings</em>.
<em>Mapping</em> is a mechanism for synchronization of attribute values between <em>user</em> and <em>accounts</em>.
In this case, Eric needs <em>inbound</em> mappings to import the data.
Inbound mappings synchronize the value in the direction from the resource into midPoint.
Eric can open the resource definition in the configuration wizard in GUI, and he can add the mappings there.
However, Eric likes to know how things work.
He looks at the configuration samples again, and he adds the mappings in the XML form.
Inbound mapping looks like this:</p>
</div>
<div class="listingblock">
<div class="title"><code>resource-csv-hr.xml</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;attribute&gt;</span>
        <span class="tag">&lt;ref&gt;</span>firstname<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;inbound&gt;</span>
            <span class="tag">&lt;target&gt;</span>
                <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/target&gt;</span>
        <span class="tag">&lt;/inbound&gt;</span>
   <span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a <em>mapping</em> that maps the account (HR) attribute <code>firstname</code> to user (midPoint) property <code>givenName</code>.
This tells midPoint to always update a value of user&#8217;s given name when the mapped HR attribute changes.
Eric adds similar mappings for all the attributes in the HR export file.
Eric also needs to add <em>synchronization</em> section to the resource definition.
The synchronization section instructs midPoint to create a new <em>user</em> for each new <em>account</em> that midPoint discovers.
This is exactly what Eric wants: create a user for each HR account.
Eric then re-imports the modified XML file into midPoint.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For the curious and impatient readers, complete definition of HR resource is stored in <code>resource-csv-hr.xml</code> file in book samples.
Please see <a href="#92-additional-information">Additional Information</a> chapter for the details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>MidPoint is now ready to synchronize the attributes.
MidPoint is ready, however it does not do anything yet.
We still need a <em>task</em> to pull all the data from the HR system.
Eric navigates to the page that shows the list of HR accounts.
There is a <b class="button">Tasks</b> button which can be used to manage tasks that manage the accounts.
Eric clicks on that button and creates a new import task by <b class="menuref">Create task</b> option in the drop-down menu.
He creates an <em>Import</em> task.
All he needs to do is fill out task name (e.g. <code>HR Import</code>) in the task wizard, everything else is pre-set to reasonable default values.
When Eric clicks on <b class="button">Save &amp; Run</b> button, the task is started, and it runs for a couple of seconds.
After the task is done Eric can look at users in midPoint by navigating <span class="menuseq"><b class="menu">Users</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">All users</b></span> in main menu:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-09-users.png" alt="Users">
</div>
</div>
<div class="paragraph">
<p>Eric can see details about the user by clicking on the username:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-10-user-details.png" alt="User details">
</div>
</div>
<div class="paragraph">
<p>This page shows all the details about the user that midPoint knows about.</p>
</div>
<div class="paragraph">
<p>The details are sorted into several sections.
We are going to explain all of that later in this book.
For now, we only care about first two sections.
The <b class="menuref">Basic</b> section shows user properties as midPoint knows them.
These properties are stored in midPoint repository.
MidPoint has quite a rich data model that can be used out-of-the-box, but the GUI only shows those properties that are actually used.
The "name", given name and family name were imported from the HR resource and that&#8217;s what the page shows.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the second tab now, clicking on <b class="menuref">Projections</b> in the details menu:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-11-user-projections.png" alt="User projections">
</div>
</div>
<div class="paragraph">
<p>The <b class="menuref">Projections</b> panel shows user&#8217;s <em>accounts</em>.
Currently, there is only one account.
It is the HR record that was used to import the data.
Account details are displayed by clicking on account identifier:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-12-user-projection-hr.png" alt="User HR projection">
</div>
</div>
<div class="paragraph">
<p>The data that are displayed here are really fresh.
Account details were retrieved from the resource at the very moment that the account was displayed.
This is the difference between <em>user</em> data and <em>account</em> data: user data are kept in midPoint repository, while account data are retrieved from the resource as needed.</p>
</div>
<div class="paragraph">
<p>The <em>user</em> and the <em>account</em> are <em>linked</em>.
MidPoint remembers that this <em>user</em> originated from this specific HR <em>account</em>.
If the HR account is modified, then the change is synchronized and applied to the user data.
The mappings are not just for the import.
They can work continually and keep the account and user data synchronized all the time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_assignments_and_projections">Assignments and Projections</h3>
<div class="paragraph">
<p>The concepts of an account is all about the reality: it shows the data that are there at this very moment.
It shows what <em>is</em> there.
However, identity management is all about policies.
Policies, by definition, specify what <em>should be</em> there.
Policies specify what is right.
However, as every citizen knows all too well, the things that <em>are</em> and the things that <em>should be</em> do not always match perfectly.
We are no idealists.
Therefore, we have designed midPoint from the day one to acknowledge that there may be a difference between reality and policy.
It is a prime responsibility of midPoint to manage that difference - and align policy and reality as much as possible in the long run.</p>
</div>
<div class="paragraph">
<p>This kind of thinking is easy to see in midPoint user interface.
There is <b class="menuref">Projections</b> panel in the user details page.
It shows the accounts that the user <em>has</em> right now.
It shows the real state in which the accounts <em>are</em>.
It shows the <em>reality</em>.
Then there is <b class="menuref">Assignments</b> panel.
This panel shows the <em>policy</em>.
It shows what accounts, roles, organizations, or services are <em>assigned</em> to the user.
It shows what user <em>should</em> have.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-13-assignments-empty.png" alt="Assignments">
</div>
</div>
<div class="paragraph">
<p>We need a new resource to demonstrate how the assignments work.
Therefore, let Eric connect a new resource to midPoint.
This time it will be new, clean and empty LDAP server.
Eric once again locates the proper example, modifies the configuration and imports it to midPoint.
In a while, there is a new LDAP resource.
Eric wants to synchronize all the users to the LDAP server.
To do that, Eric has to define mappings once again.
They will be <em>outbound</em> mappings this time, as Eric wants to propagate data <em>out of</em> midPoint into the (LDAP) resource.
We will cover the details of mapping configuration later, let&#8217;s just see the results now.
We have two resources now:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-14-resources.png" alt="Resources">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For the curious, LDAP resource configuration is located in <code>resource-ldap.xml</code> in samples directory.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>How do we create an account on that LDAP resource?
The right way to do this is to let midPoint know that a user <em>should have</em> an account on that resource.
In midPoint terminology we say, that we are <em>assigning</em> the resource to the user.
Eric needs to edit a user (navigate to user list <span class="menuseq"><b class="menu">Users</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">All users</b></span>, select a user), navigate to <em>resource assignments</em> panel by click on the <span class="menuseq"><b class="menu">Assignments</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Resource</b></span> in the details menu, and use unassuming <b class="button">New</b> button on the bottom of empty list to add an assignment for the LDAP resource:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-15-assign-ldap.png" alt="Assign LDAP account">
</div>
</div>
<div class="paragraph">
<p>After the click on <b class="button">Save</b> button, a lot of things happen.
MidPoint recomputes what the user <em>should have</em> and what the user <em>has</em>.
MidPoint detects that the user <em>should have</em> an LDAP account now (because there is a new <em>assignment</em> for it).
However, no such account exists yet.
Therefore, midPoint creates the account.</p>
</div>
<div class="paragraph">
<p>When Eric opens the user details again, and navigates to the <b class="menuref">Projections</b> panel he can see that there are two accounts now:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-16-user-projections-2.png" alt="User projections">
</div>
</div>
<div class="paragraph">
<p>There is an HR account that was used to create the user in the first place.
Then there is an LDAP account that was created as a reaction to a new assignment.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-17-user-projection-ldap.png" alt="User LDAP projection">
</div>
</div>
<div class="paragraph">
<p>There is <em>reality</em> and there is <em>policy</em>.
There are <em>accounts</em> and there are <em>assignments</em>.
Ideally these two things should match perfectly.
MidPoint will try really hard to make them match.
However, there may be exceptions.
Careful reader surely noticed that there is HR account, but there is no assignment for that account.
Despite that, midPoint has not deleted the HR account.
That is because the HR system is what we call a "pure source" system.
MidPoint does not write to the HR, it only reads from it.
Writes to the CSV export file would be overwritten by the next export anyway, therefore there is no point in writing there.
For that reason, the HR resource has an exception specified in its configuration: it allows the HR account to exist even if there is no assignment for it.
We can keep the HR account linked to the user by using this method.
We can see the data that were used to create the user.
This improves overall visibility, and it is a great help for diagnostics of configuration issues.</p>
</div>
</div>
<div class="sect2">
<h3 id="_roles">Roles</h3>
<div class="paragraph">
<p>It would be a daunting task if Eric had to assign every individual account for every individual resource to every user.
Typical identity management deployment has thousands of users and dozens of resources.
Such deployment would be very difficult to manage using direct resource assignments only.</p>
</div>
<div class="paragraph">
<p>There is a better way, of course.
We can use <em>roles</em>.
The concept of <em>role-based access control (RBAC)</em> is a well-established practice.
Indeed, the roles are the bread-and-butter of identity management.
The basic idea of RBAC is to group privileges into roles.
Then the roles are assigned to the users instead of privileges.
Let&#8217;s create a <code>Webmaster</code> role.
Then put all the privileges that a webmaster should have into that role.
Let&#8217;s assign the role to every user that works as a webmaster.
All of them will get the same privileges.
This simplifies the privilege management.
If there are two webmasters, there is no need to think about the individual privileges that a webmaster should have.
Just assign the role, the role has everything that is needed for a webmaster to do his job.
It is also easy to change webmasters: unassign role from one user, assign it to another user.
It is also easy to adjust privileges if you add a new web server.
Just add the privilege for accessing new server into the <code>Webmaster</code> role.
All webmasters will get that privilege.</p>
</div>
<div class="paragraph">
<p>That&#8217;s the theory.
How does it work for Eric?
First of all, let&#8217;s add a handful of new resources – to get some material for the roles to work on.
Now we have four resources: HR, LDAP, CRM and Portal.
That’s a good start.
Let’s do some role engineering now.</p>
</div>
<div class="paragraph">
<p>Many organizations have one role that almost every user has.
It is often <code>Employee</code> or <code>Staff</code> role.
This role gives access to all the systems that an employee should have access to: Windows domain login, e-mail, employee portal – things like that.
The ExAmPLE company is no exception.
In this case the basic role should create accounts in two systems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>LDAP server:</strong> many applications are connected to LDAP and use it for authentication.
We want every ExAmPLE employee to have account there.</p>
</li>
<li>
<p><strong>Portal:</strong> this is enterprise intranet portal with lots of small services essential for every employee.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is simple to create such role in midPoint user interface.
Eric navigates to <span class="menuseq"><b class="menu">Roles</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">New role</b></span>.
Role wizard starts, prompts for a role type.
We cannot create neither <em>application</em> nor <em>business</em> role, as we do not have basic structure for that yet.
Therefore, Eric selects the last option.
He fills in the name of the new role (<code>Employee</code>).
Then he navigates to the <span class="menuseq"><b class="menu">Inducements</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">All</b></span> panel.
This is where the role definition takes place.
Inducements are almost the same as assignments.
However, inducements do not give access to the role itself.
Inducements give access to the <em>users</em> that have this role.
So they are kind of <em>indirect</em> assignments.
Eric clicks on <b class="button">New</b> button, and adds inducements for LDAP resource into the role, by selecting the <b class="menuref">Resource</b> tab and selecting <code>LDAP</code> resource.
He repeats the process for <code>Portal</code> resource as well.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-18-role-employee-inducements.png" alt="Role Employee inducements">
</div>
</div>
<div class="paragraph">
<p>Eric clicks the <b class="button">Save</b> button, and the new role is created.
Now it is ready to be assigned to the users.
Eric goes on and assigns <code>Employee</code> role to user Bob by editing the user and adding a <em>role assignment</em>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-19-user-bob-employee.png" alt="Employee Bob">
</div>
</div>
<div class="paragraph">
<p>MidPoint automatically creates all the accounts given by the role after the modification is saved:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/02-20-user-bob-accounts.png" alt="Employee Bob accounts">
</div>
</div>
<div class="paragraph">
<p>There is the HR account that was used to create the Bob user record in the first place.
Then there are the two accounts that were created because Bob has the <code>Employee</code> role: portal account and LDAP account.</p>
</div>
<div class="paragraph">
<p>This operation works in both directions: if Eric <em>unassigns</em> the <code>Employee</code> role, the accounts given by the role will be deleted.
Eric can create any number of roles like this: roles for sales agents with CRM access, roles for sales managers with higher CRM privileges, roles for assistants and clerks, roles for everybody.
MidPoint is designed to handle large number of roles.
Each role can have its own combination of resources and entitlements.
MidPoint seamlessly merges the privileges given by all the roles a user has.
E.g. if two roles give CRM access to the user, only one CRM account will be created.
If one of these roles is unassigned, then CRM account remains there.
The account is not deleted yet because it is given by the other role.
Only when the last CRM role is removed, that’s the point where the account gets deleted.
MidPoint takes care of all that logic.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Archetype</div>
Strictly speaking, <em>role</em> is not an ideal tool to use for <code>Employee</code> access.
<code>Employee</code> is usually more than a role, it is a <em>type</em> of user.
We would probably want to assign employees their own icon, we want <code>Employee</code> type to appear in quick access menus, and so on.
MidPoint has a very special mechanism to do that: <em>archetypes</em>.
However, you do not need to forget everything that was said about roles so far.
<em>Archetypes</em> work exactly the same as roles do, with assignments, inducements, and all of that.
This is how we do it in midPoint: one generic mechanism, reused for many things.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course, there is much more midPoint <em>roles</em> can do:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roles can assign accounts to groups, grant the privileges and manage account <em>entitlements</em>.</p>
</li>
<li>
<p>Roles can mandate specific account <em>attribute values</em>, e.g. clearance levels, compartments, etc.</p>
</li>
<li>
<p>Roles may contain custom <em>logic</em> (expressions, scripts).</p>
</li>
<li>
<p>Roles may be <em>hierarchical</em>: there may be roles within roles.</p>
</li>
<li>
<p>Roles may be assigned for a specified <em>time</em>.</p>
</li>
<li>
<p>Roles may be <em>conditional</em> and <em>parametric</em>.</p>
</li>
<li>
<p>&#8230;&#8203; and much much more.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Roles are really the essence of identity management.
We will be dealing with <em>assignments</em>, <em>roles</em> and role-like objects in almost all the parts of this book.</p>
</div>
</div>
<div class="sect2">
<h3 id="_there_is_much_more">There Is Much More</h3>
<div class="paragraph">
<p>Eric the Engineer has done a few basic steps to configure midPoint as an identity management system for his company.
However, this is still a very basic configuration.
It is only a beginning.
Careful readers have already noticed a lot of things that need to be done.
E.g. employee full name is not automatically generated.
Employee numbers are used as identifiers.
We would like to have something that is more user-friendly instead.
We need to automatically assign the <code>Employee</code> role instead of doing that manually.
And so on.
There are still a lot of things to improve.
Fortunately, all of that is very easy to do with midPoint, once you know where to look.
We will be dealing with all these things in the rest of this book.
New functionality will be administered to the ExAmPLE solution in small doses in each chapter – together with a proper explanation of midPoint principles.
MidPoint is a very flexible and comprehensive platform, and there are still a lot of things to learn.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_midpoint_is_not">What MidPoint Is Not</h3>
<div class="paragraph">
<p>Now you probably have some idea what midPoint <em>is</em>.
However, it is also very important to understand what midPoint <em>is not</em>.
Identity and Access Management (IAM) field is a combination of many technologies, and it may be quite confusing sometimes.
That is perhaps the reason why the midPoint team occasionally gets questions about midPoint functionality that simply do not make much sense.</p>
</div>
<div class="paragraph">
<p>First of all, midPoint is not an <em>authentication server</em>.
MidPoint is not designed to validate your username and password.
Yes, midPoint maintains data about users (including passwords).
However, the data model that midPoint maintains is quite complex.
It is not meant to be exposed to applications directly.
That would not be very efficient.</p>
</div>
<div class="paragraph">
<p>If you want midPoint to manage users, but you also want your applications to have a centralized authentication service there is a solution: publish the data to the LDAP server.
Connect LDAP server to midPoint as a resource, and let midPoint populate and maintain the LDAP sever data.
The application will not talk to midPoint directly.
They will talk to the LDAP server.
This is better for everybody: LDAP is a standard protocol, well-supported in many applications.
LDAP servers are also extremely fast and scalable.
Therefore, use the combination of midPoint and an LDAP server of your choice.
That’s what people usually do and it works perfectly.</p>
</div>
<div class="paragraph">
<p>Of course, we said that LDAP is not authentication server either.
That&#8217;s right, it is not.
However, LDAP can still work for simple authentication scenarios.
If you need more than that, connect a proper authentication server to LDAP.
That is what most authentication servers expect anyway.</p>
</div>
<div class="paragraph">
<p>As midPoint is not an authentication server it obviously is not a <em>single sign-on</em> (SSO) server either.
If you want SSO, you will need a dedicated SSO server.
There are plenty of SSO servers to choose from in both the closed-source and open-source worlds.
You will also need a scalable directory system (LDAP) to store the data for the SSO server.
MidPoint will be pleased to manage that LDAP server for you.</p>
</div>
<div class="paragraph">
<p>One of the things that seems to be shrouded in a lot of confusion is <em>authorization</em>.
To get the record straight from the beginning: midPoint is not an authorization server.
It is not a <em>policy decision point</em> (PDP), and it definitely is not a <em>policy enforcement point</em> (PEP).
You cannot rip authorization out of your application and just "use midPoint for that".
That does not work.</p>
</div>
<div class="paragraph">
<p>You can think of midPoint as a <em>policy administration point</em> (PAP).
MidPoint has a lot of sophisticated authorization-related logic inside its core.
However, that logic is not designed to answer questions such as "Is subject S authorized to execute operation O on object X?".
MidPoint logic is different.
MidPoint is not concerned with making authorization <em>decisions</em>.
It is concerned about managing the authorization <em>policies</em>.
MidPoint sets up the authorization policies in target applications.
The applications evaluate these policies themselves.
This is a much more efficient and more reliable method.
Unlike authentication, the authorization decisions are done all the time.
Authorization is evaluated at least once per every request.
If the application makes these decision internally, then there is no need to a round-trip to the authorization server.
Performance is significantly increased.
Also, there is no single point of failure.
MidPoint failure will not interrupt authorization flow, because the application has all the data inside.
One less component to cause a failure.
Yet, the policies are centrally managed by midPoint.
When a policy changes, midPoint updates all the affected applications.
You get all the benefits without the usual drawbacks.</p>
</div>
<div class="paragraph">
<p>MidPoint does what it is supposed to do: it <em>manages</em> identities, entitlements, organizational structures and policies.
MidPoint does not do things that are not necessary.
It does not do the things that other technologies already do well.
MidPoint does not reinvent the wheel.
There is no need for this.
MidPoint is not the wheel.
MidPoint sits above all the wheels.
MidPoint is the <em>chauffeur</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="03-installation">3. Installation and Configuration Principles</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
The <em>Guide</em> is definitive.
Reality is frequently inaccurate.
</blockquote>
<div class="attribution">
&#8212; The Hitchhiker's Guide to the Galaxy<br>
<cite>The Restaurant at the End of the Universe by Douglas Adams</cite>
</div>
</div>
<div class="paragraph">
<p>This chapter provides instructions for installation and initial configuration of a midPoint system.
Installation instructions provided in this chapter focus on small installations, suitable for evaluation, experiments, and development of midPoint configurations.
Most of us are going to start with an environment like this.
Deployment of midPoint in a production setting is an entirely different matter, suitable for its own chapter.</p>
</div>
<div class="sect2">
<h3 id="_requirements">Requirements</h3>
<div class="paragraph">
<p>MidPoint will run on almost any machine.
Mid-range laptop is fine for personal use of midPoint.
MidPoint needs approximately 4GB of RAM, which is perhaps the only real limiting factor.</p>
</div>
<div class="paragraph">
<p>Theoretically, MidPoint is platform-independent, it can run on any environment where Java is running.
However, devil is in the detail.
Individual environments and operating systems have their peculiarities.
Therefore, only some environments are supported by Evolveum.</p>
</div>
<div class="paragraph">
<p>Linux is an operating system of choice for production use of midPoint.
However, midPoint will be happy in Windows or macOS environment on your laptop for non-production use.
Some midPoint releases have production-grade support for Windows environment as well.</p>
</div>
<div class="paragraph">
<p>If you look for more formal system requirements definition, then you will find that in midPoint docs (see <a href="#92-additional-information">Additional Information</a> chapter at the end of the book).</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation">Installation</h3>
<div class="paragraph">
<p>There are several ways to install and use midPoint.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Docker</strong>: MidPoint can be installed from docker images published on Docker Hub.
Docker, being a container platform, simplifies installation to downloading and running the image.
Even that is further simplified and automated with <em>Docker Compose</em>.
This is ideal method for exploration, experiments, testing and demos.
<em>Docker Engine</em> is needed to run the images, which can run on almost any computer.
Evolveum provides convenient script to set up and manage midPoint environment for docker-based installation.</p>
</li>
<li>
<p><strong>Kubernetes</strong>: MidPoint can be installed to Kubernetes platform.
This is a fully cloud-native method to deploy midPoint.
Kubernetes deployment is recommended for production use of midPoint.
<em>Kubernetes platform</em> or <em>cloud environment</em> (AWS, Azure, Google cloud) is needed for this method.
This installation method is not covered in this book.</p>
</li>
<li>
<p><strong>Distribution package</strong>: MidPoint is distributed in a form of package, which is built from source code.
The package contains <em>binaries</em>, scripts and other files to run midPoint.
<em>Java Runtime Environment</em> (JRE) is needed to run the binaries, as well as knowledge of system administration techniques.
This method is supported for production use of midPoint.
It is recommended for people that prefer the traditional installation approach.</p>
</li>
<li>
<p><strong>Source code</strong>: MidPoint is an open source software, complete source code is available.
The source code can be built to obtain binary packages.
<em>Java Development Environment</em> (JDK) is needed to build and run the binaries, as well as some knowledge of software development and system administration techniques.
This approach is recommended for deep experimentation and special scenarios, and for people that need to build their own source code.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is strongly recommended to start with the <em>Docker</em> method.
The descriptions and examples in this book assume that <em>Docker Compose</em> installation is used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_docker_compose_installation">Docker Compose Installation</h3>
<div class="paragraph">
<p><em>Docker</em> provides a popular method to distribute and run containerized software.
Evolveum is building and publishing docker images for every midPoint version.
In addition to that, <em>Docker Compose</em> definition file is provided for easier start.
<em>Docker Compose</em> file describes how the necessary containers are assembled, creating a simple environment with all the necessary components.</p>
</div>
<div class="paragraph">
<p>MidPoint installation described in this chapter is a very basic one.
It is ideal for initial exploration of midPoint, development of midPoint configurations, simple testing, demonstrations, exploration and similar purposes.
It is a very convenient installation, and it provides all you need to get started.</p>
</div>
<div class="paragraph">
<p>Following steps are applicable to Linux and macOS environment.
Windows users may use <em>Docker Desktop</em> running on <em>Windows Subsystem for Linux (WSL)</em>.
Please refer to <a href="https://docs.evolveum.com/midpoint/install/containers/docker/">Evolveum documentation regarding Docker Compose</a> for more details.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Not for production use</div>
MidPoint installation based on <em>Docker Compose</em> is not meant for production use.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You will need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Docker Engine</strong> installed on your machine.
It is available for Linux, Windows and macOS.
Please follow <a href="https://docs.docker.com/engine/install/">Docker installation instructions</a>.
Make sure that <em>Docker Compose</em> is installed as well.
Special packages are needed to support <em>compose</em> in some operating systems, e.g. <code>docker-compose-plugin</code> or <code>docker-compose-v2</code> is necessary in Debian/Ubuntu Linux.</p>
</li>
<li>
<p><strong>MidPoint Docker Script</strong> (<code>midpoint-quickstart.sh</code>) downloaded to your machine.
The script takes care of initialization of <em>Docker Compose</em> environment for midPoint.
The script can be downloaded from <a href="https://evolveum.com/download/">Evolveum download page</a>.
Detailed instructions about usage of the script can be found on <a href="https://docs.evolveum.com/midpoint/quickstart/">Quickstart page</a> in midPoint documentation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the Docker is installed and the script is downloaded, there is still some preparation to do:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new directory for the environment.
Any directory would do.</p>
<div class="paragraph">
<p><code>mkdir midpoint-demo</code></p>
</div>
<div class="paragraph">
<p>Choosing a relatively unique name for the directory would be a good idea, as <em>Docker Compose</em> is using name of the directory as a prefix for container names.
Therefore <code>midpoint-demo</code> is better name than <code>midpoint</code> or <code>demo</code>.</p>
</div>
</li>
<li>
<p>Copy the script to the new directory:</p>
<div class="paragraph">
<p><code>cp Downloads/midpoint-quickstart.sh midpoint-demo/</code></p>
</div>
</li>
<li>
<p>Enter the newly-created directory:</p>
<div class="paragraph">
<p><code>cd midpoint-demo</code></p>
</div>
</li>
<li>
<p>Initialize and start midPoint environment by running the <code>midpoint-quickstart.sh</code> script:</p>
<div class="paragraph">
<p><code>./midpoint-quickstart.sh up</code></p>
</div>
<div class="paragraph">
<p>The script needs to be executed from the dedicated directory created in the first step.
When started, the script initializes the environments.
It creates <em>Docker Compose</em> definition file (<code>docker-compose.yml</code>) and midPoint home directory (<code>midpoint-home</code>), setting correct permissions for easy management.
Then the script starts docker containers.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Docker and sudo</div>
The <code>midpoint-quickstart.sh</code> script may ask for your password, as it is using <code>sudo</code> to start Docker containers.
Using <code>sudo</code> is a recommended method to manage Docker containers in a secure way.
There are configurations that allow users to start the containers without <code>sudo</code>, yet these are not considered secure.
As midPoint is designed with security in mind and it is supposed to be <em>secure by default</em>, it uses the <code>sudo</code> method.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the environment is started, midPoint user interface can be accessed as a <code>localhost</code> service at port <code>8080</code>.</p>
</div>
<div class="paragraph">
<p>+
<code><a href="http://localhost:8080/">http://localhost:8080/</a></code></p>
</div>
<div class="paragraph">
<p>+
You can start working with midPoint now.
Log in as <code>administrator</code>.
The script has generated a random initial password (remember: <em>secure by default</em>), which can be used to log in.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Localhost only</div>
The Docker exposes midPoint as HTTP service on <code>localhost</code> port <code>8080</code>.
To make things simpler and quicker, this midPoint instance is not secured properly.
It is using HTTP instead of HTTPS.
However, this deployment is still reasonably secure, as it is exposed only on local network interface (<code>localhost</code>).
It is <strong>not</strong> accessible over network.
This is a very explicit decision to limit the exposure of new midPoint instance until it is properly secured.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case that midPoint does not start, the problems are indicated in the <em>logfile</em>.
The logfile (<code>midpoint.log</code>) is located in midPoint home directory.
In our little <em>Docker Compose</em> environment, the logfile can be found at the following path:</p>
</div>
<div class="paragraph">
<p><code>midpoint-home/log/midpoint.log</code></p>
</div>
<div class="paragraph">
<p>If there is any problem, it is likely that detailed problem description can be found at the end of the log file.
When desperate, please refer to the <a href="#90-troubleshooting">Troubleshooting</a> chapter.</p>
</div>
<div class="paragraph">
<p>When not needed, the containers can be shut down:</p>
</div>
<div class="paragraph">
<p><code>./midpoint-quickstart.sh down</code></p>
</div>
<div class="paragraph">
<p>When shut down, midPoint keeps all the data and state in the repository.
The data will be available when the container is started again.</p>
</div>
<div class="paragraph">
<p>In case that there is a need to purge all data and re-start on a clean playing field, persistent database data can be deleted by using the <code>clean</code> command passed to the script:</p>
</div>
<div class="paragraph">
<p><code>./midpoint-quickstart.sh clean</code></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Behind the scenes</div>
The script is using <em>Docker Compose</em> to do quite a lot of things behind the scenes.
First of all, the script creates midPoint home directory (<code>midpoint-home</code>), setting correct permissions for both the docker container and you can access it.
Then the script uses <em>Docker Compose</em> starts up midPoint repository, which is a PostgreSQL database instance.
The database is using a <em>persistent volume</em> to store its data, otherwise you would lose all your work on every re-start.
Then the database is initialized with proper configuration and database schema.
Finally, midPoint container is started and connected to the database.
The container generates a random administrator password, which is retrieved by the script and displayed to the user.
While it may look like a single "midPoint" instance to you, it is in fact several cooperating containers, all orchestrated by <em>Docker Compose</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_containerized_book_samples">Containerized Book Samples</h3>
<div class="paragraph">
<p>Standard <em>Docker Compose</em> definition for midPoint contains just the basic components: midPoint server and PostgreSQL database.
However, for the purposes of this book, we are going to need a little bit more - to have some fun with midPoint.
We are going to need an LDAP server, CSV files and some additional database tables to play the role of resources.
Of course, the stock <em>docker compose</em> definition can be extended to include all that.
However, the primary goal of this book is to learn midPoint.
Messing around with docker may be a distraction.
Therefore, there are already containers configured to run the environment suitable for trying examples provided in this book.
The containers are located in the <code>docker</code> directory in book samples (see <a href="#92-additional-information">Additional Information</a> chapter for details).
There are two configurations, first one corresponds roughly to the beginning of chapter 5 (Synchronization), the other corresponds to end of chapter 10 (organizational structure).
There are <code>README</code> files in both directories, explaining the details.</p>
</div>
<div class="paragraph">
<p>The containers have convenient <code>book-example.sh</code> script, which can be used to set up, start and re-set container state.
This script is meant for Linux, as primary author of this book is a hopeless Linux enthusiast.
There are no Windows or macOS versions.
However, this is open source world, contributions are more than welcome.</p>
</div>
</div>
<div class="sect2">
<h3 id="_on_line_demo">On-Line Demo</h3>
<div class="paragraph">
<p>If you want to have just a quick look at midPoint, there is on-line midPoint demo located at the following URL:</p>
</div>
<div class="paragraph">
<p><code><a href="https://demo.evolveum.com/">https://demo.evolveum.com/</a></code></p>
</div>
<div class="paragraph">
<p>The demo has some basic configuration to demonstrate midPoint features.
There are several resources configured for synchronization, role-based access control (RBAC) is set up, there is organizational structure, some policies, and many other things.
Link to the demo documentation is provided at the login page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The demo is shared among all the users, therefore it may not be in a pristine state when you log in.
The demo is re-set to the original state once a day.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_midpoint_user_interface">MidPoint User Interface</h3>
<div class="paragraph">
<p>When local midPoint instance is started, use the following URL to access midPoint user interface:</p>
</div>
<div class="paragraph">
<p><code><a href="http://localhost:8080/midpoint" class="bare">http://localhost:8080/midpoint</a></code></p>
</div>
<div class="paragraph">
<p>Log in with the following credentials:</p>
</div>
<div class="paragraph">
<p>Username: <code>administrator</code><br>
Password: <em>randomly generated at first start, displayed by the start script</em></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">HTTP</div>
Oh yes, the URL is really using insecure HTTP instead of HTTPS.
This is certainly not suitable for production use, as we have already mentioned several times.
However, it is reasonably safe for local, non-production use.
When using the provided docker configuration, midPoint service is available on <code>localhost</code> only, it is not accessible from the network.
This setup is reasonably secure for use on personal computers.
We did not want to complicate the matter by acquiring TLS certificates for HTTPS use.
However, you will need to do that for production use, in order to secure midPoint.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you are logged-in as the <code>administrator</code>.
This user has superuser privileges, therefore you can see everything, and you can do anything in the midPoint user interface.</p>
</div>
<div class="paragraph">
<p>MidPoint user interface is structured.
It has the same layout and controls for all the user interface areas:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/03-01-gui-controls.png" alt="GUI controls">
</div>
</div>
<div class="paragraph">
<p>Primary tool for user interface interaction is the menu.
MidPoint user interface is functionally divided into three parts, therefore there are also three parts of the menu:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Self-service</strong> user interface deals with the things that the user can do for oneself: displaying list of account, changing password, requesting a role and so on.
This is relatively simple part of the user interface.
It is often accessible to all the users.</p>
</li>
<li>
<p><strong>Administration</strong> user interface deals with management of other users, roles, organizational structures and similar midPoint objects.
This is a very comprehensive and considerably complex part of the user interface.
Usually only privileged users have access to this part of the user interface.
This part of user interface is often used to support delegated administration and role management therefore it is also meant for security officers, resource owners, role engineers and similar expert users.</p>
</li>
<li>
<p><strong>Configuration</strong> user interface deals with configuration of midPoint system itself.
It is used to customize midPoint behavior, set fundamental policies and rules that form the foundation of midPoint deployments.
This part of user interface is usually used only by identity management engineers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The menu can be hidden by clicking on the button at the top of the screen.
The top bar also contains the title of the current user interface page and breadcrumbs.
Breadcrumbs show where you currently are in the user interface and how you got there.
The breadcrumbs can be used to "find your way home" and back to the previous page.
The use of browser <b class="button">Back</b> button is not recommended.
Please use the <b class="button">Back</b> buttons that are present in midPoint user interface, or use breadcrumbs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_user_interface_areas">User Interface Areas</h3>
<div class="paragraph">
<p>MidPoint user interface is quite rich.
Following list provides short description of the most important parts of the user interface.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Home</strong> page gives a brief status about users own accounts, requests, work items and so on.
This is a page designed to be the first page that will be displayed to the end user after log in to midPoint.</p>
</li>
<li>
<p><strong>Profile</strong> page allows users to see or edit their own profile.</p>
</li>
<li>
<p><strong>Credentials</strong> page allows users to change their own credentials, such as password.</p>
</li>
<li>
<p><strong>Request access</strong> page allows users to select the roles that they need, and then request assignment of the roles.</p>
</li>
<li>
<p><strong>Dashboard</strong> pages shows a couple of dashboards designed to provide a lot of useful information at the first sight.
The built-in system dashboard shows statistics about midPoint installation.
Dashboards can be customized to suit needs of a particular deployment.</p>
</li>
<li>
<p><strong>User</strong> pages list users in midPoint, allows to create and edit users.</p>
</li>
<li>
<p><strong>Organizational structure</strong> pages show the organizational structure trees.
Many parallel organizational structures can be managed here, such as tree-like functional organizational structure, flat project-oriented structure, role catalogs and so on.</p>
</li>
<li>
<p><strong>Role</strong> pages allow to list and manage roles.
Roles can be defined and maintained in this part of the user interface.</p>
</li>
<li>
<p><strong>Service</strong> pages allow to list and define services, such as applications, devices, servers and so on.</p>
</li>
<li>
<p><strong>Resource</strong> pages list and manage identity resources.
New resource can be defined here, associated with the connector, tested, etc.</p>
</li>
<li>
<p><strong>Cases</strong> pages list the things that the users have to do.
Work items are created if user has to approve something or if there is some manual step in the process.</p>
</li>
<li>
<p><strong>Certification</strong> pages deal with access certification (re-certification, attestation).
Certification campaigns can be created and managed here.</p>
</li>
<li>
<p><strong>Server task</strong> pages show the tasks that are running on midPoint servers.
These may be scheduled synchronization tasks, import tasks, running user requests – everything that runs on the servers and cannot be executed immediately in a synchronous way.</p>
</li>
<li>
<p><strong>Nodes</strong> page lists processing nodes in midPoint cluster.</p>
</li>
<li>
<p><strong>Report</strong> pages allow defining and running reports.
These pages typically deal with scheduled printable reports.</p>
</li>
<li>
<p><strong>Simulation</strong> pages allow running simulated operations, predicting operation result without causing any damage.</p>
</li>
<li>
<p><strong>Audit log viewer</strong> can be used to look at audit log, reviewing record of all past operations.</p>
</li>
<li>
<p><strong>Configuration</strong> area contains many pages that manage midPoint configuration: system default configuration, repository objects, logging, bulk actions and so on.</p>
</li>
<li>
<p><strong>Archetype</strong> pages define specific object types that can be used to customize behavior of midPoint objects.</p>
</li>
<li>
<p><strong>Repository object</strong> pages for accessing objects in midPoint repository, used for low-level manipulation of midPoint configuration and data.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_user_interface_concepts">User Interface Concepts</h3>
<div class="paragraph">
<p>MidPoint user interface is using the same concepts and controls in all its parts.
For example all the lists of all the objects (users, roles, &#8230;&#8203;) look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/03-02-list-controls.png" alt="GUI list controls">
</div>
</div>
<div class="paragraph">
<p>Each row represents one object: user, roles, service, task, etc.
There is also a color-coded object icon.
The search bar at the top can be used to look for a specific object or to filter the object view.
Right side is reserved for action buttons.
Buttons in the table header trigger actions that apply to all selected objects.
Buttons in each row trigger actions that apply only to that individual object.
The buttons in the bottom-left corner execute global actions, such as creating or importing new object, exporting objects and refreshing the view.
Paging controls are in the bottom-right corner.</p>
</div>
<div class="paragraph">
<p>MidPoint has a unified color-code that makes the navigation easier.
Users, roles and other object types have their specific color and icon.
This indicates the object type, and it is used whenever possible: menu, information boxes, lists, box title accents and so on.
The primary colors and icons are shown in the dashboard:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/03-03-dashboard-object-types.png" alt="Dashboarad object types">
</div>
</div>
<div class="paragraph">
<p>All user-related controls are red, all controls that deal with organizational structure are yellow.
Roles are green.
And so on.
This color code is applied consistently through the midPoint user interface.</p>
</div>
<div class="paragraph">
<p>Similar color code applies to object icons when displayed in user lists.
However, the color that is used there does not indicate object type, but rather an <em>archetype</em>.
Archetypes are subtypes that are often used to distinguish similar objects.
For example, archetypes can be used to sort users to employees, contractors, customers and so on.
Look and behavior of "archetyped" objects is configurable.
Default midPoint configuration contains just a couple of archetypes.
Those archetypes apply red color to system users and roles.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
All objects are equal in midPoint.
MidPoint will handle users, roles, organizational units and services in the same way.
The lists used to display these objects are the same, the pages that display object details are the same.
All the objects have properties, they can be enabled/disabled in the same way, they are subject to authorizations in the same way and so on.
It is a midPoint philosophy to design several powerful principles, and then apply them over and over again.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_object_details_page">Object Details Page</h3>
<div class="paragraph">
<p>When a user clicks on a name of any object in the object list then <em>object details</em> page appears.
The detail pages for common midPoint objects, such as user or role, are very similar to each other.
They have the same layout and controls.
E.g. user details page looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/03-04-user-details.png" alt="User details">
</div>
</div>
<div class="paragraph">
<p>The screen below the information area is divided into several panels.
There is a summary panel at the top of the page.
This is an information area which shows user photo (or icon) and provides some basic information such as user identifier and title.
It also shows where the object belongs in the organizational structure.
There is also a couple of "tags" that show interesting details about the object: whether the object is enabled, whether it has special privileges and so on.</p>
</div>
<div class="paragraph">
<p>Below the summary panel, there is a panel with operation controls.
There are buttons to save the changes, go back to the previous page, controls to set operation options and so on.</p>
</div>
<div class="paragraph">
<p>The data are displayed in <em>details panel</em>.
However, midPoint data structures are often quite complex.
Displaying the data in their full complexity would make it very difficult to understand.
Therefore, the data are divided into several parts, each containing a portion of the data.
Navigation menu is displayed left to the main details panel.
It allows easy navigation through data structures, each displaying a specialized panel with object details.</p>
</div>
<div class="paragraph">
<p>The first item is perhaps the most interesting one.
It contains fields that show <em>basic</em> object properties: the attributes of the object.
Properties are displayed, and they can be edited – depending on the authorizations of currently logged-in user.
The other panels shows more complex information about the object.
E.g. activation panel shows whether the object is enabled or disabled, it shows the activation dates and other activation details.
The password panel provide password management functionality.
And so on.</p>
</div>
<div class="paragraph">
<p>The view control buttons present in the details panel can be used to adjust the way the information is presented.
These buttons control sorting of the fields, can toggle metadata display and there may be additional control buttons for more complex fields.
MidPoint shows only some fields by default, to make the presentation easier to read.
For example, most empty fields are not shown by default.
There is a small <b class="button">Show empty fields</b> button under the fields than can be used to display empty fields.</p>
</div>
<div class="paragraph">
<p>The content of the details panel changes its form, adapting to the type of displayed information.
Basic properties are shown as a series of editable fields.
Content of some panels is similar to the <b class="menuref">Basic</b> panel, displaying a set of fields.
Other panels provide lists of more complex data structures such as projections, assignments and personas.</p>
</div>
<div class="paragraph">
<p>MidPoint user interface often needs to present objects that are internally quite complex.
It does not make sense to present all the details at once.
These objects need to be presented in quite a compact form that can be expanded to show the details.
This applies to list of user’s accounts, assignments, role inducements, etc.
The objects are initially displayed as in a form of a simple list, displaying only the basic data:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/03-05-user-projections.png" alt="User projections">
</div>
</div>
<div class="paragraph">
<p>The list above shows user’s <em>projections</em>.
Those are usually accounts that are linked to user object.
Click on account name shows account details:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/03-06-user-projection-details.png" alt="Projection details">
</div>
</div>
<div class="paragraph">
<p>Account details display is shown in place of user details.
This may be slightly confusing.
However, account details can be often complex, therefore all the available screen space is needed to display them.
The <b class="button">Cancel</b> and <b class="button">Done</b> buttons at the bottom can be used to return to list of projections.
Click on <b class="button">Done</b> button will not start the operation yet, it only changes the view.
Therefore, do not confuse those buttons with <b class="button">Back</b> and <b class="button">Save</b> buttons located in the control panel.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Perceptive reader is certainly curious about the small red question mark in the corner of the account icon.
This corner of the account icon is a place where a special marker would be displayed to indicated disabled accounts.
There would be no such marker for enabled accounts.
Such visual indicators are very helpful when managing identities of larger user bases.
However, this is an LDAP account.
There is no standard way to disable an account in LDAP world.
Many LDAP servers implement their own proprietary mechanisms, and the OpenLDAP server that we are using has no such mechanism at all out-of-the-box.
Hence the question mark, indicating that the activation status of the account is <em>not known</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each panel provides the information in an editable way, provided that the user has adequate privileges to edit the information.
When the data are edited, the changes can be confirmed by using the <b class="button">Save</b> button in the operations panel.
Saving the changes is a universal way how to start almost any operation: change of user properties, assignment of roles, change of password, user disable, etc.
When you make edits in any of the panels on the details page, then nothing really happens yet.
MidPoint just remembers what you are editing.
The operation is executed only when you click the <b class="button">Save</b> button.
This is our method to execute several changes in one operation.
It may require some time to get used to it.
Just do not forget to click the <b class="button">Save</b> button when you are done editing.</p>
</div>
<div class="paragraph">
<p>Operation options are used to modify the behavior of the operation.
These options may force execution of operations that fail to pass midPoint internal checks.
There is an option to reconcile the data even if midPoint thinks that reconciliation is not needed.
And so on.
Checking or unchecking these options influences the way how midPoint executes the operation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_midpoint_configuration_basics">MidPoint Configuration Basics</h3>
<div class="paragraph">
<p>The principle of midPoint configuration is quite different from what would a typical system administrator expect.
There are almost no configuration <em>files</em> in midPoint.
MidPoint is storing the vast majority of its configuration in its configuration database.
There are several reasons for this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MidPoint configuration is <strong>complex</strong>.
MidPoint configuration is not what a typical system administrator would think of like a "configuration".
It contains numerous resource definitions that in turn contains mappings that in turn may contain scripts.
There are roles, policies, templates, &#8230;&#8203; and these objects are too complex to be expressed in simple configuration files.</p>
</li>
<li>
<p>MidPoint configuration is <strong>scalable</strong>.
It is no exception that a midPoint deployment has thousands of role definitions or organizational units, tens of resource definitions and a significant number of templates and policies.
All of that needs to be stored efficiently, for midPoint to handle deployments that manage millions of identities.
The configuration also needs to be searchable.
Managing thousands of roles in plain text files simply won’t work.</p>
</li>
<li>
<p>MidPoint configuration needs to be <strong>available</strong>.
There are midPoint deployments with several nodes working together in a cluster.
Configuration change done on one node has to be seen by other nodes.
Simple configuration files would not work here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Therefore, midPoint has a completely different approach to configuration.
The configuration is stored in a form of well-defined structured objects in the midPoint database.
We call that database <em>midPoint repository</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_objects">Configuration Objects</h3>
<div class="paragraph">
<p>Everything is an <em>object</em> in midPoint.
Every piece of configuration is represented as a structured object and stored in midPoint repository.
Object may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8ebab0bc-7e7e-11e6-a7bc-57de1cd45ecc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Basic User<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Basic user role. Almost all users have it.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;requestable&gt;</span>true<span class="tag">&lt;/requestable&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">f92e67c2-7e7e-11e6-a306-7bf6aa2e8c61</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Every object has its <em>identifier</em>.
We call that identifier <em>OID</em>, which stands for "object identifier" (it has nothing to do with LDAP or ASN.1 OIDs).
OID is usually randomly-generated universally unique identifier (UUID).
OID value has to be unique in a whole system.
This identifier is <em>persistent</em> – it is assigned to the object, and it is never changed.
OID is used for internal purposes, and it is almost never displayed to midPoint user.</p>
</div>
<div class="paragraph">
<p>Every object has a <em>name</em>.
Name is human-readable, and it can change any time.
The value of <em>name</em> is usually displayed to users.
This is the values that ordinary users understand as an identifier.</p>
</div>
<div class="paragraph">
<p>Then there are other object properties - or rather <em>items</em>.
Each type of midPoint object has a slightly different set of these items.
That’s what we call <em>schema</em>.
The items may be simple properties such as string, integer or boolean values.
There may be complex structures, and references between objects.
MidPoint data model is quite rich.
It is in fact so rich that its description will take better part of this book, because description of the data model is also description of midPoint features.</p>
</div>
<div class="paragraph">
<p>You can see midPoint configuration objects in midPoint user interface by navigating to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Repository Objects</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">All objects</b></span> and selecting object type.
The following picture shows objects of type "Role":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/03-07-repository-objects.png" alt="Repository objects">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_xml_json_and_yaml">XML, JSON and YAML</h3>
<div class="paragraph">
<p>The objects are stored in the midPoint repository in a native form which is hidden from midPoint users.
However, the objects also have a human-readable representation.
They can be represented in XML, JSON and YAML forms.
All the objects can be imported into midPoint in any of those forms.
They can be exported from midPoint in any of those forms.
They can be edited directly in midPoint using embedded editor, in any of those forms.
Just click on any object in the <b class="menuref">Repository objects</b> page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/03-08-repository-object-edit.png" alt="Repository object details">
</div>
</div>
<div class="paragraph">
<p>The ability to export, import and edit objects in XML/JSON/YAML form is absolutely essential, because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is <strong>human-readable</strong> (or rather administrator-readable).
The configuration can be created, edited and maintained in your favorite editor and then imported into midPoint.
It can be reviewed.
It can be copied and pasted.
Especially that.
No system administrator can live efficiently without an ability to copy and paste.</p>
</li>
<li>
<p>It is <strong>transferable</strong>.
It can be exported from one system (e.g. development environment) and easily transferred to another system (e.g. testing environment).
It can be easily backed-up and restored.
It can be easily shared, e.g. in a form of configuration samples.</p>
</li>
<li>
<p>It is <strong>versionable</strong>.
The exported configuration can be easily put under any ordinary version control system.
This is essential for deployment projects and configuration management.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Therefore, the midPoint configuration has the best of both worlds.
It is stored in <em>repository</em>, therefore it can be processed efficiently, it can be made available and so on.
Yet, it also has a <em>text form</em>, therefore it can be easily managed.</p>
</div>
<div class="paragraph">
<p>The XML, JSON and YAML forms are considered to be equivalent.
Objects can be written in any of these forms.</p>
</div>
<div class="listingblock">
<div class="title">XML form of role object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8ebab0bc-7e7e-11e6-a7bc-57de1cd45ecc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Basic User<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Basic user role. Almost all users have it.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;requestable&gt;</span>true<span class="tag">&lt;/requestable&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">f92e67c2-7e7e-11e6-a306-7bf6aa2e8c61</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JSON form of role object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span> : {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">oid</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">8ebab0bc-7e7e-11e6-a7bc-57de1cd45ecc</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Basic User</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Basic user role. Almost all users have it.</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">requestable</span><span class="delimiter">&quot;</span></span> : <span class="value">true</span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">inducement</span><span class="delimiter">&quot;</span></span> : {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">targetRef</span><span class="delimiter">&quot;</span></span> : {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">oid</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">f92e67c2-7e7e-11e6-a306-7bf6aa2e8c61</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">YAML form of role object</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">role</span>:
    <span class="key">oid</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">8ebab0bc-7e7e-11e6-a7bc-57de1cd45ecc</span><span class="delimiter">&quot;</span></span>
    <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Basic User</span><span class="delimiter">&quot;</span></span>
    <span class="key">description</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Basic user role. Almost all users have it.</span><span class="delimiter">&quot;</span></span>
    <span class="key">requestable</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">inducement</span>:
      - <span class="string"><span class="content">targetRef:</span><span class="content">
            oid: &quot;f92e67c2-7e7e-11e6-a306-7bf6aa2e8c61&quot;
            type: &quot;RoleType&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Most of the examples in this book are in XML notation.
The XML form is almost always simplified for clarity: there are no namespace definitions, no namespace prefixes and so on.
The complete files with all the details can be found in midPoint distribution package, midPoint source code or in other places.
See <a href="#92-additional-information">Additional Information</a> chapter for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_maintaining_midpoint_configuration">Maintaining MidPoint Configuration</h3>
<div class="paragraph">
<p>When it comes to maintenance of midPoint configuration, there are two practical methods.</p>
</div>
<div class="paragraph">
<p>First method is to maintain the configuration in midPoint: use midPoint wizards and user interface tools to create new objects and modify them.
Export the objects in regular intervals to backed them up.
This is an easy method to start with.</p>
</div>
<div class="paragraph">
<p>However, sooner or later you will probably figure out that you need the ability to copy and paste parts of the configuration, compare differences and review configuration history.
You will need to share parts of the configuration with other team members.
As we all know, no user interface is ever as efficient as an experienced engineer with a good text editor.</p>
</div>
<div class="paragraph">
<p>Then there is a second method: maintain the configuration in text form: XML, JSON or YAML.
Import the configuration to midPoint as needed.
The objects can be imported in midPoint user interface by going to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Import object</b></span> page.</p>
</div>
<div class="paragraph">
<p>It is much easier to maintain a proper version control and a good teamwork using this method.
It also seems to be more efficient once you get used to midPoint: pieces of configuration can be copied from samples, documentation or from other projects.
This makes the work efficient.
Although work with midPoint is "just" configuration, and there is usually almost no programming, this method of work is quite close to the methods that software developers use.
We know that these methods work quite efficiently, as we are using them every day.</p>
</div>
<div class="paragraph">
<p>However, maintaining configuration in <em>files</em> and importing them individually using midPoint user interface may look a bit uncomfortable.
However, there is a better way.
There is <em>MidPoint Studio</em>, an integrated development environment (IDE) based on IntelliJ IDEA.
MidPoint Studio allows you to maintain the configuration files in a form of a <em>development project</em>.
You can edit the files with all the usual luxury of IDE, such as syntax highlight and autocompletion.
Studio allows easy download and upload of changed configuration files to midPoint instance.
As the IntelliJ platform has good integration for version control systems and other development tools, this seems like an ideal approach, especially for large and complex projects.
If you plan to use midPoint professionally, <em>MidPoint Studio</em> is certainly worth trying.</p>
</div>
</div>
<div class="sect2">
<h3 id="_midpoint_repository">MidPoint Repository</h3>
<div class="paragraph">
<p>MidPoint needs its own database to work.
We call that database <em>midPoint repository</em>.
The database is used to store the configuration, users, resource definitions, account links, audit trails and a lot of other things.
Proper relational database is needed for midPoint repository, such as PostgreSQL database.
<em>Docker Compose</em> deployment makes sure that PostgreSQL is available, properly set up, initialized with database schema and ready to be used as midPoint repository.</p>
</div>
<div class="paragraph">
<p>MidPoint 4.8.5 supports several database engines.
However, only PostgreSQL database fully supports all midPoint features.
Support for database engines other than PostgreSQL is currently deprecated.
The future of <em>generic repository</em> support (as we call it) is uncertain.
Choose PostgreSQL directory (a.k.a. _native repository) to get reliable support for all midPoint features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Embedded database</div>
MidPoint had <em>embedded</em> database engine in the past, in a form of H2 database.
However, proper database engine is needed to support all midPoint features.
While the embedded H2 engine is still present in midPoint, it is not recommended to use it.
Many midPoint features will fail unless a proper database engine (PostgreSQL) engine is used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_midpoint_home_directory">MidPoint Home Directory</h3>
<div class="paragraph">
<p>While almost all of midPoint configuration is stored in the database, there are few things that cannot be stored there - such as connection parameters to the database itself.
For that purpose midPoint has a small configuration file called <code>config.xml</code>.
MidPoint also needs a place where to store other data that cannot be in the database, such as cryptographic keys, connector binaries and so on.</p>
</div>
<div class="paragraph">
<p>MidPoint needs a special directory on a filesystem for that purpose.
We call it <em>midPoint home directory</em>.
When a new midPoint instance starts for the first time, new <em>midPoint home directory</em>, populated with default configuration.
Location of <em>midPoint home directory</em> slightly varies, it depends on your deployment method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Docker-based installation: MidPoint home directory is named <code>midpoint-home</code>.
It is located in directory where the <code>midpoint-quickstart.sh</code> script was started, i.e. at the same level as the <code>docker-compose.yml</code> directory.</p>
</li>
<li>
<p>Package-based installation: MidPoint home directory is named <code>var</code>.
It is located in directory where midPoint distribution package was installed, i.e. at the same level as the <code>bin</code> directory, where midPoint start scripts are located.
Assuming that midPoint was installed in <code>/opt/midpoint</code> directory then default <em>midPoint home</em> will be located in <code>/opt/midpoint/var</code> directory.</p>
<div class="paragraph">
<p>If necessary, the location of midPoint home directory can be changed by using the <code>midpoint.home</code> Java system property.
This is done by specifying <code>-Dmidpoint.home</code> in the JVM command-line.
In case that the default midPoint start scripts are used, <code>MIDPOINT_HOME</code> environment variable can be used to set the location of midPoint home directory.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>MidPoint home directory contains several interesting items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>config.xml</code> contains fundamental configuration, such as location and credentials of repository database.</p>
</li>
<li>
<p><code>log</code> directory contains midPoint log files, <code>midpoint.log</code> file being the most important.</p>
</li>
<li>
<p><code>connid-connectors</code> directory is a place where additional identity connectors may be deployed.
Copying a connector into this directory automatically deploys it to midPoint.</p>
</li>
<li>
<p><code>resources</code> directory is used to store data for file-based resources, such as resources based on CSV connector.
This directory is used in this book.
The directory does not exist by default, and its name is not hardcoded anywhere in midPoint.
It is just a convention to store file-based resources in this directory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When midPoint starts for the first time, it starts with an empty database.
MidPoint populates the database with a minimal set of configuration objects.
We call them <em>initial objects</em>.
This set contains objects such as the <code>Superuser</code> role and user <code>administrator</code>.
These objects get imported automatically, because if they are not there, you will not be able to log into the new midPoint instance.
These objects are imported only if they are not already present in the database.
If you modify them later, midPoint will not overwrite them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_logging">Logging</h3>
<div class="paragraph">
<p>Logging is perhaps the most important mechanism to diagnose any issues with midPoint.
Logging should be <em>the</em> thing that comes to your mind anytime you cast a puzzled look at midPoint user interface.
We try to make midPoint user interface convenient to use, and we pay a lot of attention to good error reporting.
However, there are always some practical limits what the user interface can do.
The error that the user interface displays may be just a result of a long chain of causes and effects.
Error messages in the user interface may not directly point to the primary cause.
Perhaps there is no error at all, just midPoint does not do what it is supposed to do.
That is the point where <em>logging</em> comes to the rescue.</p>
</div>
<div class="paragraph">
<p>MidPoint is using Java logging facilities to log its messages.
MidPoint log file name is <code>midpoint.log</code>, and it is stored in the <code>log</code> subdirectory in midPoint home directory (<code>midpoint-home/log/midpoint.log</code> for docker-based deployment, <code>/opt/midpoint/var/log/midpoint.log</code> for package-based deployment).
The default logging level is set up more-or-less to suit normal midPoint operation.
This means that the messages on level <code>INFO</code> and above are logged while the finer levels are not logged.
If you want to diagnose midPoint issues you will need to switch the logging levels to <code>DEBUG</code>, or in extreme cases even to <code>TRACE</code>.
The logging levels can be adjusted in midPoint user interface.
Navigate to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">System</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Logging</b></span>.</p>
</div>
<div class="paragraph">
<p>MidPoint is not a simple system.
There are complex interactions, there is usually a lot of custom configuration, customizations, expressions and so on.
Diagnostics of midPoint issues is no easy task.
Therefore, there is a dedicated <a href="#90-troubleshooting">Troubleshooting</a> chapter in this book.
That chapter is your best friend when things do not go as expected.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph">
<p>We have small and simple docker-based midPoint installation now.
It is not much, yet it is more than enough to explore almost all the midPoint concepts and mechanisms.
Therefore, let us go ahead and have some fun.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="04-resources-and-mappings">4. Resources and Mappings</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
The pessimist complains about the wind; the optimist expects it to change; the realist adjusts the sails.
</blockquote>
<div class="attribution">
&#8212; William Arthur Ward
</div>
</div>
<div class="paragraph">
<p>Reading and modifying accounts, account attribute synchronization, mapping of attribute values, their transformation using scripts – these are the very basic midPoint features.
These are <em>provisioning</em> features (or rather <em>fulfilment</em> features as analysts like to have it).
These features are absolutely essential for any self-respecting identity management deployment.
Explaining the very basic mechanisms of identity management deployment is the primary purpose of this chapter.
It covers the necessary configuration to use midPoint as a <em>provisioning engine</em>.</p>
</div>
<div class="paragraph">
<p>The first thing that engineers notice about identity management is that the systems we need to integrate are not exactly homogeneous.
It is not very realistic to expect that all the systems will agree on the same interface, communication protocol and schema for identity management.
There were several attempts to unify the identity and access management landscape, but none of them was entirely successful.
The LDAP protocol was created in the 1990s.
However, even for such a mature protocol, the implementations are sill not 100% interoperable.
The situation is even worse for identity provisioning protocols.
There were several attempts to specify a standard provisioning protocol since early 2000s, but all of them failed to deliver complete interoperability.
SCIM version 2 is the latest attempt.
SCIM 2 is, quite successfully, used for some cloud applications and simple cross-organizational scenarios.
However, as almost all deployments of SCIM are using local variations, the interoperability is quite poor.
Moreover, SCIM still lacks capabilities to cover all aspects of a complete provisioning solution.</p>
</div>
<div class="paragraph">
<p>The worst pain point of identity integration is undoubtedly the <em>schema</em>.
Every application has its own data model for representation of accounts, groups, privileges and other identity-related objects.
Even if the application tries to expose that data model using some kind of standard schema (such as SCIM schema), there will always be small (but important) differences, special cases and local peculiarities.
Such deviations are a major obstacle to interoperability.</p>
</div>
<div class="paragraph">
<p>Instead of insisting on an idealistic universal schema for all applications, midPoint provides a <em>practical</em> solution to this problem.
MidPoint admits the reality: every system and application has its own schema and local variations.
Yet, we still need a <em>common</em> schema to be able to understand what is going on, to process and analyze the data.
MidPoint has a <em>common identity schema</em> inside.
Application schemas with all their peculiarities are aligned or <em>mapped</em> to the common schema.
Once the <em>mappings</em> are in place, midPoint automatically translates the data as needed, maintaining a consistent data among all the systems.
This chapter will tell you how to do it, how to set up the <em>mappings</em>.</p>
</div>
<div class="sect2">
<h3 id="_identity_resource_definitions">Identity Resource Definitions</h3>
<div class="paragraph">
<p><em>Identity resource</em> is one of the most important concepts in midPoint.
Any system connected to midPoint is an <em>identity resource</em>.
Identity resources (or just <em>resources</em> for short) are typically <em>target</em> systems where midPoint manages accounts.
Moreover, <em>source</em> systems, such as HR databases, are also considered to be identity resources.
There is no strict distinction between the <em>source</em> and <em>target</em> resource in midPoint.
Both source and target resources are defined in exactly the same way.
Resource can even act as both source and target at the same time.</p>
</div>
<div class="paragraph">
<p>MidPoint needs a way to communicate with the identity resource.
MidPoint has to know communication protocol, hostname, keys and passwords, and all other communication parameters.
For that purpose midPoint has <em>resource definition objects</em>.
These are midPoint configuration objects stored in midPoint repository.
<em>Resource definition</em> usually contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong> of the identity resource and its description.</p>
</li>
<li>
<p><strong>Reference to the connector</strong> which is used to communicate with the resource.</p>
</li>
<li>
<p><strong>Connector configuration properties</strong> that define resource hostname, port, communication settings and so on.
Those properties are used to initialize the connector.</p>
</li>
<li>
<p>Definition of <strong>object types</strong> that are interesting for midPoint.
This is typically a definition that describes how a typical account looks like.
However, there may be much more than just accounts: groups, entitlements, organizational units, &#8230;&#8203;</p>
</li>
<li>
<p>Object type definitions typically contain <strong>mappings</strong>.
Mappings define how are the attributes moved and transformed from midPoint to resource, or from resource to midPoint.</p>
</li>
<li>
<p><strong>Synchronization</strong> settings that define what midPoint should do if it discovers unknown account, if the account is deleted on the resource and so on.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Resource definition looks like this in its XML form (simplified):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b4101662-7902-11e6-9f14-53e18426fe81</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>LDAP<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">028159cc-f976-457f-be70-9e9fa079bcf7</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;connectorConfiguration&gt;</span>
        <span class="tag">&lt;configurationProperties&gt;</span>
            <span class="tag">&lt;host&gt;</span>localhost<span class="tag">&lt;/host&gt;</span>
            <span class="tag">&lt;port&gt;</span>389<span class="tag">&lt;/port&gt;</span>
            <span class="tag">&lt;baseContext&gt;</span>dc=example,dc=com<span class="tag">&lt;/baseContext&gt;</span>
            ...
        <span class="tag">&lt;/configurationProperties&gt;</span>
    <span class="tag">&lt;/connectorConfiguration&gt;</span>
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>inetOrgPerson<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
            ...
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Resource definition is a very rich (and powerful) configuration object.
It is maybe the richest configuration object in the entire midPoint platform.
Creating resource definition from scratch is usually no easy task.
There is a lot of things to consider: connector configuration, identifier conventions, mandatory attributes and attribute value formats to name just few.
There are two practical ways to create resource definitions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Start from a sample</strong>.
Locate a resource definition sample for a similar resource.
Then modify the sample to suit your needs.
This is the usual midPoint method: edit the XML/JSON/YAML file, them import it to midPoint.
Navigate to <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Resources</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Import resource definition</b></span>.</p>
<div class="paragraph">
<p>There are many resource samples to start from.
Most of them are located in midPoint distribution package.
However, there are other places to look for samples.
Please see <a href="#92-additional-information">Additional Information</a> chapter for suggestions.</p>
</div>
</li>
<li>
<p><strong>Resource wizard</strong>.
Believe it or not, there are people that do not like XML/JSON/YAML.
There are also people that really want to start creating the resource from scratch.
For all those people there is a resource wizard in the midPoint user interface.
The wizard can be used to create and edit resource using a graphical user interface.
Navigate to <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Resources</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">New resource</b></span>, select <b class="menuref">From Scratch</b> option.</p>
<div class="imageblock">
<div class="content">
<img src="images/04-01-resource-wizard.png" alt="Resource wizard">
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Resource lifecycle state</div>
Resource wizard is creating resources as <code>proposed</code> by default.
The <code>proposed</code> state is a <em>lifecycle state</em>, specifying that this object is not ready for production yet.
It is just <em>proposed</em>, i.e. it is a candidate, to be commissioned as a production configuration when properly tested.
We will deal with lifecycle states later.
All that is needed for now it to switch the resource to <code>active</code> state to operate correctly.
This can be done in the first step of the wizard, or it can be changed later when editing the resource.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However, you need to understand how the resource definitions work to do this efficiently - even if you start with resource wizard.
Next few sections will explain the structure and function of resource definitions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_connectors">Connectors</h3>
<div class="paragraph">
<p>Every resource needs a <em>connector</em> to work.
Connectors are small pieces of Java code that are used to communicate with the source and target systems.
Few popular connectors are part of midPoint distribution package (<em>bundled</em> connectors), other connectors can be downloaded and deployed in midPoint home directory.</p>
</div>
<div class="paragraph">
<p>MidPoint automatically looks for available connectors.
MidPoint creates new configuration object for each connector that it discovers.
The list of discovered connectors can be seen in midPoint user interface in <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Repository objects</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">All objects</b></span>, selecting <b class="menuref">Connector</b> in the type field located at the top of the screen.
The connector objects look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;connector</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">028159cc-f976-457f-be70-9e9fa079bcf7</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;name&gt;</span>ConnId com.evolveum.polygon.connector.ldap.LdapConnector v3.7<span class="tag">&lt;/name&gt;</span>
  <span class="tag">&lt;framework&gt;</span>http://midpoint.evolveum.com/xml/ns/public/connector/icf-1<span class="tag">&lt;/framework&gt;</span>
  <span class="tag">&lt;connectorType&gt;</span>com.evolveum.polygon.connector.ldap.LdapConnector<span class="tag">&lt;/connectorType&gt;</span>
  <span class="tag">&lt;connectorVersion&gt;</span>3.7<span class="tag">&lt;/connectorVersion&gt;</span>
  <span class="tag">&lt;connectorBundle&gt;</span>com.evolveum.polygon.connector-ldap<span class="tag">&lt;/connectorBundle&gt;</span>
  <span class="tag">&lt;namespace&gt;</span>http://midpoint.evolveum.com/xml/ns/…<span class="tag">&lt;/namespace&gt;</span>
  <span class="tag">&lt;schema&gt;</span>
      ...
  <span class="tag">&lt;/schema&gt;</span>
<span class="tag">&lt;/connector&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resource definition needs to point to the appropriate connector object.
Therefore, select the right connector from the connector list and remember its OID.
Then use the connector OID in the resource configuration like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource&gt;</span>
    <span class="tag">&lt;name&gt;</span>My LDAP Server<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">028159cc-f976-457f-be70-9e9fa079bcf7</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    ...
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Resource wizard</div>
Of course, resource wizard does all that connector stuff for you.
All you need is to select the right connector.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is a straightforward way how to link <em>connector</em> and <em>resource</em>.
However, it is not the most convenient one.
MidPoint creates connector objects automatically.
Therefore, the OIDs of the connector objects are not fixed.
Every midPoint instance will have different OID for the discovered connectors.
Therefore, if we want a resource that is always using the LDAP connector in all the midPoint instances, we cannot do that by just using OIDs.
There is another way.
You can use <em>search filter</em> instead of fixed OID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource&gt;</span>
    <span class="tag">&lt;name&gt;</span>My LDAP Server<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectorType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;filter&gt;</span>
            <span class="tag">&lt;q:text&gt;</span>connectorType = &quot;com.evolveum.polygon.connector.ldap.LdapConnector&quot;<span class="tag">&lt;/q:text&gt;</span>
        <span class="tag">&lt;/filter&gt;</span>
    <span class="tag">&lt;/connectorRef&gt;</span>
    ...
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The detailed explanation of the search filters will come later.
For now, it is important to know just few basic principles.
When this resource definition is imported, midPoint notices that there is no OID in the <code>connectorRef</code> reference.
It also notices that there is a <em>search filter</em>.
Therefore, midPoint executes that search filter.
In this case it looks for an object of <code>ConnectorType</code> type that has property <code>connectorType</code> with value <code>com.evolveum.polygon.connector.ldap.LdapConnector</code>.
Therefore, midPoint finds LDAP connector, regardless of the OID that was generated when midPoint discovered that connector.
Then midPoint takes the OID of the object that it has found.
The OID is placed to the <code>connectorRef</code> reference, so midPoint can find the connector directly, and it does not need to execute the search every time the resource is used.</p>
</div>
<div class="paragraph">
<p>This is the method that is frequently used to bind resource definition to a specific connector type.
It has the advantage that it works in all midPoint deployments.
Therefore, it is also used in the configuration samples.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bundled_and_deployed_connectors">Bundled and Deployed Connectors</h3>
<div class="paragraph">
<p>Each type of resources needs its own connector.
There is an LDAP connector that supports all the common LDAP servers.
There are connectors that work with generic database tables.
These connectors are quite generic.
However, most connectors are built for a specific application or software system: Linux servers, SAP, Zoom, etc.</p>
</div>
<div class="paragraph">
<p>There is a handful of connectors that are so generic that they are used in almost all midPoint deployments.
These connectors are <em>bundled</em> with midPoint.
It means that they are part of the midPoint application package, and they are always available.
These three connector bundles are part of midPoint:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LDAP Connector bundle, which contains:</p>
<div class="ulist">
<ul>
<li>
<p><strong>LDAP</strong> connector that works with common LDAP servers.</p>
</li>
<li>
<p><strong>Active Directory</strong> connector that can work with Microsoft Active Directory over LDAP protocol.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>DatabaseTable</strong> connector bundle with a connector that can connect to a generic relational database table.</p>
</li>
<li>
<p><strong>CSV</strong> connector bundle with a connector that works with comma-separated (CSV) text files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These connectors are always available in midPoint.
Other connectors must be deployed into midPoint.
Connector deployment is a very straightforward process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Locate the connector binary (JAR file).</p>
</li>
<li>
<p>Copy the binary into the <code>connid-connectors</code> directory which is located in midPoint home directory.</p>
</li>
<li>
<p>Wait few moments for midPoint to discover the connector.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>MidPoint periodically scans the <code>connid-connectors</code> directory.
It discovers any new connectors, and creates a connector configuration objects for them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_connector_configuration_properties">Connector Configuration Properties</h3>
<div class="paragraph">
<p>Connector needs a configuration to be able to work with the resource.
This configuration usually consists of connection parameters such as hostname, port, administrative username, password, connection security settings and so on.
The connector configuration properties are specified in the <em>resource definition object</em>.
In a simplified from it looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">690f9f44-8027-11e6-a248-3b5fe08dea36</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>My LDAP Server<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">028159cc-f976-457f-be70-9e9fa079bcf7</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;connectorConfiguration&gt;</span>
        <span class="tag">&lt;configurationProperties&gt;</span>
            <span class="tag">&lt;port&gt;</span>389<span class="tag">&lt;/port&gt;</span>
            <span class="tag">&lt;host&gt;</span>localhost<span class="tag">&lt;/host&gt;</span>
            <span class="tag">&lt;baseContext&gt;</span>dc=example,dc=com<span class="tag">&lt;/baseContext&gt;</span>
            ...
        <span class="tag">&lt;/configurationProperties&gt;</span>
    <span class="tag">&lt;/connectorConfiguration&gt;</span>
    ...
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There may be a very broad range of configuration properties - and every connector has its own set.
While working just with the XML/JSON/YAML representation of the resource definition, you will need to find out the names of the configuration properties by looking at the samples, connector documentation or maybe even connector source code.
It may look difficult, but this is a perfectly viable approach.
However, there are other ways.
Firstly, there is the <em>resource wizard</em>.
The wizard knows all the connector configuration properties, and it will present the properties in a configuration form.
The wizard takes the definition of the configuration properties from the <em>connector schema</em>.
The <em>connector schema</em> is a definition of the properties that the connector supports: their names, types, multiplicity and so on.
The <em>connector schema</em> is stored in the <em>connector configuration object</em> in the <code>schema</code> element.
Therefore, even if you are working only with the XML/JSON/YAML files, you can have a look at that schema
to figure out what connector configuration properties are supported.</p>
</div>
<div class="paragraph">
<p>The connector schema also defines the connector namespace.
Generally speaking, namespaces in midPoint are used to isolate schema extensions that might have conflicting element names.
The use of namespaces is optional in almost all parts of midPoint - but not in all the parts yet.
Connector configuration is one of the few parts where namespaces must still be used.
It also makes some sense, as namespaces are used here as an additional safety mechanism.
To keep a long story short, the configuration properties should be properly namespace-qualified:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">690f9f44-8027-11e6-a248-3b5fe08dea36</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>LDAP<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">028159cc-f976-457f-be70-9e9fa079bcf7</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;connectorConfiguration</span>
            <span class="attribute-name">xmlns:icfc</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-3</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">xmlns:icfcldap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/com.evolveum.polygon.connector-ldap/com.evolveum.polygon.connector.ldap.LdapConnector</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;icfc:configurationProperties&gt;</span>
            <span class="tag">&lt;icfcldap:port&gt;</span>389<span class="tag">&lt;/icfcldap:port&gt;</span>
            <span class="tag">&lt;icfcldap:host&gt;</span>localhost<span class="tag">&lt;/icfcldap:host&gt;</span>
            <span class="tag">&lt;icfcldap:baseContext&gt;</span>dc=example,dc=com<span class="tag">&lt;/icfcldap:baseContext&gt;</span>
            ...
        <span class="tag">&lt;/icfc:configurationProperties&gt;</span>
    <span class="tag">&lt;/connectorConfiguration&gt;</span>
    ...
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The use of namespaces will be completely optional in later midPoint versions.
For now, just copy the namespace URIs from the samples.
You do not have to completely understand what is going on.
Just one thing: the namespace of the configuration properties should be the same as the namespace defined in the connector object.
This is a long URI that is composed of connector bundle name and connector name.</p>
</div>
<div class="paragraph">
<p>For example: <code><a href="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/com.evolveum.polygon.connector-ldap/com.evolveum.polygon.connector.ldap.LdapConnector" class="bare">http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/com.evolveum.polygon.connector-ldap/com.evolveum.polygon.connector.ldap.LdapConnector</a></code></p>
</div>
<div class="paragraph">
<p>If the namespace does not match, then the connector will refuse to work.
This is a safety mechanism that prohibits accidental use of configuration from one connector in another connector, where the configuration properties may have the same name but a completely different meaning.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Resource wizard</div>
Resource wizard has a very convenient way to specify connector configuration properties.
Resource wizard also support <em>discovery</em> of some configuration properties.
For example, it can discover <em>base context</em> of an LDAP server, by connecting to the server and getting that information from server meta-data.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_resource">Testing the Resource</h3>
<div class="paragraph">
<p>Minimal resource definition has just the <em>name</em>, <em>connector reference</em> and <em>connector configuration properties</em>.
After that, the resource should show the first signs of life.
Therefore, go ahead and select a suitable sample file now.
Strip it down to the minimum, modify connector configuration properties and import the resource into midPoint.
You should be able to see your resource in the list in <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Resources</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">All resources</b></span>.
The icon next to your resource is most likely black - not green and not red.
Green icon means that the resource is working, red icon means that there is an error, black means "I do not know yet".
Click on the resource label.
The resource details page appears.
There is a <b class="button">Test Connection</b> button at the top of the page.
Click on that button.
It may take a while now.
MidPoint is initializing the connector with the configuration properties that you have specified.
Then the connector is used to check connection to the resource.
If the parameters were correct, and midPoint can reach the resource, you will see the green lights:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-02-test-resource.png" alt="Test connection">
</div>
</div>
<div class="paragraph">
<p>If there are any errors during connector initialization, configuration or network connection you will see the errors here.
In that case, correct the configuration properties, and try again.
If everything works well, then the resource icon turns green.
Now we have a very minimal working resource.</p>
</div>
<div class="paragraph">
<p>The <em>test connection</em> procedure is testing whether connector can connect to the resource.
However, can the connector access the data as well?
We would like to see some data now, to make sure that everything works fine.
We cannot do that just yet.
We have to talk about the <em>schema</em> first.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_schema">Resource Schema</h3>
<div class="paragraph">
<p>The only thing that early identity management systems dealt with was an <em>account</em>.
The world have evolved a lot since the early days of identity management in the 2000s.
Today, identity management systems need to manage many different types of resource objects: <em>accounts</em>, <em>groups</em>, <em>organizational units</em>, <em>privileges</em>, <em>roles</em>, <em>access control lists</em> and so on.
In midPoint, these are the <em>object classes</em>: types of resource objects that are made accessible to midPoint by the connector.
A minimal resource supports at least one <em>account</em> object class, but a typical resource supports more object classes.
Each object class may have a completely different set of attributes: different attribute names, different data types, some may be mandatory, some optional, single-valued or multi-valued.</p>
</div>
<div class="paragraph">
<p>The collective definition of the object classes and their attributes is what we call <em>resource schema</em>.
Obviously, resource schema is different for every resource.
Even resources that are using the same connector may have different resource schema.
For example two LDAP servers with different custom schema extensions or two business systems with different customizations.
MidPoint is a smart system, and it is capable of automatic <em>resource schema discovery</em>.
MidPoint reaches out to the resource and retrieves the schema when the resource is used for the first time.
Retrieved resource schema is stored as the <code>schema</code> element in resource definition object.
You can have a look and examine the schema there.
But beware, the schema may be quite rich and big.</p>
</div>
<div class="paragraph">
<p>Resource schema is an absolutely crucial concept.
MidPoint takes advantage of resource schema whenever it needs to work with resource objects such as accounts or groups.
MidPoint uses resource schema to validate mappings.
The schema is used for automatic type conversions.
Most importantly of all: resource schema is used to display resource objects in user interface.
MidPoint adapts to resource schema automatically.
Not a single line of custom code is needed to do that.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_resource_data">Accessing Resource Data</h3>
<div class="paragraph">
<p>We would like to have a look at resource data before going on with configuration.
It would be nice to make sure that the connector is configured correctly, that there are appropriate access rights in place for the connector to access the data and that everything works fine.
However, some resources are very flexible and generic.
LDAP servers are a prime example.
They have lots of object classes to choose from, their <em>resource schema</em> is quite bit.
We need only a couple of object classes from that huge LDAP schema.
However, LDAP connector is very generic, it does not know which object classes are the right ones.
Therefore, we have to tell midPoint which object class to choose from the schema.</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">690f9f44-8027-11e6-a248-3b5fe08dea36</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>LDAP<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">028159cc-f976-457f-be70-9e9fa079bcf7</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;connectorConfiguration&gt;</span>
        ...
    <span class="tag">&lt;/connectorConfiguration&gt;</span>

    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>Normal Account<span class="tag">&lt;/displayName&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>inetOrgPerson<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We will learn about the <code>schemaHandling</code> section later.
For now, this declaration of <em>object type</em> tells midPoint, that there are <em>accounts</em> on this resource.
The <em>accounts</em> are using <code>inetOrgPerson</code> object class.</p>
</div>
<div class="paragraph">
<p>Now, as midPoint knows what "Normal LDAP Account" means exactly, we can have a look at such accounts.
Navigate to the <b class="menuref">Accounts</b> panel in resource details page.
This is the place to browse accounts on this resource.
However, the list is empty!
It is empty, as midPoint have not tried to access the accounts yet.
Click on <b class="button">Reload</b> button does the trick.
MidPoint is using the connector to list all the accounts (objects with <code>inetOrgPerson</code> object class) in our LDAP server.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-03-list-accounts.png" alt="List resource account">
</div>
</div>
<div class="paragraph">
<p>Now you can click on any object to see the details.
This is a very useful feature for several reasons.
By looking at several objects, you can get a basic overview of how the data are structured: what attributes are used and what are the typical values.
You will appreciate that information later on when we will be setting up mappings.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hub_and_spoke">Hub and Spoke</h3>
<div class="paragraph">
<p>MidPoint topology is a <em>star</em> (a.k.a. "hub and spoke") with midPoint at the center.
This is both physical and logical topology of midPoint deployments.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-04-hub-and-spoke.png" alt="Hub and spoke">
</div>
</div>
<div class="paragraph">
<p>This means that the <em>account A</em> can be synchronized with midPoint <em>user</em> and then midPoint <em>user</em> can be synchronized with <em>account B</em>.
However, <em>account A</em> cannot be synchronized directly to <em>account B</em>.
This is a deliberate decision that was made very early in midPoint design.
We have very good reasons for it.</p>
</div>
<div class="paragraph">
<p><em>Accounts</em> and <em>user</em> that represent the same person are <em>linked</em> together.
This <em>link</em> is a relation that midPoint creates and maintains.
Therefore, midPoint knows who is the <em>owner</em> of a particular account.
MidPoint also knows which accounts the user has.
That is how midPoint knows which account needs to be synchronized with which user.
It is critical for the links to be correct, otherwise midPoint cannot reliably synchronize the data.
For that reason, midPoint takes great care to maintain the links.
That is not always an easy task.
There are strange corner cases, such as renamed accounts, or accounts that were deleted by mistake and re-created.
Yet, midPoint is built to handle such cases.
The links are always maintained.
It is the link that allows midPoint to list all user’s accounts in the user interface.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-05-user-bob-projections.png" alt="Projections">
</div>
</div>
<div class="paragraph">
<p>The user in midPoint is known as <em>focus</em> in midPoint terminology.
The accounts are known as <em>projections</em>.
You can imagine a light projector that sends many light beams from its focal point to create a projection on the screen.
This is the metaphor that we have chosen when developing midPoint.
For the lack of better words, this terminology remains in use even today.
We will get back to the concept of <em>focus</em> and <em>projections</em> many times in this book.
For now, you just need to remember that <em>projection</em> means an <em>account</em>.</p>
</div>
<div class="paragraph">
<p>MidPoint knows which account belongs to which user by following <em>links</em> that it maintains.
However, how does midPoint know which attributes to synchronize?
How to transform the values?
Which side is the authoritative one?
<em>Mappings</em> take care of that.
<em>Mapping</em> is like a flexible data replication recipe.
MidPoint allows to define mappings for each attribute in any direction.
The mappings are used to control the synchronization on a very fine granularity.</p>
</div>
<div class="paragraph">
<p>Perhaps the best way to summarize synchronization principles is to illustrate them using a couple of examples.
The first example is a modification of user properties in midPoint user interface.
When the <b class="button">Save</b> button is pressed, midPoint user interface sends the modification to midPoint core engine.
The synchronization code in midPoint core follows the links to find all the accounts that belong to this specific user.
Then the <em>mappings</em> are applied to synchronize the changed user properties to the accounts.
Account changes are propagated to the resources, and user changes are stored in midPoint repository.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-06-user-account-gui.png" alt="User-account GUI change">
</div>
</div>
<div class="paragraph">
<p>The second example is slightly different.
This case starts with a change of account data.
This may be a change of an employee record in HR system.
MidPoint detects that change, and reads the changed account.
MidPoint follows the <em>link</em> to find the user to which the account belongs.
Then it follows other links from the user to find all the other accounts that may be affected.
Similarly to the previous case, the <em>mappings</em> are applied.
The mappings from the HR account to the user are applied first.
The result is a modification of user properties.
Then a process identical to the previous case takes place.
User modifications are automatically applied to all affected accounts.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-07-user-account-inbound.png" alt="User-account GUI inbound mapping">
</div>
</div>
<div class="paragraph">
<p>Those two cases might look to be quite different.
First case is a manual change of data by system administrator.
Second case is an automatic data feed from the HR system.
However, as you can see, the principles that are used to implement those two cases are almost exactly the same.
This is the consequence of midPoint philosophy: radical reuse of functionality and generic application of principles.
You define what you want to do (the policy) by setting up the <em>mappings</em>.
MidPoint takes care that it is done when it needs to be done.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Why the star topology?</div>
The <em>star</em> or "hub and spoke" were (and still are) the big buzzwords of system integration.
Rightfully so, as the basic idea of star topology makes a lot of sense.
If every node needs to be synchronized with every other node, then the number of required connections grows quite steeply.
It is in fact proportional to the <em>square</em> of the number of nodes.
Mathematicians say that is has O(n<sup>2</sup>) complexity.
However, if you rearrange the connections so that they all point to the central "hub", then the number of connections is significantly reduced.
It is proportional to the number of nodes: O(n) complexity.
This is a huge difference, especially in deployments with many resources.
However, this approach works well only if the star topology is both physical and logical.
I.e. it makes very little sense to connect all resources to a central “hub” if that hub still internally needs O(n<sup>2</sup>) policies to synchronize the data.
That would only hide the complexity in a black box, yet the complexity would still be there.
However, midPoint is different.
MidPoint is a real "hub".
This is the reason why midPoint does not support synchronization of accounts directly with each other.
We want to have simple, clean and maintainable system, both externally and internally.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_schema_handling">Schema Handling</h3>
<div class="paragraph">
<p><em>Resource schema</em> is a very important concept.
It defines what object classes are supported by the resource and how they look like.
Yet, it is important to know not only how the objects look like.
It is also important to know what to <em>do</em> with them.
That is what the <em>schema handling</em> is all about.</p>
</div>
<div class="paragraph">
<p><em>Schema handling</em> is a part of the resource definition object.
It specifies which object classes from the resource schema are actually used by midPoint.
Most importantly of all, it specifies <em>how</em> they are used.
This is the place where <em>mappings</em> are stored.
This is the place where account-group <em>associations</em> are defined.
This is the place where schema can be augmented and tweaked.
Consequently, this is the place where most of the resource-related configuration takes place.</p>
</div>
<div class="paragraph">
<p><em>Schema handling</em> section contains definition of several <em>object types</em>.
Each <em>object type</em> refers to one "thing" that midPoint works with: default account, testing account, group, organizational unit and so on.
Let’s start with something simple.
Let’s define just one object type now: default account.
It looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b4101662-7902-11e6-9f14-53e18426fe81</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>My LDAP Server<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>inetOrgPerson<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This may seem trivial, but even such a minimal definition is important for midPoint.
This definition tells midPoint that default account on this resource has <code>inetOrgPerson</code> object class.
Resources such as LDAP servers may have dozens of object classes.
Most of them are not used at all.
There are often several alternative object classes that can be used to create accounts.
It is important to tell midPoint which object class is the right one.
That’s what this definition does.
Once this definition is in place, the accounts appear on the <b class="menuref">Accounts</b> panel of the resource details page.
This is a sign that the definition works correctly.</p>
</div>
<div class="paragraph">
<p>A clever reader surely noticed definition of <em>kind</em> in the above example.
Setting <em>kind</em> to <code>account</code> indicates that this object type definition represents (quite surprisingly) an account.
MidPoint supports many types of objects.
However, two types have a special place: <em>accounts</em> that represents the users and <em>entitlements</em> that give privileges to the accounts.
MidPoint can handle the objects in a smart way if it knows that it is either <em>account</em> or <em>entitlement</em>.
The <em>kind</em> definition tells just that.
There is also optional <em>intent</em> setting that can be used to define subtypes - but more on that later.</p>
</div>
<div class="paragraph">
<p>The schema handling section can also be used to augment (or even override) some parts of the resource schema.
E.g. following example sets a display name for this object type.
The display name will be used by the user interface when it displays the account.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b4101662-7902-11e6-9f14-53e18426fe81</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>My LDAP Server<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>Default account<span class="tag">&lt;/displayName&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>inetOrgPerson<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the most powerful feature that is used in the schema handling is the ability to deal with attributes.
Following sections are all about that.</p>
</div>
</div>
<div class="sect2">
<h3 id="_attribute_handling">Attribute Handling</h3>
<div class="paragraph">
<p>Resource objects such as accounts or groups are mostly just a bunch of attributes.
Almost all the IDM magic is about setting the correct attribute to the correct value.
The <em>schema handling</em> section of the resource definition is the place where that magic happens.</p>
</div>
<div class="paragraph">
<p>The <em>object type</em> definition contains sections that define behavior of each attribute that we care about:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b4101662-7902-11e6-9f14-53e18426fe81</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>My LDAP Server<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>inetOrgPerson<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>dn<span class="tag">&lt;/ref&gt;</span>
                <span class="comment">&lt;!-- behavior of &quot;dn&quot; attribute defined here --&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>cn<span class="tag">&lt;/ref&gt;</span>
                <span class="comment">&lt;!-- behavior of &quot;cn&quot; attribute defined here --&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is an <code>attribute</code> element for every attribute that we need to handle.
The <code>attribute</code> elements are used to set up the attributes that a typical user account has.
They are used to assign identifiers, set up full name, set description and telephone number attributes and things like that.
Lot of details can be defined here: display name of the attribute for use by the user interface, limitations, override settings and so on.
However, the most important things that go there are the <em>mappings</em>.
MidPoint evaluates the mappings in <code>attribute</code> elements to populate account attributes with the correct values.
In the simplest form, a mapping looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b4101662-7902-11e6-9f14-53e18426fe81</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>My LDAP Server<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;objectClass&gt;</span>inetOrgPerson<span class="tag">&lt;/objectClass&gt;</span>
            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>cn<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    <span class="tag">&lt;source&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/fullName<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/source&gt;</span>
                <span class="tag">&lt;/outbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The mapping specifies that the value of the <code>cn</code> attribute will be taken from the <code>fullName</code> property of the focal object (which is typically a user).
This a very simple mapping, there is no value transformation, no condition – nothing complicated at all.
This is how a lot of mappings look like.
However, mappings can also be very powerful and complex.
That will be described in next section.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Namespace prefixes <code>ri</code> and <code>icfs</code></div>
You may have noticed that <code>ri</code> and <code>icfs</code> namespace prefixes are used in some sample files when referring to object classes or attributes.
Object classes and attributes are defined in <em>resource schema</em>, and the <code>ri</code> is the namespace prefix used for that schema.
The <code>ri</code> stands for "resource instance", which refers to <em>resource schema</em>.
Similarly, some attributes are defined in fixed schema originating in the old identity connector framework (ICF), a predecessor to ConnId.
Such attributes are denoted by <code>icfs</code> prefix, which stands for "identity connector framework schema".
This is used mostly by older connectors that were not yet fully updated to ConnId standards.
The use of the <code>ri</code> namespace, similarly to almost all other namespaces, is almost always optional.
The prefixes are kept in some sample files mostly due to nostalgic reasons.
The use of <code>icfs</code> and <code>ri</code> prefixes may still be needed in case that attribute names in fixed <code>icfs</code> schema conflict with attribute names in resource schema.
In such case the prefixes are used to resolve the ambiguity.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_mappings">Mappings</h3>
<div class="paragraph">
<p><em>Mapping</em> is a very flexible mechanism that takes one or more input properties, transforms them, and puts the result in another property.
Mappings are used all over midPoint.
However, perhaps the most important use of mappings is in the <em>schema handling</em> part of the resource definition, where they are used to set up account attribute values.
We have already seen a very simple mapping that simply copies the values from one place to another.
Now it is the time to look at mappings in their entirety.</p>
</div>
<div class="paragraph">
<p>Mapping consists of the three basic parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Source</strong> part defines the data sources of the mapping.
These are usually understood as mapping <em>input</em> variables.
<em>Source</em> defines where mapping gets its data from.</p>
</li>
<li>
<p><strong>Expression</strong> part defines how the data are transformed, generated or passed on to the "other side".
This is the most flexible part of the mapping as it contains the logic.
There is a broad variety of possibilities, including support for scripting expressions.</p>
</li>
<li>
<p><strong>Target</strong> part defines what to do with the results of the mapping, where the computed values should go.
It specifies where mapping <em>output</em> should go.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The three parts of the mapping, as well as the basic principle, is illustrated in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-08-mapping.png" alt="Mapping">
</div>
</div>
<div class="paragraph">
<p>The diagram shows a mapping that takes <code>employeeNumber</code> user property and transforms it to <code>description</code> account attribute by using a simple Groovy script expression.</p>
</div>
<div class="paragraph">
<p>The <code>source</code> part of the mapping specifies that there is a single source, which is based on <code>employeeNumber</code> user property.
Source definitions are important for the mapping to correctly process relative changes (deltas), resolve mapping dependencies, etc.
The source definition tells mapping that the value of <code>employeeNumber</code> user property should be passed to an expression.</p>
</div>
<div class="paragraph">
<p>The <code>expression</code> part contains a simple Groovy script that prepends the prefix <code>emp#</code> to the employee number value, specified by the source definition.
The <code>expression</code> part of the mapping is very flexible.
There is a lot of ways that can be used to transform a value, generate new value, use a fixed value, pass a value without any change and so on.</p>
</div>
<div class="paragraph">
<p>The <code>target</code> part defines how the result of the expression should be used.
In this case, the result is to be used as a new value for <code>description</code> account attribute.
The <code>target</code> definition is necessary, so the mapping can locate appropriate definition of the target property, and make sure that the expression produces a correct data type, and that other schema constraints are maintained (e.g. single vs multiple values).</p>
</div>
<div class="paragraph">
<p>This mapping can be expressed in XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mapping&gt;</span>
    <span class="tag">&lt;source&gt;</span>
        <span class="tag">&lt;path&gt;</span>$focus/employeeNumber<span class="tag">&lt;/path&gt;</span>
    <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;expression&gt;</span>
        <span class="tag">&lt;script&gt;</span>
<span class="inline">            <span class="tag">&lt;code&gt;</span>'emp#' + employeeNumber<span class="tag">&lt;/code&gt;</span></span>
        <span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;/expression&gt;</span>
    <span class="tag">&lt;target&gt;</span>
        <span class="tag">&lt;path&gt;</span>$projection/attributes/description<span class="tag">&lt;/path&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Not all parts of the mapping are mandatory.
If the expression is not present, then "as is" expression is assumed.
Such expression simply copies the source to target without any transformation.
Some parts of the mapping may be implicitly defined by the surrounding context.
E.g. <em>target</em> or <em>source</em> is implicit if the mapping is used to define attribute behavior in the <em>schema handling</em> section.
Therefore, it is usually sufficient to define either <em>source</em> or <em>target</em> for mappings in <em>schema handling</em>.</p>
</div>
<div class="paragraph">
<p>The following example specifies a mapping in element <code>outbound</code>.
There is explicit definition of mapping source, specifying that mapping input is <code>familyName</code> property of a focal object (which is usually <em>user</em>).
The mapping has no <em>expression</em> defined, therefore it defaults to the "as is" expression.
Because the mapping is specified in <code>attribute</code> element, the mapping has an implicit <em>target</em>, which is the <code>sn</code> attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;schemaHandling&gt;</span>
    ...
    <span class="tag">&lt;attribute&gt;</span>
        <span class="tag">&lt;ref&gt;</span>sn<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;outbound&gt;</span>
             <span class="tag">&lt;source&gt;</span>
                  <span class="tag">&lt;path&gt;</span>$focus/familyName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
        <span class="tag">&lt;/outbound&gt;</span>
    <span class="tag">&lt;/attribute&gt;</span>
    ...
<span class="tag">&lt;/schemaHandling&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the mapping notation can even be shortened even further.
It is quite clear that the mapping source will be one of the properties of the focal object (user).
Therefore, the <code>$focus</code> prefix can be omitted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;schemaHandling&gt;</span>
    ...
    <span class="tag">&lt;attribute&gt;</span>
        <span class="tag">&lt;ref&gt;</span>sn<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;outbound&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                 <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
        <span class="tag">&lt;/outbound&gt;</span>
    <span class="tag">&lt;/attribute&gt;</span>
    ...
<span class="tag">&lt;/schemaHandling&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Those examples are still very simple.
Mappings can do much more – as you will learn in a while.
However, there is one more thing that we need to explain before going on.
Mappings are designed to work with more than just a single source.
Following diagram illustrates a mapping that takes two arguments: <em>given name</em> and <em>family name</em>.
The mapping produces <em>full name</em> by concatenating these value with a space in between.
This is the kind of mapping that is frequently used to construct user’s full name from its components.
While the mapping may seem simple, there are some sophisticated mechanisms hidden inside.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-09-mapping-multisource.png" alt="Mapping with two sources">
</div>
</div>
<div class="paragraph">
<p>The mapping is represented in the XML form as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mapping&gt;</span>
    <span class="tag">&lt;source&gt;</span>
        <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
    <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;source&gt;</span>
        <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
    <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;expression&gt;</span>
        <span class="tag">&lt;script&gt;</span>
<span class="inline">            <span class="tag">&lt;code&gt;</span>givenName + ' ' + familyName<span class="tag">&lt;/code&gt;</span></span>
        <span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;/expression&gt;</span>
    <span class="tag">&lt;target&gt;</span>
        <span class="tag">&lt;path&gt;</span>fullName<span class="tag">&lt;/path&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two <em>sources</em>, specified by the source definitions: user property <code>givenName</code> and another user property <code>familyName</code>.
The mapping is using <em>script expression</em> to combine the values into a single value, which is used to populate user&#8217;s <code>fullName</code> property.</p>
</div>
<div class="paragraph">
<p>This example also illustrates that the mappings are quite smart.
The mapping may be evaluated only if one of the sources changes, or if a full recompute is requested.
In case that neither <code>givenName</code> not <code>familyName</code> changes, there is no need to re-evaluate that expression.
This is one of the reasons for requiring explicit source definition in the mappings.
Without such definitions it is not (realistically) possible to reliably determine when and how the expression should be re-evaluated.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Obsolete <code>$user</code> and <code>$account</code> variables</div>
Variables <code>$focus</code> and <code>$projection</code> were introduced way back in midPoint 3.0 as a consequence of the generic synchronization feature.
The objects that the expression works with might not be just <em>user</em> or <em>account</em>.
A much broader range of objects may be used.
Therefore, generic concepts of <em>focus</em> and <em>projections</em> were introduced, and the variable names were changed to reflect that.
The old variables <code>$user</code> and <code>$account</code> can still be used, but their use is deprecated.
Despite that, they are still used in some older examples.
It is never easy to completely eliminate historical baggage, is it?
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Mappings are used all over midPoint, in many places and situations.
Sometimes a mapping needs to be really authoritative.
It has to enforce the value to the target.
Yet sometimes, we want to provide a default value, and the mapping should never change the target value once it is set.
Therefore, mapping can be set to various levels of <em>strength</em>: from <em>weak</em> to <em>strong</em>.
Following table describes how that works:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Strength</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>weak</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mapping is applied only if the target has no value.
Weak mappings are used to set <em>default values</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>normal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mapping is applied only if there is a change in source properties.
Normal-strength mappings are used to implement the <em>last change wins</em> strategy.
If the source value was modified in midPoint, then the mapping is applied, and target is modified.
If the target is modified directly, then the mapping does not overwrite the target value – until the next change in midPoint.
This is the default behavior of mappings.
If no strength is specified, then <code>normal</code> strength is assumed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>strong</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mapping is always applied.
Strong mappings <em>enforce</em> particular values.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The strength can be specified in any mapping, by using the <code>strength</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>sn<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;strength&gt;</span>strong<span class="tag">&lt;/strength&gt;</span>
        <span class="tag">&lt;source&gt;</span>
             <span class="tag">&lt;path&gt;</span>$focus/familyName<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When it comes to mapping strength, the following rule of the thumb may be useful:
If you want to enforce policy, use <em>strong</em> mappings.
If you just want to set a default value, use <em>weak</em> mapping.
If you are not sure what you are doing, then <em>normal</em> mappings will probably work just fine.</p>
</div>
</div>
<div class="sect2">
<h3 id="_expressions">Expressions</h3>
<div class="paragraph">
<p><em>Expression</em> is the most flexible part of the mapping.
There is approximately a dozen different types of expressions ranging from the simplest <em>as is</em> expression, through the <em>scripting expressions</em>, all the way to a special purpose expressions that search through midPoint repository.
Expression type is determined by the element that is used inside the <code>expression</code> part of the mapping.
We refer to those elements as <em>expression evaluators</em>.
You can find detailed description of expression evaluators in midPoint documentation.
We are going to deal only with few popular types:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Expression Evaluator</th>
<th class="tableblock halign-left valign-top">Element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">As is</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asIs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copies the value without any transformation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Literal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores literal (constant) value in the target.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a random value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>script</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes a script, stores script output in the target.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The simplest expression evaluator is <code>asIs</code>.
It simply takes the source, and copies the value to the target.
It obviously works only if there is just one source.
It is also the default expression evaluator.
If no expression is specified in the mapping, then <code>asIs</code> is assumed.
It is used like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>sn<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;source&gt;</span>
             <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/source&gt;</span>
        <span class="tag">&lt;expression&gt;</span>
            <span class="tag">&lt;asIs</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/expression&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <code>asIs</code> expression was specified explicitly.
As <code>asIs</code> is the default expression evaluator, we can save some typing and shorten the notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>sn<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;source&gt;</span>
             <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Literal</em> expression evaluator is used to place a constant value in the target.
This expression does not need any source at all.
It always produces the same value.
Following code sets the attribute <code>o</code> to fixed value <code>ExAmPLE, Inc.</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>o<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;expression&gt;</span>
            <span class="tag">&lt;value&gt;</span>ExAmPLE, Inc.<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/expression&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>generate</code> expression evaluator is used to generate a random value.
As such it is used almost exclusively to generate passwords.
We will deal with that expression later when we will be dealing with credentials.</p>
</div>
</div>
<div class="sect2">
<h3 id="_script_expressions">Script Expressions</h3>
<div class="paragraph">
<p>The most interesting expression evaluator is undoubtedly the <code>script</code> expression evaluator.
It allows execution of arbitrary scripting code to transform the value.
Basic principle is simple: values from <em>source</em> properties are stored in the script <em>variables</em>.
Script is executed, and it produces an output.
Return value of the script is stored in the <em>target</em>.</p>
</div>
<div class="paragraph">
<p>We have already seen a mapping that has a scripting expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mapping&gt;</span>
    <span class="tag">&lt;source&gt;</span>
        <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
    <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;source&gt;</span>
        <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
    <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;expression&gt;</span>
        <span class="tag">&lt;script&gt;</span>
<span class="inline">            <span class="tag">&lt;code&gt;</span>givenName + ' ' + familyName<span class="tag">&lt;/code&gt;</span></span>
        <span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;/expression&gt;</span>
    <span class="tag">&lt;target&gt;</span>
        <span class="tag">&lt;path&gt;</span>fullName<span class="tag">&lt;/path&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two sources: <code>givenName</code> and <code>familyName</code>.
The values of these user properties are placed in variables used by the script.
The variables have the same names as the sources: <code>givenName</code> and <code>familyName</code>.
Then the script may do whatever it needs to do.
It may use input variables, or it may use any other data available in the platform.
At the end, the script has to return a value.
The script above is written in <em>Groovy</em>, therefore the return value is the value of the last evaluated expression.
In this case it is the only expression in the script, which concatenates the two variables with a space in between.
Script return value is placed in the <em>target</em>, which in this case is <code>fullName</code> user property.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Groovy</div>
<em>Groovy</em> is a scripting language similar to Java programming language.
That is also the reason Groovy is a default scripting language in midPoint.
As midPoint is written in Java, Groovy was an obvious choice.
Groovy interpreter is readily available in Java ecosystem, it has familiar syntax (at least for midPoint developers) and all of midPoint functionality could be re-used in scripts.
Since the early times of midPoint, support for more scripting languages was added, most notably JavaScript and Python.
However, midPoint community seems to like Groovy, therefore it still remains the most popular choice.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Scripts are often used to transform the values before they are stored in account attributes.
One very common case is construction of LDAP distinguished name (DN).
The DN is a complex value in the form of <code>uid=foobar,ou=people,dc=example,dc=com</code>.
However, it is easy to construct such value using a simple script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>dn<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;source&gt;</span>
             <span class="tag">&lt;path&gt;</span>name<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/source&gt;</span>
        <span class="tag">&lt;expression&gt;</span>
            <span class="tag">&lt;script&gt;</span>
<span class="inline">                <span class="tag">&lt;code&gt;</span>
                    'uid=' + name + ',ou=people,dc=example,dc=com'
                <span class="tag">&lt;/code&gt;</span></span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/expression&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A clever reader surely has a disapproving look on his face now.
Of course, this is not entirely correct way to compose LDAP DN.
Please bear with us.
We will correct that later.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Midpoint supports three scripting languages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Groovy:</strong> This is the default scripting language.</p>
</li>
<li>
<p><strong>JavaScript</strong> (ECMAscript)</p>
</li>
<li>
<p><strong>Python</strong> (must be explicitly installed)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All three languages can be arbitrarily mixed even in a single midPoint deployment - although, quite understandably, such a practice is not recommended.
The language can be selected for each individual expression by using language URI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;expression&gt;</span>
    <span class="tag">&lt;script&gt;</span>
<span class="inline">        <span class="tag">&lt;language&gt;</span>http://midpoint.evolveum.com/xml/ns/public/expression/language#python<span class="tag">&lt;/language&gt;</span>
        <span class="tag">&lt;code&gt;</span>
            &quot;Python is %s, name is %s&quot; % (&quot;king&quot;, name)
        <span class="tag">&lt;/code&gt;</span></span>
    <span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/expression&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Escaping</div>
When writing scripting expression, please keep in mind that some characters must be properly escaped in the text format that you are using (XML, JSON or YAML).
E.g. the ampersand character (<code>&amp;</code>) so frequently used for logical operations needs to be escaped as <code>&amp;amp;</code> in XML.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Scripting expressions can do almost anything.
There is still more to them that meets the eye.
This section provides only the very basic description to get you started.
Will get back to the scripting expressions many times in this book.</p>
</div>
</div>
<div class="sect2">
<h3 id="_activation">Activation</h3>
<div class="paragraph">
<p>In midPoint, the term <em>activation</em> is used to denote a set of properties that describe whether an object is <em>active</em>.
This includes properties that describe whether the user is enabled or disabled, since when he should be enabled, to what date he should be active, and so on.
The simple binary enabled/disabled flag might have been sufficient in the 1990s.
That was a long time ago.
We need much more than that.
Therefore, midPoint <em>activation</em> is quite a rich data structure.
We are going to describe just the basic idea now, the details will follow later.</p>
</div>
<div class="paragraph">
<p>The most important activation concept is <em>administrative status</em>.
Administrative status defines "administrative state" of the object (user), i.e. the <em>explicit decision</em> of an administrator whether the user is enabled or disabled.
Except for administrative status, there are also <em>validity times</em>, <em>lockout status</em>, various timestamps and metadata.
We will get to that later.</p>
</div>
<div class="paragraph">
<p>The important thing to realize is that both <em>user</em> and the <em>accounts</em> have activation properties - and they are almost the same.
The <em>user</em> and <em>account</em> activation are using the same property names, meaning and data formats.
This is important, because you would probably want <em>account activation</em> to follow <em>user activation</em>.
E.g. if user is disabled, then also all his accounts should be disabled.
This is very easy to do in midPoint, because the <em>user</em> and <em>account</em> activation are compatible.
Therefore, all it takes is a very simple mapping.
There is a special place in the resource <em>schema handling</em> section for that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b4101662-7902-11e6-9f14-53e18426fe81</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>My LDAP Server<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>inetOrgPerson<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
            <span class="comment">&lt;!-- attribute handling comes here --&gt;</span>
            <span class="tag">&lt;activation&gt;</span>
                <span class="tag">&lt;administrativeStatus&gt;</span>
                    <span class="tag">&lt;outbound</span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/administrativeStatus&gt;</span>
            <span class="tag">&lt;/activation&gt;</span>
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is as simple as that.
Just an empty mapping represented by empty <code>outbount</code> element.
User has <code>administrativeStatus</code> property, account has <code>administrativeStatus</code> property, therefore midPoint knows what is the <em>source</em> and <em>target</em> of the mapping.
We do not need to specify these.
The values of the <code>administrativeStatus</code> property has the same type and meaning on both sides.
Therefore, the default <code>asIs</code> mapping is just fine.
We do not need to specify that either.
All that midPoint needs to know is that the mapping <em>exists</em> at all - that we want to pass the value from user to account.
That is a reason for having <code>outbound</code> element there, even an empty one.
MidPoint will fill in all the details.</p>
</div>
<div class="paragraph">
<p>When this mapping is in place and the user gets disabled, the account will be disabled as well.
When the user gets enabled, the account will follow suit.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Lifecycle state</div>
<em>Activation</em> is a common concept.
Accounts could be <em>enabled</em> or <em>disabled</em> since time immemorial.
However, in the 21<sup>st</sup> century, simple enabled/disabled binary state somehow lacks in expressive power.
There is much more that we would like to say about the <em>user</em>, not just that it is active or inactive.
User may not be fully active yet (e.g. before his first day at work), user may be temporarily inactive (e.g. maternal leave or sabbatical), user may be retired, and so on.
Therefore, midPoint objects support a concept of <em>lifecycle</em>, which is composed of several states, with controlled transitions between them.
However, unlike <em>users</em>, <em>accounts</em> seldom support anything more complex than enabled/disabled binary state.
That is the reason we are ignoring <em>lifecycle</em> for a moment, and we are focusing on <em>activation</em> instead.
Yet, <em>lifecycle</em> and <em>activation</em> are related, as we will see later.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_credentials">Credentials</h3>
<div class="paragraph">
<p>Credential management is important part of identity management.
There are many systems in an organization, almost all of them require a password.
Users set up a password, then they forget the password, then they request password reset, setting a new password, which they forget as well.
The endless cycle continues.
While there is probably no magic formula to completely solve this problem (perhaps except for removing passwords altogether), the situation can be made less painful.</p>
</div>
<div class="paragraph">
<p>The usual method is to <em>synchronize</em> the passwords among all the systems in one organization.
This does not make the problem go away.
However, it reduces many set-forget-reset-forget cycles to just one.
Moreover, as users are using that one password quite often, they are less likely to forget it.
Of course, having the same password on many systems is not exactly the best security practice.
However, security is all about trade-offs.
Having the same password set for all systems <em>in one organization</em> is an acceptable risk in vast majority of cases.</p>
</div>
<div class="paragraph">
<p>MidPoint is designed to easily synchronize credentials to many accounts.
Similarly to <em>activation</em>, <em>credential</em> data structures of <em>user</em> and <em>account</em> are aligned.
Therefore, all that is needed to synchronize password to an account is a simple empty mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b4101662-7902-11e6-9f14-53e18426fe81</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>My LDAP Server<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>inetOrgPerson<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
            <span class="comment">&lt;!-- attribute handling comes here --&gt;</span>
            <span class="tag">&lt;credentials&gt;</span>
                <span class="tag">&lt;password&gt;</span>
                    <span class="tag">&lt;outbound</span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/password&gt;</span>
            <span class="tag">&lt;/credentials&gt;</span>
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user password in midPoint is changed, the changed password will be propagated to all the resources that have a mapping like this.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">MidPoint sample collection</div>
Now it is perhaps a good time for you to have a look at some sample resource definitions, to get a feel how a real-world resource definition looks like.
The samples are located in the midPoint distribution package, or you can find them on-line.
See <a href="#92-additional-information">Additional Information</a> chapter for more details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_complete_provisioning_example">Complete Provisioning Example</h3>
<div class="paragraph">
<p>This section describes a complete working example of connection to the LDAP directory.
The configuration below is used to automatically create accounts in OpenLDAP server.
Entire configuration is contained in a single resource definition file.
Following paragraphs explain individual parts of the file.
Simplified XML notation is used for clarity.
Complete file in a form directly usable in midPoint can be found at the same place as all the other samples in this book
(see <a href="#92-additional-information">Additional Information</a> chapter for details).</p>
</div>
<div class="paragraph">
<p>Resource definition begins with object type, OID, name and description.
These are self-explanatory:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;name&gt;</span>LDAP<span class="tag">&lt;/name&gt;</span>

    <span class="tag">&lt;description&gt;</span>
        LDAP resource using a ConnId LDAP connector. It contains configuration
        for use with OpenLDAP servers.
        This is a sample used in the &quot;Practical Identity Management with MidPoint&quot;
        book, chapter 4.
    <span class="tag">&lt;/description&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Connector reference comes next.
We want to point to the LDAP connector.
Here we use dynamic reference that is using search filter to locate the connector:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    ...
    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectorType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;filter&gt;</span>
            <span class="tag">&lt;q:text&gt;</span>connectorType = &quot;com.evolveum.polygon.connector.ldap.LdapConnector&quot;<span class="tag">&lt;/q:text&gt;</span>
        <span class="tag">&lt;/filter&gt;</span>
    <span class="tag">&lt;/connectorRef&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reference is resolved when this object is imported to midPoint.
The resolution process takes the search filter, and it looks for connector object with the <code>connectorType</code> specified in the filter.</p>
</div>
<div class="paragraph">
<p>Connector configuration goes next.
This block specifies connector configuration properties such as hostname, port, passwords and so on.</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;connectorConfiguration&gt;</span>
        <span class="tag">&lt;icfc:configurationProperties&gt;</span>
            <span class="tag">&lt;icfcldap:port&gt;</span>389<span class="tag">&lt;/icfcldap:port&gt;</span>
            <span class="tag">&lt;icfcldap:host&gt;</span>localhost<span class="tag">&lt;/icfcldap:host&gt;</span>
            <span class="tag">&lt;icfcldap:baseContext&gt;</span>dc=example,dc=com<span class="tag">&lt;/icfcldap:baseContext&gt;</span>
            <span class="tag">&lt;icfcldap:bindDn&gt;</span>cn=idm,ou=Administrators,dc=example,dc=com<span class="tag">&lt;/icfcldap:bindDn&gt;</span>
            <span class="tag">&lt;icfcldap:bindPassword&gt;</span><span class="tag">&lt;t:clearValue&gt;</span>secret<span class="tag">&lt;/t:clearValue&gt;</span><span class="tag">&lt;/icfcldap:bindPassword&gt;</span>
            <span class="tag">&lt;icfcldap:passwordHashAlgorithm&gt;</span>SSHA<span class="tag">&lt;/icfcldap:passwordHashAlgorithm&gt;</span>
            <span class="tag">&lt;icfcldap:vlvSortAttribute&gt;</span>uid,cn,ou,dc<span class="tag">&lt;/icfcldap:vlvSortAttribute&gt;</span>
            <span class="tag">&lt;icfcldap:vlvSortOrderingRule&gt;</span>2.5.13.3<span class="tag">&lt;/icfcldap:vlvSortOrderingRule&gt;</span>
            <span class="tag">&lt;icfcldap:operationalAttributes&gt;</span>memberOf<span class="tag">&lt;/icfcldap:operationalAttributes&gt;</span>
            <span class="tag">&lt;icfcldap:operationalAttributes&gt;</span>createTimestamp<span class="tag">&lt;/icfcldap:operationalAttributes&gt;</span>
        <span class="tag">&lt;/icfc:configurationProperties&gt;</span>
    <span class="tag">&lt;/connectorConfiguration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These parts alone should already define a minimal resource.
If you define just the name, connector reference and connector configuration you should be able to import the resource to midPoint.
The connection test should pass.
However, there is absolutely no IDM logic or automation yet.
That is what we are going to add next.</p>
</div>
<div class="paragraph">
<p>Connector configuration is usually followed by <code>schema</code> element.
However, if you look at almost any file that contains resource definition, you will find no such element.
The <code>schema</code> element is automatically generated by midPoint when midPoint connects to the resource for the first time.
Therefore, there is no need to include <code>schema</code> element in the definition.</p>
</div>
<div class="paragraph">
<p>What we have to include in the definition is the configuration that tells midPoint how to <em>handle</em> the schema.
This is defined in <code>schemaHandling</code> section.
Our <code>schemaHandling</code> section contains just one <code>objectType</code> definition.
We are going to define how to handle ordinary user accounts on our OpenLDAP server.</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>Normal Account<span class="tag">&lt;/displayName&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>inetOrgPerson<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the place where we define the <em>kind</em> of objects that we are going to handle.
In this case it is <code>account</code>.
This object is <em>default</em> account.
Which means that it will be used in case that the account type is not explicitly specified.
There is also specification of a display name.
Display name is not used in automation logic.
It is used by the user interface when referring to this definition.
Finally, there is specification of the <em>object class</em>.
The <code>inetOrgPerson</code> object class will be used to create new accounts.
The object class specification determines what attributes the account have.</p>
</div>
<div class="paragraph">
<p>The <code>objectType</code> definition also includes a specification of attribute handling.
There is one section for each attribute that we want to handle in automated or special way.
It starts with the most important attribute: LDAP distinguished name (DN):</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>dn<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Distinguished Name<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;limitations&gt;</span>
                    <span class="tag">&lt;minOccurs&gt;</span>0<span class="tag">&lt;/minOccurs&gt;</span>
                <span class="tag">&lt;/limitations&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    <span class="tag">&lt;source&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/name<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/source&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;script&gt;</span>
<span class="inline">                            <span class="tag">&lt;code&gt;</span>
                                basic.composeDnWithSuffix('uid', name, 'ou=people,dc=example,dc=com')
                            <span class="tag">&lt;/code&gt;</span></span>
                        <span class="tag">&lt;/script&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                <span class="tag">&lt;/outbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ref</code> element specifies name of the attribute that we are going to work with.
In fact, this is a reference to automatically-generated <code>schema</code> part of resource definition.
Definition of display name follows.
Display name is used by the user interface as a label for the user interface elements (fields) that work with this attribute.
This definition sets a nice "Distinguished Name" label instead of cryptic "dn" which would be used by default.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s skip the limitation definition now.
We will come back to that later.</p>
</div>
<div class="paragraph">
<p>The <em>outbound mapping</em> definition follows.
This is where the automation logic is specified.
This is the place where the DN value is computed.
The <code>name</code> property of the user object is the <em>source</em> for this mapping.
The <code>name</code> property usually contains username (login name).
Its value is used by scripting expression in the mapping.
The expression is supposed to create a DN in the form:</p>
</div>
<div class="paragraph">
<p><code>uid=<em>username</em>,ou=people,dc=example,dc=com</code></p>
</div>
<div class="paragraph">
<p>This expression is a clever one.
It does not do the work all by itself.
It invokes a <em>library function</em> to compose the DN.
It may look like a good idea to use simple string concatenation to construct a DN.
However, that fails in case that the DN components contain certain characters that need to be escaped in the final DN.
The <code>composeDnWithSuffix</code> library function takes care of that, and it creates a proper DN.</p>
</div>
<div class="paragraph">
<p>The <em>outbound mapping</em> is evaluated whenever we need to construct a DN.
This obviously happens when a new object is created.
However, the same mapping is used when a user is renamed (i.e. his username changes).
This is the reason that the mapping needs specification of <em>source</em>.
Rename is often quite tricky and complicated operation.
It may not be cheap, and in some cases it may not be entirely reversible.
We definitely do not want to trigger DN changes unless they are really needed.
The specification of the mapping source tells us <em>when</em> the DN change is needed.
In this case, it tells us to change the DN if the <code>name</code> property of the user object changes.</p>
</div>
<div class="paragraph">
<p>Now it is the right time to go back to the <code>limitations</code> section.
The <code>dn</code> attribute is defines as <em>mandatory</em> attribute by the schema.
Strictly speaking, that definition is perfectly correct: LDAP object cannot be created without a DN.
As midPoint is using schema for everything, when midPoint displays a form to edit this LDAP account, it will require that DN has a value, because it is a mandatory attribute.
However, normally we do not want users to enter the DN in the user interface forms.
We want to compute DN automatically - which is exactly the point of the <em>outbound mapping</em> above.
Yet, midPoint does not know when the expression computes a value and when it does not.
The expression is a generic piece of Groovy code, there is no telling what it does until it is executed.
As far as midPoint can see, the expression can produce any value, including empty one.
Therefore, even if there is an expression, midPoint sticks to the schema, and it still requires that DN value is entered by the user.
However, we have written the expression, and we know that it will produce a value for any (reasonable) input.
Therefore, we want to tell midPoint that the DN is no longer mandatory – that the user does not need to enter DN value in user interface forms.
That is exactly what the <code>limitations</code> section does.
This section overrides the automatically generated schema, and it turns the <code>dn</code> attribute from mandatory to optional.</p>
</div>
<div class="paragraph">
<p>Now we have defined the behavior of the <code>dn</code> attribute.
We can use similar approach to define the behavior of other attributes as well.
E.g. the handling of the <code>cn</code> attribute has similar definition:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>cn<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Common Name<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;limitations&gt;</span>
                    <span class="tag">&lt;minOccurs&gt;</span>0<span class="tag">&lt;/minOccurs&gt;</span>
                <span class="tag">&lt;/limitations&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    <span class="tag">&lt;source&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/fullName<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/source&gt;</span>
                <span class="tag">&lt;/outbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case there is <em>outbound mapping</em>, but it has no explicit expression.
Which means that the value is taken from the source without any change ("as is").
Therefore, the attribute <code>cn</code> will have the same value as user property <code>fullName</code>.</p>
</div>
<div class="paragraph">
<p>It is also possible to define an attribute without any mapping:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>entryUUID<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Entry UUID<span class="tag">&lt;/displayName&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that midPoint will not provide any automatic handling for the <code>entryUUID</code> attribute.
This definition is used just to set a user-friendly display name for the attribute.</p>
</div>
<div class="paragraph">
<p><em>Mappings</em> and <em>expressions</em> have almost unlimited flexibility.
E.g. the following definition sets a static value for the <code>description</code> attribute:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>description<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    <span class="tag">&lt;strength&gt;</span>weak<span class="tag">&lt;/strength&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;value&gt;</span>Created by midPoint<span class="tag">&lt;/value&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                <span class="tag">&lt;/outbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This mapping has no source, because the source does not make any sense for literal expressions.
Static values are always the same, regardless of the source.
You can also notice that this mapping is <em>weak</em>.
It is used to set the <code>description</code> attribute only if that attribute does not have any value already.
It does not overwrite existing values.</p>
</div>
<div class="paragraph">
<p>The <code>inetOrgPerson</code> object class has much more attributes than those defined in the <code>schemaHandling</code> section.
Those attributes will be automatically displayed in the user interface.
MidPoint uses the generated resource schema to determine their names and types.
MidPoint displays these attributes, the user can change them and midPoint executes those changes.
However, apart from that, midPoint does not do any special handling on those attributes.
It is all right not to enumerate all the attributes in <code>schemaHandling</code> section.
You only need to define those attributes which you want to handle in a special way.</p>
</div>
<div class="paragraph">
<p>There are two more definitions to describe, before our example is complete.
First definition is the <code>activation</code> definition.
It is very simple:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;activation&gt;</span>
                <span class="tag">&lt;administrativeStatus&gt;</span>
                    <span class="tag">&lt;outbound</span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/administrativeStatus&gt;</span>
            <span class="tag">&lt;/activation&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a definition that specifies handling of the activation <em>administrative status</em>.
This status property specifies whether account is enabled or disabled.
Activation properties are somehow special in midPoint.
MidPoint understands the meaning and the values of activation properties.
MidPoint also expects that user activation and account activation are usually mapped together.
Therefore, it is enough to tell midPoint that you want such mapping.
MidPoint already knows the source (user activation) and the target (account activation).
If the user is disabled then the account will get disabled.
If the user is enabled than the account will get enabled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Clever reader is surely scratching his head now.
There is no LDAP standard that specifies how to enable or disable accounts.
In addition to this, OpenLDAP does not even have a concept of disabled account at all!
Therefore, how can midPoint disable an OpenLDAP account?
To tell the truth, midPoint does not know how to do it.
We have taken a bit of a poetic license here, as we wanted to demonstrate a simple activation mapping.
The configuration will not work just by itself.
OpenLDAP resource does not have this <em>capability</em>.
However, there is a way.
Activation capability can be <em>simulated</em>.
We will deal with that later.
For now let&#8217;s just marvel in the beauty of this very elegant activation mapping that does absolutely nothing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The last thing that we need for the resource to work well is to define a mapping for <em>credentials</em>.
In this case it is a <em>password</em> mapping:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;credentials&gt;</span>
                <span class="tag">&lt;password&gt;</span>
                    <span class="tag">&lt;outbound</span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/password&gt;</span>
            <span class="tag">&lt;/credentials&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly to activation, the credentials are handled in a special way.
MidPoint understands how credentials work, what their values are, and how they are used.
MidPoint also expects that user credentials, such as passwords, are usually mapped to the account credentials.
Therefore, all that midPoint needs to know is that you want to do that mapping.
It can automatically determine the source and target.
The account will have the same password as the user.
User&#8217;s password is used when a new account is created.
When user changes his password, the change is also propagated to the account.</p>
</div>
<div class="paragraph">
<p>That is it.
Now you have your first (almost) working resource.
You can import the definition to midPoint and test it.
Simply assign the resource to a user.
The OpenLDAP account will be created - the DN and all the essential attributes will be automatically computed.
When midPoint creates an account for a user, it remembers who is the owner of that account.
Therefore, it can easily delete the account when needed.
Unassign the resource, and the account will get deleted.
This is how automated provisioning and deprovisioning works.
No hardcore programming is needed, just a declarative specification, and a line or two of very simple scripting.
Such configuration can be done in a couple of minutes.
It is essentially the same process for all the applications, just the connector is different.
The connector has different configuration properties, the attribute names are different - but the principles and the tools are the same.
It is easy to connect many heterogeneous applications in this way.
The connectors and the mappings are hiding the differences.
In the end, all the "resources" look the same to midPoint.
The same principles are used to manage them.
Therefore, the management can be done efficiently, even at a large scale.</p>
</div>
<div class="paragraph">
<p>Yet this configuration is still extremely simple.
We are just scratching the surface of what midPoint can do.
There is much more to see in the next chapters.
However, we still need to explain one more fundamental midPoint concept before getting there.</p>
</div>
</div>
<div class="sect2">
<h3 id="_shadows">Shadows</h3>
<div class="paragraph">
<p>Linking <em>users</em> and <em>accounts</em> is one of the basic principle of any decent identity management system.
However, it is surprisingly difficult to implement such <em>link</em>.
There are numerous methods to reliably identify accounts, and they vary from system to system.
Some systems identify accounts only by <em>username</em> - which makes reliable detection of rename operations quite difficult.
Other systems improve on that by introducing another identifier, an identifier that is <em>persistent</em>.
Identifier value is assigned by the resource, and it never changes.
However, <em>username</em> is still used as secondary identifier, and it still has to be unique.
Yet another system may have <em>compound</em> identifiers that consist of two or more values.
Some system have <em>globally-unique</em> identifiers, while other systems have <em>local</em> identifiers that are only unique in their own object class.
Some systems have <em>hierarchically-structured</em> identifiers, others have <em>flat</em> unstructured identifiers.
Some identifiers are <em>case-sensitive</em> strings, others are <em>case-insensitive</em>, some identifiers follow complex normalization rules, and yet another identifiers are <em>binary</em> and completely opaque.
To make long story short: reliable identification is really complicated.</p>
</div>
<div class="paragraph">
<p>We do not want to pollute <em>user</em> object with all the delicate details of account identification.
Therefore, we have created a separate midPoint object that hides all the resource-related details and identification complexities.
We call it <em>shadow</em>, because it behaves as a shadow of the real account.
When midPoint detects new account, a <em>shadow</em> is automatically created to represent the account in midPoint repository.
When midPoint detects that account has changed (e.g. it was renamed), then midPoint automatically updates the <em>shadow</em>.
When the account is deleted, midPoint deletes the <em>shadow</em>.
Technically, <em>shadow</em> is still an ordinary midPoint object.
Therefore, it has object identifier (OID).
Other objects can simply point to the <em>shadow</em> using ordinary object reference.
That is exactly how user-account links are implemented:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-10-user-shadow-account.png" alt="User-shadow-account">
</div>
</div>
<div class="paragraph">
<p>The <em>shadow</em> objects contain all the data that are needed to reliably identify an <em>account</em> - or any other resource object such as <em>group</em> or <em>organizational unit</em>.
In addition to the account identifiers, <em>shadow</em> points to the corresponding resource definition, to make the identification complete.
Shadows are multi-purpose objects, and they have many uses in midPoint.
Shadows record meta-data about resource objects.
They are used to hold cached values of the attributes (this functionality is still experimental in midPoint 4.8.5).
Shadows can be used to hold the state of the resource objects for which midPoint does not have on-line communication channel and the operations are executed manually (a.k.a. "manual resources").
Therefore, shadows are quite complex objects.
Following picture provides more substantial example of a shadow.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-11-user-shadow-resource.png" alt="User-shadow-resource">
</div>
</div>
<div class="paragraph">
<p>Do not worry if that picture looks a bit scary.
Shadows may be complex, but they are almost always invisible to midPoint users.
Shadows are automatically and transparently maintained by midPoint core engine.
Under normal circumstances, MidPoint does all that is needed to maintain the shadow, and no special configuration is needed for that.
We are describing the mechanics of the shadow objects mostly for the sake of completeness.
There are situations when this knowledge may be useful.
These are usually situations when midPoint was mis-configured, and the shadows were created incorrectly.
In that case you may need to update the shadows, or even purge all shadows and start over.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_2">Conclusion</h3>
<div class="paragraph">
<p>MidPoint is configured as a simple <em>provisioning engine</em> now.
We can use midPoint to create, modify and delete accounts on many diverse systems.
However, we are still at the beginning.
MidPoint is <em>pushing</em> the changes to other systems, but it is not <em>listening</em> for any changes yet.
Similarly to people, systems that talk all the time and never listens do not make good companions.
Therefore, the next task is to make midPoint a better listener, by configuring <em>synchronization</em> mechanisms.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="05-synchronization">5. Synchronization</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
It is a capital mistake to theorize before one has data.
</blockquote>
<div class="attribution">
&#8212; Sherlock Holmes<br>
<cite>The Adventures of Sherlock Holmes by Arthur Conan Doyle</cite>
</div>
</div>
<div class="paragraph">
<p>Data are the lifeblood of any software system.
Ensuring proper management of the data is one of the primary responsibilities of all IT professionals.
However, data management can be very tricky.
One of the important principle of software architecture is often formulated as "do not repeat yourself".
This applies to code, as it applies to data: <em>though shall not repeat the data</em>.
There is one original, authoritative value.
And there should not be any copies of that value.
Ever.
There is just one universal source of truth.
If there are no copies, then the data are always consistent.
No copies mean no contradictions.
Just one truth, precise and crystal-clear.
Keep data in one place, and one place only.</p>
</div>
<div class="paragraph">
<p>That is the theory.</p>
</div>
<div class="paragraph">
<p>However, practice has a different opinion to offer.
There are many incompatible technologies in practical IT systems.
Applications built on relational databases cannot directly use data from directory services.
Even relational databases do not fit together easily.
Each application is designed with a different data model in mind.
Each cloud application has a different interface (API).
There are data translation and bridging technologies that work as adapters to resolve compatibility issues.
You make a query, the query is intercepted by an adaptor, the adaptor translates the query, executes it in a remote database, gets the results, translates them, and provides them to you.
All of that in real time.
Those are elegant solutions.
Yet, there is a cost to pay.
The adapters add latencies, and they almost always have a negative impact on performance.
Even worse, transaction handling and data consistency is very problematic.
Such adapters are additional components on a critical path, and their failures are very painful.
The resulting system is often operationally fragile: failure of even a minor component means a failure of the entire system - not to speak about the enormous complexity and cost of the solution.</p>
</div>
<div class="paragraph">
<p>On the other hand, copying all the data into my application database is so very convenient.
The application can access the data easily, using just one homogeneous mechanism.
Failure of other components are not affecting the critical path.
It is all so much better for performance.
Copying the data solves almost all the troublesome issues.
Except for one small detail: the problem of keeping the data up to date.
That is where the <em>synchronization</em> mechanisms come in.</p>
</div>
<div class="paragraph">
<p>However hard you may try, it is almost impossible to avoid making copies of the data.
Identity data are no exception.
In fact, identity data are often the most heavily affected.
That makes a lot of sense.
Applications are built for <em>users</em> to use them.
Therefore, almost every application keeps some kind of data about <em>users</em>.
In addition to that, such data are usually very sensitive from security and privacy point of view.</p>
</div>
<div class="paragraph">
<p>If we cannot avoid copying the data, the best thing that we can do is to keep the copies <em>managed</em> and <em>synchronized</em>.</p>
</div>
<div class="paragraph">
<p>Some applications have built-in support for LDAP or directory synchronization.
However, those mechanisms are usually quite weak and fragile.
For example, many applications provide capability for on-demand synchronization with directory service on login time.
It usually works like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>User enters username and password to application login dialog.</p>
</li>
<li>
<p>The application connects to the directory service to validate the password.</p>
</li>
<li>
<p>If the password is correct then the application retrieves user data from the directory.</p>
</li>
<li>
<p>The application stores copy of user data locally.</p>
</li>
<li>
<p>Business as usual.
Local copy of the data is used ever since.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>New cloud applications provide similar support for single sign-on (usually OpenID Connect or SAML), which is basically the same:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>No local session exists, therefore user is redirected to identity provider.</p>
</li>
<li>
<p>User enters username and password to login dialog at identity provider site.</p>
</li>
<li>
<p>If the password is correct, then identity provider redirect user back to application, packing user data in the response.</p>
</li>
<li>
<p>The application stores copy of user data locally.</p>
</li>
<li>
<p>Business as usual.
Local copy of the data is used ever since.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This approach works quite well at the beginning.
The data can be updated every time the user logs in - which may or may not be enough.
Yet, after a while, the data begin to stink.
Users are renamed, but the local copies are not updated.
Users are deleted, but the local copies stay around forever.
There are local accounts and privileges that are not reflected back to the directory service or identity provider, and therefore remain undetected for years.
Which means that we have a serious security and data protection problem here.
Even worse, we do not even know that the problem is there.</p>
</div>
<div class="paragraph">
<p>Some applications have more advanced synchronization processes that can do better than this.
However, an application that does synchronization well is still an extremely rare sight.
There is a good reason for this.
Synchronization is much harder than it seems.
There may be data inconsistencies on both sides.
There may be network communication errors and configuration errors.
Data models are evolving over time.
Policies are changing.
It is no easy task to reliably synchronize the data in such environment.
Therefore, there is a special breed of systems that specialize in synchronization of identity data: identity management systems.</p>
</div>
<div class="sect2">
<h3 id="_synchronization_in_midpoint">Synchronization in MidPoint</h3>
<div class="paragraph">
<p>Synchronization is one of the fundamental mechanisms of midPoint.
Synchronization mechanisms are integral part of midPoint design from its very beginning.
Many of the things that midPoint normally does are in fact just different flavors of synchronization.
There are obvious cases such as <em>reconciliation</em> process, synchronizing account attributes with data in midPoint repository.
However, there are also less obvious cases, such as ordinary <em>provisioning</em> operation when midPoint needs to create a new account for a user.
Even that case is in fact a synchronization: midPoint user properties are synchronized with a new empty account on the resource.
Majority of midPoint operations are directly or indirectly using the synchronization principles.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Reuse</div>
Reuse of the mechanisms is one of fundamental principles of midPoint design.
When we have designed midPoint, we have not invented a separate mechanism for every midPoint feature.
We have rather designed few very generic principles that are re-used at many places in midPoint.
Synchronization is one of these principles.
There is one code that implements the core of the synchronization logic.
That code is used whenever we need to "align" objects that relate to each other.
The same code is used for user-account reconciliation, ordinary provisioning, role-based provisioning, live synchronization, opportunistic data consistency &#8230;&#8203; almost everywhere.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>MidPoint synchronization provides a continuous functionality spectrum that can be tweaked and tuned to match specific needs.
Yet, the synchronization mechanisms can be divided to several broad and slightly overlapping categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Live synchronization</strong> is <em>almost real-time</em> synchronization mechanism.
MidPoint continually scans the resource for changes.
When changes are detected they are immediately processed by midPoint.
The actual latencies depend on the capabilities of the resource, but usual numbers range from few seconds to few minutes.
Only <em>recent</em> changes are processed by live synchronization.
It is a very efficient mechanism, which usually has fast responses even in large-scale deployments.
It usually runs all the time.</p>
</li>
<li>
<p><strong>Reconciliation</strong> is a process that compares the data and corrects the differences.
When an account is reconciled, midPoint computes the attribute values that the account <em>should</em> have.
The computed values are compared to the real values that the account <em>has</em>.
Any differences are corrected.
Reconciliation is quite heavy-weight mechanism, comparing all the accounts one-by-one.
It is also a very reliable mechanism.
It can correct mistakes that were missed by live synchronization, it can correct data after major failures, corruptions, and so on.
Reconciliation is usually executed in regular intervals.
However, due to its heavyweight nature, it is usually executed during off-peak times (nights and weekends).</p>
</li>
<li>
<p><strong>Import</strong> is usually a one-time process to get data from the resource to midPoint.
Import is used to populate midPoint with initial data, or it may be used to connect a new resource to midPoint.
Import is almost the same as reconciliation, with only a few minor differences.
However, the purpose of import and reconciliations are different, and therefore there may be a slightly different configuration of import policies (mappings).
Import is usually not scheduled, it is manually triggered when needed.</p>
</li>
<li>
<p><strong>Opportunistic synchronization</strong> is a very special kind of animal which is quite unique to midPoint.
Opportunistic synchronization is triggered automatically when midPoint discovers that something is not in order.
For example, if midPoint tries to modify an account, but it discovers that the account is not there.
Synchronization mechanism is triggered at that point, just for that single account.
This usually means that the account is re-created.
The opportunistic synchronization is also triggered when midPoint tries to create a new account, but the account is already there.
This approach makes midPoint a <em>self-healing</em> system.
If midPoint runs into a problem, it can often correct the problem just by itself.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Individual mechanisms differ in a way data inconsistency is <em>discovered</em>: live synchronization actively looks for new changes, reconciliation compares the data one-by-one and opportunistic synchronization discovers inconsistency by chance.
Yet, all the mechanisms <em>react</em> to inconsistency in the same way.
There is only one policy that specifies how to fix the data.
Of course, there may be slight deviations in the behavior.
For example, we usually want <em>import</em> to behave in slightly different way than <em>reconciliation</em>.
MidPoint allows that.
Yet, there is just one common synchronization mechanism.
This has a very good reason.
It does not really matter how the problem was discovered.
What really matters is that the problem gets fixed.
We do not want to maintain four separate configurations for every delicate variation of the functionality.
Having one policy is much better.
MidPoint knows which part of the configuration need to be applied in each specific situation, and it does it automatically.
This unifying approach significantly simplifies the configuration of midPoint synchronization mechanisms.
That is also a reason why the boundaries of individual synchronization mechanisms are quite fuzzy.
In fact, it is just one big mechanism with several facets.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_systems_target_systems_and_other_creatures">Source Systems, Target Systems And Other Creatures</h3>
<div class="paragraph">
<p>The tale of idealistic identity management deployment starts with a human resources (HR) system.
The HR system is supposed to have records for all the identities, therefore it is <em>authoritative source</em> system.
Identity management system pulls in all the data from HR database, recomputes them and creates accounts on <em>target systems</em>.
And they lived happily ever after.</p>
</div>
<div class="paragraph">
<p>Now, let’s get back to reality.
The HR database is indeed an authoritative source of data in many real-world cases.
However, it is a <em>limited</em> source.
It contains data about employees only, and it has only partial information about them.
For example, there is no <em>username</em> in the HR record.
<em>Username</em> has to be generated by IDM logic.
There is no initial password.
Organizational structure assignment is often incomplete or unreliable.
Therefore, HR database is only a <em>partially-authoritative source</em>.
There may be additional authoritative sources for contractors, partners, suppliers, support engineers and other identities that need to access our systems.
These are <em>additional source systems</em>.
Then there is a directory system, which is often Microsoft Active Directory.
It should be a <em>target resource</em>, in theory.
Yet, there may be pieces of authoritative information in here.
For example, an algorithm to generate a <em>username</em> may be based on the usernames that are already used in the Active Directory.
The data in Active Directory may also be needed to create a unique e-mail address.
Directory systems are also used as a semi-authoritative sources for telephone numbers, office numbers and similar identity attributes.
Therefore, such systems are both <em>target</em> and <em>source</em> systems.
Then there are "pure" target systems.
These are not supposed to be authoritative in any way.
Identity management system will only write to such systems.
Or &#8230;&#8203; will it?
What happens when a conflicting account already exists on such system, and therefore we cannot create a new account for a new employee?
How do we check if there are no accounts that are not supposed to be there?
It turns out that even the "pure" target systems contain valuable sources of information after all.</p>
</div>
<div class="paragraph">
<p>The reality brings a wild mix of source, target, semi-source, target/source and quasi-target systems that are almost impossible to put into a pre-defined boxes.
Therefore, midPoint does not bother to define a concept of "source" or "target" resource.
Any resource can be both source and target, and the authoritativeness of each attribute can be controlled on a very fine level.
Almost every real-world situation can easily fit into this model.</p>
</div>
<div class="paragraph">
<p>We are still using the terms <em>source system</em> and <em>target system</em>.
However, these terms refer to the business purpose of such systems in the identity management architecture.
The terms describe how we <em>think</em> about the systems, what is the <em>usual</em> direction of data flow.
However, midPoint will read data from target system when needed, and it will be happy to write data to source systems if necessary.</p>
</div>
</div>
<div class="sect2">
<h3 id="_inbound_and_outbound_mappings">Inbound and Outbound Mappings</h3>
<div class="paragraph">
<p>MidPoint is firmly based on the principle of reuse.
Previous chapter explained that behavior of attributes during provisioning is controlled by <em>mappings</em>.
Therefore, it is perhaps no big surprise that the behavior of attributes during synchronization is also controlled by mappings.
In fact, provisioning is just a special case of synchronization.
Following picture explains the combined mechanism.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-01-sync-source-target.png" alt="Synchronization">
</div>
</div>
<div class="paragraph">
<p>There are two types of mappings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Inbound mappings</strong> map data flowing <em>into</em> midPoint.
These mappings take the data from the source resources, transform them and apply the result to the user object.</p>
</li>
<li>
<p><strong>Outbound mappings</strong> map data flowing <em>out of</em> midPoint.
These mappings take user properties, transform them and apply the result to account attributes in target systems.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mappings themselves are almost the same regardless whether they are inbound or outbound.
They have sources, targets, expressions, conditions, etc.
Just the sources and targets are reversed:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Inbound mapping</th>
<th class="tableblock halign-left valign-top">Outbound mapping</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Direction</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource → midPoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">midPoint → resource</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Mapping source</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource object (e.g. account)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">focal object (e.g. user)</p></td>
</tr>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock">Mapping target</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">focal object (e.g. user)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource object (e.g. account)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>That is it.
Think about the mappings that were used in previous chapter, just flip the direction.
Now the mapping will take data from the account and the results will be applied to user object.
Like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>lastname<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;inbound&gt;</span>
        <span class="tag">&lt;target&gt;</span>
            <span class="tag">&lt;path&gt;</span>$focus/familyName<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/target&gt;</span>
    <span class="tag">&lt;/inbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This mapping takes the value of <code>lastname</code> attribute from the resource and stores the value in <code>familyName</code> property of midPoint user.</p>
</div>
<div class="paragraph">
<p>The rest is the same as outbound mappings.
All the expressions and evaluators can be used for inbound mappings in the same way as for outbound mappings.
For example, a Groovy expression can be used to sanitize the value before it is stored in midPoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>lastname<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;inbound&gt;</span>
        <span class="tag">&lt;expression&gt;</span>
            <span class="tag">&lt;script&gt;</span>
<span class="inline">                <span class="tag">&lt;code&gt;</span>lastname?.trim()<span class="tag">&lt;/code&gt;</span></span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;target&gt;</span>
            <span class="tag">&lt;path&gt;</span>$focus/familyName<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/target&gt;</span>
    <span class="tag">&lt;/inbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The same approach can also be taken for activation, and even for password mappings.
However, there is one difference for password mappings.
Password is usually <em>write-only</em> value.
When the password is written, it is usually hashed, and the original value cannot be retrieved any longer.
Then there are resources such as HR systems that do not store employee passwords at all, because those are not really accounts that we are reading.
Those are just regular database entries that the connector presents as accounts.
Inbound password synchronization is almost never easy, and it often requires a lot of planning and ingenuity.
However, there is one method that is used quite often.
The initial user passwords are usually randomly generated.
As this is a very common case, midPoint can do this easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;credentials&gt;</span>
    <span class="tag">&lt;password&gt;</span>
        <span class="tag">&lt;inbound&gt;</span>
            <span class="tag">&lt;strength&gt;</span>weak<span class="tag">&lt;/strength&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;generate</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;/inbound&gt;</span>
    <span class="tag">&lt;/password&gt;</span>
<span class="tag">&lt;/credentials&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This mapping generates random password for a user.
Both the mapping and <code>generate</code> expression evaluators are quite smart.
The mapping knows that the target is user password, without any need to explicitly specify that.
In addition to that, <code>generate</code> expression evaluator will take password policy into consideration.
It does not make sense to generate any random password.
If we do not consider password policy, then we can generate password that is too short, too long, too weak or too strong to be useful in any way.
Therefore, <code>generate</code> expression looks for password policy, and generates a random password that just matches requirements for password length and complexity.</p>
</div>
<div class="paragraph">
<p>There are more important details to see here.
The inbound password mapping is <em>weak</em>.
There is good reason for this.
We do not want existing midPoint password to be replaced by randomly generated password.
We only want to set a random password in case that it is an <em>initial</em> password, the first password ever.
That is exactly what a <em>weak</em> mapping does: it sets new value only if the target does not have any existing value.
Therefore, this mapping will not overwrite passwords that are already set.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is no direct account-account synchronization in midPoint.
As explained before, midPoint follows a star topology (a.k.a. "hub and spoke").
Therefore, the synchronization is either from account to user (inbound) or from user to account (outbound).
The effect of account-account synchronization is achieved by combining inbound and outbound synchronization mechanisms.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_correlation">Correlation</h3>
<div class="paragraph">
<p>It is quite easy to import all HR records into an empty midPoint: we have to set up inbound mappings, start import task, wait a bit, and all is done.
However, practical situations are much more complex.
Synchronization usually does not run on a green field.
Live synchronization and reconciliation are supposed to work with pre-existing midPoint users.
Import may not be entirely trivial either, for example we may import data from an additional data source into a running midPoint deployment.
Some users in the import data set are new, but there may be accounts describing existing users.
We need to tell the difference between brand-new account and an account that belongs to an existing user.
We need to handle them in a different way.
Of course, midPoint has a solution for this: <em>correlation</em> mechanism.</p>
</div>
<div class="paragraph">
<p><em>Correlation</em> is a method to connect newly-discovered <em>accounts</em> and existing <em>users</em>.
Whenever midPoint discovers new <em>account</em> it will try to link that account to an existing <em>user</em>.
MidPoint looks for an appropriate <em>user</em> to represent newly-discovered <em>account</em>.
It does so by <em>matching</em> selected <em>account</em> attributes to appropriate user <em>properties</em>.
Two things are needed for this to work: <em>correlation rule</em> and corresponding <em>inbound mapping</em>.</p>
</div>
<div class="paragraph">
<p><em>Correlation rule</em>, better known as <em>correlator</em>, specifies which properties are used for correlation, and how they are used.
In its simplest form, the correlator points to a single user property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;correlation&gt;</span>
    <span class="tag">&lt;correlators&gt;</span>
        <span class="tag">&lt;items&gt;</span>
            <span class="tag">&lt;item&gt;</span>
                <span class="tag">&lt;ref&gt;</span>personalNumber<span class="tag">&lt;/ref&gt;</span>
            <span class="tag">&lt;/item&gt;</span>
        <span class="tag">&lt;/items&gt;</span>
    <span class="tag">&lt;/correlators&gt;</span>
<span class="tag">&lt;/correlation&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Correlator</em>, as shown above, specifies that the <code>personalNumber</code> property should be used to correlate <em>accounts</em> and <em>users</em>.
If a newly-discovered account has a value that matches the <code>personalNumber</code> of a user, it is assumed that such user is an <em>owner</em> of the account.
Such account and user are <em>correlated</em>, and they will be <em>linked</em>.</p>
</div>
<div class="paragraph">
<p>Now we know that <code>personalNumber</code> property of midPoint users should be used for correlation.
However, which account attribute should we use to match values of <code>personalNumber</code> property?
That is where the <em>mapping</em> comes in.
MidPoint looks for <em>inbound mapping</em> that maps a value of an attribute to <code>personalNumber</code> property, such as this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>empno<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;inbound&gt;</span>
        <span class="tag">&lt;target&gt;</span>
            <span class="tag">&lt;path&gt;</span>$focus/personalNumber<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/target&gt;</span>
    <span class="tag">&lt;/inbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>MidPoint knows that it needs to take value of account attribute <code>empno</code> to produce value for user property <code>personalNumber</code>.
This is what midPoint normally does when it synchronizes account data to user data.
The same mapping is used for correlation.
MidPoint takes the value of <code>empno</code> attribute, passes it through the mapping, and compares the result with the <code>personalNumber</code> property of all users.
The user that has a matching value is correlated to the account.</p>
</div>
<div class="paragraph">
<p>The <em>correlator</em> and the <em>mapping</em> always work together.
Mapping transforms the value, correlator matches the value.</p>
</div>
<div class="paragraph">
<p>We have seen only very simple correlator so far.
However, correlator can be quite complex.
Correlation may be set up to match several items, correlation may be based on custom search filter or expression, and several rules may be used in composition, using specified weights to tune the process.
Correlation can use approximate (fuzzy) matching with human assistance, submitting probable matches for approval by administrator.</p>
</div>
<div class="paragraph">
<p>Even though correlation mechanism is very rich, the humble item-based correlator remains the most popular one.
Therefore, there is simplified method to configure it.
Definition of correlation item can be placed directly in account attribute definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>empno<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;correlator</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;inbound&gt;</span>
        <span class="tag">&lt;target&gt;</span>
            <span class="tag">&lt;path&gt;</span>$focus/personalNumber<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/target&gt;</span>
    <span class="tag">&lt;/inbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>correlator</code> clause in the mapping marks the <code>empno</code> attribute for correlation.
It will be matched with the mapping target, which is <code>personalNumber</code> user property.
This notation is all that is needed to set up simple correlation scheme.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Correlation in samples</div>
The simple method of <code>correlator</code> definition is not used in the samples.
Not yet.
We do not have our ExAmPLE configuration done yet, therefore we had to make few compromises.
One of the compromises is username, we do have proper configuration for that yet.
We are abusing employee number to stand in for real username.
That means we need <em>two</em> inbound mappings for <code>empno</code> attribute.
If we marked <code>empno</code> attribute for correlation, midPoint does not know which of the two target properties is the right one for matching.
Therefore, we need to go the long way around in the samples, and specify the correlator using the full notation.
At least for now.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We have dealt with correlation for <em>source</em> resources so far, such as the HR systems in our ExAmPLE scenario.
However, there is a slightly surprising fact, that correlation is usually not necessary for source systems with a single authoritative source.
In such cases, the users are created from the accounts originating in the source systems.
The users are automatically linked to the originating accounts at the moment of creation, no correlation is necessary there.
The correlation is necessary in case that there is another source of data which overlaps with the primary source, such as second source system or manual entry of user data using user interface.
Even though correlation mechanism may not be necessary in some cases, it is a best practice to set it up for production deployments.
Having it set up from the beginning lowers the probability that it will be missing when new data source is added, or in case that system administrator manually creates user during HR system outage.
It makes the deployment more resilient.</p>
</div>
<div class="paragraph">
<p>Apart from <em>source</em> resources, correlation is absolutely essential for handling <em>target</em> resources.
It is a very rare occasion to connect an empty target system to midPoint.
Almost all the target systems that are connected to midPoint contain existing data, existing accounts that belong to users in midPoint.
When such target system is connected to midPoint, we have to <em>correlate</em> the account to midPoint users to correctly set up the links.
The correlation mechanism is the same, regardless whether it is used for source or target systems - except for one little difference.
While we would have a suitable <em>inbound</em> mapping for source systems, we may not have that for target system.
Target systems often use <em>outbound</em> mappings only.
Therefore, we need to add the missing <em>inbound</em> mapping to be used to correlate target systems:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>employeeNumber<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;correlator</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;strength&gt;</span>strong<span class="tag">&lt;/strength&gt;</span>
        <span class="tag">&lt;source&gt;</span>
            <span class="tag">&lt;path&gt;</span>$focus/personalNumber<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span>
    <span class="tag">&lt;inbound&gt;</span>
        <span class="tag">&lt;target&gt;</span>
            <span class="tag">&lt;path&gt;</span>$focus/personalNumber<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/target&gt;</span>
        <span class="tag">&lt;evaluationPhases&gt;</span>
            <span class="tag">&lt;include&gt;</span>beforeCorrelation<span class="tag">&lt;/include&gt;</span>
            <span class="tag">&lt;exclude&gt;</span>clockwork<span class="tag">&lt;/exclude&gt;</span>
        <span class="tag">&lt;/evaluationPhases&gt;</span>
    <span class="tag">&lt;/inbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, there are two mappings for <code>employeeNumber</code> attribute.
The usual <em>outbound</em> mapping is used for ordinary provisioning, it populates the target attribute <code>employeeNumber</code> with value taken from <code>personalNumber</code> property of midPoint user.
The other <em>inbound</em> mapping is used for correlation.
It takes the <code>employeeNumber</code> account attribute to correlate it with <code>personalNumber</code> user property.
However, we do not want that inbound mapping to be used to copy attribute values, as that could overwrite the authoritative information of <code>personalNumber</code> user property with incorrect data.
Therefore, we are setting up this mapping to be <em>correlation-only</em>, using the <code>evaluationPhases</code> clause.
The clause specifies that the mapping should be used to provide data for correlation (including <code>beforeCorrelation</code> phase), however it should not be used for ordinary synchronization processing (excluding <code>clockwork</code> phase).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Clever reader certainly looks thoughtful now.
Why do we need both <em>outbound</em> and <em>inbound</em> mapping here?
If we had <em>outbound</em> mapping only, we can clearly see how the <code>employeeNumber</code> attribute and <code>personalNumber</code> property relate to each other.
As there is <code>asIs</code> mapping, it could work both ways, we could reverse it, and use it in <em>inbound</em> direction as well.
Well, in theory, clever reader would be right.
It could be possible.
However, it is not implemented yet.
MidPoint is smart, but not yet <em>that</em> smart.
For the time being, both mappings are necessary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is important to realize, that correlation is always a <em>database search</em>.
We have value of account attribute on one hand, and we have the entire user database on second hand.
We have to find one specific user in the entire database, based on the value of correlation attribute.
Looking for each individual user one-by-one is not a scalable method, we have to utilize database search capabilities to make it efficiently.
Therefore, when choosing a correlation property, make sure it is a searchable (indexed) property.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Correlation before midPoint 4.6</div>
MidPoint versions before 4.6 used <em>correlation expressions</em>, which were basically a search filters parametrized by expressions.
This was simple and elegant mechanisms for many years, but it was also quite limited.
MidPoint 4.6 introduced <em>smart correlation</em> mechanisms, and the old correlation expressions were deprecated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Corrlators are efficient method to automatically link large number of accounts and users.
However, correlators rely on reliable and clean data.
If employee numbers were consistently recorded for every account, correlators can do all the work.
If usernames were applied consistently across all systems, correlators are going to be a great tool.
However, we all know that there is an exception to every rule.
Practical data are not perfect, there are omissions, typos and all kind of errors.
Therefore, in practical scenarios, there are always some accounts that cannot be correlated automatically.
Manual action is necessary to correlate them.
The usual approach is to use <b class="button">Change owner</b> button in account list to manually set up owner for an account.</p>
</div>
</div>
<div class="sect2">
<h3 id="_synchronization_situations_and_reactions">Synchronization Situations and Reactions</h3>
<div class="paragraph">
<p>Correlation mechanism can be used to find an owner for a new account.
That is a part of the solution, but it is not a whole solution yet.
If the owner is found, then the action is quite obvious: link the account to the user and proceed as usual.
However, what to do if the owner is <em>not</em> found?
This resource may be an <em>authoritative</em> resource, and therefore we want to create a new user based on the account.
On the other hand, this may be a reconciliation with a <em>target</em> resource, and we have just found an illegal (orphaned) account.
We probably want to deactivate such account in this case.
Moreover, what to do if more than one owner is found?
There are many scenarios, and the situation can become quite complicated.
Therefore, midPoint has a concept of <em>synchronization situations</em> to make all the possible cases understandable and manageable.</p>
</div>
<div class="paragraph">
<p>Whenever midPoint deals with a change on an account, the <em>situation</em> of that account is determined.
The situation reflects whether this account is already <em>linked</em> to the user, whether we know the candidate <em>owner</em>, whether we cannot determine the owner at all, and so on.
Individual situations are explained in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Situation</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>linked</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The account is properly linked to the owner.
This is the normal situation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unlinked</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The account is not linked to the owner, but we know who the owner should be.
Correlation mechanism told us who the owner is.
MidPoint thinks that the link should exist, but it is not linked yet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unmatched</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The account is not linked, and we do not even know who the owner should be.
The correlation mechanism has not returned any candidates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disputed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The account is not linked, and there are several potential owners.
The correlation expression returned more than one candidate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>collision</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The account is linked to more than one owner.
This should not happen under normal circumstances.
This is usually caused by faulty customizations or software bugs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleted</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">There was an account, but it was deleted on the resource.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>After synchronization <em>situation</em> is determined, midPoint continues by figuring out what a proper <em>reaction</em> is.
The reaction may be quite clear for some situations (e.g. <code>unlinked</code>), but there is a lot of variability for other situations (e.g. <code>unmatched</code> and <code>deleted</code>).
This variability is a reason that midPoint allows to set a reaction for each situation individually.
There are several pre-defined reactions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Action</th>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Usual situations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synchronize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>synchronize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Synchronize all the data, using the mappings.
This does the "normal thing", it applies the usual processing.
No changes in links are made, no users or accounts are created or deleted at this point.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>linked</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add focus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addFocus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New midPoint user will be created, and it will be linked to the account.
This is usually a reaction configured for authoritative resources, used in situation when a new account is discovered.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unmatched</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete focus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteFocus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MidPoint user that owns the account will be deleted.
This is usually a reaction configured for authoritative resources, used in situations when midPoint detects that an account was deleted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleted</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inactivate focus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inactivateFocus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MidPoint user that owns the account will be disabled.
This is also used for authoritative resources.
This is a milder reaction that deleting the user.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleted</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete resource object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteResourceObject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The account will be deleted.
This is the usual reaction when illegal account is detected on non-authoritative resource.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unmatched</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inactivate resource object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inactivateResourceObject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The account will be disabled.
Usually a milder reaction to an illegal account.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unmatched</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If no reaction is explicitly configured for a situation, then midPoint does nothing.
The situation is recorded in midPoint repository, but no other action is taken.
This is part of midPoint philosophy: not to change the data unless an action was explicitly configured.</p>
</div>
<div class="paragraph">
<p>The reactions can be defined in the synchronization section of object type definition in resource configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            ...

            <span class="tag">&lt;synchronization&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>linked<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;synchronize</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>deleted<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;deleteFocus</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>unlinked<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;link</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>unmatched<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;addFocus</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
            <span class="tag">&lt;/synchronization&gt;</span>

        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a typical configuration for an authoritative resource.
Most of the configuration is perhaps self-explanatory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When all is fine (situation: <code>linked</code>) then do the usual thing (action: <code>synchronize</code>).</p>
</li>
<li>
<p>When the existing account is deleted from the resource (situation: <code>deleted</code>), then delete the user as well (action: <code>deleteFocus</code>).</p>
</li>
<li>
<p>When we find an account which should be linked but is not (situation: <code>unlinked</code>), then link it (action: <code>link</code>).</p>
</li>
<li>
<p>When a new account on the resource is found, and it does not have an owner (situation: <code>unmatched</code>), then create a new user (action: <code>addFocus</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Perhaps the only thing that deserves special explanation is the <code>synchronize</code> reaction.
In the <code>linked</code> situation, there is not much to do.
Everything seems to be in order.
However, there may still be attributes that are not set correctly.
We may need to fully apply all the inbound and outbound mappings, to make sure that all the data are correct.
This is what the <code>synchronize</code> reaction does, among many other things.
In fact, we want to do the "synchronize" thing as part of all other reactions too.
MidPoint does that implicitly, there is no need to add <code>synchronize</code> to every other reaction.
However, we need to explicitly add <code>synchronize</code> to the <code>linked</code> situation, as it is the only reaction that there is.
If we leaved the <code>linked</code> situation empty, midPoint does nothing.
Putting <code>synchronize</code> action there tells midPoint do to the usual thing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unlink action</div>
There is a pre-defined <code>unlink</code> action, in addition to other actions specified in the table above.
However, the <code>unlink</code> action is not needed, as midPoint unlinks the account automatically when it is gone.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Synchronization reactions are used to configure resource for a variety of scenarios.
The <code>addFocus</code> reaction is used to configure authoritative resources, other reactions may be used to configure target resources, semi-authoritative resources and so on.
Synchronization reactions provide control on account level, while mappings provide control on attribute level.
Together they can be used to implement variety of synchronization scenarios.</p>
</div>
</div>
<div class="sect2">
<h3 id="_synchronization_flow">Synchronization Flow</h3>
<div class="paragraph">
<p>Correlation and synchronization actions are just two pieces of much bigger synchronization puzzle.
Connector provides account data, correlation looks for an owner, synchronization situations and reaction decide what to do with the account, and so on.
Every mechanism has its place in a comprehensive synchronization flow.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-02-synchronization-flow.png" alt="Synchronization flow">
</div>
</div>
<div class="paragraph">
<p>The figure above illustrates the usual sequence of events during inbound synchronization:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Account is created in the resource database.</p>
</li>
<li>
<p>Appropriate identity connector is used to read account data.</p>
</li>
<li>
<p>Account <em>shadow</em> is created in midPoint.</p>
</li>
<li>
<p>Correlation mechanism is applied to determine account ownership (unless the account is already linked to a user).</p>
</li>
<li>
<p>Synchronization situation is determined based on account ownership and state of the account.</p>
</li>
<li>
<p>Appropriate reaction to the situation is determined based on resource configuration.</p>
</li>
<li>
<p>Inbound mappings are evaluated to map account values to the user.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Description of the synchronization process is slightly simplified for clarity.
There are also obvious deviations from this process.
E.g. some inbound mappings are evaluated before correlation to provide data for correlation, inbound mappings are skipped in case that the user is about to be deleted, the mappings are also skipped if there is no synchronization reaction and so on.
However, generally speaking, the sequence above is what usually happens during inbound synchronization.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the data are reflected to <em>user</em>, the usual midPoint recompute process starts.
This also includes evaluation of object templates, roles, policies and all the other things that will be covered in following chapters.
This is the main part of midPoint processing, internally referred to as "clockwork".
It is essentially the same processing as if user was modified by an administrator using midPoint user interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Synchronization before midPoint 4.6</div>
When was midPoint originally created, synchronization configuration was a completely separate top-level part of resource definition.
It made quite a lot of sense more than a decade ago, when midPoint was much simpler.
However, as midPoint evolved, it became obvious that this is not the best way.
It would make much more sense if the synchronization configuration was coupled with resource object type configuration in schema handling part.
This was finally corrected in midPoint 4.6, which gives us the form of configuration that we have today.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_synchronization_tasks">Synchronization Tasks</h3>
<div class="paragraph">
<p>Now we know how the inbound synchronization works: midPoint reads the account, then correlation is applied, situation determined and reaction executed.
However, we have not yet discussed the details of the very first step: how does midPoint actually gets account data?
Nothing happens without a reason, therefore there must be some active component in midPoint that looks for the new, changed and deleted accounts.
That component is a <em>synchronization task</em>.</p>
</div>
<div class="paragraph">
<p>MidPoint <em>task</em> is an active process that runs inside midPoint server.
This is the first time that we encounter the concept of a <em>task</em>, but it is definitely not the last one.
Tasks are used for numerous purposes in midPoint.
They are used to track long-running operations and actions that work on large sets of objects (bulk actions).
There are tasks that execute cleanup jobs, compile reports and provide variety of other functions.
The concept of a <em>task</em> is a very powerful and flexible one.
Tasks can be used to track execution of a short one-off operations.
Tasks can be used to execute scheduled actions in regular intervals.
Tasks can be used to track long-running processes.
We will be using tasks in almost every chapter of this book.</p>
</div>
<div class="paragraph">
<p>Tasks are used as an active component to "run" almost all synchronization mechanisms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Reconciliation task</strong> is listing all the accounts in a specific resource.
The task executes reconciliation process for every account that is found.
This essentially means that midPoint computes how that particular account should look like, and then the computed values are compared with real account attributes.
As reconciliation is processing all accounts one-by-one and recomputes all the data, it is quite a heavyweight task.
This task is usually scheduled for regular execution using quite a long execution interval (days or weeks).</p>
</li>
<li>
<p><strong>Live synchronization task</strong> is looking (polling) for changes in a specific resource.
The task will look for accounts that were created, modified or deleted recently.
The task will get a description of the change (delta), and pass that to midPoint synchronization mechanisms.
Live synchronization is designed to be fast and efficient, to provide <em>almost real-time</em> reaction to changes.
This task is almost always scheduled for regular execution in very short intervals (minutes or seconds).</p>
</li>
<li>
<p><strong>Import from resource task</strong> is listing all the accounts from a specific resource.
The task will pretend that the accounts were just created.
This usually motivates midPoint to create users based on those accounts, or link these accounts to existing users.
This task is usually not scheduled, it is almost always executed manually as needed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each type of synchronization task is detecting changes using a different mechanism.
However, once the task detects the change or reads the account, then the processing is the same for all tasks.
All the tasks lead to the same algorithms based on the same configuration and policies.
Therefore, it does not matter whether it has all started in <em>reconciliation</em> or <em>live synchronization</em> task, it will all end up in the same correlation-situation-reaction-mapping flow.</p>
</div>
<div class="paragraph">
<p>The tasks are necessary to <em>initiate</em> the synchronization.
They are the active part, the spark that starts the synchronization process.
Without the tasks the synchronization does not really work.
There are ways the synchronization can "happen" even without a task, e.g. as a reaction to user interface operation, or if a new account is discovered during an unrelated operation.
Despite that, practical deployments need at least one synchronization task to work properly.
This task takes care of the vast majority of synchronization cases.</p>
</div>
<div class="paragraph">
<p>Strictly speaking, a task is quite a strange kind of animal.
Tasks have their data and configuration as most other midPoint objects have.
Unlike other objects, tasks are <em>active</em>, they <em>run</em>.
Therefore, there are CPU threads associated with the tasks when the tasks are running.
There are mechanisms to monitor task progress.
The tasks need to be cluster-aware, they have to fail over to a different midPoint node if one node fails.
The tasks are quite complex, and they may be a bit tricky to handle.
Fortunately, midPoint is making task handling reasonably simple.
Tasks are represented as ordinary midPoint objects.
Therefore, tasks can be imported to midPoint in XML/JSON/YAML form as any other object.
Tasks can be easily edited in their XML/JSON/YAML form to change the scheduling, modify the parameters, and so on.
Of course, there are some special functions that only the tasks have (such as <em>suspend</em> and <em>resume</em>).
Such functions cannot be directly controlled using the XML/JSON/YAML format.
However, the vast majority of task management can be done using the very same methods that are used to control other midPoint objects.</p>
</div>
<div class="paragraph">
<p>Tasks can be created by taking the XML/JSON/YAML file and importing that to midPoint.
That is the way synchronization tasks are often managed.
When an XML-formatted resource definition is created, then there is often an associated synchronization task.
Which means that both resource and all the necessary synchronization tasks can be imported together.
Synchronization tasks can also be created from midPoint user interface.
They are usually created by using special-purpose <b class="menuref">Defined tasks</b> menu item in resource detail pages.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-03-synchronization-tasks.png" alt="Synchronization tasks">
</div>
</div>
<div class="paragraph">
<p>Once the synchronization tasks are created, they can be managed in the same way as other tasks are managed: in the <b class="menuref">Server tasks</b> part of the midPoint user interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_synchronization_example_hr_feed">Synchronization Example: HR Feed</h3>
<div class="paragraph">
<p>This section describes complete working example that feeds HR data into midPoint.
The HR system used by ExAmPLE company is an old and complex thing.
Therefore, the easiest integration method is to use structured text exports.
The system can export employee data in a form of a comma-separated text file (CSV).
The HR system is set up to export fresh data every night.
MidPoint takes this export file, crunches the content, and updates the data about users.</p>
</div>
<div class="paragraph">
<p>This configuration is done in three steps.
First, we create a simple setup to import the data into midPoint.
This is an operation that is executed only once.
Then the configuration is updated to run scheduled reconciliation task.
Reconciliation compares all the data records every time, and it makes any necessary updates.
Even though this method would be perfectly acceptable for a company of this size, we are still going set up a live synchronization task, to make synchronization lighter and faster.</p>
</div>
<div class="paragraph">
<p>The core of the configuration is contained in a single <em>resource definition</em> file.
Following paragraphs explain individual parts of the file.
There are few additional configuration files for reconciliation and live synchronization <em>tasks</em>.
Simplified XML notation is used for clarity.
The complete file in a form that is directly usable in midPoint can be found at the same place as all the other samples in this book (see <a href="#92-additional-information">Additional Information</a> chapter for details).</p>
</div>
<div class="paragraph">
<p>The resource representing HR system is configured as data source.
It is used to "pull" the data inside midPoint.
However, as we have described previously, there is no fundamental difference between source and target resources in midPoint.
Therefore, this HR resource starts in entirely ordinary way.
There is a reference to the CSV connector and the connector configuration:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">03c3ceea-78e2-11e6-954d-dfdfa9ace0cf</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>HR System<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;connectorRef&gt;</span>...<span class="tag">&lt;/connectorRef&gt;</span>
    <span class="tag">&lt;connectorConfiguration&gt;</span>
        <span class="tag">&lt;configurationProperties&gt;</span>
            <span class="tag">&lt;filePath&gt;</span>/var/opt/midpoint/resources/hr.csv<span class="tag">&lt;/filePath&gt;</span>
            <span class="tag">&lt;encoding&gt;</span>utf-8<span class="tag">&lt;/encoding&gt;</span>
            <span class="tag">&lt;fieldDelimiter&gt;</span>,<span class="tag">&lt;/fieldDelimiter&gt;</span>
            <span class="tag">&lt;multivalueDelimiter&gt;</span>;<span class="tag">&lt;/multivalueDelimiter&gt;</span>
            <span class="tag">&lt;uniqueAttribute&gt;</span>empno<span class="tag">&lt;/uniqueAttribute&gt;</span>
            <span class="tag">&lt;passwordAttribute&gt;</span>password<span class="tag">&lt;/passwordAttribute&gt;</span>
        <span class="tag">&lt;/configurationProperties&gt;</span>
    <span class="tag">&lt;/connectorConfiguration&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next section is <em>schema handling</em> configuration.
That is where it becomes slightly more interesting.
The schema handling section contains inbound mappings for HR account attributes:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>Default Account<span class="tag">&lt;/displayName&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>AccountObjectClass<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
            <span class="tag">&lt;focus&gt;</span>
                <span class="tag">&lt;type&gt;</span>UserType<span class="tag">&lt;/type&gt;</span>
                <span class="tag">&lt;archetypeRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000702</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/focus&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The schema handling section starts with the usual definitions of <em>account</em> object type.
This is a definition of <code>Default account</code>, using the only object class that our CSV-based HR connector provides.
We have seen that before, in previous chapter.
However, there is a new part, definition of <em>focus</em>.
The <code>delineation</code> and most other parts of schema handling definition refer to <em>account</em> or other <em>resource</em> objects.
In midPoint parlance those are seen as <em>projections</em>, the "spoke" part of hub-and-spoke synchronization topology.
However, the <code>focus</code> part is different.
It refers to the objects in midPoint repository, objects that are at the center of the synchronization topology, the <em>focal</em> object.
In our case, <em>user</em> is our focal objects, as we are going to synchronize HR <em>accounts</em> with midPoint <em>users</em>.
The other part of the <code>focus</code> definition specifies an <em>archetype</em>, which defines finer characteristics of focal object.
In this case it points to <code>Person</code> archetype.
<em>User</em> objects that are going to be created during synchronization will have this archetype automatically assigned.
We will learn more about archetypes later, in <a href="#08-archetypes">Archetypes</a> chapter.</p>
</div>
<div class="paragraph">
<p>Next part of the definition specifies properties and mappings of account <em>attributes</em>:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>empno<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Employee number<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/name<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/personalNumber<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>firstname<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>First name<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/givenName<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>lastname<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Last name<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/familyName<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The account attribute <code>empno</code> is mapped to midPoint user properties name and <code>personalNumber</code>.
Account attributes <code>firstname</code> and <code>lastname</code> are mapped to <code>givenName</code> and <code>familyName</code> properties respectively.
This is perhaps self-explanatory.</p>
</div>
<div class="paragraph">
<p>The next part of the configuration specifies mappings for activation and credentials:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;activation&gt;</span>
                <span class="tag">&lt;administrativeStatus&gt;</span>
                    <span class="tag">&lt;inbound</span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/administrativeStatus&gt;</span>
            <span class="tag">&lt;/activation&gt;</span>

            <span class="tag">&lt;credentials&gt;</span>
                <span class="tag">&lt;password&gt;</span>
                    <span class="tag">&lt;inbound&gt;</span>
                        <span class="tag">&lt;strength&gt;</span>weak<span class="tag">&lt;/strength&gt;</span>
                        <span class="tag">&lt;expression&gt;</span>
                            <span class="tag">&lt;generate</span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;/expression&gt;</span>
                    <span class="tag">&lt;/inbound&gt;</span>
                <span class="tag">&lt;/password&gt;</span>
            <span class="tag">&lt;/credentials&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Activation</em> is a very specific concept in midPoint, controlling whether accounts is active (enabled or disabled) among other things.
MidPoint knows activation attributes and their meaning, they are pre-defined in midPoint <em>schema</em>.
Therefore, there is no need to specify a lot of details.
That makes activation mapping a very simple thing.
The configuration specifies that the administrative status should be mapped in the inbound direction.
That is it.</p>
</div>
<div class="paragraph">
<p>However, the mapping for credentials needs a bit of explanation.
What midPoint sees as HR <em>accounts</em> are not exactly accounts, they are usually just records in the HR database.
Nobody is using these HR records to log into the HR systems.
Therefore, there is no <em>password</em> associated with them.
Yet, we need a password for the users in midPoint.
Therefore, we are going to <em>generate</em> the passwords.
For that purpose, we are going to use the weak mapping with generate expression that was explained above.</p>
</div>
<div class="paragraph">
<p>Next section specifies correlation settings.
The ownership of the accounts that are not already linked is determined by the correlation mechanism.</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;correlation&gt;</span>
                <span class="tag">&lt;correlators&gt;</span>
                    <span class="tag">&lt;items&gt;</span>
                        <span class="tag">&lt;item&gt;</span>
                            <span class="tag">&lt;ref&gt;</span>personalNumber<span class="tag">&lt;/ref&gt;</span>
                        <span class="tag">&lt;/item&gt;</span>
                    <span class="tag">&lt;/items&gt;</span>
                <span class="tag">&lt;/correlators&gt;</span>
            <span class="tag">&lt;/correlation&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, <code>personalNumber</code> user property is used for correlation.
MidPoint knows that <code>personalNumber</code> is mapped from <code>empno</code> account attribute, therefore midPoint compares values of <code>personalNumber</code> user property and <code>empno</code> account attribute.
If the values match then the user is considered to be an owner of the account.</p>
</div>
<div class="paragraph">
<p>The mappings are undoubtedly important part of synchronization configuration.
The mappings specify how are the account data reflected to midPoint user.
However, the mappings do not specify whether the accounts should be created or deleted.
Mappings control the data, but they do not control the <em>lifecycle</em>.
It is the next configuration section that makes this resource really authoritative:</p>
</div>
<div class="listingblock">
<div class="title">ressource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;synchronization&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>unmatched<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;addFocus</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>unlinked<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;link</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>linked<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;synchronize</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>deleted<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;deleteFocus</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
            <span class="tag">&lt;/synchronization&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the information in this chapter, this configuration should be quite easy to read.
This a typical configuration for authoritative resource.
If there is a new account on the resource, and we do not have an owner (situation: <code>unmatched</code>), then we create a new user (action: <code>addFocus</code>).
If there is a new account for which we can find existing owner (situation: <code>unlinked</code>), then simply link it (reaction: <code>link</code>).
If the account is linked already (situation: <code>linked</code>), then we just synchronize the data.
In fact, we synchronize data for all the other situations as well.
Except the last one.
If the account is deleted in the HR system (situation: <code>deleted</code>), then we want to delete midPoint user as well (reaction: <code>deleteFocus</code>).
As the user gets deleted there is no point in synchronizing the data.
MidPoint knows that, and it skips application of mappings.</p>
</div>
<div class="paragraph">
<p>There is one more little detail in this resource definition:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    ...
    <span class="tag">&lt;projection&gt;</span>
        <span class="tag">&lt;assignmentPolicyEnforcement&gt;</span>none<span class="tag">&lt;/assignmentPolicyEnforcement&gt;</span>
    <span class="tag">&lt;/projection&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a setting that adjusts the behavior of midPoint <em>assignments</em>.
As was already mentioned, all resources in midPoint are created equal.
The source resources must follow the same rules as target resources.
One of the fundamental rules of midPoint is that there should not be any account without a specific reason to exist.
In midPoint terminology, every account exists because there is an <em>assignment</em> that justifies its existence.
While this approach is exactly what we want for the vast majority of (well behaving) resources, it is not exactly ideal for resources that are pure data sources.
Those resources work the other way around.
The HR account is in fact a <em>cause</em> for midPoint user existence, not its effect.
Therefore, there is really useful <code>assignmentPolicyEnforcement</code> setting that controls the behavior of assignments.
This setting is used in a variety of scenarios, mostly for data migration, and to tame resources that just won’t behave in a civilized manner.
However, in this case, the setting is used to turn off the assignment enforcement for this resource entirely.
As this resource is an authoritative source, the assignment enforcement does not make much sense.
Behavior of this resource is defined by the <code>synchronization</code> section of resource configuration.</p>
</div>
<div class="paragraph">
<p>Resource configuration is complete now.
This configuration sets up the connector, mappings, correlation and synchronization policies.
The configuration is the same for all the synchronization flavors: import, reconciliation and live sync - they will all use the same settings.
When it comes to configuration, the only difference between those synchronization flavors is the way how the synchronization <em>tasks</em> are set up.
If an <em>import</em> task is set up, then import of resource accounts will be executed.
If <em>reconciliation</em> task is set up, the reconciliation will be executed.
It is all in the tasks.
Synchronization tasks can be easily set up using those convenient buttons in the user interface.
However, we like to make our lives a bit painful in our part of the world.
Therefore, we are going to go hardcore, and we import the tasks in the XML form.</p>
</div>
<div class="paragraph">
<p>First task is an <em>import</em> task.
This task lists all the accounts in the HR CSV file.
The task pretends that each of the accounts was just created.
If the task is executed for the first time, then resulting situation of the accounts is going to be either <code>unmatched</code> or <code>unlinked</code>.
Therefore, the task creates new midPoint users, or links the accounts to existing users.</p>
</div>
<div class="listingblock">
<div class="title">task-hr-import.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fa25e6dc-a858-11e7-8ebc-eb2b71ecce1d</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>HR Import<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="comment">&lt;!-- Import task archetype --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000503</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ArchetypeType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    <span class="tag">&lt;ownerRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000002</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;executionState&gt;</span>runnable<span class="tag">&lt;/executionState&gt;</span>
    <span class="tag">&lt;schedule&gt;</span>
        <span class="tag">&lt;recurrence&gt;</span>single<span class="tag">&lt;/recurrence&gt;</span>
    <span class="tag">&lt;/schedule&gt;</span>
    <span class="tag">&lt;activity&gt;</span>
        <span class="tag">&lt;work&gt;</span>
            <span class="tag">&lt;import&gt;</span>
                <span class="tag">&lt;resourceObjects&gt;</span>
                    <span class="comment">&lt;!-- HR Resource --&gt;</span>
                    <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">03c3ceea-78e2-11e6-954d-dfdfa9ace0cf</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
                <span class="tag">&lt;/resourceObjects&gt;</span>
            <span class="tag">&lt;/import&gt;</span>
        <span class="tag">&lt;/work&gt;</span>
    <span class="tag">&lt;/activity&gt;</span>
<span class="tag">&lt;/task&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a very basic structure of a task.
Similarly to all midPoint objects, a task has a <em>name</em>.
Then there is an assignment of <code>Import task</code> <em>archetype</em>.
We will describe archetypes later.
For now, it is only important to know that this classifies the task as <em>import</em> task, so the user interface can place the task in proper categories.
Task needs definition of an <em>owner</em>.
The owner is a user that is executing the task.
This is important, because authorizations of task owner determine what the task is allowed to do.
This is also the identity that will be recorded in the audit log.
In this case <code>administrator</code> is owner of this task.
Task <em>execution state</em> tells whether the task is running, it is suspended or finished.
Tasks are often executed periodically, therefore they need a <em>schedule</em>.
In this case, we start with task that is executed just once, to test the configuration.
Hence the <code>single</code> recurrence, which specifies that the task runs only once.
Then there is definition of <em>activity</em>.
Activity specifies what the task really does.
In this case the activity specifies that this is a synchronization task which <em>imports</em> accounts from the resource.
The resource is specified by the <code>resourceRef</code> reference in the activity specification.
This points to our HR resource.</p>
</div>
<div class="paragraph">
<p>As task <em>execution state</em> is set to <code>runnable</code>, midPoint tries to execute the task when the definition is imported.
That means that import of accounts from the HR resource starts immediately.
Progress of the task can be monitored in the Server tasks section of midPoint user interface.
The import task is not a recurring task, it will run only once.
If you need to re-run the task, you can do that from midPoint user interface.
However, the task will not get executed again, unless you explicitly tell midPoint to do so.
This is very typical behavior for import tasks, they are usually executed only when a new resource is connected to the system.
Once everything is set up, correlated and linked, then the import task is not needed any more.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A clever reader may ask what happens when the import task is executed more than once.
The answer is simple: not much.
Even if the task pretends that the accounts were just created, midPoint is not fooled easily.
In fact, it is hard to believe that the account was just created if midPoint already has shadow for that account, and it is linked to a user, isn’t it?
Therefore, midPoint is going to stay calm and carry on.
It keeps the user, it keeps the shadow and also the link between them.
If there is any change in the account attribute, the change will be reflected to the user.
That is it.
No big drama here.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Import</em> task gets the data from the resource into midPoint.
As import is not a recurring task, it does not <em>keep</em> the data synchronized.
Import tasks are not designed to do so.
Fortunately, there are other tasks that are designed for continuous synchronization.
<em>Reconciliation</em> task is one of these.
Reconciliation task lists all the accounts on a resource and compares that with data in midPoint.</p>
</div>
<div class="listingblock">
<div class="title">task-hr-recon.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bbe4ceac-a85c-11e7-a49f-0f5777d22906</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>HR Reconciliation<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="comment">&lt;!-- Reconciliation task archetype --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000501</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ArchetypeType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    <span class="tag">&lt;ownerRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000002</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;executionState&gt;</span>runnable<span class="tag">&lt;/executionState&gt;</span>
    <span class="tag">&lt;schedule&gt;</span>
        <span class="tag">&lt;recurrence&gt;</span>recurring<span class="tag">&lt;/recurrence&gt;</span>
        <span class="tag">&lt;cronLikePattern&gt;</span>0 0 1 ? * SAT<span class="tag">&lt;/cronLikePattern&gt;</span>
        <span class="tag">&lt;misfireAction&gt;</span>executeImmediately<span class="tag">&lt;/misfireAction&gt;</span>
    <span class="tag">&lt;/schedule&gt;</span>
    <span class="tag">&lt;activity&gt;</span>
        <span class="tag">&lt;work&gt;</span>
            <span class="tag">&lt;reconciliation&gt;</span>
                <span class="tag">&lt;resourceObjects&gt;</span>
                    <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">03c3ceea-78e2-11e6-954d-dfdfa9ace0cf</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
                <span class="tag">&lt;/resourceObjects&gt;</span>
            <span class="tag">&lt;/reconciliation&gt;</span>
        <span class="tag">&lt;/work&gt;</span>
    <span class="tag">&lt;/activity&gt;</span>
<span class="tag">&lt;/task&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Definition of a <em>reconciliation</em> task is almost the same as the definition of import task.
However, there are crucial differences.
First of all, there is different <em>activity</em>.
This is what makes this task a <em>reconciliation</em> task.
Then, the task is <em>recurring</em>.
This means that midPoint will repeat execution of the task.
Therefore, there is also execution schedule, so the server knows when to execute the task.
Reconciliation tasks are usually resource-intensive, therefore we usually want to execute them at a very specific off-peak times.
For that reason the execution schedule is defined using a cron-like pattern.
UNIX-friendly readers will be surely familiar with this.
The format is:</p>
</div>
<div class="paragraph">
<p><code><em>seconds</em> <em>minutes</em> <em>hours</em> <em>day-of-month</em> <em>month</em> <em>day-of-week</em> <em>year</em></code></p>
</div>
<div class="paragraph">
<p>The string <code>0 0 1 ? * SAT</code> means that this task will be executed every Saturday at 01:00:00am.
There is also definition of misfire action.
Misfire is a situation when the server is down at the time when the task is supposed to run.
In this case, if the server is down in the early hours of Saturday, this task will be executed as soon as the server starts up.</p>
</div>
<div class="paragraph">
<p><em>Reconciliation</em> is a real workhorse of identity management.
It can be used for almost any resource.
It is very reliable.
It is often used to fix data problems, apply new policies, look for missing accounts, detect illegal accounts and so on.
It is indeed a really useful tool.
Yet, it has its downside.
Reconciliation iterates through all the accounts, it recomputes all the applicable policies for every account, one-by-one.
Therefore, it may be quite resource-intensive.
It may be even quite brutal if the policies are complex, user population is high and the resources are slow.
This can take hours or even days in extreme cases.
Even for smaller deployments, reconciliation is not entirely easy.
The problem is not in midPoint.
MidPoint can be usually scaled up to handle the load.
However, listing all the accounts often may put unacceptable load on the <em>resources</em>, the source and target systems.
Therefore, reconciliation is not executed often.
Daily, weekly or even monthly reconciliation seems to be a common approach.</p>
</div>
<div class="paragraph">
<p>Reconciliation is reliable, but it is not entirely what we would call "real-time".
Of course, midPoint has a faster alternative.</p>
</div>
<div class="paragraph">
<p><em>Live synchronization</em> is the way to go for real-time synchronization - or rather <em>almost</em> real-time synchronization.
Practical latencies for live synchronization are in the range of seconds or minutes, which is fast enough for most practical cases.
Live synchronization is also quite resource-efficient.
Overall, it is much faster and much lighter than reconciliation.
Unfortunately, live synchronization is not available for all resources.
Live synchronization depends on the ability to get recent changes from the resource in a very efficient way.
Therefore, it is only available for resources that record the changes.
The specific mechanism to record the changes may vary from resource to resource.
It may be as basic as a simple modification timestamp, or it may be a complex real-time change log.
The mechanism has to be good enough for the connector to discover recent changes, and it must be efficient enough for the connector to do that every couple of seconds.
If such mechanism is available, and the connector knows how to use it, then setting up live synchronization is easy.
All that is needed is live synchronization task.</p>
</div>
<div class="listingblock">
<div class="title">task-hr-livesync.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;task</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7c57adc2-a857-11e7-83ac-0f212d965f5b</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>HR Live Synchronization<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;ownerRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000002</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;executionState&gt;</span>runnable<span class="tag">&lt;/executionState&gt;</span>
    <span class="tag">&lt;schedule&gt;</span>
        <span class="tag">&lt;recurrence&gt;</span>recurring<span class="tag">&lt;/recurrence&gt;</span>
        <span class="tag">&lt;interval&gt;</span>10<span class="tag">&lt;/interval&gt;</span>
    <span class="tag">&lt;/schedule&gt;</span>
    <span class="tag">&lt;activity&gt;</span>
        <span class="tag">&lt;work&gt;</span>
            <span class="tag">&lt;liveSynchronization&gt;</span>
                <span class="tag">&lt;resourceObjects&gt;</span>
                    <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">03c3ceea-78e2-11e6-954d-dfdfa9ace0cf</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
                <span class="tag">&lt;/resourceObjects&gt;</span>
            <span class="tag">&lt;/liveSynchronization&gt;</span>
        <span class="tag">&lt;/work&gt;</span>
    <span class="tag">&lt;/activity&gt;</span>
<span class="tag">&lt;/task&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This task definition should be easy to understand by now.
There is a different <em>activity</em> that makes this a live synchronization task.
There is also a different type of <em>scheduling</em>.
We do not want to execute this task at a specific time.
We rather want to execute it all the time, at regular intervals.
In this case the interval is set to 10 seconds.
That is all.
We have live synchronization running.
If the HR CSV file is changed, the changes will get automatically processed by midPoint.</p>
</div>
<div class="paragraph">
<p>Setting up synchronization flavors such as reconciliation or life synchronization is just a matter of setting up the tasks.
The rest of the configuration is the same for all flavors.
Therefore, it is very easy to run both live synchronization and reconciliation for the same resource - just create two tasks.
In fact, this is quite a common setup.
Live synchronization is used to get the changes quickly and efficiently.
Reconciliation is used to make sure all the changes were processed and that the policies are applied consistently.</p>
</div>
<div class="paragraph">
<p>Now we have the HR feed up and running.
However, there are still few issues.
A clever reader would surely notice that this is not a very good HR resource.
MidPoint users created from this HR feed have given name and family name, but the <em>full name</em> field is empty.
Do not worry.
We will sort that out in later chapters, with the help of <em>object template</em>.
Also, the users have employee number as their username.
This may be in fact a very good approach for some deployments as it avoids the need to rename accounts.
However, it is not a very user-friendly approach.
Therefore, most deployments would like to generate more convenient usernames.
This is easy to do with midPoint, and we will also address that later.
There is still a lot of things to learn before we get to a complete synchronization set up.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hr_feed_recommendations">HR Feed Recommendations</h3>
<div class="paragraph">
<p>All resources are created equal in midPoint.
However, source resources almost always have a slightly special standing.
Even though midPoint mechanisms are the same for all resources, the data coming from the sources often have significant impact on the entire solution.
There is this traditional computer engineering wisdom: <em>garbage in, garbage out</em>.
An error in data feed may cause a lot of problems everywhere.
Therefore, it is important to get the data sources right.
This is usually one of the first steps in an identity management project.</p>
</div>
<div class="paragraph">
<p>Unfortunately, source data feed is usually quite difficult to set up correctly - and it is almost impossible to get it right at the first try.
There may be good old configuration problems, which are usually easy to fix.
There may be data compatibility problems, such as presence of non-ASCII national characters where they are not expected.
Worst of all, source data may be of poor quality, there may be inconsistencies, typos, the data may be out of date, not reflecting the reality very well.
These problems are the most difficult to correct, as the right way to correct them is to modify the data at its source - in the source database, HR system or spreadsheet exchanged by e-mail.
That takes time, meetings, mail messages, management decisions, processes, excuses, delays and huge amount of patience.
Therefore, setup of a data source is usually an iterative process.
The process usually goes like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up initial source resource definition based on the information you have.
Set up connector and test connection.
Check that you can see the accounts.
Set up mappings and synchronization policy.</p>
</li>
<li>
<p>Test the import process on a couple of individual accounts.
Navigate to the resource details pages, click on <b class="menuref">Accounts</b> tab to list accounts, choose an account and click on the small <b class="button">Import</b> button in the table row.
Import of that individual account starts immediately.
Just that one account.
It is easier to see the errors (see step 6) by using this method.</p>
</li>
<li>
<p>Fix any errors that you see and repeat step 2.</p>
</li>
<li>
<p>Create an import task and run import of all accounts.</p>
</li>
<li>
<p>Examine task errors.
You can use task details page to get the summary.</p>
</li>
<li>
<p>If there are no errors, then examine the users.
If everything seems right then it is time to congratulate yourself.
You have a good import.
However, this is unlikely to happen on the first few attempts.</p>
</li>
<li>
<p>You will probably need to have a look into system logs to learn the details of individual import failures.
MidPoint heavily relies on logs for detailed error analysis.
See the <a href="#90-troubleshooting">Troubleshooting</a> chapter of this book to learn how to adjust log levels and how to get understand the log messages.</p>
</li>
<li>
<p>Some errors are likely to be caused by the errors in your mappings and policies.
These are usually easy to fix.
However, there are usually worse errors as well – errors caused by wrong or unexpected input data.
The right way would be to fix the data.
However, that is not always possible (in fact it is almost never a feasible option for a quick fix).
Fortunately, most of the input data errors can be fixed (read: "worked around") in midPoint with a bit of ingenuity.
Just use the power of the mappings.
For example, clean up the unexpected characters, white space or data formats using scripting expressions.</p>
</li>
<li>
<p>Rinse and repeat.
If the errors you get are not severe then you may simply re-run the import task.
This often works just fine.
However, if the problem was in a mapping that completely ruined all the data then it is perhaps best to start with a blank slate.
We are all just humans and this situation happens quite often, especially in the beginning while you are still learning.
Therefore, there is a special feature to help you out.
Navigate to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Repository Objects</b></span>.
There is a small unassuming expand button in the top-right part of the screen.
That button opens a context menu.
Select <b class="menuref">Delete all identities</b> item.
That is what we lovingly call "laxative button".
A brief dialog will pop up asking you to specify which identities exactly are to be deleted (users, shadows, &#8230;&#8203;).
This is a very convenient way how to get back to a black slate, but keep all the configuration (resources, templates, tasks).</p>
</li>
<li>
<p>Goto step 2. Repeat until done.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the initial identity management deployment step includes an HR feed, we strongly recommend to start with that HR feed.
It is significant benefit to have authoritative HR data in the midPoint to start with.
It is usually easier to correlate other resources to midPoint users later on, if the users were created from a reasonably reliable HR data.
Also, it will usually take some tweaking to get the HR import right.
The possibility to easily clean up midPoint and get to a clean slate is extremely useful.
However, this "wipeout" approach is possible only if the HR feed is the first resource that is connected to midPoint.</p>
</div>
<div class="paragraph">
<p>A clever reader would notice, that we assumed that the source feed is taken from a CSV file.
This is indeed the case in many deployments.
The CSV file is usually produced as an automatic scheduled export of HR system data, running every night.
If a new employee or contractor is about to join the company, there is usually no hurry.
This information is entered into the HR system at least a few days in advance, therefore daily CSV export is perfectly acceptable.
However, there may be cases when we want a faster response.
Maybe we do not even want additional burden of dealing with CSV exports.
Of course, there is a solution.
In theory, any connector can be used for source resource.
There are specialized connectors that are taking data directly from the HR system.
For example, there is a connector for Oracle HCM system.
Unfortunately, there is no connector that can take data from SAP HR system yet.</p>
</div>
</div>
<div class="sect2">
<h3 id="_synchronization_and_provisioning">Synchronization and Provisioning</h3>
<div class="paragraph">
<p>Synchronization and provisioning are intimately related.
Everything that we have explained about provisioning in the previous chapter also applies to synchronization.
In fact, provisioning and synchronization are just applications of the same basic mechanisms.
Provisioning starts with modification of a user.
Synchronization starts a bit earlier: inbound mappings are used to map values from source system to the user.
The result of inbound mapping evaluation is modification of the user object.
According to midPoint principles, it does not matter how the user was modified.
The reaction is the same: accounts are provisioned, modified or deleted.</p>
</div>
<div class="paragraph">
<p>The synchronization (<em>inbound</em> processing) and provisioning (<em>outbound</em> processing) usually happen in one seamless operation.
For example, the HR connector detects update in the last name of an employee.
That modification is applied to midPoint user, therefore the family name of midPoint user is updated.
The operation continues by evaluating all templates, roles and outbound mappings.
The outbound mappings usually map the family name change to the resource attributes.
Therefore, the resource accounts linked to the user are immediately updated.
All of that happens in a single operation.
That is how midPoint works.
MidPoint is not a human.
It never procrastinates (unless explicitly instructed do to so).
MidPoint does not postpone the operation for later if the operation can be executed immediately.
MidPoint tries to get the data right on the first try.
Therefore, there are no specialized propagation or provisioning tasks that you might know from older identity management systems.
MidPoint does not need them.</p>
</div>
<div class="paragraph">
<p>There are other advantages in doing everything in one operation.
It is all one operation, therefore midPoint knows all the details: what was the cause, what is the effect, what exactly has been changed.
Such <em>context</em> is extremely important for troubleshooting.
Some identity management systems decouple the cause from the effect.
Such a divided approach may have its advantages, but it is an absolute nightmare when an engineer needs to figure out why a certain effect happened.
For that reason, midPoint has both the cause and the effects bundled together in a single operation.
Therefore, it is much easier to figure out what is going on.
Having the cause and effect connected in one operation makes it possible to neatly record entire operation in the audit trail.
Then there is another huge advantage: midPoint knows exactly what has been changed.
This means that midPoint does not only know the new value of a property.
MidPoint also knows the old value and values that were added or removed.
This is a complete description of the change that we call a <em>delta</em>.
This is recorded at the beginning of the operation, and propagated all the way until the operation is done.
Therefore the mappings can be smart.
This approach enables a lot of interesting behavioral patterns.
For example, it is quite easy for midPoint to implement the "last change wins" policy.
In this case midPoint will simply overwrite only those attributes that are really changed in operation.
MidPoint can leave other values untouched.
In fact, this is the default behavior of midPoint.
It is a very useful behavior during deployment of a new identity management system.</p>
</div>
<div class="paragraph">
<p>Careful processing of the operations allows configurations that are not feasible with older identity management systems, e.g. a resource that is both a source and a target.
In fact a lot of identity management systems can have resource that is both a source and a target - as long as it is a source for one attribute and a target for another attribute.
However, midPoint can live with a resource where the same attribute is both a source and a target.
In fact there may be many sources and many targets for the same property at the same time.
This is a very useful configuration, indeed.
Just think about <em>telephone number</em> property.
It is usually something that the user sets up himself.
This may be set up by some kind of specialized self-service, it may be updated by a call center call, the user may update that in his Active Directory profile &#8230;&#8203; there are many ways how this information is changed.
Yet, we want this property to be consistent.
We want telephone number to be the same everywhere.
We do not care where it was changed.
We just want to propagate the last change from anywhere to all the other systems.
MidPoint can easily do this.
Just specify both inbound and outbound mappings for the same attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>mobile<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;source&gt;</span>
             <span class="tag">&lt;path&gt;</span>$focus/telephoneNumber<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span>
    <span class="tag">&lt;inbound&gt;</span>
        <span class="tag">&lt;target&gt;</span>
             <span class="tag">&lt;path&gt;</span>$focus/telephoneNumber<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/target&gt;</span>
    <span class="tag">&lt;/inbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the change in user property <code>telephoneNumber</code> is propagated to the account attribute <code>mobile</code> (outbound change).
However, also a change in the account attribute <code>mobile</code> is propagated back to user property <code>telephoneNumber</code> (inbound change).
Last change wins.</p>
</div>
<div class="paragraph">
<p>A clever reader certainly grumbles something about infinite loops now.
No need to not worry here.
MidPoint can see complete operation context, both inbound and outbound sides.
Therefore, midPoint knows when to stop processing the operation.
There are even mechanism how to avoid loops caused by connectors detecting changes caused by the connector itself.
MidPoint will break those loops automatically.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mapping_and_expression_tips_and_tricks">Mapping and Expression Tips and Tricks</h3>
<div class="paragraph">
<p>Mappings and expressions provide a very powerful mechanism.
In fact, most of midPoint initial configuration is about setting up correct mappings.
However, with great power comes great responsibility, and mappings may look a bit intimidating at a first sight.
Fortunately, there are some tips and tricks that make the life with mappings and expressions a bit easier.</p>
</div>
<div class="paragraph">
<p>Most mappings are aware of the context in which they are used.
Therefore, paths of mapping sources and targets can be shortened - or even left out entirely.
Activation and credential mappings used in the HR feed example are the obvious cases.
Yet, even paths in ordinary mappings may be shortened.
For example take the outbound mapping source:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;source&gt;</span>
             <span class="tag">&lt;path&gt;</span>$focus/telephoneNumber<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As the mapping knows that its source is a focus (user) the definition may be shortened:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;source&gt;</span>
             <span class="tag">&lt;path&gt;</span>telephoneNumber<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Typical midPoint deployment has tens or hundreds of mappings.
Deployments with thousands of mappings are definitely feasible.
There are two things that can make maintaining the mappings easier.
Optionally, you can specify the mapping <em>name</em>.
Mapping name appears in the log files and some error messages.
It may be easier to identify which mapping is causing problems, or it may help locate the trace of mapping execution in the log file.
It is <em>strongly recommended</em> to provide name for your mappings.
Mapping can also have a <em>description</em>.
The description can be used as a general-purpose comment or a documentation explaining what the mapping does.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>mobile<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;name&gt;</span>ldap-mobile<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;description&gt;</span>
            Mapping that sets value for LDAP mobile attribute based on
            user’s telephone number.
        <span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;source&gt;</span>
             <span class="tag">&lt;path&gt;</span>telephoneNumber<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/source&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mappings can become quite complex.
There may be multi-line scripting expression in the mapping, it may not entirely obvious what is the input and output.
Therefore, each mapping and each expression have an ability to enable tracing using the <code>trace</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;attribute&gt;</span>
    <span class="tag">&lt;ref&gt;</span>mobile<span class="tag">&lt;/ref&gt;</span>
    <span class="tag">&lt;outbound&gt;</span>
        <span class="tag">&lt;name&gt;</span>ldap-mobile<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;trace&gt;</span>true<span class="tag">&lt;/trace&gt;</span>
        <span class="tag">&lt;source&gt;</span>
             <span class="tag">&lt;path&gt;</span>telephoneNumber<span class="tag">&lt;/path&gt;</span>
        <span class="tag">&lt;/source&gt;</span>
        <span class="tag">&lt;expression&gt;</span>
            <span class="tag">&lt;trace&gt;</span>true<span class="tag">&lt;/trace&gt;</span>
            <span class="tag">&lt;script&gt;</span>
<span class="inline">                <span class="tag">&lt;code&gt;</span>...<span class="tag">&lt;/code&gt;</span></span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/expression&gt;</span>
    <span class="tag">&lt;/outbound&gt;</span>
<span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If tracing is enabled, then the mapping or expression execution is recorded in the log files.
Tracing can be enabled at both mapping level and expression level.
Mapping tracing is shorter.
It provides overview of the mapping inputs and outputs.
Expression-level tracing is much more detailed.</p>
</div>
<div class="paragraph">
<p>However, even this level of tracing may not be enough to debug expression code.
Therefore, there is a special expression function for logging.
Arbitrary messages may be logged by script expression code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;expression&gt;</span>
        <span class="tag">&lt;script&gt;</span>
<span class="inline">            <span class="tag">&lt;code&gt;</span>
                ...
                log.info(&quot;Value of foo is {}&quot;, foo)
                ...
            <span class="tag">&lt;/code&gt;</span></span>
        <span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;/expression&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Generally speaking, troubleshooting of mappings may be quite difficult as it is often intertwined with midPoint internal algorithms.
Still, there are ways how to do it.
The <a href="#90-troubleshooting">Troubleshooting</a> chapter provides much more details on this.</p>
</div>
<div class="sect3">
<h4 id="_expression_functions">Expression Functions</h4>
<div class="paragraph">
<p>Expressions in general, and scripting expressions in particular, are the place where most midPoint customization takes place.
Scripting expressions are able to execute any code in a general-purpose programming language.
Script can transform the data in any way, or it can execute any function.
Quite naturally, there are functions that are frequently used in the scripts.
Therefore, midPoint provides convenient scripting libraries full of useful methods ready to be used in scripting expressions.</p>
</div>
<div class="paragraph">
<p>There are two built-in scripting libraries that are used very often:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Basic script library</strong> provides very basic functions for string operations, object property retrieval, etc.
These are simple, efficient stand-alone functions.
These functions can be used in every expression.</p>
</li>
<li>
<p><strong>MidPoint script library</strong> provides access to higher-level midPoint functions contain identity-management-specific and midPoint-specific logic.
This library can be used to access almost all midPoint functionality.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The libraries are designed to be very easy to use from the scripting code.
While the specific details how to invoke the library depend on the scripting language, the libraries are usually accessible by the use of <code>basic</code> and <code>midpoint</code> symbols.
Function <code>norm()</code> from the basic library can be invoked in a Groovy script like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;expression&gt;</span>
        <span class="tag">&lt;script&gt;</span>
<span class="inline">            <span class="tag">&lt;code&gt;</span>
                ...
                basic.norm('Guľôčka v jamôčke!')
                ...
            <span class="tag">&lt;/code&gt;</span></span>
        <span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;/expression&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Invocation of the libraries from JavaScript and Python is almost the same, and we are sure that a clever reader will have no trouble figuring that out.
What is more difficult to figure out is which functions the libraries provide.
For that purpose there is a page in midPoint docs that lists all the libraries and this page also has a link to library function documentation.
Look for <a href="https://docs.evolveum.com/midpoint/reference/expressions/expressions/script/functions/">Script Expression Functions</a> page in midPoint docs.</p>
</div>
<div class="paragraph">
<p>Only two libraries were mentioned in this section so far.
However, this is not a whole story.
A clever reader has certainly figured out that the logging function described in previous section is also a scripting library - and there may be more libraries in the future.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resource_capabilities">Resource Capabilities</h3>
<div class="paragraph">
<p>The systems that midPoint connects to are not created equal.
In fact, those systems significantly differ in their capabilities.
Most systems can <em>create</em> accounts.
However, not all of them can <em>delete</em> accounts.
There are systems that keep the accounts forever, the accounts can be only permanently disabled.
Yet another systems cannot <em>enable</em> or <em>disable</em> accounts.
While most systems support <em>password</em> authentication, other system do not.
There is a lot of natural diversity in the provisioning wilderness.
The connector may introduce additional limitations as well.
Even if target system supports a particular feature, connector may not have appropriate code to use it.
MidPoint needs to take all these differences into consideration when executing synchronization and provisioning operations.</p>
</div>
<div class="paragraph">
<p>MidPoint refers to these features of the systems and connectors as <em>resource capabilities</em>.
Although capabilities may look quite complex, they are essentially just a list of things that a connector and resource can do.
MidPoint is aware of the resource capabilities, and their limitations.
Therefore, midPoint can work with resource data correctly.
E.g. midPoint will not try to modify account on a read-only resource.</p>
</div>
<div class="paragraph">
<p>Capabilities are usually automatically discovered by midPoint, and everything just works out of the box.
There is usually no extra work to maintain the capabilities.
Yet, sometimes there is a need to tweak the capabilities a bit.
Maybe the connector cannot detect resource capabilities well enough.
Maybe there is a read-only resource, but the connector has no way of knowing this.
In that case, the <em>write</em> capabilities have to be manually disabled in midPoint.
For that reason there are two sets of capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Native capabilities</strong> are capabilities detected by the connector.
Those are always automatically generated by midPoint.
Those capabilities should not be modified by administrator.</p>
</li>
<li>
<p><strong>Configured capabilities</strong> are the capabilities modified by the administrator.
Configured capabilities are used to override native capabilities.
Configured capabilities are usually empty, which means that only native capabilities are used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are many ways to tweak the capabilities by the administrator.
Yet, there is one case that is particularly interesting for synchronization and provisioning: simulated activation capability.</p>
</div>
<div class="paragraph">
<p>MidPoint connectors can be tailored specifically for a particular system.
E.g. there are often connectors that are developed specifically for one custom enterprise application.
At the other side of the spectrum are <em>generic connectors</em>, that can fit a wide variety of systems and applications.
LDAP, CSV and database table connectors are examples of such generic connectors.
Such connectors are so useful that they are used in almost every midPoint deployment.
However, there is no standardized way to <em>disable</em> an account in database table or a CSV file.
Various columns and various values are used to represent account activation status.
Quite surprisingly, there is no standardized way to disable an account in LDAP directory either.
That is bad news for midPoint.
MidPoint takes a significant advantage from knowing whether account is disabled or enabled.
We had to do something about this "disable ambiguity".
And we did.</p>
</div>
<div class="paragraph">
<p>There is way to tell midPoint which <em>attribute</em> and what <em>values</em> are used to represent account activation status.
Configured activation capability is used for that purpose:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;capabilities&gt;</span>
        <span class="tag">&lt;configured&gt;</span>
            <span class="tag">&lt;cap:activation&gt;</span>
                <span class="tag">&lt;cap:status&gt;</span>
                    <span class="tag">&lt;cap:attribute&gt;</span>ri:active<span class="tag">&lt;/cap:attribute&gt;</span>
                    <span class="tag">&lt;cap:enableValue&gt;</span>true<span class="tag">&lt;/cap:enableValue&gt;</span>
                    <span class="tag">&lt;cap:disableValue&gt;</span>false<span class="tag">&lt;/cap:disableValue&gt;</span>
                <span class="tag">&lt;/cap:status&gt;</span>
            <span class="tag">&lt;/cap:activation&gt;</span>
        <span class="tag">&lt;/configured&gt;</span>
    <span class="tag">&lt;/capabilities&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Configured capability above specifies resource attribute <code>active</code> as the attribute that controls account activation status.
If this attribute is set to value <code>true</code> then the account is enabled.
If the attribute is set to value <code>false</code> then the account is disabled.
That is it.
Once this configured capability is part of resource definition, then midPoint will pretend that the resource can enable and disable accounts.
Attempt to disable account will be transparently translated to modification of <code>active</code> attribute.
Moreover, it also works the other way around.
If an account has attribute <code>active</code> set to <code>false</code> value, midPoint will display that account as disabled.
No extra logic or mapping is needed to achieve that.
The capability does it all.</p>
</div>
<div class="paragraph">
<p>The situation is slightly more complex in our LDAP server in ExAmPLE company.
ExAmPLE is using <em>OpenLDAP</em> server, which does not have any reasonable method to disable users.
Therefore, we have to be very creative.
Perhaps the least bad method is to extend OpenLDAP schema with custom auxiliary object class <code>MidPointPerson</code> which defines new attribute <code>midPointAccountStatus</code>.
The <code>midPointAccountStatus</code> takes values <code>enabled</code> and <code>disabled</code> to represent account status.
No value of <code>midPointAccountStatus</code> attribute means <em>enabled</em> account as well.
As there are two options for representing <em>enabled</em> status, we have to specify that in the definition of simulated capability:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;capabilities&gt;</span>
        <span class="tag">&lt;configured&gt;</span>
            <span class="tag">&lt;cap:activation&gt;</span>
                <span class="tag">&lt;cap:status&gt;</span>
                    <span class="tag">&lt;cap:attribute&gt;</span>ri:midPointAccountStatus<span class="tag">&lt;/cap:attribute&gt;</span>
                    <span class="tag">&lt;cap:enableValue&gt;</span><span class="tag">&lt;/cap:enableValue&gt;</span>
                    <span class="tag">&lt;cap:enableValue&gt;</span>enabled<span class="tag">&lt;/cap:enableValue&gt;</span>
                    <span class="tag">&lt;cap:disableValue&gt;</span>disabled<span class="tag">&lt;/cap:disableValue&gt;</span>
                <span class="tag">&lt;/cap:status&gt;</span>
            <span class="tag">&lt;/cap:activation&gt;</span>
        <span class="tag">&lt;/configured&gt;</span>
    <span class="tag">&lt;/capabilities&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is not an ideal solution as this <code>MidPointPerson</code> object class is quite cumbersome.
However, when combined with some access control list (ACL) magic, it can work quite well.</p>
</div>
</div>
<div class="sect2">
<h3 id="_synchronization_example_ldap_account_correlation">Synchronization Example: LDAP Account Correlation</h3>
<div class="paragraph">
<p>Previous example demonstrated the use of synchronization for HR data feed.
That is the most obvious use of synchronization mechanisms.
However, midPoint synchronization can do more tricks than just feeding data to midPoint.
Synchronization is frequently used even for target resources.
In that case the synchronization is usually used for several purposes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Initial migration:</strong> This is a process of connecting new resource to midPoint.
There are usually accounts that already exist in the resource at the time when a resource is connected to midPoint.
It is likely that at least some accounts correspond to the users that are present in midPoint (e.g. users created from the HR feed).
Therefore, the accounts from the resource need to be <em>correlated</em> to the users that already exist in midPoint.
Synchronization is the right mechanism for this.</p>
</li>
<li>
<p><strong>Detection of illegal (orphaned) accounts:</strong> Security policies are usually set up in such a way that only those people that need an account on a particular resource should have that account.
This is known as the <em>principle of least privilege</em>.
However, in typical identity management deployment, there is nothing that would prohibit system administrator to create any accounts at will.
This freedom is often even desirable, because there are emergency situations where full control over the system is crucial.
Yet, even for emergency cases, we want to make sure that the situation is aligned with policies when the emergency is over.
MidPoint can easily do that, by scanning the target systems in regular intervals.
Synchronization mechanisms can be used to detect accounts that do not have any legal basis (orphaned accounts) and delete or disable such accounts.
Again, synchronization mechanism can do that easily.</p>
</li>
<li>
<p><strong>Attribute value synchronization:</strong> Accounts in target resources are usually created as a result of midPoint provisioning action.
However, account attribute values are in fact copies of the data in midPoint.
Attribute values can easily be changed by users or system administrator, may be set to old values during data recovery procedure, or they can get out of sync by a variety of other means.
MidPoint can make sure that the attributes are synchronized and that they stay synchronized for a long time.
Synchronization mechanisms are ideal for this purpose.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Older identity management systems used synchronization mostly to get data from the source resources to identity management system.
Synchronization in midPoint is much more powerful than that.
It can be applied both to source systems and target systems, it can pull data, push data, detect inconsistencies and fix them.
Synchronization is a general purpose mechanism, it is a real work-horse of identity management with midPoint.
This is the principle of reuse again.
Synchronization mechanism can be reused for variety of purposes.</p>
</div>
<div class="paragraph">
<p>In this example we will be using synchronization to connect existing LDAP server to midPoint.
We assume that our midPoint is already connected to the HR system and we have imported the HR data.
Now we have midPoint users created for all our employees.
Then there is this LDAP server.
It is really important LDAP server.
This server is used by company enterprise portal and also by a variety of smaller web applications.
Those applications are using the LDAP server for user authentication and access authorization.
The LDAP server was deployed many years ago.
Initially, it was populated by the HR data.
However, the LDAP server was managed manually by a system administrator during all these years.
Therefore, it is expected that there are some accounts that belong to former employees.
Also, it might have happened that some accounts are missing.
It is quite likely that a lot of the accounts have wrong data.</p>
</div>
<div class="paragraph">
<p>First task is to set up the <em>connector</em> for this resource.
As LDAP servers are used for identity management purpose all the time, MidPoint comes with a really good LDAP connector.
All we need is to set up the resource to use that connector:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>LDAP<span class="tag">&lt;/name&gt;</span>

    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectorType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;filter&gt;</span>
            <span class="tag">&lt;q:text&gt;</span>connectorType = &quot;com.evolveum.polygon.connector.ldap.LdapConnector&quot;<span class="tag">&lt;/q:text&gt;</span>
        <span class="tag">&lt;/filter&gt;</span>
    <span class="tag">&lt;/connectorRef&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>What we can see here is a slightly more sophisticated method to reference the connector.
So far we have seen only a direct connector reference by OID.
This works well for almost all the references in midPoint, because OID never changes.
However, connectors are somehow elusive objects.
Objects that represent connectors are dynamically created by midPoint when a connector is discovered.
Therefore, the OID is generated at random when midPoint discovers new connector.
There is no practical way for a system administrator to predict that OID.
Yet, we still want our resource definitions to refer to a particular connector when we import the definition.
Therefore, there is an alternative way to specify object references.
This method is using a <em>search filter</em> instead of direct OID reference.
When this resource definition is imported to midPoint, midPoint uses that filter and looks for LDAP connector.
If that connector is found, then the OID of that connector is placed in the reference (<code>connectorRef</code>).
Therefore, the next time midPoint is using this resource, it can follow the OID directly.
This is a very convenient method.
However, there are few limitations.
Firstly, the filter is resolved only during import of the resource definition object.
Which means that it is resolved only once.
If the connector is not present at import time, then the reference needs to be corrected manually.
Secondly, this approach works if there is only one LDAP connector deployed to midPoint.
This is usually the case.
However, the connector framework can contain several connectors of the same type in different versions.
This is a very useful feature for gradual connector upgrades, testing of new connector versions and so on.
Yet, in case that the filter matches more than one object, the import will fail.
In that case the connector reference has to be set up manually.
However, this method of connector references is very useful in practice, and it is used all the time.</p>
</div>
<div class="paragraph">
<p>Once we have proper reference to LDAP connector we need to configure the connection:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    ...
    <span class="tag">&lt;connectorConfiguration&gt;</span>
        <span class="tag">&lt;icfc:configurationProperties&gt;</span>
            <span class="tag">&lt;cc:port&gt;</span>389<span class="tag">&lt;/cc:port&gt;</span>
            <span class="tag">&lt;cc:host&gt;</span>localhost<span class="tag">&lt;/cc:host&gt;</span>
            <span class="tag">&lt;cc:baseContext&gt;</span>dc=example,dc=com<span class="tag">&lt;/cc:baseContext&gt;</span>
            <span class="tag">&lt;cc:bindDn&gt;</span>cn=idm,ou=Administrators,dc=example,dc=com<span class="tag">&lt;/cc:bindDn&gt;</span>
            <span class="tag">&lt;cc:bindPassword&gt;</span><span class="tag">&lt;t:clearValue&gt;</span>secret<span class="tag">&lt;/t:clearValue&gt;</span><span class="tag">&lt;/cc:bindPassword&gt;</span>
            ...
        <span class="tag">&lt;/icfc:configurationProperties&gt;</span>
    <span class="tag">&lt;/connectorConfiguration&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all very similar to the configuration of the other resource that were already presented in this book.
It should be quite self-explanatory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The XML example above, as all other examples in this book, is simplified and shortened for clarity.
You will not be able to import the example in this form into midPoint.
For a full importable examples see the files that are supposed to accompany this book.
Please see <a href="#92-additional-information">Additional Information</a> chapter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The basic resource configuration above is sufficient to connect to the resource.
Therefore, the test connection operation on resource details page should be successful.
However, LDAP servers support many object classes and midPoint does not yet know which object class represents account.
Therefore, we need to add schema handling section to our resource:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    ...
     <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>Normal Account<span class="tag">&lt;/displayName&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>inetOrgPerson<span class="tag">&lt;/objectClass&gt;</span>
                <span class="tag">&lt;auxiliaryObjectClass&gt;</span>midPointPerson<span class="tag">&lt;/auxiliaryObjectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is pretty much the standard definition as we have already seen.
However, there is one new aspect: <code>midPointPerson</code> auxiliary object class.
This is an additional LDAP object class which is going to be applied to all object that midPoint eventually creates.
It is not important for synchronization at this stage, yet we are going to set it up now, so we have a complete working configuration.</p>
</div>
<div class="paragraph">
<p>We continue with setting up mappings for the attributes:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>dn<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Distinguished Name<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;limitations&gt;</span>
                    <span class="tag">&lt;minOccurs&gt;</span>0<span class="tag">&lt;/minOccurs&gt;</span>
                    <span class="tag">&lt;maxOccurs&gt;</span>1<span class="tag">&lt;/maxOccurs&gt;</span>
                <span class="tag">&lt;/limitations&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    <span class="tag">&lt;source&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/name<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/source&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;script&gt;</span>
<span class="inline">                            <span class="tag">&lt;code&gt;</span>
                                basic.composeDnWithSuffix('uid', name,
                                        'ou=people,dc=example,dc=com')
                            <span class="tag">&lt;/code&gt;</span></span>
                        <span class="tag">&lt;/script&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                <span class="tag">&lt;/outbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>There should be outbound mapping for each mandatory LDAP attribute for the <code>inetOrgPerson</code> object class.
Such mappings are very typical for a target resource definition.</p>
</div>
<div class="paragraph">
<p>Once we set up the schema handling, we should be able to conveniently list LDAP accounts in midPoint.
However, we need to click on the <b class="button">Reload</b> button.
The accounts are stored in the LDAP server and midPoint can access them.
However, midPoint have not processed the accounts yet.
Therefore, there are no account shadows in midPoint repository yet.
Click on the <b class="button">Reload</b> button initiate reading of accounts from the LDAP server.</p>
</div>
<div class="paragraph">
<p>We are going to import (or reconcile) the resource accounts.
However, if we try to do this now, nothing would really happen.
The accounts are not linked to users, therefore midPoint would not synchronize the attributes.
MidPoint was not told to do anything with the accounts, therefore midPoint does nothing.
That is one of midPoint principles: midPoint does not change the accounts in any way unless it is explicitly told to do so.
We would rather do nothing than to destroy the data.</p>
</div>
<div class="paragraph">
<p>Before we can import the accounts, we need to set up the synchronization configuration for this resource.
There are accounts in the LDAP server that should belong to users that already exist in midPoint.
We want to link them.
However, we do not want to do the linking manually.
We would rather set up a <em>correlation</em> mechanism that does this automatically.
We would like to use LDAP attribute <code>employeeNumber</code> to correlate accounts.</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>employeeNumber<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Employee Number<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;correlator</span><span class="tag">/&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    ...
                <span class="tag">&lt;/outbound&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/personalNumber<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                    <span class="tag">&lt;evaluationPhases&gt;</span>
                        <span class="tag">&lt;include&gt;</span>beforeCorrelation<span class="tag">&lt;/include&gt;</span>
                        <span class="tag">&lt;exclude&gt;</span>clockwork<span class="tag">&lt;/exclude&gt;</span>
                    <span class="tag">&lt;/evaluationPhases&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>employeeNumber</code> attribute is configured as <em>correlator</em> by using the <code>correlator</code> configuration element.
The <code>employeeNumber</code> attribute is mapped to <code>personalNumber</code> user property, therefore midPoint knows that values of <code>employeeNumber</code> attribute are to be compared with values of <code>personalNumber</code>.
When midPoint encounters an LDAP account, it takes value of <code>employeeNumber</code> attribute, transforms it using the <em>inbound</em> mapping defined above, and looks for matching value of <code>personalNumber</code> among all the users.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Inbound mapping and evaluation phases</div>
<em>Inbound</em> mapping is necessary at this point, even though the LDAP resource is a <em>target</em> resource.
The <em>inbound</em> mapping is used to transform the value for correlation purposes.
Its responsibility is to transform the value of <code>employeeNumber</code> account attribute to the same format as is used by <code>personalNumber</code> user property.
In this case the format is the same, therefore no transformation is used (<code>asIs</code> expression is assumed).
The <code>evaluationPhases</code> configuration limits application of this mapping to <em>correlation</em> only.
It excludes <em>clockwork</em> phase, which is a main synchronization phase.
Therefore, the mapping will be used for correlation, but it will not be used for other parts of synchronization process.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If correlation values match, then we assume that the account should be <em>linked</em> to the user.
In that case midPoint decides that synchronization situation is <code>unlinked</code> (they should be linked, but they are not yet linked).
We want midPoint to link the account in this case, therefore we define appropriate reaction:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">                ...
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>unlinked<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;link</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                ...</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Unliked</em> accounts get <em>linked</em>.
This takes care of accounts for whose we can automatically find an owner by using correlation mechanism.
What we should do with other accounts?
We will do nothing about them just yet.
Therefore, we do not need to define any other reactions.
This may be somehow surprising.
We do not want illegal accounts in our LDAP server, do we?
Then perhaps we would like to see a reaction to delete <em>unmatched</em> accounts, right?
That would be a good approach, but it is just too early for this.
We do not want to delete unmatched account just now.
There may be accounts that are perfectly legal, just the <code>employeeNumber</code> attribute is missing or mistyped.
Data errors like those happen all the time, especially when the data were managed manually.
We do not want to over-react and start deleting accounts too early.
Therefore, we go just with this one synchronization reaction for now.</p>
</div>
<div class="paragraph">
<p>Now it is the right time to start import or reconciliation task for LDAP resource.
After the task is finished the situation may look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-04-reconciliation-ldap-unmatched.png" alt="OpenLDAP accounts">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For the curious readers, the LDAP server has data equivalent to the content of <code>ldap-real.ldif</code> file located in book samples.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It looks like we have quite a good data in the LDAP server.
Most of the accounts were successfully correlated and linked to their owners.
Yet, there are few accounts that were not correlated.
Those accounts ended up in <em>unmatched</em> situation.
You can resolve this situation by manually linking the unmatched accounts to their users.
Simply click on the small triangle button next to the unmatched entry and select <b class="menuref">Change owner</b> from the context menu.
Then select the right user (<code>Isabella Irvine</code>) in the dialog that appears.
After that the account is linked to the user.
Repeat this process to link all unmatched accounts.</p>
</div>
<div class="paragraph">
<p>There is one interesting thing in the screenshot above.
Have a look at the LDAP account identified by <code>uid=carol</code>.
While most other accounts have their <code>uid</code> value taken from the surname of the user, this account is an exception.
Even though the <code>uid</code> value is obviously wrong, midPoint have linked the account to the correct user (<code>Carol Cooper</code>).
The reason is that we have set up midPoint to use <code>employeeNumber</code> for correlation.
Even accounts whose usernames violate the convention can be automatically linked to their owners - as long as there is any reliable piece of information that can be used for correlation.</p>
</div>
<div class="paragraph">
<p>Search panel on top of account list can be used to make manual linking faster.
The <b class="button">Situation</b> search control can be used to select accounts that are in <code>Unmatched</code> situation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-05-reconciliation-ldap-unmatched-filter.png" alt="Looking for unmatched accounts">
</div>
</div>
<div class="paragraph">
<p>We can quickly handle the obvious unmatched accounts, and link them manually.
When all the accounts are linked to their owners, we end up with two accounts that do not have owners: <code>john</code> and <code>oscar</code>.
In identity management parlance, these are called <em>orphaned accounts</em>.
While having a closer look at the accounts, these two accounts obviously belong to former employee.
John and Oscar do not work for ExAmPLE company for several years.
While John&#8217;s account is <em>disabled</em> at the very least, Oscar&#8217;s account is still active.
What a <em>deprovisioning disaster</em> this is!
We have illegal account here, still active, still accessible by an employee that might not be entirely happy to be laid off.
Quite obviously, we have to do something about it.</p>
</div>
<div class="paragraph">
<p>This is the right time to complete the synchronization policy.
Once the correlation is complete and all accounts have an owner, detecting an <em>unmatched</em> account means that an illegal account is created in LDAP server.
Now we can tell midPoint to <em>delete</em> any <em>unmatched</em> accounts.</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">                ...
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>unmatched<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;deleteResourceObject</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When reconciliation task is completed, all orphaned accounts are gone.
We have reduced our security risks, which is one of the primary reasons for having identity management system in the first place.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Disable orphaned accounts</div>
<div class="paragraph">
<p>Clever reader is not entirely persuaded at this point.
Outright deletion of orphaned account might look nice in security policy documents, yet it looks just too aggressive for practical use.
Clever reader is, as always, quite right.
We really want to react to orphaned accounts as soon as possible to reduce any security risks, which means we want to react automatically.
However, it is much better to just <em>disable</em> the account instead of deleting it.
Some orphaned accounts may have benign reasons.
The account might have been created by LDAP administrator, because the HR system is temporarily broken and business must go on.
Detection of orphaned account may also be a false positive, caused by miscofiguration of midPoint correlation mechanism, or simple caused by wrong HR data.
Re-enabling the account is much less work than re-creating the account, especially if there were already some data stored in the account.
Even if orphaned account is detected correctly, we still may want to keep it for a while.
It may provide good material (and evidence) for investigation of possible security incident.</p>
</div>
<div class="paragraph">
<p>Fortunately, it is easy to reconfigure midPoint to disable the account instead of deleting it.
All that is needed is to change the action from <code>deleteResourceObject</code> to <code>inactivateResourceObject</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We have our accounts partially cleaned up now.
All accounts are linked to owners and orphaned accounts are gone.
However, there may be some accounts in the LDAP server that have wrong attribute values.
By "wrong" we mean that the attributes have different values than the values that are computed by the outbound mappings.
However, midPoint is not correcting those values just yet.
Remember the midPoint principle that it does not change the account unless we have explicitly told to do so?
Those accounts are in the <code>linked</code> situation, and we have not configured any reaction for this situation.
Therefore, midPoint did nothing.
Now we need to tell midPoint to synchronize the values:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">                ...
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>linked<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;synchronize</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>A clever readers is now surely wondering whether we have forgotten something.
We have, indeed.
Attribute values are synchronized by running reconciliation process.
However, our outbound mappings will not work in reconciliation.
They do not have any explicit definition of <em>strength</em>, therefore midPoint assumes <code>normal</code> strength.
Those mappings are supposed to implement the <em>last change wins</em> strategy.
Therefore, reconciliation cannot overwrite the account data, as midPoint does not know whether it was account attribute or user property that was the last to change.
If midPoint is not sure about something, then it assumes a conservative position and does nothing.
We do not want to destroy the data.
Therefore, what we need to do now is to let midPoint know that we really mean it, that the mappings are really <code>strong</code>:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>cn<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Common Name<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;limitations&gt;</span>
                    <span class="tag">&lt;minOccurs&gt;</span>0<span class="tag">&lt;/minOccurs&gt;</span>
                    <span class="tag">&lt;maxOccurs&gt;</span>1<span class="tag">&lt;/maxOccurs&gt;</span>
                <span class="tag">&lt;/limitations&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    <span class="tag">&lt;strength&gt;</span>strong<span class="tag">&lt;/strength&gt;</span>
                    <span class="tag">&lt;source&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/fullName<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/source&gt;</span>
                <span class="tag">&lt;/outbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Clever reader is uneasy once again.
What is this <code>limitations</code> thing here?
Simply speaking, the limitations specify that the attribute is optional (<code>minOccurs=0</code>) and that it is single-valued (<code>maxOccurs=1</code>).
However, isn’t midPoint supposed to be completely schema-aware and figure that all by itself?
Yes, it is, and midPoint does it all right.
In fact, that is the reason why we need to override the information from the schema using this <code>limitations</code> element here.
The <code>cn</code> attribute is specified in LDAP schema as a mandatory attribute.
However, we have just specified outbound mapping for that attribute.
Even if no value for attribute <code>cn</code> is entered in midPoint user interface, we can still determine that value by using the expression.
Therefore, even though LDAP schema specifies attribute <code>cn</code> as mandatory, we want to present that attribute as optional in midPoint user interface.
Hence the <code>minOccurs</code> limitation.
The <code>maxOccurs</code> limitation is immediately obvious to anyone who is intimately familiar with LDAP peculiarities.
In the LDAP world, almost everything is multi-valued by default.
Even commonly used attributes for account identifiers and names are multi-valued.
Nobody is really using them as multi-valued attributes, because vast majority of applications will probably explode if they ever encounter two values in the <code>cn</code> attribute.
Yet, those attributes are formally defined as multi-valued in LDAP schema, and that is what midPoint gets from LDAP connector.
The <code>maxOccurs</code> limitation is overriding the schema, and forcing midPoint to handle this attribute as if it was single-value attribute.</p>
</div>
<div class="paragraph">
<p>The last thing that we need at this point is to handle <em>activation</em>.
We need a very simple mapping for that:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;activation&gt;</span>
                <span class="tag">&lt;administrativeStatus&gt;</span>
                    <span class="tag">&lt;outbound</span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/administrativeStatus&gt;</span>
            <span class="tag">&lt;/activation&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mapping is entirely empty (<code>&lt;outbound/&gt;</code>), as it completely relies on default settings.
Source is default (<code>$focus/activation/effectiveStatus</code>), target is default (<code>activation/administrativeStatus</code> of account),
also the expression is default (<code>asIs</code>).
All midPoint needs to know is that we want such mapping at all.</p>
</div>
<div class="paragraph">
<p>However, there is one more detail to set up.
As LDAP does not have any standard reasonable account disable mechanism, we have to tell midPoint which method are we using for this particular case.
We do that using configured capability, as we have already seen before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    <span class="tag">&lt;capabilities&gt;</span>
        <span class="tag">&lt;configured&gt;</span>
            <span class="tag">&lt;cap:activation&gt;</span>
                <span class="tag">&lt;cap:status&gt;</span>
                    <span class="tag">&lt;cap:attribute&gt;</span>ri:midPointAccountStatus<span class="tag">&lt;/cap:attribute&gt;</span>
                    <span class="tag">&lt;cap:enableValue&gt;</span><span class="tag">&lt;/cap:enableValue&gt;</span>
                    <span class="tag">&lt;cap:enableValue&gt;</span>enabled<span class="tag">&lt;/cap:enableValue&gt;</span>
                    <span class="tag">&lt;cap:disableValue&gt;</span>disabled<span class="tag">&lt;/cap:disableValue&gt;</span>
                <span class="tag">&lt;/cap:status&gt;</span>
            <span class="tag">&lt;/cap:activation&gt;</span>
        <span class="tag">&lt;/configured&gt;</span>
    <span class="tag">&lt;/capabilities&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>From this point on we can keep reconciliation task running periodically by setting task schedule.
Our synchronization policies are in good shape, ready to be continually enforced.
Periodic reconciliation runs keeps account attributes updated.
Even more importantly, it keeps us protected from serious security risk posed by orphaned accounts.</p>
</div>
<div class="paragraph">
<p>That is all.
Now you can schedule reconciliation tasks to keep an eye on the LDAP server.
The task corrects any attribute values that step out of line and deletes any illegal accounts.
This is how synchronization tasks can be useful, even in case of pure target resources.</p>
</div>
<div class="paragraph">
<p>However, there is one last word of warning.
Those accounts were synchronized and linked to existing midPoint users.
The accounts were not created by midPoint.
Therefore, there is nothing in midPoint that would say that those accounts <em>should</em> exist.
In midPoint parlance, there are no <em>assignments</em> for those accounts.
MidPoint makes clear distinction between <em>policy</em> and <em>reality</em>.
Therefore, midPoint is aware that those accounts <em>exist</em>, but there is no policy statement that would justify their existence.
By default, midPoint does nothing, and it lets the accounts live.
The accounts are created or deleted only if there is an explicit change in the assignments.
There is no such change now, therefore the accounts are not deleted.
However, this is quite a fragile situation.
Accounts that are linked but not assigned can easily get deleted if midPoint administrator is not careful.
Of course, there are methods to handle such situations.
One way would be to create the assignments together with the links.
Those that are interested in this method should look up keyword "legalize" in midPoint docs.
However, there are much better methods to handle such situations.
Perhaps the best approach would be to utilize the roles (RBAC).
This is the topic of the <a href="#07-rbac">Role-Based Access Control</a> chapter later.
Yet, there are still more things to learn about synchronization until we get there.</p>
</div>
</div>
<div class="sect2">
<h3 id="_peculiarities_of_reconciliation">Peculiarities of Reconciliation</h3>
<div class="paragraph">
<p>Reconciliation is a process of comparing current state of an account (<em>reality</em>) to a desired state of the account (<em>policy</em>).
Reconciliation does not only compare the accounts, it is actively <em>correcting</em> the inconsistencies.
Reconciliation can correct wrong data on resources (<em>outbound</em> direction).
Yet, it also works the other way.
It can correct the data in midPoint (<em>inbound</em> direction).
Therefore, reconciliation is one of the most useful tools in the identity management toolbox.</p>
</div>
<div class="paragraph">
<p>Reconciliation can be used in a variety of ways.
Reconciliation can be initiated for one specific user by using midPoint user interface.
In that case, midPoint compares the values of all user’s accounts to the values that were computed using the mappings.
If there are differences, midPoint corrects account values.
This approach is perfect for testing reconciliation setting using just a single user.
This feature is also useful for fixing values of one specific user.</p>
</div>
<div class="paragraph">
<p>Reconciliation of a specific user may be useful, but it is an ad-hoc approach.
We usually favor systemic approaches in identity management.
Therefore, reconciliation is usually used in a form of a reconciliation <em>task</em>.
Reconciliation task lists all the accounts on the resource, and then it reconciles each account, one by one.
This is a way to keep <em>all</em> resource accounts continuously synchronized.</p>
</div>
<div class="paragraph">
<p>There is a couple of things regarding reconciliation that can be somehow surprising.
Firstly, reconciliation of an <em>account</em> may cause modification of a <em>user</em>.
This happens if there are <em>inbound</em> mappings for that account.
This is perhaps quite expected.
However, the operation does not stop there.
If a <em>user</em> is changed, then such change may propagate to other <em>accounts</em> on other resources, usually by the means of <em>outbound</em> mappings.
MidPoint does not like procrastination, therefore it will try to apply all the changes immediately.
It means that reconciliation of one <em>account</em> may cause changes to other <em>accounts</em>.
Which makes a lot of sense, yet it may be quite surprising.
Secondly, reconciliation skips all <em>normal-strength</em> mappings.
We have already explained the reasons for that, but this is something that can surprise even an experienced midPoint engineer from time to time.
If we are sure that we want the mapped value to be present in the account all the time, then <em>strong</em> mappings are the way to go.</p>
</div>
<div class="paragraph">
<p>A curious reader that has already explored midPoint user interface has surely noticed <em>recompute</em> function.
To the untrained eye, <em>recompute</em> looks almost exactly the same as <em>reconciliation</em>.
However, there are subtle differences.
Firstly, recompute does not force fetching of account data.
When <em>recomputing</em>, fresh account attributes are not retrieved from the resource, unless midPoint inevitably needs them for the computation.
This usually happens if <code>weak</code> or <code>strong</code> mappings are used, in that case the attribute values <em>are</em> retrieved.
However, if there are <code>normal</code> mappings only, then recompute may skip retrieval of fresh account data.
MidPoint compares and corrects account attribute values only for those accounts that are retrieved from resource during this process.
That is how recompute works.
Correcting <em>account</em> data is more or less just a side effect of recompute.
The purpose of <em>recompute</em> is to correct data of midPoint <em>users</em>, which means evaluation of object templates and other internal policies.</p>
</div>
<div class="paragraph">
<p>On the other hand, <em>reconciliation</em> always tries to read all the accounts regardless whether they are needed for computation or not.
Therefore, all the attributes on all the accounts are corrected.
That is the purpose of reconciliation: correct the <em>account</em> data.</p>
</div>
<div class="paragraph">
<p>There is yet another difference between recompute and reconcile <em>tasks</em>.
The purpose of <em>recompute</em> task is to correct user data.
Therefore, recompute task iterates over midPoint <em>users</em>.
Recompute task does not detect new accounts on the resource, and it may even overlook if an account is deleted.
However, <em>reconciliation</em> task is different.
In fact, reconciliation task has several stages.
Main reconciliation stage lists all resource <em>accounts</em>.
It determines owner of each account, compares the attributes and corrects them.
As this process iterates over real accounts on a resource, it can easily detect new accounts.
When the main stage is completed, the next phase looks at account <em>shadows</em> stored in midPoint.
The task looks for shadows that have not been processed in the main phase.
Those are accounts that used to be on the resource some time ago, but have disappeared since.
That is how reconciliation detects deleted accounts.</p>
</div>
<div class="paragraph">
<p>Rule of the thumb for the <em>reconciliation</em> versus <em>recompute</em> dilemma is this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <em>recompute</em> if you want to update <em>users</em>.
For example, use recompute after change of object templates, policy rules or role definitions to apply the changes to all users.
Recompute is usually initiated manually, on <em>as needed</em> basis.</p>
</li>
<li>
<p>Use <em>reconciliation</em> to keep <em>accounts</em> synchronized.
For example, run periodic reconciliation task to make sure accounts in your LDAP servers are up-to-date.
Reconciliation is usually <em>scheduled</em> at regular intervals, to continually maintain data consistency.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_usernames">Usernames</h3>
<div class="paragraph">
<p>Usernames take many forms.
Some people like usernames based on first names (<code>john</code>), others prefer last names (<code>smith</code>), many practical solutions end up using a combination of both (<code>jsmith</code>).
Some organizations prefer immutable identifiers, such as employee numbers (<code>1458363</code>), which is not entirely favored by users.
We will discuss that later, in <a href="#09-focus-processing">Focus Processing</a> chapter.
Whatever username convention we are going to choose, we have a problem in our current ExAmPLE midPoint deployment: midPoint has usernames based on employee numbers (<code>001</code>), while LDAP has usernames based on names (<code>anderson</code>).
We should use one or the other, not both of them at the same time.</p>
</div>
<div class="paragraph">
<p>Clean, simple and systematic solution would be to force usernames based on employee numbers from midPoint to LDAP.
This is very simple to do, all we need is to change strength of <code>dn</code> mapping from <code>weak</code> to <code>strong</code>.
Next reconciliation run would change all the usernames in LDAP to match values of user <code>name</code> property in midPoint.
However, this may not be entirely desirable.
This process changes all usernames in the LDAP directory, changing their usernames (<code>uid</code>), but also distinguished names (<code>dn</code>) in the directory.
There are usually other applications connected to the directory, as that is the reasons for directories to exist.
Application accounts are almost always bound to either <code>uid</code> or <code>dn</code> in LDAP directory.
Strictly speaking, there is immutable <code>entryUUID</code> attribute in OpenLDAP directory, which is almost ideal for account binding.
Of course, almost no application is using <code>entryUUID</code>, they all rely on <code>uid</code> or <code>dn</code>.
If <code>uid</code> and <code>dn</code> are changed, account bindings in applications may be lost.
Users may lose their settings, preferences, user profiles, access to data and home directories - and they are not going to like that.
Not to mention the simple fact, that they are not going to like the new numeric usernames in the first place.</p>
</div>
<div class="paragraph">
<p>It may be a much better idea to keep existing LDAP usernames, and change usernames in midPoint to match them.
Fortunately, this is also very easy to do.
All we need is one <em>inbound</em> mapping:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>uid<span class="tag">&lt;/ref&gt;</span>
                ...
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;strength&gt;</span>strong<span class="tag">&lt;/strength&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>name<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
                ...
            <span class="tag">&lt;/attribute&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once reconciliation run is completed, LDAP usernames are applied to midPoint users.
Users have user-friendly (although slightly non-consistent) usernames now.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-06-users-nice-usernames.png" alt="Users with nice usernames">
</div>
</div>
<div class="paragraph">
<p>It is a good idea to remove the inbound mapping after midPoint usernames are corrected.
We do not need it any more, and it can be quite confusing or even harmful in the long run.
We probably want to <em>generate</em> usernames in a systematic and consistent way from now on, which will be described in <a href="#09-focus-processing">Focus Processing</a> chapter.</p>
</div>
<div class="paragraph">
<p>It is also a good idea to disable inbound mapping from <code>empno</code> attribute to user&#8217;s <code>name</code> in the HR resource.
If we would leave this mapping active, it can ruin our usernames by replacing them with employee numbers from HR system.
Even worse, as we have configured outbound mappings to LDAP directory, change of user&#8217;s <code>name</code> is reflected to LDAP <code>uid</code> attribute, effectively renaming all LDAP accounts.
We definitely do not want that!
Disabling the inbound HR mapping leaves us in a situation in which there is no mapping for user&#8217;s <code>name</code> at all.
This means creation of new midPoint user from new HR record is going to fail.
We have to live with that now, as we are not going to risk destruction of all our usernames.
We will fix that later, when we learn how to generate proper usernames.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deltas">Deltas</h3>
<div class="paragraph">
<p>Reconciliation is really useful mechanism.
It is reliable and thorough.
However, it is also quite slow, and it consumes o lot of computational and network resources.
There are good reasons why reconciliation is such a heavyweight beast.
Reconciliation works with <em>absolute</em> state of accounts.
It means that reconciliation is reading <em>all</em> the accounts with <em>all</em> the values of <em>all</em> relevant attributes.
Then it recomputes <em>everything</em>.
Even the attributes and values that were not changed are recomputed.
This is a very reliable way of computation, and it is also the method used by the majority of traditional identity management systems.</p>
</div>
<div class="paragraph">
<p>Yet, there is also a better way.
If we know that just one attribute was changed, we can recompute that single attribute only.
We do not need to care about other attributes.
Moreover, if we know that attribute <code>foo</code> has changed in such a way, that there is a new value <code>bar</code>, then it gets even better.
We just need to recompute the value <code>bar</code>, and we need not care about any other values.
This is what we like to call a <em>relative change</em>.
We care just about the values that were <em>changed</em>.
That is how midPoint works internally.
We could say that MidPoint is <em>relativistic</em> system.</p>
</div>
<div class="paragraph">
<p>This is where <em>delta</em> comes in.
Delta is a data structure that describes the <em>change</em> of a single midPoint object.
<em>Add delta</em> describes a new midPoint object that is about to be <em>created</em>.
<em>Modify delta</em> describes existing midPoint object where some properties have <em>changed</em>.
<em>Delete delta</em> describes an object that is going to be <em>deleted</em>.</p>
</div>
<div class="paragraph">
<p>This is a very powerful mechanism.
Just remember that everything in midPoint can be represented as an object: user, account, resource, role, security policy &#8230;&#8203; everything.
Therefore, delta can represent any change in midPoint.
It may be a change of user password, deletion of an account, change of connector configuration or introduction of a new policy rule.
If all the changes can be represented in a uniform way, then they can also be handled in a uniform way.
Therefore, it is easy for midPoint to record all the changes in an <em>audit trail</em> – including configuration changes.
It is easy to route any change through an approval process.
And so on.
MidPoint can create a relatively simple mechanisms to handle changes, and then those mechanisms can be applied to any change of (almost) any object.</p>
</div>
<div class="paragraph">
<p>Let’s have a closer look at an anatomy of a delta.
There are three types of delta: <em>add</em>, <em>modify</em> and <em>delete</em>.
<em>Add delta</em> is quite simple.
It contains a new object to be created.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-07-delta-add.png" alt="Add delta">
</div>
</div>
<div class="paragraph">
<p><em>Delete delta</em> is even simpler.
It contains just object identifier (OID) of an object to be deleted.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-08-delta-delete.png" alt="Delete delta">
</div>
</div>
<div class="paragraph">
<p>Last one is <em>modify delta</em>.
This delta contains a description of modified properties of an existing object.
As the object can change in a variety of ways, modify delta is the most complex of the three.
Modify delta contains a list of <em>item deltas</em>.
Each item delta describes how a particular part of an object changes.
For example, following delta describes that a new value <code>pirate</code> is added to a user property <code>employeeType</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-09-delta-modify-add.png" alt="Modify delta: add">
</div>
</div>
<div class="paragraph">
<p>The item delta may have three modification types: <em>add</em>, <em>delete</em> and <em>replace</em>.
<em>Add modification</em> means that new value or values are added to an item.
<em>Delete modification</em> means that value or values are removed from an item.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-10-delta-modify-delete.png" alt="Modify delta: delete">
</div>
</div>
<div class="paragraph">
<p>In both <em>add</em> and <em>delete</em> cases, the values that are not mentioned in the delta are not affected.
They remain unchanged as they are.
However, <em>replace</em> modification is different.
This means that all existing values of the item are going to be discarded, and they are replaced with the value or values from the delta.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/05-11-delta-modify-replace.png" alt="Modify delta: replace">
</div>
</div>
<div class="paragraph">
<p>The deltas are designed to work with both single-valued and multi-valued items.
In fact, <em>add modification</em> and <em>delete modification</em> deltas are specifically designed with multi-value items in mind.
Those deltas can work efficiently even in cases that there is a multi-valued attribute that has a very large number of values.
There is a good reason for this.
Multi-valued properties are quite common in the identity management field.
Just think about how roles, groups, privileges and access control lists are usually implemented.
Everyone who ever managed a large group in LDAP server certainly remembers that experience in vivid colors.
Fortunately, midPoint is designed to handle situations like these.</p>
</div>
<div class="paragraph">
<p>Everything in midPoint is designed to work with deltas: user interface, mappings, authorizations, auditing &#8230;&#8203; all the way down to the low-level data storage components.
Mappings work in a relativistic ways.
That is one of the reasons why we need to explicitly specify <em>sources</em> of the mapping.
Mapping source definitions are matched with items in the <em>delta</em> to control execution of the mapping.
Deltas permeate entire midPoint computation.
Deltas are input to the mappings, and mapping produce other deltas as output.
Therefore, we can have a complete chain: deltas that are result of inbound mappings is applied to the user object, but those deltas are also input to outbound mappings.
Everything is <em>relativistic</em> in midPoint.</p>
</div>
<div class="paragraph">
<p>This might seem to be a bit over-complicated at the beginning.
But do not worry.
You will get used to it.
Clearly, this approach has major advantages.</p>
</div>
<div class="paragraph">
<p>However, a clever reader does not seem to be impressed.
How can this relativistic approach conserve any significant portion of computational resources?
We usually fetch the entire account from the resource anyway.
Therefore, there is no harm to recompute all the attributes.
The <em>computation</em> itself is fast, it is the <em>fetch</em> operation that is slow.
Isn’t it?
The clever reader is, of course, right - or rather partially right at the very least.
Most resources indeed fetch all the account attributes in a single efficient operation.
For those cases, there is no big increase in efficiency if we go with the relativistic methods.
However, there are exceptions.
For example, some resources does not return all the values of big attributes, e.g. all the members of a large group.
Additional requests are needed to fetch all the values – and there may be a lot of requests if the group is really large.
Relativistic approach has significant benefit in those cases.
The benefits will be even more obvious when we get to the live synchronization in the next section.
Yet, performance is not the primary motivation for the relativistic approach.
There is one extremely strong reason to be relativistic: <em>data consistency</em>.
Consistency is something that brings ugly nightmares to many engineers who try to design distributed system.
Identity management solution <em>is</em> a distributed system, managing data in many independent applications and databases.
It is also a very <em>loosely-coupled</em> distributed system.
There is no support for locking or transactions in the connectors.
Even if there was some support, the vast majority of resource cannot provide those consistency mechanisms on their identity management APIs.
This means that midPoint cannot rely on traditional data consistency mechanisms.
MidPoint cannot make sure that the data are not changed during computation or between computations.
That is why <em>relativistic</em> approach is so useful.
Relativistic computation has a very high probability of achieving correct result even without locking or transactions.
This is more than acceptable for typical identity management deployments.
For those rare cases where relativistic computation can fluctuate, there is always <em>reconciliation</em> as a last resort.
Yet, thanks to the relativistic nature of midPoint, the need for reconciliation is significantly reduced.</p>
</div>
<div class="paragraph">
<p>That was a lot of long words, but clever reader seems to be satisfied now.
At least for a while.
For the readers that are still scratching their heads, there is quite a simple summary: relativistic approach of midPoint can do miracles.
For example, midPoint resource can be both sources and targets, even a single attribute can be both source and target of information.
It is the relativistic approach that enables configurations like this.
The principle of relativity is relatively simple.
Yet, its effect in midPoint is nothing short of being revolutionary.</p>
</div>
</div>
<div class="sect2">
<h3 id="_live_synchronization">Live Synchronization</h3>
<div class="paragraph">
<p>MidPoint has a range of synchronization mechanisms.
Slow, brutal but reliable <em>reconciliation</em> is at one end.
<em>Live synchronization</em> is on the other.
Live synchronization is a lightweight mechanism that can provide almost-real-time synchronization capabilities.
Live synchronization is looking for <em>recent changes</em> on a resource.
When such changes are detected, live synchronization mechanisms process those changes immediately.
The synchronization delay is usually in order of seconds or minutes, provided live synchronization is used properly.
Unlike reconciliation, live synchronization is not triggered manually.
That would make very little sense.
Live synchronization works in a long-running task, repeatedly looking for fresh changes in short time intervals.</p>
</div>
<div class="paragraph">
<p>If a resource is already configured for synchronization, then all that is needed to run live synchronization is to set up a live synchronization <em>task</em>.
MidPoint user interface can be used to do that easily.
An example of live synchronization task was provided in the <em>HR Feed</em> section above.
Live synchronization task wakes up at regular intervals.
Each time the task waves up, it invokes the connector.
Connectors capable of live synchronization have special operation that is used to get fresh changes from the resource.</p>
</div>
<div class="paragraph">
<p>The connector can support any reasonable change detection mechanism – in theory.
Yet, two mechanisms are commonly used in practice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Timestamp-based synchronization:</strong> Resource keeps track of last modification timestamp for each account.
The connector looks for all accounts that have been modified since last scan.
This is very simple and relatively efficient method.
However, it has one major limitation: it cannot detect deleted accounts.
If an account is deleted, then there is no timestamp for that account, and therefore the connector will not find it in the live synchronization scan.</p>
</li>
<li>
<p><strong>Changelog-based synchronization:</strong> Resource keeps a "log" of recent changes.
The connector is looking at the log, and it is processing all the changes that were added to the log since the last scan.
This is a very efficient and flexible method.
Yet, it is not simple.
Not many systems support it, and there are often hidden complexities.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those mechanisms are called <em>live synchronization strategies</em>, and they are further explained in following section.</p>
</div>
<div class="paragraph">
<p>All live synchronization methods need to keep the track of what changes are "recent", i.e. which changes were already processed by midPoint and which were not processed yet.
There is usually some value that needs to be remembered by midPoint: timestamp of last scan, last sequence number in the change log, serial number of last processed change and so on.
Each connector has a different value with a connector-specific meaning.
MidPoint refers to those values as "tokens".
The most recent token is stored in the live synchronization task.
That is how midPoint keeps track of processed changes.
There are (hopefully quite rare) cases when resource and midPoint token get out of alignment.
This may happen in cases such as the resource database is restored from a backup, if network time gets out of synchronization and so on.
If that happen, then deleting the token from the live synchronization task is usually all it takes to get the synchronization running again.</p>
</div>
<div class="paragraph">
<p>Live synchronization is fast and very efficient.
However, it is not entirely reliable.
MidPoint may miss some changes.
This is quite a rare situation, but it may happen.
Reconciliation can remedy the situation in such a case.
Just remember, all the synchronization mechanism share the same configuration.
It is perfectly acceptable to run live synchronization and reconciliation on the same resource at the same time.
Of course, it would be a good idea to run reconciliation less frequently than live synchronization.</p>
</div>
</div>
<div class="sect2">
<h3 id="_live_synchronization_strategies">Live Synchronization Strategies</h3>
<div class="paragraph">
<p>Live synchronization is fast and efficient - in theory.
However, as usual, the devil is in the details.
There is no one single synchronization protocol or standard that would work for all the resources.
Every system has its own way to synchronize data.
Some systems (such as LDAP servers) even have several mechanisms to choose from.
Then there are source systems that have no practical way to implement efficient synchronization.
We would refer to such methods as <em>live synchronization strategies</em>.</p>
</div>
<div class="paragraph">
<p>Synchronization strategy is configured on connector level, and the details should be, theoretically, hidden inside the connector.
MidPoint would not know and would not need to know what synchronization strategy is used.
That might work in an ideal world.
Yet, we live in a practical world, and there are many details that leak through the connector interface.</p>
</div>
<div class="paragraph">
<p>Let us use LDAP as an example.
LDAP is, theoretically, a standard.
However, the standard does not specify any synchronization mechanism.
There is experimental RFC 4533, which is not widely adopted.
Yet, synchronization capabilities are necessary, and every major LDAP server provides some synchronization mechanism.
Some mechanisms are quite good, some are not.
There is an ancient "Retro change log" mechanism, going back to Netscape/iPlanet LDAP servers originating in the 1990s.
That mechanism is still used today, in several variants.
Active Directory, in a very typical way, has its own "DirSync" synchronization mechanism.
OpenLDAP has yet another mechanism based on the access log.
There is this RFC 4533 standard, which is used so rarely, that there was no request to implement it in midPoint LDAP connector.
Then there is a catch-all synchronization mechanism that looks for recent changes based on <code>modifyTimestamp</code> attribute.</p>
</div>
<div class="paragraph">
<p>In theory, all the synchronization strategies above should be equivalent - but they are not.
For example, some variants of "Retro change log" synchronization cannot reliably detect rename operations.
There may be problems with delete operations as well, especially if coupled with rename operations.
Almost every mechanism has its quirks.
Then there is the <code>modifyTimestamp</code>, which is the most problematic of all.</p>
</div>
<div class="paragraph">
<p>Unfortunately, it is quite common practice to use a synchronization strategy based on last modification timestamp.
Not just for LDAP, but also for database tables and other types of source systems.
This is perhaps understandable, as this is a very simple mechanism.
However, it has a lot of problems.
The obvious problems can be caused by de-synchronized time on network, although in the age of Network Time Protocol (NTP) this should not be a problem at all.
The other problem is a timestamp granularity.
If the timestamp is granular to one second, that can be a big problem.
One second is a very long time for a computer.
A lot can happen in one second.
Therefore, the connector has to include the "boundary" second to both consecutive synchronization runs, which means that the records may be processed twice.
Going for millisecond granularity makes the problem less severe, but the problem is still there.</p>
</div>
<div class="paragraph">
<p>However, the worst problem is that this strategy cannot detect deleted objects.
Deleted objects are not there anymore, they do not have last modification timestamp, therefore they will not be included the search.
This means that there must be a reconciliation process running together with live synchronization.
Wait a minute, it is usually recommended running reconciliation anyway, as a form of "safety net", isn&#8217;t it?
It is, but the difference is in the timing.
It is one thing to run reconciliation once a week to make sure that no records were missed.
Yet, it is a completely different thing to run reconciliation every hour to make sure deleted objects are properly handled.
This makes a huge difference, especially for deployments with millions of entries.
Strategies based on last modification timestamp may look like a good idea at the beginning.
However, they usually turn into a major liability in the long run.
Avoid them if you can.</p>
</div>
<div class="paragraph">
<p>The bottom line is, that synchronization strategies are not created equal.
In fact, the individual strategies tend to have vastly different characteristics.
Our advice is to learn how each synchronization strategy works, what are the limitations and when it fails.
Also, avoid the use of strategies based on last modification timestamp if there is any other viable alternative.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_3">Conclusion</h3>
<div class="paragraph">
<p>Synchronization is one of the most important mechanisms in the entire identity management field.
Primary purpose of synchronization is to get the data <em>into</em> midPoint.
That is good approach when an identity management deployment begins: feed your midPoint with data first.
Get the data from the HR system.
Correlate the data with Active Directory.
Connect all the major resources to midPoint and correlate the data again.
MidPoint does not need to make any changes at this stage.
In fact, it is perfectly good approach to make all the resource read-only at this stage.
The point is to let midPoint see the data.
Why do we need that?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We can see what is the real <em>quality</em> of the data.
Most system owners have at least some idea what data sets are there.
However, it is almost impossible to estimate data quality until the data are processed and verified.
That is exactly what midPoint can do at this stage.
This is essential information to plan data cleanup and sanitation.</p>
</li>
<li>
<p>We can learn how many accounts and account types are there.
It is perhaps quite obvious that there are <em>employee</em> accounts.
Are there also accounts for contractors, suppliers, support engineers?
Are those accounts active?
What is the naming convention?
Do system administrators use employee accounts for administration, or are they using dedicated high-privilege accounts?
This information is crucial to set up provisioning policies.</p>
</li>
<li>
<p>We can learn distribution of accounts and their entitlements.
Do all employees have accounts in Active Directory?
Are there any large user groups?
How does organizational structure influence the accounts?
This information is very useful to design a role-based access control structures and other policies.</p>
</li>
<li>
<p>We can detect some security vulnerabilities.
Are there orphaned accounts that should have been deleted long time ago?
Are there testing accounts that were left unattended after the last nighttime emergency?
Indeed, there is no security without identity management.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is a good start.
Even if this is all that you do in the first step of the deployment, it is still a major benefit.
You can get better <em>visibility</em>, and with that comes better <em>security</em>.
You have the data to analyze your environment, and plan next step of the identity management deployment.
You won&#8217;t be blind any longer.
That is extremely important.
It is indeed a capital mistake to theorize before one has data.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="06-schema">6. Schema</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
If you have built castles in the air, your work need not be lost, that is where they should be. Now put the foundations under them.
</blockquote>
<div class="attribution">
&#8212; Henry David Thoreau
</div>
</div>
<div class="paragraph">
<p>So far we have been discussing the things that influence how midPoint interacts with the outside.
Resource definitions, outbound and inbound mappings, even the roles - the primary purpose of those things is to control how data get into midPoint and out of midPoint.
Now it is time to discuss how midPoint works <em>internally</em>.</p>
</div>
<div class="paragraph">
<p>Early identity management systems were little more than smart data transformers.
They took data from data sources, modified them in some way, applied access control model such as RBAC, and then they pushed the data out.
There was very little crucial information that was stored inside the IDM system itself.
However, that was a long time ago.
The world is a different place now.
Focus of identity management field has shifted towards identity governance and high-level policies.
It is not enough to just transform the data.
Policies have to be applied.
Regulatory compliance has to be evaluated.
There are processes to follow, paperwork to do, evidence to collect, reports to compile, notifications, reviews and daily status reports.
It is perhaps no big surprise that there is a good deal of <em>management</em> in Identity Management after all.</p>
</div>
<div class="paragraph">
<p>Many of the following chapters deal with these management concepts.
However, we have to start from the basics, the very foundation of midPoint: schema.
MidPoint is built for much more that just a mere data transformation.
MidPoint is designed to <em>unify</em> the data.
Schema plays a crucial part in that ambition.</p>
</div>
<div class="sect2">
<h3 id="_midpoint_schema">MidPoint Schema</h3>
<div class="paragraph">
<p>MidPoint is designed as a schema-aware system, from the bottom to the top.
MidPoint has a <em>definition</em> for every bit of data that passes through it.
We know whether a particular piece of data is string, integer or timestamp.
We know whether it is single-valued or multi-valued.
We know whether it is optional or mandatory.
We know whether this is a sensitive piece of data that requires extra protection.
We know whether it is part of technical meta-data that we usually do not want to show by default.
We usually also know what label we should use when we are presenting the data, and how that label translates to other languages.
We know quite a lot about the data that we work with.
All the objects that midPoint works with are completely defined by the schema.
There is a schema for user, role, org, resource, system configuration and everything else.</p>
</div>
<div class="paragraph">
<p>Such awareness of the schema brings significant advantages to midPoint.
The most obvious advantage is in data presentation.
We know that we need to render a calendar selector because that particular data property is timestamp.
We know that we need to render a text field with a plus button to add values because that particular property is a multi-valued string.
We know that some fields should be disabled because those properties are read-only.
This behavior is not hard-coded in the user interface code.
Vast majority of midPoint user interface is rendered by interpreting midPoint schema.</p>
</div>
<div class="paragraph">
<p>This approach is absolutely crucial for any serious data management system to operate efficiently, doubly so for identity management.
One of the reasons is that the identity management system works with data that are retrieved from other systems (resources).
It is not realistically possible to hard-code midPoint user interface for all the various attributes that all the possible resources could have.
A different strategy is needed here, a strategy that is much more dynamic.</p>
</div>
<div class="paragraph">
<p>When midPoint connects to a new resource for the first time it attempts to retrieve <em>resource schema</em>.
The <em>resource schema</em> specifies what object classes the resource supports, which attributes the object classes have, what types are those and other details about the data model of the resource.
MidPoint transforms this <em>resource schema</em> to its own native format, and stores that in the resource definition.
This means that midPoint has the schema available anytime it is needed for dynamic interpretation.
That schema is used to display resource data in the most natural and user-friendly way.
It is also used by automatic data type conversions, which makes configuration of mappings easier.</p>
</div>
</div>
<div class="sect2">
<h3 id="_data_unification">Data Unification</h3>
<div class="paragraph">
<p>MidPoint schema is not just a nice way to describe user, role or organizational structure.
It has a much deeper meaning.
The primary purpose of a schema is integration, data translation and unification.
A clever reader would certainly remember that we have already talked about <em>star topology</em> or <em>hub-and-spoke</em> integration pattern.
MidPoint is like a hub of the wheel and all the resources connect to midPoint as spokes.
MidPoint is actively discouraging direct resource-to-resource communication.
Everything in midPoint is built for resource-to-midPoint and midPoint-to-resource communication.
MidPoint is always the center – for a very good reason.
All resource data need to be translated to and from midPoint "data language".
Thus, midPoint creates a <em>common language</em> that everybody can understand.
This is the very purpose of midPoint schema.
The schema of user, role, org and service is designed to contain properties that are often used in identity-related integration scenarios.
Therefore, an engineer who is designing a mapping is quite likely to find a suitable property in midPoint schema that is prepared to be used.</p>
</div>
<div class="paragraph">
<p>MidPoint schema forms a <em>lingua franca</em>, a common language that can be translated to various data dialects used by the resources.
Even more than that, it also provides a basic framework that can be reused for many midPoint deployments.
Therefore, an engineer starting a new deployment does not need to start on a completely green field.
The basic schema will always be there to provide a starting point.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Ever wondered why midPoint is called midPoint? Clever reader would have figured that out already.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_basic_user_schema">Basic User Schema</h3>
<div class="paragraph">
<p>When it comes to identity management field, there is one concept that is at the center of everything: concept of <em>user</em>.
User is undoubtedly the most important object in the entire midPoint schema.
Therefore, it is worth to have a closer look at how this object looks like.
This is going to be a really educative lesson, as it will explain several fundamental principles of midPoint.</p>
</div>
<div class="paragraph">
<p><em>User</em> is represented by schema datatype identified as <code>UserType</code>.
Adding the <code>Type</code> suffix to data types is a common convention in midPoint, there are <code>UserType</code>, <code>RoleType</code>, <code>OrgType</code>, <code>ResourceType</code> and so on.
This convention is partially historic, partially given by XML Schema conventions, partially a convenience to developers.
Regardless of the origins, this convention is used for all the data types in midPoint schemas.
You will get used to it eventually.</p>
</div>
<div class="paragraph">
<p><code>UserType</code> is what we call an <em>object definition</em> in midPoint parlance.
This means that <code>UserType</code> data structure specifies a complete midPoint object with all the things that any self-respecting object needs.
There is <em>object identifier</em> (OID), <em>name</em> that can be presented in different forms and languages, free-form <em>description</em> and so on.
All midPoint objects have those things.</p>
</div>
<div class="paragraph">
<p>The <code>UserType</code> data structure has many additional <em>properties</em>, <em>containers</em> and <em>references</em>.
<em>Property</em> is a primitive data item such as string, integer or a timestamp.
<em>Container</em> is a complex data structure that contains a bunch of properties or other containers.
<em>Reference</em> is a pointer to another midPoint object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Properties are primitive.
However, there may be properties that have internal structure, even quite a complex internal structure.
This is sometimes given by historic reasons.
However, there are also properties that need to be complex, e.g. properties that require localizable presentation, or properties that provide protection of data.
Indeed, this may be somehow confusing.
Even a clever reader looks puzzled now.
However, this distinction is not a big issue, for now.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Definition of <code>UserType</code> is summarized in the following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Human-readable, mutable name of the object.
It is typically a username or some kind of application-level identifier.
The value must be unique among all the users.<br>
Example: <code>jrandom</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Free-form textual description of the object.
This is meant to be displayed in the user interface.<br>
Example: <code>Random account for testing</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extension</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A container for custom schema extensions.
We will discuss that later.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Meta-data about object creation, modification, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lifecycleState</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lifecycle state of the object.
This property defines whether the object represents a draft, proposed definition, whether it is active, deprecated, and so on.<br>
Example: <code>active</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assignment</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of object&#8217;s assignments.
Assignments define the privileges, policies and "features" that this object should have, that this object is entitled to.
Typical assignment will point to a role, or define a construction of an account.<br>
Assignments represent what the object should have.
The assignments represent a <em>policy</em>, a <em>desired state</em> of things.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>linkRef</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of shadows (projections) linked to this focal object.
E.g. a set of accounts linked to a user.
This is the set of shadows that belongs to the focal object in a sense that these shadows represents the focal object on the resource.
E.g. The set of accounts that represent the same midPoint user (the same physical person, they are "analogous").<br>
Links define what the object <em>has</em>.
The links reflect <em>real state</em> of things.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>activation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type that defines activation properties.
Determines whether something is active (and working) or inactive (e.g. disabled).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jpegPhoto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Photo of a user (in a binary form).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>costCenter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name, identifier or code of the cost center to which the user belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locality</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary locality of the user, the place where the user usually works, the country, city or building that he belongs to.
The specific meaning and form of this property is deployment-specific.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>preferredLanguage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates user&#8217;s preferred language, usually for the purpose of localizing user interfaces.
The format is IETF language tag defined in BCP 47, where underscore is used as a subtag separator.
This is usually a ISO 639-1 two-letter language code optionally followed by ISO 3166-1 two-letter country code separated by underscore.<br>
Example: <code>en_US</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locale</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines user&#8217;s preference in displaying currency, dates and other items related to location and culture.
It has the same format as <code>preferredLanguage</code>.<br>
Example: <code>en_US</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timezone</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User&#8217;s preferred timezone.
It is specified in the "tz database" (a.k.a "Olson") format.<br>
Example: <code>Europe/Bratislava</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>emailAddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-Mail address of the user, org. unit, etc.
This is the address supposed to be used for communication with the user.<br>
Example: <code>random@example.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>telephoneNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary telephone number of the user.<br>
Example: <code>+421 123 456 789</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fullName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full name of the user with all the decorations, middle name initials, honorific title and any other structure that is usual in the cultural environment that the system operates in.
This element is intended to be displayed to a common user of the system.
Example: <code>James W. Random, PhD.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>givenName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Given name of the user.
It is usually the first name of the user, but the order of names may differ in various cultural environments.
This element will always contain the name that was given to the user at birth or was chosen by the user.<br>
Example: <code>James</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>familyName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Family name of the user.
It is usually the last name of the user, but the order of names may differ in various cultural environments.
This element will always contain the name that was inherited from the family or was assigned to a user by some other means.
Example: <code>Random</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>additionalName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Middle name, patronymic, matronymic or any other name of a person.
It is usually the middle component of the name, however that may be culture-dependent.
Example: <code>Walker</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nickName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Familiar or otherwise informal way to address a person.
Example: <code>Randy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>honorificPrefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Honorific titles that go before the name.
Example: <code>Sir</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>honorificSuffix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Honorific titles that go after the name.
Example: <code>PhD.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>title</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User&#8217;s title defining a work position or a primary role in the organization.
Example: <code>CEO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>personalNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unique, business-oriented identifier of the employee.
E.g. employee number, student identifier, citizen identifier, ID card number, social security number, etc.
Typically used as a correlation identifier and for auditing purposes.
Should be immutable, but the specific properties and usage are deployment-specific.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>organization</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name or (preferably) immutable identifier of organization that the user belongs to.
The format is deployment-specific.
This property together with organizationalUnit may be used to provide easy-to-use data about organizational membership of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>organizationalUnit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name or (preferably) immutable identifier of organizational unit that the user belongs to.
The format is deployment-specific.
This property together with organization may be used to provide easy-to-use data about organizational membership of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>credentials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The set of user&#8217;s credentials (such as passwords).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This is a basic outline of the schema for <code>UserType</code>.
This description is slightly simplified.
Not all the items that are defined for <code>UserType</code> are shown in the table above.
<em>Deprecated</em> items are not shown at all.
Only some <em>operational</em> properties are shown.
Some items are simplified or entirely omitted for clarity.</p>
</div>
<div class="paragraph">
<p>Following example illustrates the use of midPoint <code>UserType</code> schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;activation&gt;</span>
        <span class="tag">&lt;administrativeStatus&gt;</span>enabled<span class="tag">&lt;/administrativeStatus&gt;</span>
    <span class="tag">&lt;/activation&gt;</span>
    <span class="tag">&lt;preferredLanguage&gt;</span>en_US<span class="tag">&lt;/preferredLanguage&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aaa6cde4-0471-11e9-9b50-c743da469067</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4e73ed62-aef9-11e9-a7a8-57334ef1f991</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    <span class="tag">&lt;emailAddress&gt;</span>alice.anderson@example.com<span class="tag">&lt;/emailAddress&gt;</span>
    <span class="tag">&lt;fullName&gt;</span>Alice Anderson, PhD.<span class="tag">&lt;/fullName&gt;</span>
    <span class="tag">&lt;givenName&gt;</span>Alice<span class="tag">&lt;/givenName&gt;</span>
    <span class="tag">&lt;familyName&gt;</span>Anderson<span class="tag">&lt;/familyName&gt;</span>
    <span class="tag">&lt;honorificSuffix&gt;</span>PhD.<span class="tag">&lt;/honorificSuffix&gt;</span>
    <span class="tag">&lt;title&gt;</span>Business Analyst<span class="tag">&lt;/title&gt;</span>
    <span class="tag">&lt;personalNumber&gt;</span>001<span class="tag">&lt;/personalNumber&gt;</span>
    <span class="tag">&lt;organizationalUnit&gt;</span>10010<span class="tag">&lt;/organizationalUnit&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operational_experimental_and_deprecated_items">Operational, Experimental and Deprecated Items</h3>
<div class="paragraph">
<p>Most of the items in midPoint schema are quite ordinary and they behave as expected.
Such as the <code>fullName</code> property.
The property can be set and changed by using midPoint user interface.
However, then there are some extraordinary items.
Those are automatically determined and controlled by midPoint core engine.
Those items are essential for correct operation of midPoint.
Therefore, they are called <em>operational</em> items.
Operational items are usually not directly displayed in the user interface.
They are either completely hidden, displayed indirectly or displayed only when user chooses to display them.</p>
</div>
<div class="paragraph">
<p>MidPoint schema has grown and evolved over time, and it is still evolving.
Therefore, it is quite expected that the schema will slightly change over time.
However, we do not want to affect midPoint deployments by incompatible schema changes in every midPoint release.
Therefore, items are usually not removed from midPoint schema without a warning.
An item that we plan to remove is marked as <em>deprecated</em> first.
At that point, such item is still working as it was working before.
However, it is not displayed in the user interface, to discourage use of that item.
Deprecated items are removed in one of the subsequent midPoint releases.
This gives enough time for midPoint users to adapt to schema changes.</p>
</div>
<div class="paragraph">
<p>There is also another kind of schema evolution.
Development of most midPoint features is quick and straightforward.
Then there are features that are quite complex or features that involve some degree of exploration.
Those features cannot be implemented in a single midPoint release.
There are also features that are provided to the midPoint community as a "preview", to gather feedback for further development.
All such features are marked as <em>experimental</em>.
Those features are not officially supported, but you are free to use them at your own risk.
Most new features require extensions of midPoint schema.
This is also true for those <em>experimental</em> features.
However, when going experimental, there is a fair chance that something will change in the future.
Therefore, we are explicitly marking parts of the schema as <em>experimental</em>.
This is a warning that those parts are likely to change.
We are not promising any kind of compatibility for <em>experimental</em> parts of midPoint schema.
They may change any time, they may even completely disappear.
There will be no deprecation or any other warning.
Simply speaking: if you are dealing with <em>experimental</em> features, you are completely on your own.
Do not come crying when those things stop working.
You have been warned.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lifecycle_and_activation">Lifecycle and Activation</h3>
<div class="paragraph">
<p>Time is cruel, everything that we do is in some way temporary.
Except perhaps for stupidity, which seems to be utterly endless.
Sadly, all other things have a beginning and an end.
Employees have hiring date, contracts have end dates, users can be deactivated, roles may get replaced and so on.
We use the terms <em>lifecycle</em> and <em>activation</em> to encompass all those things that deal with the questions of digital life and death of the objects.</p>
</div>
<div class="sect3">
<h4 id="_lifecycle_state">Lifecycle State</h4>
<div class="paragraph">
<p>Users, as well as other identity-related objects have their cycle of life.
They are enrolled into the system, such as record of new hire is entered into HR system.
Then the objects are active, such as user accounts of an active employee.
The objects may be inactivated for a while, such as an employee on maternal leave or sabbatical.
Employees do not work for ever, they may resign, may be laid off, or retired.
Even then, a record of a former employee may be kept for some time.</p>
</div>
<div class="paragraph">
<p>While the details of the lifecycle may be subtly different for various organizations and types of objects, the basic outline is almost always the same.
For that reason the basic lifecycle states are pre-configured in midPoint, as illustrated in following diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/06-01-lifecycle-statechart.png" alt="Lifecycle states">
</div>
</div>
<div class="paragraph">
<p>Objects have their lifecycle state specified in <code>lifecycleState</code> property.
If no explicit value is specified, the default value is <code>active</code>.
Pre-defined lifecycle states are described in following table.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">State</th>
<th class="tableblock halign-left valign-top">Is active</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>draft</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of the new object in progress.
The definition may change at any moment, it is not ready yet.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role definition in preparation (not finished yet).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>proposed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a new object is ready for use, but there is still a review process to be applied (e.g. approval).
The definition should not change in this state.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Finished new role definition in approval process.<br>
Self-registered user, not yet validated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>active</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active and working definition.
Ready to be used without any unusual limitations.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active employee.<br>
Role in production use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>suspended</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspended definition, temporarily disabled.
It is expected that the object will return to <em>active</em> state eventually.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Employee on temporary leave (maternal leave, sabbatical).<br>
Resource temporarily disabled for maintenance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deprecated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active definition which is being phased out.
The definition is still fully operational, but it should not be used for new assignments.
E.g. it should not be requested, it should not be approved, etc.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated role: still working, but not intended to be assigned any more.<br>
Legacy resource: we still want to read the data, but we do not want to create new accounts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>archived</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inactive historical definition.
It is no longer used.
It is maintained only for historical, auditing and sentimental reasons.
E.g. some systems require that the account exists to maintain referential consistency of historical data, audit records, etc.
It may also be used to "block" the user or account identifier to avoid their reuse.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retired employee, keeping minimal record for accounting reasons and to avoid identifier recycling.<br>
Phased-out role definition, kept for historical reasons.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>failed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unexpected error has occurred during object lifecycle.
Result of that event is that the object is rendered inactive.
The situation cannot be automatically remedied.
Manual action is needed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role definition rejected during approvals, without obvious continuation of the process.<br>
Role definition identified to be in violation of the policy, immediately taken out of use.<br>
Resource with unexpected critical errors, requiring attention od administrators.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Lifecycle state of an object determines whether it is considered active or inactive, among other things.
This is perhaps the most important effect of lifecycle state on the system.
User in <code>suspended</code> state is inactive, accounts are disabled, user cannot log in.
Role in <code>draft</code> state is also inactive, the definition is not complete yet, it is not ready for use.
Objects in <code>active</code> state operate normally.</p>
</div>
<div class="paragraph">
<p>When it comes to users, lifecycle state is meant to be controlled automatically, if possible.
The usual method is to synchronize user lifecycle states from the data source, such as HR system.
Candidate user record is meant to be <code>proposed</code>, the changed to <code>active</code> when hired, temporarily set to <code>suspended</code> during maternal leave, and finally end up in <code>archived</code> state until the object is deleted.</p>
</div>
<div class="paragraph">
<p>Users are not the only objects that are affected by lifecycle state.
Many object types in midPoint have lifecycle states.
Interpretation of the states are still almost the same.
However, unlike <em>users</em>, lifecycle states of other objects are usually controlled manually.
E.g. a business role begins its life in <code>draft</code> state.
Role manager builds up role definition while in <code>draft</code> state, looking for appropriate combination of application roles to include in the definition, consulting with colleagues.
This may take some time.
In the meantime, the role is in <code>draft</code> state, inactive, without any risk of unintentional use.
When role definition is done, it is switched to <code>proposed</code> state, reviewed, approved and finally set as <code>active</code>.
When in <code>active</code> state, the role is fully operational, assigned to users, maybe even modified a bit to adapt to changed circumstances.
Sooner or later the role becomes obsolete.
However, we cannot simply delete the role, as it is still assigned to users.
We have to be careful, we do not want to disrupt the business.
First, we switch the role to <code>deprecated</code> state.
The role is still active, everything works fine, just the role cannot be requested and it should not be assigned to any users.
Then we can take our time to clean up all existing role assignments, replacing deprecated role with newer equivalents.
Finally, when all assignments are gone, we can switch role to <code>archived</code> state.</p>
</div>
<div class="paragraph">
<p>Lifecycle state can be applied to many configuration elements in addition to objects.
When lifecycle state is applied to parts of configuration, it controls whether the respective configuration is applied.
E.g. setting a mapping to <code>draft</code> lifecycle state effectively disables the mapping.
This approach can be used to temporarily deactivate parts of configuration.</p>
</div>
<div class="paragraph">
<p>Lifecycle state provides elegant, systematic, unified and controlled mechanisms to control how <em>active</em> an object is.
It guides an objects from its digital cradle to its eventual binary death.
As such, it is one of the essential mechanisms of identity management.</p>
</div>
</div>
<div class="sect3">
<h4 id="_activation_2">Activation</h4>
<div class="paragraph">
<p>Identity management is all about the rules, policies and principles applied at scale.
However, the world around us is not always completely systematic and elegant.
There are always exceptions, special cases, data errors and other circumstances that do not entirely fit into our elegant identity management universe.
For that reason, midPoint has <em>activation</em> mechanism, which provides ability for finer control as compared to simple lifecycle state.
<em>Activation</em> also provides ability for manual overrides by administrator in case of need.</p>
</div>
<div class="paragraph">
<p>The <em>activation</em> in itself is multi-dimensional and a bit complex data structure.
It is composed of several properties that may change in somehow independent and somehow inter-dependent way.
Following list provides a quick summary of activation properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Administrative status</strong> defines administrative state of the object, usually manually set by system administrator.</p>
</li>
<li>
<p><strong>Validity</strong> properties specify <em>when</em> the object should be active.
There is activation date and deactivation date.</p>
</li>
<li>
<p><strong>Effective status</strong> is a computed operational property that shows the current effective status of the user.
It is computed from lifecycle state and other activation properties.</p>
</li>
<li>
<p><strong>Lockout status</strong> is used for automatic temporary inactivation of user, e.g. in case of numerous failed authentication attempts.</p>
</li>
<li>
<p><strong>Additional operational properties</strong> provide (meta) data about the past changes of administrative status.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The best way to explain how activation works is to describe the meaning and behavior of individual properties.</p>
</div>
<div class="paragraph">
<p><em>Administrative status</em> defines the "administrative state" of the object (user),
i.e. the explicit decision of the administrator.
If administrative status is set, this property overrides any other constraints in the activation type (but not the lifecycle state).
E.g. if this is set to <code>enabled</code> and the user is not yet valid (according to <em>validity</em> below), the user should be considered active.
If set to <code>disabled</code> the user is considered inactive regardless of other settings.
Therefore, this property does <strong>not</strong> necessarily define an actual state of the object.
It is a kind of "manual override".
In fact, the most common setting for this property is to leave it unset and let other properties determine the state.
If this property is not present then the other constraints in the activation type should be considered (namely validity properties, see below).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Administrative Status Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no value</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No explicit override.
Other activation properties determine the resulting status.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is active.
It is enabled and fully operational (if lifecycle state permits).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is inactive.
It has been disabled by an administrative action.</p>
<p class="tableblock">This indicates <strong>temporary</strong> inactivation with an intent to enable the entity later.
It is usually used to temporarily disable account for security reasons.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If the administrative status is not present, and there are no other constraints in the activation type, or if there is no activation type at all, then the object is assumed to be "enabled", i.e. that the user is active - provided that the lifecycle state of the object allows it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>archived</code> state of administrative status should not be used.
Lifecycle state <code>archived</code> should be used instead.
This administrative status value is one of the leftovers from midPoint history, from the dark ages when lifecycle state did not exist yet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Validity</em> refers to times <em>when</em> the object is considered legal or otherwise usable.
In midPoint, the validity is currently defined by two dates: the date from which the object is valid (<code>validFrom</code>) and the date to which an object is valid (<code>validTo</code>).
When talking about users, these dates usually represent the date when the contract with the user started (hiring date) and the date when the contract ends.
The user is considered <em>valid</em> (active) between these two dates.
The user is considered inactive before the <code>validFrom</code> date or after the <code>validTo</code> date.</p>
</div>
<div class="paragraph">
<p>It is perfectly acceptable to set just one of the dates or no date at all.
If any date is unset then it is assumed to extend to infinity.
E.g. if <code>validFrom</code> date is not set, the user is considered active from the beginning of the universe to the moment specified by the <code>validTo</code> date.</p>
</div>
<div class="paragraph">
<p>The validity is overridden by the administrative status.
Therefore, if administrative status is set to any non-empty value then the validity dates are not considered at all.</p>
</div>
<div class="paragraph">
<p><em>Lockout status</em> defines the state of user or account lock-out.
Lock-out means that the account was temporarily disabled due to failed login attempts or a similar abuse attempt.
This mechanism is usually used to avoid brute-force or dictionary password attacks and the lock will usually expire by itself in a matter of minutes.</p>
</div>
<div class="paragraph">
<p>This value is usually set by the resource or by midpoint internal authentication code.
This value is mostly used to read the lockout status of a user or an account.
This value is semi-writable.
If the object is locked then it can be used to set it to the unlocked state.
However, it does not work the other way around.
It cannot be used to lock the account.
Locking is always done by the authentication code.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Lockout Status Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no value</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No information (generally means unlocked user or account)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>normal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unlocked and operational user or account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locked</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user or account has been locked.
Log-in to the account is temporarily disabled.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Please note that even if user of account are in the <code>normal</code> (unlocked) state, they still can be disabled by lifecycle, administrative status or validity which will make them efficiently inactive.</p>
</div>
<div class="paragraph">
<p>There is also an informational property <code>lockoutExpirationTimestamp</code> that provides information about the expiration of the lock.
However, not all resources may be able to provide such information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lifecycle_vs_activation">Lifecycle vs Activation</h4>
<div class="paragraph">
<p><em>Lifecycle state</em> and <em>activation</em> work together, although the interaction between them might look slightly mysterious.
Object lifecycle specifies phases of object’s life, separated by important life-changing events.
Therefore, lifecycle state is the most important aspect when considering whether object is active or inactive.
When lifecycle state specifies that object is <em>inactive</em>, then the decision is final.
Such object is inactive, regardless of any other activation setting.</p>
</div>
<div class="paragraph">
<p>This makes perfect sense.
E.g. when an object is in <code>draft</code> state, it is just being prepared for use.
Such object may have validity dates or administrative status that would normally make it active.
However, we do not want draft objects to be active yet.
Such object may need a review and approval to transition to <code>active</code> lifecycle state.
Only then it will really become active.</p>
</div>
<div class="paragraph">
<p>If lifecycle state indicates object as <em>active</em>, the the <em>activation</em> part is considered.
Administrative status, validity dates and lockout status are computed, which determines state of the object.</p>
</div>
<div class="paragraph">
<p>This may look complicated.
However, it matches the needs of identity management reality quite well.
As the rule of the thumb, it is usually <em>lifecycle state</em> which is synchronized from data source.
E.g. the HR system makes computation whether employee is in hiring process, whether the employee is active or retired.
MidPoint takes that HR status and translates it to the pre-defined <em>lifecycle state</em> values.
However, the HR system may not be able to provide such aggregate status.
In that case midPoint <em>inbound mappings</em> should be used in a creative way to supplement that functionality.
Unfortunately, the details are always deployment-specific, as the specific solution depends on the data that the HR system can provide.
E.g. it is quite a common practice to map validity dates from HR system, and let midPoint do the validity calculations.
The specific mappings of lifecycle state and validity dates is always somehow tricky in practice.
It heavily depends on specific characteristics and capabilities of the data source (HR system).
However, it is strongly recommended to control <em>lifecycle state</em> by using <em>inbound mapping</em> from the data source (HR system), and do <strong>not</strong> control <em>administrative status</em>.
<em>Administrative status</em> should remain as a "last resort" mechanisms when user needs to be quickly disabled by manual action, e.g. in case of security incident.</p>
</div>
<div class="paragraph">
<p>The concepts of lifecycle and activation are not limited to users.
Many midPoint objects have lifecycle state and activation.
Roles can expire, organizational units can be disabled and so on.
Lifecycle and activation are a concepts that have a very broad application in midPoint.
Even assignments have activation, which is a crucial element in some configuration (e.g. multi-affiliation).
Assignments are often used to model employment contracts, student affiliations, service contracts and similar concepts that have time boundaries.
This is usually achieved by a clever use of assignment activation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_activation_operational_properties">Activation Operational Properties</h4>
<div class="paragraph">
<p>Lifecycle state and activation are somehow complex and spread out in several dimensions.
Therefore, it may not be entirely obvious which objects are active and which are not.
For that reason midPoint provides an operational property <code>effectiveStatus</code> which shows the computed "effective state" of the object.
Simply speaking, it is a read-only property which tells whether the user should be considered active or inactive.
The effective status is the result of combining lifecycle state and several activation settings (administrative status, validity dates, etc.).</p>
</div>
<div class="paragraph">
<p>The effective status holds the result of a computation, therefore it is an <em>operational</em> property that is recomputed every time the status changes.
The effective status should not be set directly.
The effective status can be changed only indirectly by changing other activation properties.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Effective Status Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no value</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not yet computed.
This should not happen under normal circumstances.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is active.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is inactive (<strong>temporary</strong> inactivation).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>archived</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The entity is inactive (<strong>permanent</strong> inactivation).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The effective status is the property that is used by majority of midPoint code when determining whether a particular object is active or inactive.
This property should always have a value in a normal case.
If this property is not present then the computation haven&#8217;t taken place yet.</p>
</div>
<div class="paragraph">
<p>Similarly to effective status, there is yet another operational property <code>validityStatus</code>.
This property reflects the state of validity constraints with respect to current time.
The values are <code>before</code>, <code>in</code> and <code>after</code>, meaning the states before the validity intervals started, inside the validity interval and after the validity interval ended respectively.</p>
</div>
<div class="paragraph">
<p>There also other <em>operational</em> properties in the activation data structure that provide operational data about user activation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disableReason</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL that identifies a reason for disable.
This may be indication that that identity was disabled explicitly, that the <code>disabled</code> status was computed, or it may indicate other source of the disable event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disableTimestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of last modification of the activation status to the disabled state.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enableTimestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of last modification of the activation status to the enabled state.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>archiveTimestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of last modification of the activation status to the archived state.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>validityChangeTimestamp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of last modification of the effective validity state, i.e. last time the validity state was recomputed with a result that was different from the previous recomputation.
It is used to avoid repeated validity change deltas.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Those properties are <em>operational</em>, therefore from the user point of view they are read-only.
The values are automatically computed by midPoint and stored in the database.</p>
</div>
</div>
<div class="sect3">
<h4 id="_activation_and_lifecycle_examples">Activation and Lifecycle Examples</h4>
<div class="paragraph">
<p>Let’s see how that works on few examples.
The simplest example is perhaps not even worth mentioning.
A user without any lifecycle state or activation data structure is considered to be <em>active</em> (enabled).
When such user is stored in midPoint repository, midPoint will automatically compute <code>effectiveStatus</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;activation&gt;</span>
        <span class="tag">&lt;effectiveStatus&gt;</span>enabled<span class="tag">&lt;/effectiveStatus&gt;</span>
    <span class="tag">&lt;/activation&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The user can be temporarily inactivated by setting <code>lifecycleState</code> to <code>suspended</code>.
Property <code>effectiveStatus</code> will indicate that user is <em>inactive</em> now.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;lifecycleState&gt;</span>suspended<span class="tag">&lt;/lifecycleState&gt;</span>
    ...
    <span class="tag">&lt;activation&gt;</span>
        <span class="tag">&lt;effectiveStatus&gt;</span>disabled<span class="tag">&lt;/effectiveStatus&gt;</span>
    <span class="tag">&lt;/activation&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Changing <code>lifecycleState</code> back to <code>active</code> re-activates the user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;lifecycleState&gt;</span>active<span class="tag">&lt;/lifecycleState&gt;</span>
    ...
    <span class="tag">&lt;activation&gt;</span>
        <span class="tag">&lt;effectiveStatus&gt;</span>enabled<span class="tag">&lt;/effectiveStatus&gt;</span>
    <span class="tag">&lt;/activation&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lifecycle state is usually maintained automatically, using inbound mapping from the HR system.
If an administrator would try to change lifecycle state manually, synchronization may reset the state back to its previous value.
However, administrator can manually disable user by using <code>administrativeStatus</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;lifecycleState&gt;</span>active<span class="tag">&lt;/lifecycleState&gt;</span>
    ...
    <span class="tag">&lt;activation&gt;</span>
        <span class="tag">&lt;administrativeStatus&gt;</span>disabled<span class="tag">&lt;/administrativeStatus&gt;</span>
    <span class="tag">&lt;/activation&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When such user object is stored after the modification, midPoint computes the value of effective status:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;lifecycleState&gt;</span>active<span class="tag">&lt;/lifecycleState&gt;</span>
    ...
    <span class="tag">&lt;activation&gt;</span>
        <span class="tag">&lt;administrativeStatus&gt;</span>disabled<span class="tag">&lt;/administrativeStatus&gt;</span>
        <span class="tag">&lt;effectiveStatus&gt;</span>disabled<span class="tag">&lt;/effectiveStatus&gt;</span>
    <span class="tag">&lt;/activation&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though the lifecycle state of the user is <code>active</code>, the user is manually inactivated using <code>administrativeStatus</code>.</p>
</div>
<div class="paragraph">
<p>The use of administrative status is usually quite harsh, and lifecycle state may be quite simplistic.
MidPoint deployments are often using validity constraints in addition to lifecycle state.
For example, an employee that has employment contract for a year would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>bob<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;activation&gt;</span>
        <span class="tag">&lt;validFrom&gt;</span>2019-01-01T00:00:00Z<span class="tag">&lt;/validFrom&gt;</span>
        <span class="tag">&lt;validTo&gt;</span>2019-12-31T23:59:59Z<span class="tag">&lt;/validTo&gt;</span>
        <span class="tag">&lt;validityStatus&gt;</span>in<span class="tag">&lt;/validityStatus&gt;</span>
        <span class="tag">&lt;effectiveStatus&gt;</span>enabled<span class="tag">&lt;/effectiveStatus&gt;</span>
    <span class="tag">&lt;/activation&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Given that this chapter was written in 2019, such user will be active.
It will automatically switch to inactive state after the last day of 2019.
However, if there is ever a need to explicitly disable the user, administrative status can still be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>bob<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;activation&gt;</span>
        <span class="tag">&lt;administrativeStatus&gt;</span>disabled<span class="tag">&lt;/administrativeStatus&gt;</span>
        <span class="tag">&lt;validFrom&gt;</span>2019-01-01T00:00:00Z<span class="tag">&lt;/validFrom&gt;</span>
        <span class="tag">&lt;validTo&gt;</span>2019-12-31T23:59:59Z<span class="tag">&lt;/validTo&gt;</span>
        <span class="tag">&lt;validityStatus&gt;</span>in<span class="tag">&lt;/validityStatus&gt;</span>
        <span class="tag">&lt;effectiveStatus&gt;</span>disabled<span class="tag">&lt;/effectiveStatus&gt;</span>
    <span class="tag">&lt;/activation&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the user is still in its validity interval.
Hence the <code>in</code> value of <code>validityStatus</code>.
However, the administrative status is explicitly set to <code>disabled</code>.
Therefore, the resulting effective status is also <code>disabled</code>.</p>
</div>
<div class="paragraph">
<p>Activation operational properties are very useful, not just for troubleshooting.
These properties are often used in reports, dashboards and search filters.
E.g. the best way to search all <em>active</em> users is to search for <code>activation/effectiveStatus = "enabled"</code>.
Similarly, filter <code>activation/effectiveStatus = "disabled"</code> looks for all <em>inactive</em> users, regardless whether they are inactive due to lifecycle state, administrative status or validity constraints.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_schema_definition">Schema Definition</h3>
<div class="paragraph">
<p>So far we have talked mostly about the <em>user</em> schema (<code>UserType</code> data type).
However, midPoint schema much broader than that.
There are many types of objects, and there are thousands of data types overall.
It would be almost impossible to manage such a big schema if it were hard-coded in midPoint code.
Therefore, the schema is defined in special definition files that are used by midPoint in several ways.
Schema definition used by the <em>user interface</em> to automatically render form fields.
It is also used by midPoint <em>expression engine</em> to automatically convert data types.
It is even used by midPoint <em>build process</em> (compilation), to make sure that midPoint code is using the schema properly.
MidPoint is completely schema-aware system, from the bottom to the top.</p>
</div>
<div class="paragraph">
<p>Schema obviously plays a crucial role in everything that midPoint does.
Therefore, it may be interesting to have a closer look at schema definition.
This can be particularly useful for engineers that are deploying midPoint professionally, and that often needs to extend and customize the schema.</p>
</div>
<div class="paragraph">
<p>MidPoint schema is specified in <em>XML Schema Definition (XSD)</em> format.
MidPoint schema is defined in several parts, but the most important is the "core" schema definition.
The schema files reside in midPoint source code in <code>schema</code> component in the <code>infra</code> subsystem.
Therefore, schema files can be found in the <code>resources</code> part under the <code>infra/schema</code> subdirectory of midPoint source code.
Schema files are also included in midPoint distribution package for convenience.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Why XSD?
Why did we choose to use the <em>XML Schema Definition</em> format for midPoint schema?
There are historic reasons and there are pragmatic reasons.
Back in early 2010s when midPoint was born, XML was perhaps the only sensible choice to build a complex system.
Alternatives such as JSON were young, and their schema languages ranged from <em>very limited</em> through <em>useless</em> to <em>non-existent</em>.
Therefore, XML and XSD were a natural choice.
We needed to extend XSD with custom features.
Fortunately, XSD allowed that.
We also needed to rewrite parts of the XML/XSD-processing code.
Unfortunately, the XML ecosystem was not designed for this, and we have also hit other limitations of XML and XSD.
We have to invent a new way to use XSD to describe generic data structures (a.k.a. "Prism objects") that can be represented in XML, JSON and YAML.
Due to that innovation, XSD did not really hold us back that much.
Despite all its limitations, XSD worked for us quite well during all those years.
However, we are getting very close to the very limits of what XSD (or any similar schema language) can do.
We are already working on a replacement: <em>Axiom data modeling language</em>.
Axiom is a next-generation language, supporting not just a <em>data</em> schema, but also <em>meta-data</em> schema.
Axiom is still very young, it needs more work and time to mature.
However, it is certainly a future for midPoint.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Every deployment engineer that takes midPoint deployments seriously should be aware of the <em>schema</em>.
Hardcore engineer will surely open the XSD files in their favorite text editor in the terminal and analyze the definitions line-by-line.
Developers could open the XSD files in their IDEs and have a nice organized look at the schema.
However, even an ordinary engineer could benefit from learning the basics of XSD and having a look at a few important data types in midPoint schema.</p>
</div>
<div class="paragraph">
<p>Schema definition is not just about the properties, containers and data types.
Crucial part of the schema definition is in-line documentation.
Most of the data types and items are documented by using XSD in-line documentation mechanism.
Therefore, a huge amount of details about midPoint can be learned by exploring the schema.
We have tried to make that process easier by developing <em>schemadoc</em> mechanism.
Schemadoc is a process that takes raw midPoint schema and generates HTML documentation out of that.
This task is part of midPoint build process and generated documentation is a result of midPoint build.
Schemadoc is also available online.
Just search for "schemadoc" in midPoint docs.</p>
</div>
<div class="paragraph">
<p>Schema is not just a description how midPoint works.
MidPoint schema is part of midPoint itself.
It is used when midPoint is compiled.
It is parsed when midPoint starts.
It is used by midPoint core and user interface.
MidPoint is complex, and even the experts can be sometimes wrong about midPoint functionality.
MidPoint documentation is quite extensive, therefore it may be misleading or out of date at places.
But not the schema.
Schema is always right.
Otherwise midPoint won’t work at all.
In midPoint world, <em>schema</em> is the law.
When in doubt, look at the schema.</p>
</div>
</div>
<div class="sect2">
<h3 id="_schema_extensibility">Schema Extensibility</h3>
<div class="paragraph">
<p>MidPoint schema is quite rich.
Many of the properties that are frequently used in identity management deployments are already part of midPoint schema.
Given name, family name, full name, additional names, honorific titles, job title, personal number - it is all there, ready to be used.
However, reality has always a way to bring unexpected things.
Therefore, midPoint deployments won’t get far if midPoint schema cannot be extended.</p>
</div>
<div class="paragraph">
<p>Vast majority of midPoint schema is available at <em>compile-time</em>.
This means that such schema is used during <em>compilation</em> (build) of midPoint.
That "static" part of schema is somehow hardcoded into midPoint itself, and it would be very difficult to change.
Therefore, we have developed a mechanism to extend the schema at <em>deployment-time</em>.
Small parts of the XSD definition can be provided when midPoint is <em>deployed</em>.
MidPoint reads those definitions when it starts up.
The static part of the schema is extended with those definitions.
From that point on, the extensions are part of midPoint schema.
The extensions are naturally used by midPoint user interface, expression-processing code and all other parts of midPoint.</p>
</div>
<div class="paragraph">
<p>Our ExAmPLE company was quite happy with the progress of their identity management deployment so far.
Mappings were used to synchronize values of user names and all other common attributes.
There is plenty of suitable properties for that in midPoint schema such as <code>givenName</code> and <code>fullName</code>.
Even <code>personalNumber</code> came very handy.
However, now they need to customize midPoint schema to better suit their very specific needs.
The company management decided that the people are going to look really cool in fancy hats.
Therefore, they are going provide a hat for every employee.
Which means that the identity management system needs to track hat size for all users.
Hat size is not used in the identity management deployments very often, therefore it is not a part of standard midPoint schema.
Fortunately, it is quite easy to extend the schema.</p>
</div>
<div class="paragraph">
<p>First step to extend midPoint schema is to prepare a small XSD file:</p>
</div>
<div class="listingblock">
<div class="title">example.xsd</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;xsd:schema</span> <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/xml/ns/midpoint/schema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UserTypeExtensionType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:appinfo&gt;</span>
                <span class="tag">&lt;a:extension</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c:UserType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/xsd:appinfo&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:sequence&gt;</span>
            <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hatSize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:string</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;/xsd:complexType&gt;</span>
<span class="tag">&lt;/xsd:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This file defines a new data structure <code>UserTypeExtensionType</code>.
The name of this data structure does not really matter.
What matters is that it is bound to an extension of <code>UserType</code> in the <em>annotation</em> part of the type definition.
When midPoint reads this file, it extends the definition of <code>UserType</code> with this data type.</p>
</div>
<div class="paragraph">
<p>The extension specifies just a single property: <code>hatSize</code>.
This is an optional single-valued string property, which is specified by the <code>minOccurs</code> and <code>maxOccurs</code> clauses.
Every user in midPoint can have this property.
When this schema extension is applied, user interface is going to automatically display text input field of this property for every user.</p>
</div>
<div class="paragraph">
<p>MidPoint administrator puts this XSD content into <code>example.xsd</code> file.
Name of the file can be chosen arbitrarily as long as it has <code>.xsd</code> file extension.
Administrator copies that file to <code>schema</code> subdirectory of <em>midPoint home directory</em> and restarts midPoint.
From that point on the schema extension is active.</p>
</div>
<div class="paragraph">
<p>The users can be extended with custom property now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user</span> <span class="attribute-name">xmlns:exmpl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/xml/ns/midpoint/schema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;extension&gt;</span>
        <span class="tag">&lt;exmpl:hatSize&gt;</span>M<span class="tag">&lt;/exmpl:hatSize&gt;</span>
    <span class="tag">&lt;/extension&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a couple of important remarks to be made here.
Firstly, all the extension properties are always placed in a special <code>extension</code> container in the objects.
Even though the properties are placed inside a container, the user interface will present them in the same way as the other midPoint properties originating from the static midPoint schema.
In midPoint, all schema items are treated equally, regardless of their origin.</p>
</div>
<div class="paragraph">
<p>Secondly, a clever reader surely noticed that we have used <em>XML namespace</em> here.
We have omitted XML namespaces from the majority of other examples, as they are not that important when working with midPoint objects.
However, schema is different.
Namespaces are handled quite strictly when working with the schema.
Namespaces must be declared and namespace prefixes must be properly used in all <em>XSD definitions</em>.
This is how the XSD language was designed.
The most important namespace in this case is the <em>target namespace</em> of the extended schema.
The URI for this namespace should be chosen in such a way that it is globally unique.
The use of your DNS domain is the recommended technique.</p>
</div>
<div class="paragraph">
<p>Namespaces also <em>should</em> be used when working with <code>extension</code> container in users and other midPoint objects.
This requirement is not that strict, as midPoint can usually figure out the namespace.
However, this may be a problem in case that several schema extensions are combined.
Such schema combinations are fully supported by midPoint.
MidPoint simply parses all the XSD files in the schema directory and applies all of them as extensions.
These files may contain conflicting definitions of the same items.
The <em>namespace</em> is used to differentiate between them.
Therefore, if there is an expectation that several schema extensions will be used in the same deployment, then the use of namespaces in object extension is more than recommended.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Extension container</div>
<div class="paragraph">
<p>Why is there an <code>extension</code> container?
Why are the extension properties not mixed among other static properties?
XML should allow that.
Yet, it does not really work well in practice.
This is related to the intricacies of XML and XML schema.</p>
</div>
<div class="paragraph">
<p>Theoretically, XML is completely extensible.
However, when XML Schema is applied to XML, some extensibility scenarios do not work very well.
That is also the case for mixing of static XML elements and dynamic XML elements.
We are hitting what is called "Unique Particle Resolution" limitation of XML schema.
This was further amplified by limitations of Java XML libraries.
The easiest and perhaps even most correct way to resolve this limitation was to create a dedicated XML element for schema extensions.
That is what we have done in early midPoint versions.
The schema processing code in midPoint has significantly improved since, and now we are almost at the point where we could remove the <code>extension</code> element.
Unfortunately, we are not yet there.
Moreover, there is still an aspect of compatibility to consider.
The <code>extension</code> element stays, at least for now.
However, we are trying hard to hide its existence from the end user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>MidPoint schema does not just specify the "core" data model.
MidPoint schema goes a bit further, and it can also specify the details of data <em>presentation</em>.
This means that the schema can specify a <em>label</em> that should be used for particular data item, <em>help text</em>, <em>tooltip</em> and other characteristics.
The XML Schema (XSD) cannot do this out-of-the-box.
Fortunately, XSD schema can be extended by <em>annotations</em>.
Those annotations can be used to define the presentation properties of an items:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    ...
    <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hatSize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:string</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:appinfo&gt;</span>
                <span class="tag">&lt;a:displayName&gt;</span>Hat size<span class="tag">&lt;/a:displayName&gt;</span>
                <span class="tag">&lt;a:help&gt;</span>
                    Your hat size, in whatever mysterious units the hatters
                    are using for measuring hats.
                <span class="tag">&lt;/a:help&gt;</span>
            <span class="tag">&lt;/xsd:appinfo&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;/xsd:element&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works fine, if your system works in a single localization environment.
Yet, this is not enough in case that you need to support more than one language.
MidPoint was born in Europe, and here at the old continent we know quite well all the pain that comes with multi-language environments.
Therefore, MidPoint is designed to be localizable.
You can simply use localization keys instead of actual text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    ...
    <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hatSize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:string</span><span class="delimiter">&quot;</span></span>
                 <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:appinfo&gt;</span>
                <span class="tag">&lt;a:displayName&gt;</span>UserTypeExtensionType.hatSize.displayName<span class="tag">&lt;/a:displayName&gt;</span>
                <span class="tag">&lt;a:help&gt;</span>UserTypeExtensionType.hatSize.help<span class="tag">&lt;/a:help&gt;</span>
            <span class="tag">&lt;/xsd:appinfo&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
    <span class="tag">&lt;/xsd:element&gt;</span>
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual text to be used for the label can be looked up in the <em>localization catalog</em>.
However, using localization catalogs is a matter of its own.
It will be covered by later chapters.</p>
</div>
</div>
<div class="sect2">
<h3 id="_polystring_and_protected_string">PolyString and Protected String</h3>
<div class="paragraph">
<p>Majority of midPoint schema is pretty standard stuff.
When you walk through the jungle of midPoint schema definition, you can see all the usual wildlife: strings, integers, booleans, timestamps and binary values.
Yet, there are few species that are quite strange.
However strange they might look, they are immensely useful.
Their names are <em>PolyString</em> and <em>protected string</em>.</p>
</div>
<div class="paragraph">
<p><em>PolyString</em> (<code>PolyStringType</code>) is the stranger one of those two.
Its name came from <em>polymorphic string</em>, which means a string that can take a variety of forms.
In its simplest form, PolyString is just a simple string that can be <em>normalized</em>.
<em>Normalization</em> means that we convert the original string into some standard form, e.g. by removing leading and trailing whitespace (trimming), converting all letters to lower case, simplifying national characters and so on.</p>
</div>
<div class="paragraph">
<p>Many ordinary midPoint properties are PolyStrings.
Object <code>name</code> and user’s <code>givenName</code>, <code>familyName</code> and <code>fullName</code> and all PolyStrings.
However, not even a clever reader have noticed anything suspicious about these properties so far.
This is because normalization is almost transparent in midPoint PolyStrings, it happens on its own in the background.
However, now it is a time to have a peek inside.
Let’s import a user that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>semančík<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;fullName&gt;</span>Radovan Semančík,  PhD. <span class="tag">&lt;/fullName&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What is really stored in midPoint repository is this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>
        <span class="tag">&lt;orig&gt;</span>semančík<span class="tag">&lt;/orig&gt;</span>
        <span class="tag">&lt;norm&gt;</span>semancik<span class="tag">&lt;/norm&gt;</span>
    <span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;fullName&gt;</span>
        <span class="tag">&lt;orig&gt;</span>Radovan Semančík,  PhD. <span class="tag">&lt;/orig&gt;</span>
        <span class="tag">&lt;norm&gt;</span>radovan semancik phd<span class="tag">&lt;/norm&gt;</span>
    <span class="tag">&lt;/fullName&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This all happens transparently.
PolyStrings are displayed as strings in the user interface.
They are handled (almost completely) as strings in the mappings.
Ordinary midPoint user has no idea that the normalization happens at all.
If everything is so transparent, why do we bother to normalize strings at all?
PolyString normalization has many practical uses.
Two of them are embedded quite deep in the way how midPoint works.</p>
</div>
<div class="paragraph">
<p>Firstly, normalization is used to provide reliable uniqueness mechanism.
Usually we do not want a user with username <code>semancik</code> and another user with username <code>Semancik</code> or even <code>Semančík</code>.
This may lead to confusion, and it even totally breaks some applications.
As midPoint has uniqueness constraints on both the <code>orig</code> and <code>norm</code> parts of the name, such situation is completely avoided.
All those usernames have the <em>same</em> normalized form <code>semancik</code>, therefore the uniqueness constraint on <code>norm</code> part of the name prohibits the use of all those forms at the same time.</p>
</div>
<div class="paragraph">
<p>Secondly, normalization is simple and elegant way to conveniently search for objects in international environments.
When PolyStrings are searched, the value from the query is normalized.
Then the <code>norm</code> part of the PolyString is searched.
Therefore, whether the query contains <code>semancik</code>, <code>Semancik</code> or <code>semančík</code>, it will always find the user entry above.</p>
</div>
<div class="paragraph">
<p>Default normalization algorithm in midPoint should be a good fit for most environments.
However, there are always deployments that are different.
For example, characters such as hyphens (<code>-</code>) are usually not considered to be significant.
Yet, some deployments may consider <code>aliceanderson</code> and <code>alice-anderson</code> to be two different usernames.
The default midPoint normalization mechanism removes hyphens, therefore attempt to have two such users will end up with an error.
Fortunately, the normalization algorithm is customizable.
There are several algorithms to choose from and they can even be parameterized.
In the extreme case, there is a way to develop a completely custom algorithm.
Therefore, the PolyString normalization should fit pretty much every deployment scenario.</p>
</div>
<div class="paragraph">
<p>PolyString still has more tricks to do.
Simple normalization is not much of a <em>polymorphism</em> yet.
PolyString becomes a real shape-shifter when used in fully localized environments.
PolyString is designed to store values that can have individualized representations in national environments.
E.g. in international deployments we probably want to provide localized role names.
Like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role&gt;</span>
    <span class="tag">&lt;name&gt;</span>
        <span class="tag">&lt;orig&gt;</span>System administrator<span class="tag">&lt;/orig&gt;</span>
        <span class="tag">&lt;lang&gt;</span>
            <span class="tag">&lt;en&gt;</span>System administrator<span class="tag">&lt;/en&gt;</span>
            <span class="tag">&lt;sk&gt;</span>Systémový správca<span class="tag">&lt;/sk&gt;</span>
            <span class="tag">&lt;cz&gt;</span>Správce systému<span class="tag">&lt;/cz&gt;</span>
        <span class="tag">&lt;/lang&gt;</span>
    <span class="tag">&lt;/name&gt;</span>
    ...
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a mechanism to display midPoint to end users in their own language, complete with localized <em>content</em> of midPoint.</p>
</div>
<div class="paragraph">
<p>The other strange animal in the midPoint jungle is <em>protected string</em> (<code>ProtectedStringType</code>).
Identity management systems often work with sensitive data such as user passwords.
All the identity-related data usually need protection, but those sensitive data items need even better safeguards.
This usually means that some kind of cryptographic technique needs to be employed.
E.g. we do not want to store passwords in the cleartext form.
Want them to be either hashed or encrypted.
That is what protected string is for.
Protected string is basically just a simple string, but it has extra cryptographic protection.</p>
</div>
<div class="paragraph">
<p>If you have ever dealt with cryptography, you will probably know that cryptography is not simple.
Even such a seemingly simple thing as password hashing is quite complex when it comes to all the details.
E.g. we do not want to store plain hash, as that would not provide sufficient protection.
We want <em>salted</em> hash.
Which means that the salt value needs to be stored together with the string.
Many algorithms are parametric, and the parameters used during the hashing also need to be stored.
Most importantly, we do not want to hard-wire midPoint to any specific algorithm.
Cryptographic algorithms often do not age well, and they need to be replaced eventually.
Therefore, we also need to store algorithm identifiers with the value.
If the value is encrypted, we also need to store key identifier, as several keys may be active at the same time.
Nothing is simple in cryptography.
The cryptographic devil is in the tiny and often counter-intuitive details.</p>
</div>
<div class="paragraph">
<p><em>Protected string</em> is a data structure that is designed to handle all those pesky cryptographic details, and still pretend that the content of the data structure is just a string.
Similarly to PolyString, the basic usage of protected string is quite simple.
Data can be imported into midPoint by using <code>clearValue</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;credentials&gt;</span>
        <span class="tag">&lt;password&gt;</span>
            <span class="tag">&lt;value&gt;</span>
                  <span class="tag">&lt;clearValue&gt;</span>sup3rSECRET<span class="tag">&lt;/clearValue&gt;</span>
            <span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/password&gt;</span>
    <span class="tag">&lt;/credentials&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The data are automatically protected when the object is imported into midPoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;credentials&gt;</span>
        <span class="tag">&lt;password&gt;</span>
            <span class="tag">&lt;value&gt;</span>
                <span class="tag">&lt;t:encryptedData&gt;</span>
                    <span class="tag">&lt;t:encryptionMethod&gt;</span>
                        <span class="tag">&lt;t:algorithm&gt;</span>http://www.w3.org/2001/04/xmlenc#aes128-cbc<span class="tag">&lt;/t:algorithm&gt;</span>
                    <span class="tag">&lt;/t:encryptionMethod&gt;</span>
                    <span class="tag">&lt;t:keyInfo&gt;</span>
                        <span class="tag">&lt;t:keyName&gt;</span>1z0N17tv6hNQh5CAJ+jWHWDXeBM=<span class="tag">&lt;/t:keyName&gt;</span>
                    <span class="tag">&lt;/t:keyInfo&gt;</span>
                    <span class="tag">&lt;t:cipherData&gt;</span>
                        <span class="tag">&lt;t:cipherValue&gt;</span>g6Neg3ZEXY/ga00SpEa9w5MlJ9/IR+M1vEjdceni6bM=<span class="tag">&lt;/t:cipherValue&gt;</span>
                    <span class="tag">&lt;/t:cipherData&gt;</span>
                <span class="tag">&lt;/t:encryptedData&gt;</span>
            <span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/password&gt;</span>
    <span class="tag">&lt;/credentials&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Protected string data type supports <em>cleartext</em> representation, <em>encryption</em> using a symmetric algorithm and <em>hashing</em>.
However, the protected string data type is just a mechanism for storing the data, it is just a place where the values can be stored.
Whether specific protected string in the schema gets encrypted or hashed, and at which point that happens, is not controlled by the protected string data type itself.
It is controlled by midPoint configuration and policies.
For example, whether user password is encrypted or hashed is determined by midPoint <em>security policy</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_schema_concepts">Advanced Schema Concepts</h3>
<div class="paragraph">
<p>This section describes schema concepts that goes deeper into midPoint mechanisms and implementation.
Awareness of those concepts will provide insight into how midPoint works.
However, we have already talked about the schema quite a lot, and this chapter was quite low on practical examples.
Feel free to skip the rest of this chapter if you want to get your hands dirty as soon as possible.
However, please make sure to come back later.
You will have to learn those schema concepts eventually, to get the best of midPoint functionality.</p>
</div>
<div class="sect3">
<h4 id="_type_hierarchy">Type Hierarchy</h4>
<div class="paragraph">
<p>So far we have presented midPoint schema as a simple set of data types.
There is <code>UserType</code> for users, <code>RoleType</code> for roles and so on.
However, all the midPoint objects have something in common.
For example, all of them have <em>object identifier</em> (OID), <em>name</em>, <em>description</em> and so on.
We could simply copy definitions of those properties to all the data types.
However, that is not the best way to do data modeling.
The proper way is to create a <em>type hierarchy</em>.
Therefore, there is an <code>ObjectType</code> data type that specifies all the items that all the object types share.
However, midPoint schema is substantial and one common ancestor won’t be enough.
MidPoint type hierarchy was evolving during midPoint development, and now it forms quite a rich structure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/06-02-type-hierarchy.png" alt="Type hierarchy">
</div>
</div>
<div class="paragraph">
<p>Following table is summarizing midPoint data types and their purpose.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Data type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ObjectType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common (abstract) data type for all midPoint objects.
Specifies basic items that all midPoint objects have: <em>name</em>, <em>description</em>, <em>metadata</em> and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AssignmentHolderType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract supertype for all object types that can have assignments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FocusType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract supertype for all object types that can be <em>focus</em> of full midPoint computation.
This basically means objects that have <em>projections</em> (accounts).
Focal objects also have <em>activation</em>, they may have <em>personas</em>, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UserType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User object represents a physical user of the system.
Properties of user object typically describe the user as a physical person.
Therefore, the user object defines handful of properties that are commonly used to describe users in the identity management solutions (employees, customers, partners, etc.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AbstractRoleType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract data type that contains the "essence" of a role.
Roles and other objects that behave like roles are derived from this data type.
All abstract roles may "grant" accounts on resources, attributes and entitlements for such accounts.
The role can also imply (<em>induce</em>) organizational units, other roles or various identity management objects that can be assigned directly to user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RoleType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A role in the role-based access control (RBAC) sense.
The roles specify privileges that the user (or other object) should have.</p>
<p class="tableblock">Roles are intended to give privileges to users and other objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OrgType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organizational unit, division, section, object group, team, project or any other form of organizing things and/or people.
The OrgType objects are designed to form a hierarchical organizational structure (or rather several parallel organizational structures).</p>
<p class="tableblock">Orgs are intended to group objects.
As orgs are <em>abstract roles</em>, they can also behave as roles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ServiceType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This object type represents any kind of abstract or concrete services, or devices such as servers, virtual machines, printers, mobile devices, network nodes, application servers, applications or anything similar.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ArchetypeType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archetype definition.
Archetype defines custom object (sub)type.
I.e. it defines specific behavior, look and feel of objects of a particular type, such as "employee", "project", "application", "business role" and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResourceType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource represents a system or component external to midPoint system which is managed by midPoint.
It is sometimes called identity resource, IT resource, target system, source system, provisioning target or by variety of their names.
MidPoint connects to the resource to create accounts, assign accounts to groups, etc.
Resource may also be an authoritative source of data, database that contains organizational structure and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ConnectorType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description of a generic connector.
Connector in midPoint is any method of connection to the resource.
This usually describes a ConnId identity connector.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ConnectorHostType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host definition for remote connector, remote connector framework or a remote "gateway".
This usually specifies the detail of a ConnId remote connector server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SystemConfigurationType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System configuration object.
It holds global system configuration setting.
There is just one object of this type in the system.
It has a fixed identifier (OID).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TaskType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object that contains information about a task.
This can represent active running task, it may be a scheduled task waiting for execution, or the object may contain a results of a finished task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ObjectTemplateType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An object that contains mappings and other configuration intended to apply to other object types.
E.g. it may be used as “user template” to set up basic properties of new user objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LookupTableType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An object that represents lookup table.
The lookup table can be used for two purposes: value enumerations (e.g. for GUI or validation) and value mapping (translation).
Simply speaking it is a set of key-value pairs that can be efficiently stored and used in midPoint user interface, mappings and so on.
It is designed to hold a large number of key-value pairs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SecurityPolicyType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System that contains definitions of overall security policy.
It contains configuration of authentication mechanisms, credentials management (such as password resets) and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ValuePolicyType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Policy for values of properties.
This is almost always used to store password policies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FunctionLibraryType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object that contains a set of reusable functions.
Those functions can be used in mappings and expressions in all parts of midPoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ObjectCollectionType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object that specifies a collection of other objects.
It is mostly just a named search filter that can be reused in other parts of midPoint.
However, there are also some advanced functions that can be used in dashboards, for compliance purposes and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReportType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specification of midPoint report.
This specification defines what the report should contain, how it should look like, output format and so on.</p>
<p class="tableblock">This object contains a report <em>definition</em>.
It is a report “template” that can be executed, and it produces data.
The output data are referred to by report output objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReportDataType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object that refers to data of the report.
This is usually an output of a report, but it may also refer to input data that are to be imported to midPoint.
It also contains metadata, e.g. timestamp of report was creation, what definition was used, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SequenceType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of a sequence object that produces unique values.
The sequence state is persistently stored in the repository, therefore it can efficiently produce unique identifiers in a controlled and predictable manner.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FormType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Form definition.
Forms define how a certain user interface form or dialog is presented in the user interface.
It is used for user interface customization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DashboardType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object that specifies a look and a behavior of a dashboard.
This is used for user interface customization.
It can also specify some aspects of midPoint reports.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GenericObjectType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic type for any other object type that do not fit into any other category.
However, support for this data type is extremely limited.
We generally do not recommend to use it at all.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ShadowType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shadow of a resource object.
Local copy of any object on the provisioning resource that is related to provisioning.
It may be account, group, role (on the target system), privilege, security label, organizational unit or anything else that is worth managing in identity management.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NodeType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node describes a single installation of midPoint.
MidPoint installations can work in cluster.
The Node objects are the way how the nodes in cluster know about each other.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Type hierarchy is a principle that is used in many software systems.
This principle is probably quite obvious to all software developers, but it may need some time to get used to for other engineers.
However, the basic idea is quite simple.
E.g. <code>AbstractRoleType</code> has all the items that are needed for an object to behave like a role.
<code>RoleType</code>, <code>OrgType</code>, <code>ServiceType</code> and <code>ArchetypeType</code> are subtypes of <code>AbstractRoleType</code>.
Therefore <code>RoleType</code>, <code>OrgType</code>, <code>ServiceType</code> and <code>ArchetypeType</code> can all behave like a role.</p>
</div>
<div class="paragraph">
<p>This may sound quite strange, why would we want an <em>organizational unit</em> to behave like a <em>role</em>?
Yet, the answer is quite obvious.
Membership in an <em>organizational unit</em> may imply some privileges.
Other identity systems need complex rules such as "if user belongs to organizational unit <code>A</code> then he will also have role `X`".
That is not needed in midPoint.
<em>Organizational unit</em> is like a <em>role</em>, therefore it can simply include all the roles that are needed.
This means that the role-based access control (RBAC) principles can be applied to several object types.
This approach illustrates a very typical trait of a midPoint philosophy: reuse of generic principles.
We reuse existing principles instead of complicating the system by inventing a new single-purpose mechanism.
As you will see later, this makes midPoint both elegant and powerful.</p>
</div>
</div>
<div class="sect3">
<h4 id="_item_path">Item Path</h4>
<div class="paragraph">
<p>MidPoint configuration often needs to reference a particular item in a particular object.
For example, mapping sources and target are references to properties and containers.
However, midPoint data structures can be quite complex.
For example, password is stored in property value that is located in container <code>password</code> which is in container <code>credentials</code> defined in <code>FocusType</code> data type.
It may be difficult to find a way in this little maze.
There may be even some unambiguous situations.
For example, user status is controlled by property <code>administrativeStatus</code> that is in the <code>activation</code> container.
However, <code>assignment</code> also has an <code>activation</code> container, and there is an assignment <code>administrativeStatus</code>.
Therefore, referencing an item by a simple name would not be enough.
We need something more sophisticated.</p>
</div>
<div class="paragraph">
<p>MidPoint is using the concept of <em>item path</em> to reference items in the schema.
In its simplest form, item path is just a sequence of item names concatenated by slash characters.
For example the path of user administrative status is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>activation/administrativeStatus</code></pre>
</div>
</div>
<div class="paragraph">
<p>whereas the path of assignment activation status is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>assignment/activation/administrativeStatus</code></pre>
</div>
</div>
<div class="paragraph">
<p>Item path provides an unambiguous reference to a specific item in midPoint schema.
The path can be used in all the places where there is a need to reference a particular item.
It is often used in mappings to specify sources and target.
Search filters are often using item paths to form search queries.
The path is also used in other places that we will mention in later chapters.
The concept of <em>item path</em> is deeply embedded in all midPoint operations.
For example, modification deltas are using item path to precisely pinpoint the places in the object that are modified.</p>
</div>
<div class="paragraph">
<p>The path is used to locate a particular item in midPoint schema.
It is also used to reference a specific value in midPoint objects.
In that case the path often looks simple, as we have seen it above.
As long as we are dealing only with single-value containers, the path can unambiguously point to a specific item.
However, we may get into trouble in case that <em>multi-valued containers</em> are used, which are often used in midPoint schema.
Assignment is one of those multi-valued container.
User can have many assignments.
If we want to disable one particular assignment, how do we do it?
If we would use the path above, then it is not clear <em>which</em> assignment should be disabled.
Therefore, in case of multi-valued containers, the path is extended with a <em>container identifier</em> in square brackets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>assignment[123]/activation/administrativeStatus</code></pre>
</div>
</div>
<div class="paragraph">
<p>This path is unambiguously referencing <code>administrativeStatus</code> property in an <code>activation</code> container in a very specific assignment - an <code>assignment</code> container with identifier <code>123</code>.
This form of the path is used mostly in the deltas, and user should not need to ever enter those paths manually.
However, this form is often recorded in midPoint log files and other diagnostic output.
Therefore, it is quite useful to be familiar with it.</p>
</div>
<div class="paragraph">
<p>You might wonder why there is an identifier for <code>assignment</code> but there is no identifier for <code>activation</code>.
Both are containers, aren’t they?
The clever reader already knows the answer.
<code>assignment</code> is a multi-valued container.
Therefore, identifier is needed to pinpoint a specific value of that container.
However, <code>activation</code> is a single-valued container.
There is no danger of ambiguity.
Therefore, the identifier is not needed in this case.</p>
</div>
<div class="paragraph">
<p>This form of item path works fine if we need to identify an item in a particular object.
However, sometimes we have a lot of objects and other data structures to choose from.
For example, a mapping can have several sources and expression variables.
Therefore, using simple paths would be ambiguous, as it would not specify where the path <em>starts</em>.
In such case the path can start with an optional <em>variable identifier</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>$focus/activation/administrativeStatus</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path above explicitly states that it should be applied to the content of variable <code>focus</code>.
Therefore, there is no danger that this path could be applied to a shadow object which also has the <code>activation</code> container.
This form of item path is often used in <code>path</code> expression evaluators.</p>
</div>
<div class="paragraph">
<p>Clever reader is surely wondering about QNames now.
The XML schema defines the elements in a form of QNames, which basically means "names in a namespace".
Therefore, element names are supposed to be QNames, and item path should use QNames as well.
Yet, so far all the names in the path looked like simple strings.
In fact, they indeed are simple strings, but they point to elements in the schema.
While the path is correct and unambiguous, midPoint does not need the namespaces.
Simple string (known as <em>local part</em> of QNames) are enough to navigate through the schema and automatically determine the namespaces.
The same principle is used for parsing XML, JSON or YAML document without namespace definitions.
However, there may be ambiguities in case that several custom schema extensions are used.
Those extensions may have elements with conflicting local parts.
In that case an alternative form of item path can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>declare namespace exmpl=&quot;http://example.com/xml/ns/midpoint/schema&quot;; extension/exmpl:foo</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This alternative form is based on XPath specification, that was used in early midPoint versions and it was an inspiration for the concept of item path.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Clever reader may have also noticed that there are two types of namespaces that are often used in midPoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://prism.evolveum.com/xml/ns/public/...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://midpoint.evolveum.com/xml/ns/public/...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Indeed, the schema is divided into two big parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Prism schema</strong> is used to express basic concepts that deal with objects, deltas, item paths, queries and similar mechanisms.
Those are concepts of our data representation library that we dubbed <em>Prism</em>.
Prism concepts are very generic mechanisms that (theoretically) have nothing to do with identity management or midPoint.
Prism is supposed to be a general-purpose data representation library that can be reused to build other applications.</p>
</li>
<li>
<p><strong>MidPoint schema</strong> is used to express all the objects and data types that midPoint works with.
All the concepts specific to identity management are there: user, role, org, assignment and many, many others.
This is the data model of identity management as it is implemented in midPoint.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_4">Conclusion</h3>
<div class="paragraph">
<p>This is all about midPoint schema that you need to know right now.
There is still much more to learn, as the entire midPoint schema is big and complex.
Understanding of midPoint schema is absolutely crucial for advanced use of midPoint, as the schema is a foundation of everything that midPoint does.
Yet, the best way to do the learning is to do it on the go.
You will learn more about midPoint schema as you will explore midPoint functionality.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="07-rbac">7. Role-Based Access Control</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Simplicity is the most complex of all concepts.
</blockquote>
<div class="attribution">
&#8212; Mentat conundrum<br>
<cite>Dune: House Corrino by Brian Herbert and Kevin J. Anderson</cite>
</div>
</div>
<div class="paragraph">
<p>Basic idea of role-based access control (RBAC) is very simple: instead of assigning the same privileges to users over and over again, let’s group such privileges into roles.
Then assign roles to users.
Such RBAC roles often align with organizational roles such as <em>manager</em>, <em>assistant</em> or <em>analyst</em>.
Therefore, roles are quite easy to understand even on an intuitive level.
RBAC should make your life easier - at least in theory.</p>
</div>
<div class="paragraph">
<p>Role-based access control principles are present in almost all identity management systems.
Therefore, it is no surprise that RBAC is one of the basic midPoint access control mechanisms.
MidPoint supports all the usual RBAC features, such as role hierarchies, an automatic assignment of roles and entitlement definition.
However, midPoint goes beyond traditional RBAC.
MidPoint roles can be smart.
There may be dynamic expressions inside midPoint roles, such as attribute mappings.
The roles may be conditional: one role is included in another role, but only in case that a specific condition is satisfied.
The roles may be parametric: the role can determine the specific set of entitlements based on the user data or a parameter of a role assignment.
Traditional concept of roles is enhanced with <em>policy</em>: rules, expressions and constraints applied to roles.
MidPoint advanced RBAC mechanism, together with role auto-assignment capabilities and other policy mechanisms create a very powerful combination to express complex policies.
This creates <em>policy-driven</em> RBAC, a mechanism that is quite unique to midPoint.
Although midPoint policy mechanisms are based on RBAC principles, its capabilities are similar to other popular access control models, such as attribute-based access control (ABAC) or policy-based access control (PBAC).
For the curious, there is a discussion of midPoint approach in light of other access control models at the end of this chapter.</p>
</div>
<div class="paragraph">
<p>Role dynamics in midPoint goes even one step further.
The RBAC system can be applied to the roles themselves, thus creating <em>meta-roles</em>.
It is quite common that the roles are divided into several types: application roles, business roles, technical roles and so on.
However, all the business roles have common characteristics such as common approval processes, common life-cycle policies etc.
Instead of copying the common parts into each and every business role, the business roles may be assigned a common <em>archetype</em> which acts as a meta-role.
Archetype defines all the common characteristics of all business roles, therefore the RBAC system is much easier to maintain.
More on that later.</p>
</div>
<div class="paragraph">
<p>Powerful RBAC mechanisms in midPoint are flexible enough to handle very complex scenarios.
However, we will start small.
We begin with simple scenarios, building our way up.
This chapter describes basic midPoint RBAC mechanism.
It provides enough information to start with the usual role-based approach.
Following chapters will build on that, describing more and more advanced use of the RBAC mechanism.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Terminology</div>
The term <em>RBAC</em> is many things to many people.
We use the term <em>RBAC</em> in quite a broad sense.
We do not strictly mean NIST RBAC model.
What me mean by <em>RBAC</em> is a generic mechanism that is based on the concept of roles.
Although the basic principles of midPoint RBAC are very similar to NIST RBAC model, we take the liberty to deviate from NIST model when needed.
As you will see later, such deviation is really necessary.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_reality_vs_policy">Reality vs Policy</h3>
<div class="paragraph">
<p>Previous chapters were focused on account provisioning and synchronization.
Their primary focus was an <em>account</em> (or a similar resource object).
This is what we call <em>reality</em> in midPoint way of thinking.
Accounts are objects that exist in the databases and files on the resources.
In that aspect they are almost tangible things.
Existence of an account allows user to access a particular system, to execute operations and so on.
Therefore, we consider an account to be something <em>real</em>.</p>
</div>
<div class="paragraph">
<p>However, how do we know whether an account should exist or it should not exist?
The situation would be quite clear if midPoint is the only source of truth.
In that case, if there is a linked shadow, then account should exist, if there is no shadow, then account is illegal.
However, reality is almost never that simple.
In real deployments, MidPoint is not the only source of truth.
It is usually human resource (HR) system that is the source of the truth – but only for some types of users, usually employees.
Then there are external users, temporary workers, special personas for user administrators, services, devices and so on.
Some of them may have their own authoritative source systems similar to HR database.
However, for some users it may still be midPoint which is the ultimate source of truth.
Moreover, that "truth" may be in fact only partial information, or it may be compiled from several sources.
To keep long story short: reality is messy and complicated.
It is often quite difficult to figure out which accounts particular user <em>should</em> have and which he <em>should not</em> have.
Yet, this distinction is absolutely crucial for cybersecurity.
Various identity management systems came with broad range of mechanisms to handle this problem, and sadly, those mechanisms are often not very good.
Fortunately, midPoint was designed from the beginning with a full awareness of this problem.
Therefore, there is a clean distinction between <em>reality</em> and <em>policy</em> in midPoint.</p>
</div>
<div class="paragraph">
<p>Accounts, shadows and links are what we refer to as <em>reality</em>.
Those describe what <em>exists</em>, what <em>is</em>.
Then there is a separate mechanism to describe <em>policy</em>.
Policy, in midPoint parlance, means definition of what <em>should be</em>.
In the ideal world, <em>reality</em> and <em>policy</em> should be in accord.
They should describe the same state of things.
However, we do not live in ideal world.
Perfectly good accounts may be deleted by mistake, illegal accounts may be created, entitlements may get mixed up, attribute values may get destroyed – there are many dangers in the big wild world out there.
Then there are scenarios when we actually <em>want</em> reality to be different from policy for a given period of time.
Those may be migration scenarios when a new system is being connected to midPoint and the data needs to be cleaned up.
<em>Reality</em> and <em>policy</em> do not match exactly in practice.
We all know that only too well.
Therefore, midPoint is designed in such a way that it can graciously handle the differences between <em>reality</em> and <em>policy</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_assignment">Assignment</h3>
<div class="paragraph">
<p>When it comes to policy, the most important concept is an <em>assignment</em>.
Simply speaking, assignment is a data structure which specifies that a particular user should have something.
The simplest case is <em>account assignment</em>.
This type of assignment states that the user should have an account on a particular resource.</p>
</div>
<div class="paragraph">
<p>The mechanism that midPoint uses to define that a particular user needs an account, entitlement or other resource object is called <em>construction</em>.
The simplest case is a <em>construction</em> that specifies to create an account (a.k.a. <em>account construction</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
             <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The term <em>construction</em> means that object on that particular resource should be <em>constructed</em>.
In this case, the object on OpenLDAP resource should be constructed for this particular user.
If no construction parameters are specified then a <em>default account</em> will be constructed.
Which means that outbound mappings in the OpenLDAP resource definition will be used to set up the account.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-01-user-assignment-resource-simple.png" alt="Simple account assignment">
</div>
</div>
<div class="paragraph">
<p>Construction can be quite a complex data structure describing object types, object classes, attributes and so on.
However, it is unlikely that they will be placed directly in <em>assignment</em> like in the above example.
More on that later.
What is important for now is that assignments specify <em>policy</em>.</p>
</div>
<div class="paragraph">
<p>After the assignment is added to a user, and all the processing and provisioning takes place, the situation looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-02-user-assignment-resource-account.png" alt="Simple account assignment and account link">
</div>
</div>
<div class="paragraph">
<p>Assignment is a definition of policy which states that an OpenLDAP account should exist for Alice.
When such assignment is added to Alice, there is suddenly a discrepancy between reality and policy.
The assignment states that Alice <em>should have</em> an account, but no such account exists on OpenLDAP resource yet.
It is a nature of midPoint to align policy and reality as much as possible (unless it is told otherwise).
Therefore, midPoint tries to create missing account.
Once that account is created, <em>reality</em> and <em>policy</em> are aligned once again.</p>
</div>
<div class="paragraph">
<p>This may look like a very complicated method to do something simple.
However, this kind of thinking is really necessary to handle complex cases.
There may be several assignments that mandate the same account.
There may be assignments for the same accounts, but each assignment mandates different attributes or values.
The account that the assignments mandate may exist already, e.g. it may be linked by previous reconciliation with the resource.
There may be several accounts for the same user on the same resource (e.g. "ordinary" account and "testing" account).
And so on.
We will deal with various cases in this book.
Yet, the basic principle is always the same: assignments are <em>policy</em> and midPoint is trying to align <em>reality</em> to match the <em>policy</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_roles_2">Roles</h3>
<div class="paragraph">
<p>There is much more in the concept of an assignment than just the very simple account assignment.
<em>Assignment</em> is a generic mechanism that is used in midPoint for wide variety of cases, from simple account provisioning to really complex identity governance policies.
One specific assignment type is particularly interesting with respect to the topic of this chapter: role assignment.</p>
</div>
<div class="paragraph">
<p>The basic idea of role-based access control (RBAC) is simple:
Instead of assigning account to users directly, let us group all accounts that a particular group of users need into a <em>role</em>.
Then assign the role to users.
Later on you may add new application to your system, and you probably want existing the users to have account there.
In that case all that is needed is to add that account to a <em>role</em> and recompute the users.
All the users that should have the account will get the account.
This principle is reused for many purposes in midPoint: accounts, privileges, authorizations, policies &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p><em>Role</em> is a special type of object in midPoint.
Yet, as all midPoint objects, role has a very familiar structure:</p>
</div>
<div class="listingblock">
<div class="title">role-business-analyst.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aaa6cde4-0471-11e9-9b50-c743da469067</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Business analyst<span class="tag">&lt;/name&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Role object has its <em>object identifier (OID)</em> and <em>name</em>.
The rest of the role usually specifies the privileges that the role gives to the users.
We can <em>assign</em> the role to a user by creating an <em>assignment</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aaa6cde4-0471-11e9-9b50-c743da469067</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>User <code>alice</code> has role <code>Business Analyst</code> assigned.
The assignment is using the familiar style of object references in midPoint, referring to the role by its object identifier (OID).
This is very useful, as the assignment stays valid in case that the role or the user are renamed - and both of those events are much more frequent that one would think.</p>
</div>
</div>
<div class="sect2">
<h3 id="_roles_and_provisioning">Roles and Provisioning</h3>
<div class="paragraph">
<p>Provisioning is the bread and butter of identity management.
Therefore, it is quite understandable that the most natural usage of roles in midPoint is to automate provisioning.
Provisioning roles are usually combining several <em>construction</em> statements.
The idea is that a provisioning role should specify all the privileges that users of that role need.
Therefore, a <code>Business Analyst</code> role may look like this:</p>
</div>
<div class="listingblock">
<div class="title">role-business-analyst.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aaa6cde4-0471-11e9-9b50-c743da469067</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Business analyst<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
             <span class="comment">&lt;!-- OpenLDAP resource --&gt;</span>
             <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
             <span class="comment">&lt;!-- CRM resource --&gt;</span>
             <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">04afeda6-394b-11e6-8cbe-abf7ff430056</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The usual case is that every employee need to have basic access to company functionality.
In our case, that access is granted by an account in central OpenLDAP directory.
In addition to the basic LDAP account, business analysts need access to the CRM system.
The role combines all the accounts that a business analyst needs.
Assign that one role, and the user has all that is needed to do the job.</p>
</div>
<div class="paragraph">
<p>The key to the functionality of roles is <em>inducement</em>.
Think of <em>inducement</em> as indirect assignment.
Assignments give privileges directly to the object in which they are placed.
The assignment in the previous section gave account to the user, because it was placed in the user object.
However, here we do not want the accounts to be created for a role.
We want accounts to be created for all the users that have the role.
That is one <em>order of indirection</em> down the line.
Therefore, we (usually) do not want to use assignments in roles.
We want to use something that reflects this indirect relation.
That is exactly what <em>inducement</em> is.
Inducement is very similar to assignment - in fact it has exactly the same structure.
However, while assignment is direct, inducement is indirect.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-03-user-assignment-role.png" alt="User, role and resource">
</div>
</div>
<div class="paragraph">
<p>MidPoint user interface can show a nice summary of the inducements:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-04-gui-role-inducements.png" alt="Role inducements in user interface">
</div>
</div>
<div class="paragraph">
<p>It is perhaps worth explaining what happens if this <code>Business analyst</code> role is assigned to a user.
When <code>Business analyst</code> role is assigned to a user, midPoint processes all the parts of role definition.
MidPoint takes the inducements from the role, and applies them to the user.
In fact, midPoint behaves in almost the same way as if those construction statements were specified directly in user’s assignment.
This results in a familiar situation: policy mandates that two accounts should exit, but in reality there are no such accounts.
Therefore midPoint creates the accounts.
Of course, midPoint also creates appropriate shadow objects and links them to the user.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-05-user-assignment-role-accounts.png" alt="User, role assignment, shadows and accounts">
</div>
</div>
<div class="paragraph">
<p>This is how midPoint implements role-based access control (RBAC) for provisioning purposes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_roles_accounts_and_attributes">Roles, Accounts and Attributes</h3>
<div class="paragraph">
<p>We have already seen how <em>outbound mappings</em> can be used in resource to set up account attributes.
Roles can also contain outbound mappings, therefore they can be used for a similar purpose:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aaa6cde4-0471-11e9-9b50-c743da469067</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Business analyst<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
             <span class="comment">&lt;!-- OpenLDAP resource --&gt;</span>
             <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
             <span class="tag">&lt;attribute&gt;</span>
                 <span class="tag">&lt;ref&gt;</span>ri:title<span class="tag">&lt;/ref&gt;</span>
                 <span class="tag">&lt;outbound&gt;</span>
                     <span class="tag">&lt;expression&gt;</span>
                         <span class="tag">&lt;value&gt;</span>Business Analyst<span class="tag">&lt;/value&gt;</span>
                     <span class="tag">&lt;/expression&gt;</span>
                 <span class="tag">&lt;/outbound&gt;</span>
             <span class="tag">&lt;/attribute&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
    ...
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the above role is assigned to a user, an account on OpenLDAP server is created.
The account is provisioned in a usual way - all the outbound mappings from resource definition are applied to set up the account.
However, there is one difference.
The role specifies one additional outbound mapping for the account.
This mapping is included in the set of usual account mappings when the account is provisioned.
Therefore, the account has attribute <code>title</code> set to <code>Business Analyst</code>.</p>
</div>
<div class="paragraph">
<p>This is a very typical pattern used by many midPoint deployments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Common and usual attribute values are specified by outbound mappings in the <em>resource definition</em> (in <code>schemaHandling</code>).
Usually, those mappings that take <em>user</em> properties as their source, producing values for <em>account</em> attributes.
Many of those mappings do not even transform the value at all (<code>asIs</code> mappings).
Common identity attributes such as <em>username</em> and <em>full name</em> are provisioned this way.</p>
</li>
<li>
<p>Attributes that are specific to roles are defined in the roles themselves.
Those mappings often do not have any source at all.
They just set a static value (literal <code>value</code> mappings).
<em>Entitlement associations</em> such as group membership are also provisioned this way.
More on that later.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At the time when midPoint is about to provision an account, all the mappings are merged and processed together.
It is quite common that more than one role has a construction for the same account.
All those constructions from all such roles are merged together, and they are added to the mappings specified in resource definition.
All those mappings are used to compute final values of account attributes.</p>
</div>
<div class="paragraph">
<p>Most account attributes are <em>single-valued</em>.
Attempt to set more than one value for such an attribute ends up with an error.
Therefore, it does not make sense to specify more than one mapping for single-valued attribute.
The mapping can be specified in a <em>resource definition</em> or in the <em>role</em>, but only one of those should be active at any time.
Mapping <em>conditions</em> and <em>strength</em> can be used to selectively deactivate some mappings in more complicated cases.
However, it still means that only one mapping is supposed to set the value.</p>
</div>
<div class="paragraph">
<p>Some account attributes are <em>multi-valued</em>.
In that case, midPoint merges the values from all the mappings.
Several <em>roles</em> may contribute to the final set of attribute values, as can the mappings in <em>resource definition</em>.
This is the usual case of attributes that specify privileges, such as permissions, authorization codes, access control list (ACL) entries and so on.</p>
</div>
<div class="paragraph">
<p>Merging of multi-valued attributes is an easy way how to manage simple privileges in resources.
However, midPoint contains sophisticated mechanism for managing <em>entitlements</em> such as groups.
There is an entire chapter in this book dedicated to entitlement management.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Additive principle.</div>
MidPoint is built on a principle of <em>merging</em>.
Assigned roles are merged together, further merged with outbound mappings, entitlements are merged and so on.
MidPoint always adds, it never subtracts.
E.g. there is no simple way how one role can "eliminate" a value given by another role.
If a role specifies that an account should have value <code>A</code>, that account will have value <code>A</code>.
That’s it.
It can also have values <code>B</code> and <code>C</code> given by other roles.
However, <code>A</code> will always be there, no matter what other roles do (unless those roles are involved in some really dark magic).
This may seem quite limiting.
However, it is sufficient for the vast majority of cases.
It only needs a change in your way of thinking about privileges.
Do not think about <em>removing</em> a privilege.
Think about <em>not adding</em> a privilege.
There are many ways how that can be achieved.
There is a role hierarchy, mappings can be conditional and whole assignments and inducements can be conditional too.
We are trying really hard to avoid concept of "removing" privileges, because that requires ordered processing.
E.g. if role <code>X</code> adds something and role <code>Y</code> removes it, the final result depends on the order in which such roles are processed.
This creates ambiguities, it limits parallelism and overall it is a huge complication.
Therefore, we try to avoid it.
And so far we have been successful.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_role_hierarchy">Role Hierarchy</h3>
<div class="paragraph">
<p>Ability to group privileges into roles is somehow useful.
However, it is still not good enough unless your access control policy is extremely simple.
Most practical policies require placing roles into roles, thus creating <em>role hierarchy</em>.</p>
</div>
<div class="paragraph">
<p>Let’s consider two work positions: <em>clerk</em> and <em>supervisor</em>.
We are going to create roles for both work positions.
Clerk has some basic set of privileges.
Supervisor can do everything that a clerk can do, but supervisor has some additional privileges.
A naive way would be to simply copy all the clerk’s privileges in supervisor’s role.
However, privileges are seldom static.
Access control policies tend to change and evolve as much as the environment changes.
It is likely that a clerk’s privileges will change in the future.
In that case, we would need to update the supervisor’s role as well.
This would be a maintenance burden.
Now imagine hundreds or thousands of related roles that need constant maintenance.
Any person maintaining such a structure would need superhuman precision and patience to do that.</p>
</div>
<div class="paragraph">
<p>A better idea is to <em>include</em> clerk’s role into a supervisor’s role.
If clerk’s privileges change, then also supervisor’s privileges are automatically updated.
Maintenance is much easier.
This is the basic idea of <em>role hierarchy</em>.
Basic privileges are placed into low-level roles.
Low-level roles are combined to create a higher-level roles.
Then those roles may be combined as well.
The process is repeated until there are all the roles that are needed for assignment to users.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-06-role-hierarchy.png" alt="Role hierarchy">
</div>
</div>
<div class="paragraph">
<p>Creating role hierarchies in midPoint is quite easy.
A clever reader would already expect that this has something to do with <em>inducements</em> - and clever reader would be absolutely right.
Role hierarchy is nothing more than a set of <em>inducements</em> between roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">48d4ef98-20e3-46ab-cd78-548d38364a6b</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Clerk<span class="tag">&lt;/name&gt;</span>
    <span class="comment">&lt;!-- Privileges needed to do clerk’s work will be here. --&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">86e58643-d5e7-36a8-04f6-38dc3754f04e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Supervisor<span class="tag">&lt;/name&gt;</span>
    <span class="comment">&lt;!-- Privileges that are unique to supervisor’s work will be here. --&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="comment">&lt;!-- This &quot;includes&quot; all the clerk’s privileges in this role --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">48d4ef98-20e3-46ab-cd78-548d38364a6b</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>inducement</em> includes <code>Clerk</code> role in <code>Supervisor</code> role.
When midPoint evaluates the <code>Supervisor</code> role, it gets all the <em>inducements</em> from both the <code>Supervisor</code> and <code>Clerk</code> roles.
This process is almost transparent, it works almost as if the clerk’s privileges were copied in the supervisor’s role.
All the constructions in all the inducements in both roles are processed.
Therefore, supervisor will get all the accounts that a clerk would get, plus few extra privileges.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-07-supervisor-clerk-inducement.png" alt="Supervisor-clerk inducement">
</div>
</div>
<div class="paragraph">
<p>Both <code>Clerk</code> and <code>Supervisor</code> roles are likely to have <em>construction</em> for the same account.
This is quite natural, as both clerk and supervisor would probably work with the same applications.
However, their privileges are different.
This is where the merging mechanism becomes very useful.
When a supervisor role is processed, then privileges of clerk are merged with privileges of supervisor:</p>
</div>
<div class="listingblock">
<div class="title">role-clerk.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">48d4ef98-20e3-46ab-cd78-548d38364a6b</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Clerk<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
             <span class="comment">&lt;!-- Record management system --&gt;</span>
             <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">84de003e-014f-2040-efbc-482e009ed2bcf</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
             <span class="tag">&lt;attribute&gt;</span>
                 <span class="tag">&lt;ref&gt;</span>ri:priv<span class="tag">&lt;/ref&gt;</span>
                 <span class="tag">&lt;outbound&gt;</span>
                     <span class="tag">&lt;expression&gt;</span>
                         <span class="tag">&lt;value&gt;</span>read<span class="tag">&lt;/value&gt;</span>
                         <span class="tag">&lt;value&gt;</span>create<span class="tag">&lt;/value&gt;</span>
                     <span class="tag">&lt;/expression&gt;</span>
                 <span class="tag">&lt;/outbound&gt;</span>
             <span class="tag">&lt;/attribute&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">role-supervisor.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">86e58643-d5e7-36a8-04f6-38dc3754f04e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Supervisor<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
             <span class="comment">&lt;!-- Record management system --&gt;</span>
             <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">84de003e-014f-2040-efbc-482e009ed2bcf</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
             <span class="tag">&lt;attribute&gt;</span>
                 <span class="tag">&lt;ref&gt;</span>ri:priv<span class="tag">&lt;/ref&gt;</span>
                 <span class="tag">&lt;outbound&gt;</span>
                     <span class="tag">&lt;expression&gt;</span>
                         <span class="tag">&lt;value&gt;</span>approve<span class="tag">&lt;/value&gt;</span>
                         <span class="tag">&lt;value&gt;</span>modify<span class="tag">&lt;/value&gt;</span>
                         <span class="tag">&lt;value&gt;</span>delete<span class="tag">&lt;/value&gt;</span>
                     <span class="tag">&lt;/expression&gt;</span>
                 <span class="tag">&lt;/outbound&gt;</span>
             <span class="tag">&lt;/attribute&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">48d4ef98-20e3-46ab-cd78-548d38364a6b</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When supervisor’s role is processed, midPoint figures out that those two <code>construction</code> statements are referring to the same account.
Therefore, they are merged together.
Supervisor gets an account that has <code>priv</code> attribute set to values <code>read</code>, <code>create</code>, <code>approve</code>, <code>modify</code> and <code>delete</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-08-supervisor-clerk-inducement-constructions.png" alt="Supervisor-clerk inducement with constructions">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Assignments in roles.</div>
So far we have seen only <em>inducement</em> in the roles.
But what about <em>assignment</em>?
<em>Assignment</em> is indeed used in the roles, but it has different meaning.
<em>Inducement</em> means that role <code>A</code> has to be included in role <code>B</code>.
However, <em>assignment</em> means that role <code>A</code> has to be applied to role <code>B</code>.
In that case, role <code>A</code> is in fact a <em>meta-role</em>.
More on that later.
For now, it is good to remember a rule of the thumb: role hierarchy is always created by <em>inducements</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_role_universality">Role Universality</h3>
<div class="paragraph">
<p>MidPoint role is a very useful kind of animal, therefore it is used for almost everything in midPoint.
MidPoint role can be used as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Provisioning role:</strong> The role can include <em>constructions</em> that control provisioning and deprovisioning of accounts.</p>
</li>
<li>
<p><strong>Entitlement management:</strong> The constructions can include specification of <em>entitlement associations</em> such as membership in groups, resource-side roles, possession of privileges and so on.</p>
</li>
<li>
<p><strong>Internal authorization:</strong> The roles give access to data in midPoint itself.
E.g. a role can allow reading selected user properties.
<em>Authorizations</em> in a role can also allow access to particular parts of midPoint user interface, remote network services and so on.</p>
</li>
<li>
<p><strong>Policy specifications:</strong> Roles (and especially meta-roles) are the places where important parts of <em>policy management</em> is specified.
Roles include <em>policy rules</em> that can apply segregation of duties (SoD) policies, approval policies, compliance policies and so on.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All those aspects can be combined into a single role.
Therefore, such role can specify everything that is needed for the role holder to live a complete digital life: access to systems (accounts), entitlements, access to midPoint itself (e.g. for self-service), apply policy constraints and so on.
Everything in one place.</p>
</div>
<div class="paragraph">
<p>Role universality may seem mundane and completely natural, but in fact it is quite unique and incredibly powerful idea.
As you will see later, roles can be driven through approval process, lifecycle management can be applied to role, roles can be subject to policies, role compliance can be evaluated and so on.
All of this applies to ordinary (provisioning) roles.
However, the same mechanism can be applied also to roles that govern the administration of midPoint itself - even to meta-roles that specify high-level policies.
Which means that in a strange post-modern way, midPoint can be applied to itself.
MidPoint can be its own manager.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Surprisingly, role universality is quite a unique concept in the identity management field.
The common approach of traditional identity management systems is to separate provisioning roles, authorization roles, governance roles and so on.
Each of them was different, and it was managed in a different way.
It was quite difficult to create a unified and consistent policy.
This is one of many aspects where midPoint provides a seemingly simple mechanism, but that mechanisms simplifies a lot of things and provides an elegant solution to a difficult problem.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_role_engineering">Role Engineering</h3>
<div class="paragraph">
<p>There are many ways how a role hierarchy can be structured.
One way is to create all roles as "end user" roles that are supposed to be directly assigned to user.
The clerk-supervisor example above is that case.
The low-level roles (e.g. <code>Clerk</code>) should contain all the privileges necessary for that role to function in an organization, such as all the necessary access to all the applications, networks, services and devices.
Then combine the elemental roles into a bigger roles, combining business responsibilities as needed.
Repeat the process until the entire access control landscape is covered with beautiful roles.</p>
</div>
<div class="paragraph">
<p>That is the theory.</p>
</div>
<div class="paragraph">
<p>It is perhaps no big surprise that the practice is quite different.
There is one big problem with the theoretical approach described above.
It assumes that the person who defines roles <em>knows</em> what privileges should be included in that role.
I.e. it assumes that business processes and especially business responsibilities are clearly defined.
It is a very reasonable assumption.
It is also an assumption that is almost always utterly false.</p>
</div>
<div class="paragraph">
<p>Oh no!
How can we proceed if one of our fundamental assumptions is false?
Is role-based access control (RBAC) doomed to failure?
Certainly, there are people who eagerly proclaim that role-based approach is useless, suggesting many innovative approaches that are usually even more useless in practice.
Role-based access control is not dead, not even close.
RBAC practice is just much harder than it may seem.</p>
</div>
<div class="paragraph">
<p>Yes, it is true that nobody knows exactly what privileges a clerk should have.
However, it is known what privileges Harry Harris needs to do his day-to-day work.
Harry is a clerk.
Therefore, it is perhaps fair to assume that the privileges that Harry has are pretty much the same privileges that should be included in clerk role.
This <em>bottom-up</em> approach may not be perfect for business analytics puritans, but it is a practical approach, favored by many pragmatic organizations.</p>
</div>
<div class="paragraph">
<p>However, it is not practical to start with roles that have business meaning.
I.e., it is not practical to start with <code>Clerk</code> role, as we do not yet know what privileges should be in that role - because we do not know what privileges Harry has yet, and we may not even know that Harry is a clerk.
There are too many missing pieces to start solving the <em>business</em> puzzle yet.</p>
</div>
<div class="sect3">
<h4 id="_application_roles">Application Roles</h4>
<div class="paragraph">
<p>We start by creating <em>application roles</em>.
Those roles deal with access to a single <em>application</em>.
An application role may be quite broad, as giving access to the entire application, or it may be quite narrow giving access to small parts of the application.</p>
</div>
<div class="paragraph">
<p>The usual starting point is to create an application role for every <em>group</em> in Active Directory or a similar central directory system.
<em>Groups</em> are very good starting material.
They tend to be the right granularity, not too broad, not too narrow.
Users are already assigned to groups, as they need the privileges given by the group membership to carry out their work.
Therefore, the groups form some kind of basic vocabulary to start access control conversation among application administrators, business people and role engineers.
Starting with groups makes sense from a business continuity perspective as well.
Good starting point, indeed.</p>
</div>
<div class="paragraph">
<p>Let us create application role for every Active Directory group.
Such application role grants <em>account</em> in Active Directory, as well as <em>membership</em> in one specific <em>group</em>.
MidPoint <em>entitlement</em> mechanism is an ideal tool to do this.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Entitlements and synchronization of application roles</div>
Indeed, midPoint <em>entitlement</em> mechanism is an ideal tool for building application roles.
Unfortunately, the <em>Entitlements</em> chapter of this book is not written yet.
MidPoint reference documentation can provide the necessary information in the meantime.
Similarly, <em>generic synchronization</em> is an ideal tool to keep <em>groups</em> and <em>application roles</em> consistent.
There are some information about <em>generic synchronization</em> in the <a href="#10-orgstruct">Organizational Structure</a> chapter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Strictly speaking, <em>application roles</em> are not meant to be assigned directly to users.
They are supposed to be abstract, to be the base "material" used to create higher-level roles.
However, we are not at that maturity level yet.
We have to accept that application roles are assigned directly to users, at least for now.
Although we are not strictly doing any serious role-based access control yet, we can already do some role-based magic with application roles only.
Once we have application roles, users can request them, we can review and approve the request, assign some roles automatically and so on.
We can keep track of <em>who</em> has <em>what</em> and <em>why</em>, <em>when</em> it was assigned and <em>how</em> (requested, approved) - these are very useful data.
<em>Owners</em> can be assigned to application roles, keeping an information who is responsible for each particular group.
There is still a lot of value even at this point.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Misery of application roles</div>
Obviously, there are some downsides to using application roles.
Application roles duplicate the information that is already present in the resource.
E.g. there is one application role for each Active Directory group.
When an information is duplicated, there is potential for the copies to become inconsistent.
As there is usually a huge number of application roles, automatic synchronization is an absolute must to make long-term maintenance of application roles feasible.
Strictly speaking, application roles may not be necessary in midPoint.
MidPoint has a clean concept of <em>construction</em> that can refer to <em>entitlements</em>, which can be directly used in business role.
However, this method is difficult to combine with the <em>bottom-up</em> approach, therefore it is not used often.
During the early years of midPoint we had hope to avoid using application roles at all.
Even earlier versions of this book advocated such approach.
However, the practice of application roles seems to be well established already.
Even though application roles may not be perfect, they are very practical.
We have to admit that.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_business_roles">Business Roles</h4>
<div class="paragraph">
<p>Once we have the application roles, we can start combining them into roles that have a <em>business</em> meaning.
Those higher-level roles are called <em>business roles</em>, as they reflect the needs of the business, such as specific job or responsibility in a business process.</p>
</div>
<div class="paragraph">
<p>Here comes the <code>Clerk</code> role at last.
The <code>Clerk</code> role is created by combing several application roles.
How do we know what roles to combine into <code>Clerk</code> role?
We have a look at Harry Harris, who is a clerk.
Application roles that Harry has are probably the application roles that should be included in <code>Clerk</code> business role.
This is the way we can create our business roles, working from the bottom up.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-09-role-hierarchy-application-business.png" alt="Role hierarchy - application and business roles">
</div>
</div>
<div class="paragraph">
<p>This sounds easy, yet it never really is that simple.
Harry may have other responsibilities besides being a clerk.
Therefore, the <code>Clerk</code> role is not supposed to contain all the Harry&#8217;s application roles.
We may need to have a look at the roles of Violet Vickers who is doing similar job in the same organization unit and compute an intersection of Harry&#8217;s and Violet&#8217;s application roles.
Even that may not be entirely precise, as both Harry and Violet may have other responsibilities, and they may share a common application role purely by chance.
Also, there may be roles that Harry and Violet have, and they do not actually need them.
It is very difficult to get this exactly right.
However, it is perhaps better to have not entirely precise yet somehow manageable system than to have no system at all.</p>
</div>
<div class="paragraph">
<p>It may be daunting task to do this analysis for every user (or combination of users), manually, with just a rudimentary tooling.
This smells like huge spreadsheets that gets outdated even sooner than the analysis is done.
In fact, it is usually feasible to define just a small subset of business roles, leaving many application roles assigned directly to users.
This is not entirely right, not right at all.
Yet, it is feasible, while complete business role coverage is usually not.
Once again, it is better to have working partial solution than to have non-working perfect solution.</p>
</div>
<div class="paragraph">
<p>Yet, there is some hope.
So-called "artificial intelligence" methods have quite improved lately, creating practical tools.
Such techniques can be applied to role engineering as well, usually in a form of <em>role mining</em>.
Role mining is an automated process that detects similarities in role assignments.
It can detect that a specific combination of application roles is assigned to a specific group of users.
Such combination could make a good candidate for a business role.
Role mining can do this at scale, analyzing many users and roles in one session.
This is a great tool to speed up role engineering process.
The tooling is quite rudimentary for now, and it may look somehow complex to use.
Yet, it is practical, for those that have the courage to try it.
MidPoint 4.8 has a role mining capability that is worth trying.</p>
</div>
</div>
<div class="sect3">
<h4 id="_role_types">Role Types</h4>
<div class="paragraph">
<p>In some deployments, there are more types of roles, not just <em>application</em> and <em>business</em> roles.
The other roles are much less common, yet they are used from time to time.
The table below summarizes role types:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Content</th>
<th class="tableblock halign-left valign-top">Should be assigned to users?</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role describing access to a single <em>application</em>.
Usually represents one specific <em>entitlement</em> in the application, such as application group, privilege or role.
It is bound to one specific application (hence the name).</p>
<p class="tableblock">Application roles are often created automatically by importing/synchronizing entitlements, e.g. by importing Active Directory groups.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to a single application.</p>
<p class="tableblock">MidPoint <code>construction</code> with reference to a single resource.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p>
<p class="tableblock">Yet, they are quite often assigned to users.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active Directory Domain Administrators</p>
<p class="tableblock">Company Website Editors</p>
<p class="tableblock">Database <code>foo</code> read-only access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Technical role</p>
<p class="tableblock">IT role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combines several application roles or low-level privileges into one unit that is easier to manage.
Often used for application roles that depend on each other, e.g. when operating system access is needed to perform database administration.
They are considered to be somewhere between <em>application roles</em> and <em>business roles</em>.
They are not application roles, as they can give access to several applications.
They are not business role either, as they do not describe a complete business responsibility, and they often use very technical and non-business-friendly terminology, which makes them a separate species on their own.
They are not used very often.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to a couple of application that depend on each other, or make sense together.</p>
<p class="tableblock">Several midPoint `construction`s, referencing couple of resources.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In exceptional cases, e.g. very specific and complex IT responsibility.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database <code>bar</code> administration with OS access</p>
<p class="tableblock">Backup/restore management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides internal authorizations or privileges in the system where it is defined.
In midPoint, these are roles that provide access to parts of midPoint itself.
Authorization roles do not grant access to any other systems.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MidPoint <code>authorization</code> statements.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No.</p>
<p class="tableblock">Yet, some roles may be assigned to users in early stages of the deployment when business roles are not fully formed yet.
Especially the <code>Superuser</code> role.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MidPoint <code>Superuser</code> role</p>
<p class="tableblock">MidPoint <code>Approver</code> role</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business role represent a business responsibility, function in a business process, business-related work position or similar business concept.
Business roles are supposed to be a combination of smaller "elemental" roles.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any other role type, including other business roles.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Clerk</code></p>
<p class="tableblock"><code>Branch Supervisor</code></p>
<p class="tableblock"><code>Marketing Assistant</code></p>
<p class="tableblock"><code>Call Center Operator</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are pre-defined <em>archetypes</em> for application and business roles in midPoint 4.8.
As we will explain later, <em>archetypes</em> give character and behavior to objects.
The two pre-defined role archetypes are ready to use in midPoint.
Role wizards are prepared to create new <em>application</em> and <em>business</em> roles to match the archetypes.</p>
</div>
<div class="paragraph">
<p>Overall, role engineering is an <em>art</em> rather than a science.
It is not strictly a technological job.
Entire identity management and governance is about business-IT cooperation, which is never easy.
Role engineering is even harder, as there is even bigger overlap to business.
Much more cooperation, patience and persistence is necessary to get practical results.
However, the results are well worth the effort.
More on that later, in future versions of this book.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_assignment_gets_complicated">Assignment Gets Complicated</h3>
<div class="paragraph">
<p>At the first sight, the concept of <em>assignment</em> may seem quite mundane, maybe even over-complicated.
In fact, it is a very powerful concept, and it has been a crucial part of midPoint design from the very beginning.
Assignment is so much more that just a simple user-role connection:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assignments can have <strong>validity period</strong>.
This can be used to assign roles for a temporary period of time.
It can also be used to assign roles that will be activated in the future.</p>
</li>
<li>
<p>Assignment have <strong>administrative status</strong> that can be used to manually disable or enable a particular assignment.
This can be used to manage exceptions from the policies or it can be very useful in emergency situations.</p>
</li>
<li>
<p>Assignments can contain <strong>parameters</strong> that are used to support parametric roles.</p>
</li>
<li>
<p>Assignments are subject to policies, governance and compliance mechanisms.
Assignments have their lifecycle, they are subject to re-certification campaigns, there can be policy exception recorded for an assignment and so on.
More on that in later chapters of this book.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, assignment validity period can be used to assign a role only for a temporary period:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>bob<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="comment">&lt;!-- Deputy Cheerleader role --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0c87d8f8-c9a4-11e9-81b8-e7d43e9f9a2b</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;activation&gt;</span>
            <span class="tag">&lt;validTo&gt;</span>2019-12-31T23:59:59Z<span class="tag">&lt;/validTo&gt;</span>
        <span class="tag">&lt;/activation&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As <em>assignment</em> and <em>inducement</em> are in fact the same data structure, similar approach can be used to disable parts of role hierarchy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role&gt;</span>
    <span class="tag">&lt;name&gt;</span>Marketing Research Undersecretary<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;indudement&gt;</span>...<span class="tag">&lt;/indudement&gt;</span>
    <span class="tag">&lt;indudement&gt;</span>...<span class="tag">&lt;/indudement&gt;</span>
    ...
    <span class="tag">&lt;indudement&gt;</span>
        <span class="tag">&lt;description&gt;</span>
            Employee access to the lab is disabled because the lab burned down
            during an ugly accident. Will be re-enabled when the lab is rebuilt.
        <span class="tag">&lt;/description&gt;</span>
        <span class="comment">&lt;!-- Experimental Research Lab Access role --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e8ef819c-c9a4-11e9-80a8-1bddb446391e</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;activation&gt;</span>
            <span class="tag">&lt;administrativeStatus&gt;</span>disabled<span class="tag">&lt;/administrativeStatus&gt;</span>
        <span class="tag">&lt;/activation&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Many types and variants of assignments can be combined in a single user.
Assignment validity periods may overlap, there may be disabled assignments and enabled assignments for the same role at the same time, there may be several assignments to the same role with various parameters and so on.
All reasonable combinations are supported, which allows modeling very complicated schemes such as multi-affiliation, multiple employment contracts and so on.
<em>Assignment</em> is a crucial data structure for midPoint platform, and we will be dealing with it in almost every chapter in the book.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dynamic_roles">Dynamic Roles</h3>
<div class="paragraph">
<p>RBAC is a nice and elegant method to create and maintain access control policies.
However, there is a serious danger: roles can be quite explosive.
The role structure can easily get out of control, and the roles may start to multiply.
This is known as <em>role explosion</em>, and it is one of the nastiest drawbacks of access control system based on static roles.
It is not uncommon for an organization to have much more roles than it has users.
This creates a recurring maintenance nightmare.
Fortunately, midPoint has a very powerful support for dynamic roles that can significantly reduce or even completely eliminate the impact of role explosion.</p>
</div>
<div class="paragraph">
<p>To understand dynamic roles, we first need to understand what is the problem with static roles.
Many organizations have jobs that are very similar, they just differ is some small detail.
For example, all bank tellers are similar, the difference is just the branch office where they work.
Similarly, all the assistant jobs are pretty much the same.
The difference is the department or section that they work for.
Therefore, there is <code>Sales Assistant</code>, <code>Engineering Assistant</code>, <code>Logistics Assistant</code> - and a hundred or so similar roles.
Almost all the privileges in those roles are the same.
Of course, we can create an (abstract) role <code>Assistant</code> that will have all the common privileges.
However, we still need those hundreds of specific assistant roles as sub-roles of the common <code>Assistant</code> role.
And then it gets even worse, because there may be <code>Senior Sales Assistant</code>, <code>Trainee Sales Assistant</code>, <code>Senior Engineering Assistant</code>, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>The key to the role explosion is a realization that those "exploded" roles are created in an algorithmic way.
Maybe we do not need <code>Sales Assistant</code>, <code>Engineering Assistant</code> and <code>Logistics Assistant</code> roles at all.
Maybe we need just one <code>Assistant</code> role.
The organizational unit (sales, engineering or logistics) is just a parameter to that role.
Then the number of roles can be significantly reduced.
This is what we call <em>parametric roles</em>.</p>
</div>
<div class="paragraph">
<p>Parametric roles are not your ordinary garden-variety roles that contain a fixed set of privileges.
Parametric roles need to be much smarter.
E.g. the <code>Assistant</code> role needs an algorithm, that takes the organization unit as an input, and it outputs privileges that are appropriate for that organizational unit.
This may be a simple expression that determines correct group name based on organizational unit name.
Yet, it may be quite a complex code that determines most efficient location of home directories and other resources based on office location.
There is no free lunch.
The algorithm that was used to generate the number of "exploded" roles is not going to magically disappear.
In case of parametric roles, that algorithm needs to be placed in the role itself.
However, it may still be easier to maintain a couple of expressions in few smart roles than to maintain thousands upon thousands of ordinary roles.</p>
</div>
<div class="paragraph">
<p>The usual problem with parametric roles is, quite obviously, the presence of the parameters.
The parameters cannot be stored with the role, as they are different for each <em>assignment</em> of the role.
The parameters also cannot be stored directly with the user, as the user may have the same role assigned with a different set of parameters.
Fortunately, midPoint was designed with this problem in mind.
This was one of the big motivations to create a concept of <em>assignment</em> in the first place.
<em>Assignment</em> is the right place to store the parameters, as it is the data structure that associates user with a specific role.</p>
</div>
<div class="paragraph">
<p>ExAmPLE is a very progressive company.
Similarly to other corporations, they have functional organizational structure.
However, their employees are also organized in <em>teams</em>.
Each team can have a manager and ordinary members.
The team membership is represented by custom attributes in LDAP server.
Each user has two custom multi-value attributes: <code>exampleTeamMember</code> and <code>exampleTeamManager</code>.
Both attributes expect team name as their value.</p>
</div>
<div class="paragraph">
<p>The naïve way to handle this would be to create two roles for each team.
However, there are hundreds of team, and this approach would create a maintenance nightmare.
A smarter solution is to use parametric roles.
There are only two roles: <code>Team Member</code> and <code>Team Manager</code>.
Those roles take custom property <code>teamName</code> as parameter.
But where does this property comes from?
It comes from assignment extension.
Each time the team role is assigned, there needs to be a parameter in the assignment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>alice<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;extension&gt;</span>
            <span class="tag">&lt;exmpl:teamName&gt;</span>x-force<span class="tag">&lt;/exmpl:teamName&gt;</span>
        <span class="tag">&lt;/extension&gt;</span>
        <span class="comment">&lt;!-- Team Manager role --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aaa6cde4-0471-11e9-9b50-c743da469067</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the first part of the solution.
The second part are the roles.
The roles need to be a bit smarter to use the <code>teamName</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aaa6cde4-0471-11e9-9b50-c743da469067</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Team Manager<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
             <span class="comment">&lt;!-- OpenLDAP resource --&gt;</span>
             <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
             <span class="tag">&lt;attribute&gt;</span>
                 <span class="tag">&lt;ref&gt;</span>ri:exampleTeamManager<span class="tag">&lt;/ref&gt;</span>
                 <span class="tag">&lt;outbound&gt;</span>
                     <span class="tag">&lt;expression&gt;</span>
                         <span class="tag">&lt;path&gt;</span>$assignment/extension/teamName<span class="tag">&lt;/path&gt;</span>
                     <span class="tag">&lt;/expression&gt;</span>
                 <span class="tag">&lt;/outbound&gt;</span>
             <span class="tag">&lt;/attribute&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Resulting LDAP account looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ldif">dn: uid=alice,ou=people,dc=example,dc=com
objectclass: inetOrgPerson
...
exampleTeamManager: x-force
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This setup is illustrated in the following diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/07-10-user-parametric-role.png" alt="Parametric role assignment">
</div>
</div>
<div class="paragraph">
<p>This is the basic mechanism of parametric roles.
It is incredibly powerful mechanism.
Unfortunately, current implementation of parametric roles in midPoint is quite limited.
While midPoint was designed with parametric roles in mind, the implementation is not yet finished.
MidPoint core engine supports parametric roles quite well.
Assignment parameters and mappings should work perfectly.
However, the support for assignment parameters in midPoint user interface is very limited.
In fact, the production-quality support is limited only to the couple of hardcoded parameters (<code>orgRef</code> and <code>tenantRef</code>) and even that leaves a lot to be desired.
While we would like to improve support for parametric roles in midPoint, we have to listen to what midPoint subscribers are saying.
Our development priorities are influenced by midPoint platform subscribers.
So far platform subscribers prioritized other features and therefore there was not sufficient funding to completely finish user interface support for parametric roles.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Roles may also explode due to other reasons.
Application roles that were mentioned above may significantly contribute to role explosion.
Also attempts to "atomize" the low-level roles as an attempt to create enough "material" to compose higher-level roles may lead to explosion.
MidPoint has some mechanism that limit those effects.
However, perhaps the best approach for those cases could be summarized as "do not overdo it".
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_metaroles">Metaroles</h3>
<div class="paragraph">
<p>MidPoint roles are usually applied to users.
However, midPoint roles are <em>universal</em>.
The roles can be applied to almost any midPoint object.
Roles can be applied to users, organizations, services and even to roles themselves.
Roles applied to other roles (and other objects) are meta-roles.</p>
</div>
<div class="paragraph">
<p>Meta-roles may seem similar to a role hierarchy.
However, <em>meta-role</em> is a completely different animal.
The crucial difference is that the meta-role is applied to the <em>role</em>, and not to the user.
The inducements in the meta-role often contain policies such as approval policy, or construction clauses that create groups or organizational units.
We usually do not want to create a group for each <em>user</em>.
Yet, we often want to create a group for <em>application role</em>.
That’s what meta-role can do.</p>
</div>
<div class="paragraph">
<p>Meta-roles can specify behavior and apply policies to broad classes of other objects.
This makes meta-role mechanism very flexible and powerful, one of the most important mechanisms in midPoint.</p>
</div>
<div class="paragraph">
<p><em>Archetypes</em> are the most common objects that work as meta-roles.
Therefore, we will explain the details about meta-roles in <a href="#08-archetypes">Archetypes</a> chapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rbac_abac_pbac_and_other_wildlife">RBAC, ABAC, PBAC And Other Wildlife</h3>
<div class="paragraph">
<p>This section is where we will get all thoughtful and philosophical.
The people that are bored with philosophical questions should skip the rest of this chapter.
We will also throw some dirt on almost every access control model in existence.
Therefore, the people that maintain dogmatic beliefs about identity and access management mechanisms should skip this section as well.
On the other hand, open-minded people are quite likely to enjoy it.</p>
</div>
<div class="paragraph">
<p>Role-based access control (RBAC) is just one of many access control models.
There are many variants of RBAC, and there are other access control models that are based on a completely different paradigms.
One such popular model is attribute-based access control (ABAC).
ABAC is based on an idea that access to the systems can be determined dynamically, just based on "attributes".
Simply speaking, we can imagine ABAC as a one big algorithm that takes "attributes" as an input and decides whether access should be allowed or denied.</p>
</div>
<div class="paragraph">
<p>Policy-based access control (PBAC) is similar to ABAC.
PBAC extends the notion of attribute-based decisions to an abstract concept of <em>policy</em>.
Access decisions are still supposed to be algorithmic, although the algorithm is not limited to attributes.</p>
</div>
<div class="paragraph">
<p>ABAC is very popular in the access management (AM) community because of its simplicity.
PBAC, as an extension of the idea, is also gaining traction.
It all makes much sense, as it is much simpler and faster to evaluate one policy expression than to sift through a mountain of roles.
The problem with ABAC and PBAC is manageability.
ABAC and PBAC assume that all access control decisions could be based on algorithms, that they can be made anytime a decision is needed.
However, that is almost never the case in larger practical deployments.</p>
</div>
<div class="paragraph">
<p>Too many identity professionals dream about complete automation of access control.
It would be a marvel if an access control system could automatically determine the privileges of every person simply based on the organizational unit, work responsibilities or any other attributes of that person.
It would be perfect to get that information from an HR system, process it through a set of algorithms and automatically provision correct privileges to everybody.
That is a very nice dream, indeed.
However, reality has a different idea.
Such automated approach never really works in practice.</p>
</div>
<div class="paragraph">
<p>First problem is at the very start: HR data are almost never correct.
There is very little motivation for the HR data to be completely correct.
It is not a big issues if someone has a wrong job code or organizational unit code in the HR system.
The business goes on, the salary is paid, everybody is happy.
There is no efficient feedback loop that would force corrections in HR data - until the identity management system is deployed, that is.
It takes years or even decades for a typical company to deploy an identity management system.
At that point the HR data are beyond repair.
The corrections that need to be done in the HR system are substantial.
It is very difficult to correct HR data manually, even in small organizations.
Bigger deployments absolutely require proper tooling to do that job.
However, even with good tooling, it usually takes a lot of time to get the data right.
Many identity management deployments were significantly delayed, or even canceled, because of data quality problems.
Reliance on correct input data is dangerous.
Identity system should be able to handle wrong input data.</p>
</div>
<div class="paragraph">
<p>The identity management deployment should not be delayed because of wrong input data.
That would be like refusing to use your reading glasses because the text you are reading is misspelled.
Identity management systems are essential tools that assist you in the process of data clean-up.
The identity management system should be deployed using whatever data are available, and it should be used to manage data quality on day-to-day basis.
It is naive to think that once the data are cleaned-up they will stay clean.
The processes that crated data errors are still there, therefore data errors are going to appear all the time.
The crucial insight is to accept that there are (and will be) data errors, and to design the mechanisms to detect and correct them.</p>
</div>
<div class="paragraph">
<p>There are many manual and ad-hoc decisions that need to be made in practical identity management deployments.
This is not limited to identity management deployment <em>project</em>.
Many ad-hoc decisions must be made during routine day-to-day operation of deployed system.
Privileges need to be assigned manually to compensate for missing input data.
Privileges need to be corrected, input data need to be temporarily overridden, policy exceptions has to be made.
There are many things that need to be done manually, almost on day-to-day basis.
For ABAC, PBAC and similar models this would mean that a policy needs to be <em>updated</em> on a day-to-day basis.
However, these systems are not designed for such flexibility.</p>
</div>
<div class="paragraph">
<p>Then there is another big problem: the data are <em>incomplete</em>.
Even if HR are data are correct, the data usually do not provide all the information needed to completely provision the user with privileges.
The HR data are often limited to organizational unit and formal code of the work position.
However, this is often miles away from the job that user really does.
The usual solution to this problem relies on the users to <em>request</em> the privileges that are needed to do their jobs.
Such request is routed through appropriate <em>approval</em> process.
That <em>request</em> is a big problem for ABAC and PBAC.
What exactly should the user request to get the privileges?
Should the user request a change in the "policy"?
That would not be practical.
Should the user request a new value for an attribute?
Which attribute?
What value that would be?
Users will need a way to <em>choose</em> what they are requesting from a list of options.
Can we somehow create a catalog of the <em>things</em> that a user can request?
Once again, ABAC and PBAC are not designed for this.
Yet, all those problems are very easy to solve in RBAC.
User is expected to request a <em>role</em>.
It is quite easy to create a <em>role catalog</em>.
<em>Role</em> is a concept that users are familiar with.
However, as ABAC and PBAC do not rely on roles, there is nothing that a user can get a grip on.
There is no "handle" that would allow the user to make much sense from the abstract policies.</p>
</div>
<div class="paragraph">
<p>This is all a consequence of yet another ABAC/PBAC problem.
While ABAC/PBAC policy may be easy to set up, it is quite difficult to <em>analyze</em> and <em>maintain</em>.
There are simple and obvious questions that are very difficult to answer in ABAC/PBAC world.
What are the privileges of this specific user?
Which users are entitled to access this particular application?
Which users are affected by this particular policy statement?
How many users will be affected if I make this change to policy?
ABAC/PBAC systems would need a complex simulation algorithms to answer those questions.
However, answering such questions is quite easy in RBAC model.
In RBAC, policies are encapsulated into roles.
Therefore, only the users that have those roles are affected.
The roles also divide the policy to a smaller, manageable pieces.
Each of the roles can have its own state and lifecycle.
Therefore, it is not that difficult to work with two versions of the same role at the same time.
Old version is still assigned to some users, but we are deprecating that and slowly migrating to a new version.
Such continuous processes are difficult to do in ABAC.</p>
</div>
<div class="paragraph">
<p>Then there is still one crucial problem when ABAC/PBAC is used in provisioning scenarios.
The "policies" often benefit from the fact that complete data about the user accessing the system are available when the access control decision is made.
The crucial part of that data is called <em>context</em>.
This includes data such as time of day, network location of the user, recent events related to the user, real-time estimate of the risk and so on.
However, such data are simply not available in provisioning scenarios.
Accounts are usually provisioned long before the first access to the account is made.
Therefore, many of the advantages of ABAC/PBAC are useless in identity management scenarios that rely on provisioning.</p>
</div>
<div class="paragraph">
<p>However, ABAC and PBAC are not complete failures.
They are very useful in customer-oriented identity and access management (CIAM).
Customer identities are usually "lightweight", and the policies are simple.
However, when there is a need to manage employees, teachers, contractors and similar "heavyweight" identities then ABAC/PBAC approach almost always fails.</p>
</div>
<div class="paragraph">
<p>The fact that ABAC/PBAC fails in complex practical identity management deployments does not mean that RBAC is ideal.
Quite the contrary.
RBAC has problems of its own, and the applicability of pure RBAC in practical identity management deployments is very limited.
Many of the problems of RBAC model motivated engineers to develop ABAC, PBAC and similar models.
In fact, the "algorithmic" idea of ABAC/PBAC is not entirely bad.
Only if we had a way how to combine ABAC/PBAC and RBAC &#8230;&#8203; oh, but there is a way!
We did it already.</p>
</div>
<div class="paragraph">
<p>MidPoint combines RBAC and ABAC/PBAC by putting expressions into roles.
We have seen that already.
When role is assigned, the expressions in the role gets evaluated.
There can be any complex algorithm in the expression, even a complete ABAC/PBAC policy.
At least in theory.
MidPoint expressions do not make access control decisions, because it is not the job of an identity management system to make such decisions.
Identity management system should set up the account.
It provides the "material" for an authorization system to make a correct decisions.
Therefore, midPoint goes as close to ABAC/PBAC as a provisioning system can go.
In an extreme case the entire ABAC/PBAC policy can be implemented in outbound expressions in resource definition.
Yet, there are a good reasons nobody does that.</p>
</div>
<div class="paragraph">
<p>Dividing the policy into smaller parts brings substantial advantage.
Therefore, many midPoint deployments are very RBAC-like.
There are many roles and rich role hierarchies.
Role expressions are used in moderation.
Yet, there are also deployments that are using parametric roles and role expressions extensively.
In such cases there is a smaller number of roles, almost no role hierarchy, but the roles are smarter.
Those are more PBAC-like deployments.
Yet, roles are still there.
The roles act as "handles" for users to understand the policies, to give names to relevant parts of the policy.
This combined approach works surprisingly well.</p>
</div>
<div class="paragraph">
<p>Of course, this idea is not new.
Many RBAC-like systems use some kind of "smart" behavior inside the roles.
However, so far we haven’t seen anything as comprehensive as midPoint dynamic role-based access control model.
Therefore, we had to invent an impressive marketing name for our creation.
Due to a momentary lapse of imagination we dubbed it <em>policy-driven RBAC</em> (PD-RBAC).
Whatever you choose to call it, the fact is that this approach is very useful in practice.
It can transform apparent chaos into something that can be efficiently managed.
After all, that is the whole point of identity management and governance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_5">Conclusion</h3>
<div class="paragraph">
<p>Role-based access control (RBAC) means many things to many people.
Some consider it a cure-all, the only viable access control standard, others consider it cumbersome, yet others proclaim its death.
Whatever is said about RBAC, the fact is, that RBAC is here, and it is here to stay.
When it comes to midPoint, RBAC has its place as a very useful concept and essential tool.
The truth is that the policy-driven RBAC variant that midPoint is using is miles apart from the traditional static RBAC models of the past.
MidPoint would not be able to work efficiently without major innovation of the RBAC model.</p>
</div>
<div class="paragraph">
<p>Role-based access control as well as dynamic policies are at the heart of midPoint.
Similarly, identity management systems such as midPoint are at the heart of IT infrastructure.
Many <em>applications</em> implement at least some aspects of RBAC or similar access control models.
However, almost all the applications limit the applicability of RBAC to the application itself.
I.e. roles in an application can contain only those privileges that apply to that particular application.
The roles cannot have privileges from other application.
However, identity management systems are different.
Identity management systems such as midPoint are reaching out to many <em>applications</em> (resources).
Therefore, a single midPoint role can give access to many applications at once.
No other application can do that.
This properly alone make identity management systems indispensable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="08-archetypes">8. Archetypes</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
All generalizations are dangerous, even this one.
</blockquote>
<div class="attribution">
&#8212; Alexandre Dumas
</div>
</div>
<div class="paragraph">
<p>MidPoint has many types of objects hard-coded: <em>users</em>, <em>roles</em>, <em>orgs</em>, <em>services</em> and many more.
However, no amount of hard-coded types could ever be enough to describe the vast diversity of the world around us.
Hence, there are <em>archetypes</em>, providing a mechanism to describe objects in finer details.</p>
</div>
<div class="sect2">
<h3 id="_focal_objects">Focal Objects</h3>
<div class="paragraph">
<p>There are five basic types of <em>focal</em> objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>User</strong> (<code>UserType</code>) represents users, usually as physical persons or personas.</p>
</li>
<li>
<p><strong>Org</strong> (<code>OrgType</code>) represents groups of other objects, such as organizational units, teams, projects or locations.</p>
</li>
<li>
<p><strong>Role</strong> (<code>RoleType</code>) represents roles, responsibilities or policies that can be applied to other objects.</p>
</li>
<li>
<p><strong>Service</strong> (<code>ServiceType</code>) represents non-human actors and assets, such as network services, applications and devices.</p>
</li>
<li>
<p><strong>Generic object</strong> (<code>GenericObjectType</code>) can represent anything else.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are <em>focal</em> types, because they can be a <em>focus</em> of midPoint computation.
They are the <em>center</em> of start topology, the <em>hub</em> of the hub-and-spoke data mapping model that midPoint is using.
E.g. User has several linked accounts.
In midPoint parlance, <em>user</em> is the <em>focus</em>, <em>accounts</em> are <em>projections</em>.
User data can be mapped to accounts, account data can be mapped to user, but account cannot be mapped to another account.
That is the principle of the <em>star topology</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-05-user-bob-projections.png" alt="Star topology">
</div>
</div>
<div class="paragraph">
<p>We have already seen that.
However, <em>focal objects</em> are meant to be much more than a mere center of data synchronization topology.
These objects are meant to have <em>business meaning</em>, to represent entities and concepts from the real world around us.
Almost every practical object, entity or concept can be classified to the first four types.
Physical persons, personas and other human-like identities can be represented as <em>users</em>.
Groups of other objects can be represented as <em>orgs</em>, such as organizations, organizational units, various types of teams, projects, classes, interest groups and task forces.
Even concepts that do not immediately come to mind can be represented as <em>orgs</em>, such as locations or nationalities.
Concept of <em>service</em> can represent almost any <em>thing</em>, such as devices, network services, applications, databases, documents - even non-tangible <em>assets</em> such as datasets or workspaces.
MidPoint <em>roles</em> can be, quite obviously, used as roles for role-based access control (RBAC) purposes.
However, they can also represent business concepts, such as jobs, work positions and responsibilities.
<em>Roles</em> can even represent very abstract concepts such as policies, classifications and clearances.
Almost anything that you can think of, anything which would be described as <em>identity</em>, could be classified in those four types: <em>user</em>, <em>org</em>, <em>role</em> or <em>service</em>.
In a very rare case when a concept does not fit in any of these categories, there is always <em>generic object</em> as a last resort.
However, the <em>user</em>-<em>org</em>-<em>role</em>-<em>service</em> quartet works so well, that the <em>generic object</em> was not really needed for years and years.</p>
</div>
<div class="paragraph">
<p>The four types are not just cosmetics, they have specific features that allow them to represent real-world concepts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>User</strong> has several naming properties, such as <em>full name</em> and <em>given name</em>, which are typical for natural persons.
It also has <em>credentials</em> (e.g. password)</p>
</li>
<li>
<p><strong>Org</strong> can form hierarchies.
There can be <em>orgs</em> in <em>orgs</em>, which is very useful for building organizational structures, or hierarchies of locations.</p>
</li>
<li>
<p><strong>Role</strong> is meant to grant privileges to users.</p>
</li>
<li>
<p><strong>Service</strong> has <em>credentials</em>, similarly to users.
Therefore, <em>service</em> can represent machine agents, robots and similar <em>active</em> things that behave like humans.
However, <em>service</em> is meant to represent non-human identities, therefore it does not have human-like names.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This description is somehow simplified.
In reality, things are a bit more generic in midPoint.
<em>Roles</em> are not the only type of objects that can grant privileges.
All role-like objects (known as <em>abstract roles</em> in midPoint) have this ability, which means <em>orgs</em> and <em>services</em> can grant privileges too.
Also, all the four focal types can have <em>credentials</em>, at least in theory.
There is a significant overlap among the capabilities of the four object types.
However, the description above is a nice summarization of the <em>purpose</em> for which the object types were created.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Policy</div>
MidPoint 4.9 is introducing another focal object type: <em>policy</em> (<code>PolicyType</code>).
While policies can be represented by <em>roles</em> (<code>RoleType</code>) in midPoint 4.8 and earlier, the new <em>policy</em> type brings clarity.
In midPoint 4.9 and later, there is a clear distinction between quite concrete <em>role</em> and very abstract <em>policy</em>.
This is a nice improvement, which improves thinking about <em>roles</em> and <em>policies</em> by optically separating them.
It also looks very good in user interface.
Other than that, <em>roles</em> and <em>policies</em> work exactly the same.
It is a curious thing, that sometimes even such apparently cosmetic change makes a big perceived difference.
We strongly recommend midPoint 4.9 to anyone who plans to heavily use <em>policies</em>, e.g. in deployments that need to address complex
<em>regulatory compliance</em> scenarios.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_archetypes">Archetypes</h3>
<div class="paragraph">
<p>The four basic object types can represent almost anything we are likely to encounter in identity management world.
However, it does not mean that the four types fit all object types <em>perfectly</em>.
We often need to distinguish various nuances among object types.
E.g. we may want to use colors or icons to distinguish between <em>applications</em>, <em>mobile devices</em> and <em>workspaces</em>.</p>
</div>
<div class="paragraph">
<p>Basic structure of archetype definition is simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000702</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;archetypePolicy&gt;</span>
        <span class="tag">&lt;display&gt;</span>
            <span class="tag">&lt;label&gt;</span>Person<span class="tag">&lt;/label&gt;</span>
            <span class="tag">&lt;pluralLabel&gt;</span>Persons<span class="tag">&lt;/pluralLabel&gt;</span>
            <span class="tag">&lt;icon&gt;</span>
                <span class="tag">&lt;cssClass&gt;</span>fa fa-user<span class="tag">&lt;/cssClass&gt;</span>
                <span class="tag">&lt;color&gt;</span>green<span class="tag">&lt;/color&gt;</span>
            <span class="tag">&lt;/icon&gt;</span>
        <span class="tag">&lt;/display&gt;</span>
    <span class="tag">&lt;/archetypePolicy&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a special <code>archetypePolicy</code> container which is very specific to archetypes.
This container specifies characteristics of <em>archetyped</em> objects, which are objects that have this archetype.
In the case illustrated above, the <code>Person</code> archetype is supposed to apply to users who are physical, natural persons (as opposed to virtual <em>personas</em>).
Archetype policy specifies that the archetyped objects have <em>green</em> icon defined by <code>fa fa-user</code> CSS classes.
Each archetyped object has to be referred to as <code>Person</code>.
Plural form <code>Persons</code> is going to be used in lists and collections of archetyped objects.
This is quite a minimal definition of archetype.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Font Awesome icons</div>
MidPoint is using <em>Font Awesome</em> icons, which is a nice collection of icons to choose from.
Font Awesome icons are referred to by their <em>CSS classes</em>.
Readers that have some web design experience would understand.
For the others, just search the web for "font awesome icons", choose an icon and look for snipped of HTML code such as <code>&lt;i class="fa fa-user"&gt;&lt;/i&gt;</code>.
The value of <code>class</code> HTML attribute is supposed to go to the <code>cssClass</code> property of archetype definition.
Of course, midPoint is open source software, therefore it contains only <em>free</em> Font Awesome icons.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We have nice little archetype definition now.
However, it does not do much just by itself.
Archetype has to be applied to midPoint objects to be useful.
As we are in midPoint, archetypes are <em>assigned</em> to objects, of course.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000702</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>anderson<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000702</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ArchetypeType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When archetype is assigned to an object, the object gains characteristics specified in the <em>archetype policy</em> specified in the archetype.
This means that <em>persons</em> are shown using <em>green</em> color in midPoint user interface, as that is specific in the <code>Person</code> archetype.</p>
</div>
<div class="paragraph">
<p>Archetypes can be managed and create in midPoint user interface as well.
Navigate to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Archetypes</b></span>.</p>
</div>
<div class="paragraph">
<p>Archetypes can specify several aspects that affect look, feel and behavior of archetyped objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Icon, color, labels and similar presentation properties.</p>
</li>
<li>
<p>Object template, which specifies mappings and other details about individual data <em>items</em> of the object.</p>
</li>
<li>
<p>Provisioning defaults, e.g. specifying that all employees should have an account in enterprise directory.</p>
</li>
<li>
<p>Policies to be applied to archetyped objects.</p>
</li>
<li>
<p>Collecting the objects, providing ability to quickly look them up in searches, menu shortcuts, and so on.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Archetypes can significantly influence archetyped objects, as you will see in the rest of this chapter.
This ability makes archetypes very useful.
Due to their usefulness, archetypes permeate midPoint configurations.
Many archetypes are provided as pre-configured (initial) objects out-of-the-box.
Archetypes are also seen in prominent places in midPoint user interface.
They also provide prime opportunity for customization.
Overall, archetypes are to the core of every midPoint deployment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_structural_vs_auxiliary">Structural vs Auxiliary</h3>
<div class="paragraph">
<p>An object can have more than one archetype, as long as following rules are followed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At most one <strong>structural archetype</strong> can be applied to object.
Structural archetype provides <em>structure</em> to the object, it specifies icon, color, and presentation of the object.
In the future, structural archetype may define <em>schema</em> for the objects.</p>
</li>
<li>
<p>Any number of <strong>auxiliary archetypes</strong> can be applied to object.
Auxiliary archetypes provide <em>additional</em> information, functionality and policies to the objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>Structural</em> archetypes should be used to represent <em>nature</em> of the objects, characteristics that are unlikely to change.
Good examples are <code>Person</code> or <code>Application</code>.
On the other hand, <em>auxiliary</em> archetypes are more like the roles.
They usually represent characteristics that might change, or characteristics that could be combined.
For example, <code>Employee</code>, <code>Student</code> and <code>Volunteer</code> are good examples, as a <code>Person</code> could theoretically be student and employee of a school at the same time, as well as volunteer for certain activities.</p>
</div>
<div class="paragraph">
<p>Definition of <em>auxiliary</em> archetypes is almost the same as definition of <em>structural</em> archetypes, except for <code>archetypeType</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8070c13e-73ff-11ef-b9ac-7beb1c83f753</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Employee<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;archetypeType&gt;</span>auxiliary<span class="tag">&lt;/archetypeType&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Limited UI support</div>
User interface support for auxiliary archetypes is quite limited in midPoint 4.8.
This is the reason auxiliary archetypes are not used often in midPoint 4.8.
In fact, use of birthright <em>roles</em> is still recommended in midPoint 4.8, instead of using auxiliary archetypes such as <code>Employee</code>.
More on that in next chapter.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_pre_configured_archetypes">Pre-configured Archetypes</h3>
<div class="paragraph">
<p>Archetypes are very useful mechanism for setting up presentation of behaviour of objects.
Therefore, midPoint contains a set of pre-defined archetypes, ready to be used.
Following table describes the most interesting pre-configured archetypes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Archetype</th>
<th class="tableblock halign-left valign-top">Holder type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Person</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archetype for natural persons.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archetype for system users, i.e. non-person users that are needed for system to work, such as <code>administrator</code> user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archetype for applications, as a basic building blocks for access control.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archetype for roles that directly grant access to applications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Business role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archetype for roles that represent business concepts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archetype for roles that are essential from the system point of view, such as <code>Superuser</code> role.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are other pre-defined archetypes as well, mostly for tasks, cases, reports and marks.
These are not important for now.
There are no pre-defined archetypes for organizational units in midPoint 4.8.
More on that later, in a chapter dedicated to organizational structures.</p>
</div>
</div>
<div class="sect2">
<h3 id="_life_with_archetypes">Life with Archetypes</h3>
<div class="paragraph">
<p>Archetypes influence many aspects of "life" for midPoint objects.
Therefore, it is a best practice to set proper archetype for object as soon as the object is created.
This approach makes it easier to customize behavior of objects later on.
For this reason, we have set <code>Person</code> archetype for all users created by synchronization from HR system.
This is going to be very useful, as we will see in next chapter dealing with object templates.
Similarly, it is recommended to properly set archetypes for new roles, services, orgs and other objects.</p>
</div>
<div class="paragraph">
<p>Choosing the right archetypes is quite important, as change of (structural) archetypes is a serious matter.
Archetypes define many aspects of object character, presentation and behavior.
Change of archetype means quite a substantial change of object nature already.
In the future, it is very likely that archetypes could define object <em>schema</em> as well, influencing the way the object is composed and stored.
Therefore, change of archetypes would mean a change of its very structure.
As object schema changes, new mandatory properties would need new values and values of removed properties should be removed.
Therefore, there is already a special method to change an archetype in midPoint.
In midPoint user interface, there is <b class="button">Change archetype</b> button on object details page that starts a special action of archetype change.</p>
</div>
<div class="paragraph">
<p>Archetypes naturally work as <em>object collections</em>.
Therefore, archetypes can be used to conveniently search for all archetyped objects.
Simply use the <b class="button">Object collection</b> control in the search bar and select archetype you are looking for.
Moreover, archetypes can be used to customize midPoint menu, object details panels and other parts of midPoint user interface.
Menu items regarding archetypes are already pre-configured in some cases (e.g. <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Users</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Persons</b></span>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">archetypeRef</div>
Archetypes are <em>assigned</em> to objects.
While archetype assignment is limited, it is still quite a complex object to deal with.
As archetype searches are common, midPoint needs to execute them as quickly as possible.
Therefore, there is special <code>archetypeRef</code> reference in archetyped objects, point to applied archetype(s).
However, this reference is <em>operational</em>, it is managed by midPoint internally, it should never be changed by midPoint users.
Archetypes should be managed solely by changing <em>assignments</em>.
Yet, the <code>archetypeRef</code> may still be useful, e.g. when searching for archetyped objects using scripts or midPoint REST interface.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_archetypes_as_roles">Archetypes as Roles</h3>
<div class="paragraph">
<p>Archetypes are <em>abstract roles</em>.
Similarly to <em>orgs</em> and <em>services</em>, <em>archetypes</em> behave like roles.
<em>Inducements</em> in the archetype apply to all archetyped objects.
This is very convenient method to apply default settings to broad classes of users.
Pre-defined <code>Person</code> archetype is especially suitable for this purpose.
Inducements added to <code>Person</code> archetype can be used to set up default accounts and roles for users.</p>
</div>
<div class="paragraph">
<p>Our deployment at ExAmPLE company goes quite well.
We have HR synchronization set up.
We have also connected LDAP server and correlated the accounts.
However, the LDAP setup is not complete.
When new employee is hired, midPoint takes the HR record and creates a user.
However, the user is not going to get an LDAP account, as every employee should.</p>
</div>
<div class="paragraph">
<p>As archetypes work as roles, and all employees have <code>Person</code> archetype, we can easily do what we need.
Setting up default accounts for employees is a simple matter of adding an <em>inducement</em> to the <code>Person</code> archetype.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000702</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
             <span class="comment">&lt;!-- OpenLDAP resource --&gt;</span>
             <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
             <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When HR record is synchronized to midPoint, user is created, <code>Person</code> archetype is applied, <em>inducement</em> is processed and LDAP account created.
This configuration <em>almost</em> works, except for one little detail.
New user&#8217;s username is generated from employee number.
This is not very convenient for users.
However, we still need one more trick to get there, which is explained in the <a href="#09-focus-processing">Focus Processing</a> chapter.</p>
</div>
<div class="paragraph">
<p>In addition to accounts, archetypes are useful for setting up default roles and privileges.
E.g. <code>Person</code> archetype can be used to grant access to midPoint user interface to all users by adding <em>inducement</em> to <code>End user</code> role.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000702</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000008</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Archetypes are ideal for provisioning <em>birthright</em> privileges, access rights that are automatically given to users based on their type.</p>
</div>
</div>
<div class="sect2">
<h3 id="_archetypes_as_meta_roles">Archetypes as Meta-roles</h3>
<div class="paragraph">
<p>Simply speaking, <em>meta-roles</em> are roles applied to other roles.
Ordinary role applies its characteristics to a <em>user</em>.
<em>Meta-role</em> applies its characteristics to another <em>role</em>.
This is perfectly possible in midPoint, as role can be applied to almost any midPoint object.
Then why not apply a role to another role?
This may seem like a pretty useless exercise, but the truth is that meta-roles are tremendously useful.</p>
</div>
<div class="paragraph">
<p>History is repeating, they say.
The fact is that repetition is daily bread in almost all identity management deployments.
E.g. many business roles have something in common.
For example, the business roles have similar approval process.
There may be role classes that have similar exclusion policies that are part of global segregation of duties (SoD) policy.
There are roles that are tied to entitlements in a systematic way, and so on.
Roles, organizational units, services and other role-like objects tend to be quite similar.
Therefore, applying meta-roles to them can be very useful.</p>
</div>
<div class="paragraph">
<p>Archetypes are a prime example of meta-roles.
<code>Business role</code> archetype is a meta-role that applies its policies to all <em>business roles</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000321</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Business role<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="comment">&lt;!--
            Policies, rules, constructions and other things
            that should be applied to all business roles.
        --&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Statements in the <em>inducement</em> above are applied to business <em>roles</em>, as opposed to ordinary role where inducements are applied to <em>users</em>.
Similarly, <code>Application</code> archetype applies its inducements to <em>services</em>.</p>
</div>
<div class="paragraph">
<p>This ability makes archetypes ideal for addressing slight differences in behavior of various object types.
For example, we probably would like to synchronize <em>applications</em> with enterprise application inventory system.
However, that does apply to <em>applications</em> only, and not to other services.
Therefore, <code>Application</code> archetype is ideal place to configure this policy.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Reuse in midPoint</div>
Meta-roles are one of the stranger concepts of midPoint, but it goes well with midPoint philosophy.
Meta-roles are roles that are applied to themselves.
This is a reuse of an existing mechanism to create something new.
This is very typical for midPoint.
We always try to reuse an existing mechanism instead of reinventing a new one.
The result is quite unexpected and surprising sometimes.
When we have designed the role-based access control system for midPoint, we haven’t thought about meta-roles at all.
The meta-roles just appeared as a consequence of the design, a consequence that was absolutely unexpected.
Fortunately, we have quickly realized the potential that meta-roles have, and we have put them to a full use.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It may be difficult to understand the concept of meta-roles from such a short and very abstract description.
Do not worry.
As meta-roles are often used in midPoint, we will get back to the meta-roles on several occasions.
Meta-roles often allow simplification of complex problems by creating a very elegant solutions.
For now, it is enough to remember that roles can be applied to almost anything in midPoint, including themselves.</p>
</div>
</div>
<div class="sect2">
<h3 id="_assignment_relation">Assignment Relation</h3>
<div class="paragraph">
<p>Archetypes are very flexible, even perhaps a little bit too flexible.
Theoretically, an archetype can be assigned to anything, any type of object.
However, it does not make much sense to use <code>Person</code> archetype on roles or services.
Therefore, midPoint has to constraint the ability to use archetypes.</p>
</div>
<div class="paragraph">
<p>MidPoint has <em>assignment relation</em> mechanism that can be used to fine-tune the application and use of archetypes.
This mechanism can be configured by using <code>assignmentRelation</code> clause.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000702</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;identifier&gt;</span>holderType<span class="tag">&lt;/identifier&gt;</span>
        <span class="tag">&lt;assignmentRelation&gt;</span>
            <span class="tag">&lt;holderType&gt;</span>UserType<span class="tag">&lt;/holderType&gt;</span>
        <span class="tag">&lt;/assignmentRelation&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the <em>assignment relation</em> clause specifies <em>holder type</em> for archetype.
Simple speaking, this is the type that an archetype can apply to, a type that can <em>hold</em> assignment to the archetype.
In this case, the <em>holder type</em> is constrained to <em>user</em> (<code>UserType</code>).
Hence, <code>Person</code> archetype can be applied to <em>users</em>, and no other object type.</p>
</div>
<div class="paragraph">
<p><em>Assignment relation</em> is important for maintaining some sanity in the vast flexibility of midPoint platform.
As we know that <code>Person</code> archetype should be applied to <em>users</em>, we can easily detect errors when the archetype is accidentally applied to other object type.
<em>Assignment relation</em> is even more important for the user interface.
Due to the <em>assignment relation</em> specification above, midPoint user interface knows that it makes sense to offer <code>Person</code> archetype as an option for creating new <em>user</em>, but this archetype does not make sense not for <em>org</em> or <em>role</em>.
Several parts of midPoint user interface adapt to <em>assignment relation</em> specified in archetypes.</p>
</div>
<div class="paragraph">
<p>Clever reader has surely noticed that <em>assignment relation</em> clause is enclosed in an <em>assignment</em>.
This has certainly some deeper meaning.
Clever reader is right once again.
As <em>assignment relation</em> is placed in <em>assignment</em>, it applies to the archetype itself.
In the case above, specification of the <em>holder type</em> applies to the <em>archetype</em>.
Archetype <code>Person</code> can be applied to <em>users</em> (<code>UserType</code>).
On the other hand, we can put <em>assignment relation</em> clause in <em>inducement</em>.
In that case, the clause would apply to <em>archetyped objects</em> instead.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider an example of <code>Business Role</code> archetype.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000321</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Business Role<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;assignmentRelation&gt;</span>
            <span class="tag">&lt;description&gt;</span>This archetype can be assigned to role.<span class="tag">&lt;/description&gt;</span>
            <span class="tag">&lt;holderType&gt;</span>RoleType<span class="tag">&lt;/holderType&gt;</span>
        <span class="tag">&lt;/assignmentRelation&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;assignmentRelation&gt;</span>
            <span class="tag">&lt;description&gt;</span>Business role can be assigned to users.<span class="tag">&lt;/description&gt;</span>
            <span class="tag">&lt;holderType&gt;</span>UserType<span class="tag">&lt;/holderType&gt;</span>
        <span class="tag">&lt;/assignmentRelation&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
    ...
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are <em>assignment relation</em> clauses both in <em>assignment</em> and in <em>inducement</em>.
The clause in <em>assignment</em> applies to the archetype itself.
It states that the <em>archetype</em> is supposed to be applied to <em>roles</em>.
We have seen that already.
The other clause is placed in <em>inducement</em>.
This clause applies to all archetyped object, which means to all <em>business roles</em>.
It states that <em>business role</em> can be given to <em>users</em> only, it cannot be given to <em>orgs</em> or <em>services</em>.</p>
</div>
<div class="paragraph">
<p>This is the principle of meta-roles in practice.
Archetypes are meta-roles, applied to roles.
In this case <code>Business Role</code> archetype is a meta-role that applies to <em>roles</em>, which gives these roles character of <em>business roles</em>.</p>
</div>
<div class="paragraph">
<p><em>Assignment relation</em> is an important mechanism to maintain order in amazing flexibility of midPoint platform, especially when this mechanism is coupled with <em>archetypes</em>.
Together, this two mechanisms can form variety of object types and relations between them.
This is the foundation allowing midPoint to describe vast diversity of identities in the wold around us.</p>
</div>
</div>
<div class="sect2">
<h3 id="_future_of_archetypes">Future of Archetypes</h3>
<div class="paragraph">
<p>While the underlying mechanism of <em>meta-roles</em> is part of midPoint for a very long time, archetypes were added a bit later.
Archetypes embrace the <em>meta-role</em> mechanism, making it nicer and easier to use, while adding some features of their own.
While archetypes in midPoint 4.8.5 are already quite powerful, there are still plans for improvement.</p>
</div>
<div class="paragraph">
<p>Archetypes are supposed to exert tighter control over <em>character</em> of the archetyped object in the future.
This means that archetype should control <em>lifecycle</em> of the object and further details of its presentation and behavior.
However, perhaps the most important future function of archetypes is to control <em>schema</em> of archetyped objects.
As we have seen in <a href="#06-schema">Schema</a> chapter, midPoint schema can be extended with custom properties.
However, such schema extension is <em>global</em>, it applies to all objects of a given type.
Vision for future midPoint gives similar ability to archetypes.
In later midPoint versions, archetypes should be able to specify schema extension for archetyped objects.
This could make schema management more elegant, cleaner and much more manageable.
However, there are also downsides.
As archetypes can change, this means that object schema can change as well.
New schema applied by new archetype may include mandatory properties, which need values.
Scheme of old archetype might have included properties that are not part of new schema.
Values of such properties must be discarded, which means destructive operation.
There are other complications as well - none of them unsolvable, but none one them easy to solve either.</p>
</div>
<div class="paragraph">
<p>That is one of the reasons why <em>change of archetype</em> is a special operation in midPoint user interface.
This operation is quite simple in midPoint 4.8.5, however we expect that it will get much more complex later on.
Possible consequences of archetype change also led us to limit the application of archetypes.
While archetypes are <em>abstract roles</em>, unlike other abstract roles, archetypes can only be assigned to objects <em>directly</em>.
Archetypes can only be referenced from an object in a plain, non-conditional, direct <em>assignment</em>, just like we have seen at the beginning of this chapter.
Indirect use of archetypes (e.g. referencing archetypes from <em>inducements</em>) is not supported, and it may lead to unforeseeable behavior.
When it comes to archetypes, perhaps the best strategy is to keep things simple.
At least for now.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_6">Conclusion</h3>
<div class="paragraph">
<p>Archetypes make midPoint nicer and more elegant.
Icons, colors and other nuances that archetypes bring make it easier to navigate midPoint user interface.
However, most importantly, archetypes make midPoint data more <em>descriptive</em>.
Archetypes can be used to describe variety of identity types, including all the flavors and nuances of the diverse world around us.</p>
</div>
<div class="paragraph">
<p>Archetypes are build on deep underlying principles of midPoint platform, such as the <em>meta-role</em> mechanism.
Yet, archetypes are giving such deep mechanisms a nice human-friendly form.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="09-focus-processing">9. Focus Processing</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Scientists study the world as it is; engineers create the world that has never been.
</blockquote>
<div class="attribution">
&#8212; Theodore von Kármán
</div>
</div>
<div class="paragraph">
<p>Identity management systems are often seen as integration engines that move data from one system to another system.
This is indeed a very important part of the identity management functionality.
However, the things identity management systems do <em>internally</em> are crucial to all identity management solutions - especially those that deal with <em>identity governance</em> and <em>regulatory compliance</em>.</p>
</div>
<div class="paragraph">
<p>MidPoint does quite a lot of things that may not be entirely obvious on the outside.
There are rules to apply, processes to drive and policies to enforce.
Those things are gaining utter importance at that strange boundary where identity <em>management</em> becomes identity <em>governance</em>.
MidPoint has powerful mechanisms to support identity governance.
We will get to them later.
We need to explain the basic mechanisms of midPoint internal processing first.</p>
</div>
<div class="paragraph">
<p>This chapter is about processing of <em>focus</em>, which is a midPoint term for object that is at the center of computation.
The <em>focus</em> is usually a <em>user</em>, therefore this chapter is about the internal processing about the <em>user</em> object itself.
It deals with handling of <em>user</em> properties such as determining <em>username</em>, <em>e-mail address</em> and composing <em>full name</em>.
Moreover, it deals with other aspects of internal processing, such as automatic assignment of roles.</p>
</div>
<div class="sect2">
<h3 id="_object_templates">Object Templates</h3>
<div class="paragraph">
<p>Data that flow into midPoint are seldom complete and clean.
Quite the contrary.
The data coming from the "feeds" are often incomplete, they are not very precise, and sometimes several sources may not even agree on a value for a particular data item.
<em>Inbound mappings</em> can be used to sort out <em>some</em> of these problems.
However, inbound mappings are designed to work in isolation.
They work only for one particular <em>resource</em> and one particular <em>attribute</em>.
We often need to gather data from several resources, and then look at all of them at once.
Inbound mappings cannot do that very well, as they are tied to the <em>resource</em>.
However, inbound mappings can be used to gather all the relevant data in the <em>user object</em>.
Then we can have a look at <em>user object</em>, where those data are gathered, and process them all together.
That is what <em>object templates</em> do.
Object template can be used to do variety of things to all kinds of midPoint objects.</p>
</div>
<div class="paragraph">
<p>Simply speaking, <em>object template</em> is a set of definitions and mappings that is applied to a particular midPoint object.
For example, <em>user template</em> is applied to all <em>user</em> objects.
The mappings in the <em>object template</em> can produce new values for the object.
For instance, a very typical use of <em>object template</em> is computation of user’s full name:</p>
</div>
<div class="listingblock">
<div class="title">object-template-user-simple.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">22f83022-b76d-11e9-8a30-6ffc11b23016</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>User Template<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>fullName<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;strength&gt;</span>weak<span class="tag">&lt;/strength&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;script&gt;</span>
<span class="inline">                    <span class="tag">&lt;code&gt;</span>givenName + ' ' + familyName<span class="tag">&lt;/code&gt;</span></span>
                <span class="tag">&lt;/script&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The mapping above computes the value of user’s <code>fullName</code> property from <code>givenName</code> and <code>familyName</code> by using a simple Groovy expression.
It is a <em>weak</em> mapping, therefore it computes the full name only in case that it is not present already.</p>
</div>
<div class="paragraph">
<p>Import of object template definition into midPoint does not do much.
The template is not used yet, it just stored in midPoint repository.
There can be several object templates for different types of objects, archetypes or organizations at the same time.
MidPoint does not know how to use the template, unless it is specified in a configuration.
The simplest and most common way to use an object template is to configure use in the <em>archetype</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000702</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;archetypePolicy&gt;</span>
        ...
        <span class="tag">&lt;objectTemplateRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">22f83022-b76d-11e9-8a30-6ffc11b23016</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/archetypePolicy&gt;</span>
    ...
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, object template can be configured <em>globally</em> in system configuration object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;systemConfiguration&gt;</span>
    ...
    <span class="tag">&lt;defaultObjectPolicyConfiguration&gt;</span>
        <span class="tag">&lt;type&gt;</span>UserType<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;objectTemplateRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">22f83022-b76d-11e9-8a30-6ffc11b23016</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/defaultObjectPolicyConfiguration&gt;</span>
    ...
<span class="tag">&lt;/systemConfiguration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration activates the object template for use by all objects of <code>UserType</code> type.
Therefore, this template is applied to all midPoint <em>users</em>.</p>
</div>
<div class="paragraph">
<p>Even though object templates can be set globally, it is usually better to apply object template using <em>archetypes</em>.
Use of archetypes provides finer control over content of individual objects.
E.g. we want to generate full name by concatenating given name and family name for <em>persons</em> (users with <code>Person</code> archetype), yet we do not want to do that for non-person users (such as <code>administrator</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
User interface can be used to set up and activate object templates as well.
Navigate to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">System</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Policies</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Object policies</b></span>, create a new policy using the btn:New[] button.
Specify reference to your template, select <code>User</code> in type field and click btn:Save[].
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Object template is applied every time an object is created, changed or explicitly recomputed (e.g. on reconciliation).
Object template is applied after all the inbound mappings are processed.
Inbound mappings often copy important data to the object, therefore the template can work on data that are summarized from all the resources.</p>
</div>
<div class="sect3">
<h4 id="_item_definitions">Item Definitions</h4>
<div class="paragraph">
<p>We have already seen an example of <em>object template</em> used to apply a <em>mapping</em> on <code>fullName</code> property of midPoint users.
This was a very simple example.
Object template can also do other tricks.</p>
</div>
<div class="paragraph">
<p>The processing of an object template is usually focused on particular <em>items</em> of an object.
Therefore, almost all the functionality of object template is located in <code>item</code> element that references a particular item by its <em>path</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">22f83022-b76d-11e9-8a30-6ffc11b23016</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>User Template<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>fullName<span class="tag">&lt;/ref&gt;</span>
        ...
    <span class="tag">&lt;/item&gt;</span>
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>assignment<span class="tag">&lt;/ref&gt;</span>
        ...
    <span class="tag">&lt;/item&gt;</span>
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most common use of object template is to evaluate <em>mappings</em> on items, such as the mapping to determine user’s <em>full name</em> above.
Therefore, the mappings evaluated by the template are pre-configured with convenient default settings.
Target of the mapping is automatically set to the <em>item</em> for which it is specified.
Sources of the mapping need to be defined explicitly.
The basic idea is, that the <em>user template</em> should take properties of <em>user</em> as inputs.
In other words, the template works on the same object both as input and output.</p>
</div>
<div class="paragraph">
<p>Unlike inbound and outbound mappings, object template mappings often use static (literal) values or a very simple expressions to determine the value.
However, in object templates, mapping <em>conditions</em> are often used to control application of the value.
The easiest way to explain this is to use an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>description<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>extension/hatSize<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;value&gt;</span>WARNING: Big brain!<span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
            <span class="tag">&lt;condition&gt;</span>
                <span class="tag">&lt;script&gt;</span>
<span class="inline">                    <span class="tag">&lt;code&gt;</span>hatSize <span class="entity">&amp;gt;</span> 60<span class="tag">&lt;/code&gt;</span></span>
                <span class="tag">&lt;/script&gt;</span>
            <span class="tag">&lt;/condition&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This mapping is applied to <code>description</code> property of the user.
The mapping sets a fixed warning text specified as text literal using <code>value</code> expression evaluator.
However, the mapping is not setting that value for all the objects.
The mapping is applied only for objects that satisfy the <em>condition</em>.
The condition is set to trigger for all the users that have hat size larger than 60.</p>
</div>
<div class="paragraph">
<p>Mappings are made to be <em>relativistic</em>.
This means that mappings react to changes.
The same principle applies to mapping conditions - they are <em>relativistic</em> too.
Therefore, the mapping reacts to changes in its sources, as well as changes in the condition state.
When user’s head grows, and the hat size changes to a value over 60, then the mapping <em>adds</em> the warning.
When the user’s head shrinks, then the warning is <em>removed</em>.</p>
</div>
<div class="paragraph">
<p>It may look that this mechanism is unnecessarily complicated, if you look at single-valued properties only.
It all starts to make sense in case of <em>multi-value</em> items, such as the <em>assignments</em>.
We will get to that in the next section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_schema">Schema</h4>
<div class="paragraph">
<p><em>Mappings</em> are the things that object template does almost all the time.
However, the template can also do other interesting things.
First of all, object template can tweak the <em>schema</em>.
MidPoint comes with quite a rich schema, ready to be used.
However, the schema is not a perfect fit for all the deployments.
<a href="#06-schema">Schema</a> chapter described a method to <em>extend</em> the schema with custom items.
However, what we should do if we want to change the <em>built-in schema</em> of midPoint?
The schema is hard-coded to midPoint, even compiled into midPoint source code.
It is not that easy to change the built-in schema.
Yet, object template provides a mechanism to customize the use and presentation of built-in schema.
The <code>item</code> specification can be used to modify the way how midPoint <em>applies</em> the schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>givenName<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;displayName&gt;</span>First Name<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>additionalName<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;displayName&gt;</span>Middle Name<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>familyName<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;displayName&gt;</span>Last Name<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The "additional name" is a nice and generic term that can fit many cultural environment.
However, it is not very usual or intuitive in cultures that are not used to such a generic term (which means pretty much <em>all</em> the cultures).
Therefore, almost all midPoint deployments that chose to use this property would like to rename it to something that feels more natural.
Similarly, "given name" and "family name" do not fit well in all the cultures.
We have expected that.
Therefore, object template can be used to modify some aspects of built-in schema, such as the display labels.</p>
</div>
<div class="paragraph">
<p>Object template can also be used to override object <em>multiplicity</em>, especially to change mandatory item into optional.
MidPoint insists on having <code>name</code> property set for all the users.
However, we may be able to compute value of <code>name</code> property from other properties, such as other names of the user, employee number or other identifiers.
Therefore, we do not want to present <code>name</code> item as mandatory in the user interface.
Therefore, we would allow midPoint administrator to leave <code>name</code> field blank in the user interface when creating a new user.
However, user interface is strictly driven by the schema, as are all the other midPoint components.
As <code>name</code> is mandatory in the schema, the user interface insists that the <code>name</code> field must be filled in.</p>
</div>
<div class="paragraph">
<p>This behavior can be changed in the object template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>name<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;limitations&gt;</span>
            <span class="tag">&lt;layer&gt;</span>presentation<span class="tag">&lt;/layer&gt;</span>
            <span class="tag">&lt;minOccurs&gt;</span>0<span class="tag">&lt;/minOccurs&gt;</span>
        <span class="tag">&lt;/limitations&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            ...
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration makes the <code>name</code> property optional for the <em>presentation</em> purposes.
This means that the user interface treats <code>name</code> as optional field.
However, core midPoint engine still requires <code>name</code> property to have a value.
This gives <em>object template</em> a chance to generate the value for <code>name</code> property.</p>
</div>
<div class="paragraph">
<p>However, the <code>name</code> field is still rendered as <em>read-write</em> item in the user interface.
We do not want that, as <code>name</code> is supposed to be <em>immutable</em> identifier in our deployment.
We do not want anyone to change the <code>name</code> once it was generated.
Therefore, we would like to present <code>name</code> as <em>read-only</em> item in the user interface.
This can also be achieved by object template, by using <code>access</code> configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>name<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;limitations&gt;</span>
            <span class="tag">&lt;layer&gt;</span>presentation<span class="tag">&lt;/layer&gt;</span>
            <span class="tag">&lt;minOccurs&gt;</span>0<span class="tag">&lt;/minOccurs&gt;</span>
            <span class="tag">&lt;access&gt;</span>
                <span class="tag">&lt;read&gt;</span>true<span class="tag">&lt;/read&gt;</span>
                <span class="tag">&lt;add&gt;</span>false<span class="tag">&lt;/add&gt;</span>
                <span class="tag">&lt;modify&gt;</span>false<span class="tag">&lt;/modify&gt;</span>
            <span class="tag">&lt;/access&gt;</span>
        <span class="tag">&lt;/limitations&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            ...
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Even immutable identifiers may need to change occasionally.
There may be a bug in the identifier generator, or we may need to manually change identifier to match the reality.
Theoretically, every piece of the solution should play by the rules.
Yet, we know that rules have exceptions in the practice.
Therefore, privileged users such as system administrator should be able to change the identifiers when it is really needed.
The proper way how to do this would be to use <em>authorizations</em>, and not object template.
Unfortunately, we do not know how to use authorizations yet.
Therefore, this solution will have to do, at least for now.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Perhaps the most extreme measure to change presentation of midPoint schema is ability to eliminate certain item entirely.
In fact, this happens quite often.
MidPoint schema is rich, and many deployments do not use all the items defined in midPoint schema.
It makes little sense to present the items that are not used, therefore there is a way to tell midPoint that we want to completely ignore an item:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>organization<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;limitations&gt;</span>
            <span class="tag">&lt;layer&gt;</span>presentation<span class="tag">&lt;/layer&gt;</span>
            <span class="tag">&lt;processing&gt;</span>ignore<span class="tag">&lt;/processing&gt;</span>
        <span class="tag">&lt;/limitations&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Object template can be used to do further tricks.
It can be used to associate value enumeration with an item, e.g. to apply lookup table to a particular item.
Object templates can be used to set up a validation expression for items - and a couple of other things.
More on that later.</p>
</div>
</div>
<div class="sect3">
<h4 id="_includes">Includes</h4>
<div class="paragraph">
<p>There are many ways to apply an object template to an object.
The template can be set <em>globally</em> in system configuration, it can be set by an <em>archetype</em> or even by an <em>organizational unit</em>.
However, only one object template can be active for any particular object at one time.
Yet, there are often mappings that need to apply universally.
For example, we may want to generate <em>full name</em> using the same algorithm for all users, regardless of their archetype.
We may also want to automatically assign some roles to all users regardless of their organizational units.
For that reason there is mechanism to include one object template in another:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">22f83022-b76d-11e9-8a30-6ffc11b23016</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Default User Template<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>fullName<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            ...
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60eab6a8-ba87-11e9-b9a3-bbb8418de4d5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Special User Template<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;includeRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">22f83022-b76d-11e9-8a30-6ffc11b23016</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>employeeNumber<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            ...
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the special user template includes all the mappings from default user template.
Therefore, both mapping for <code>employeeNumber</code> and mapping for <code>fullName</code> will be processed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automatic_role_assignment">Automatic Role Assignment</h3>
<div class="paragraph">
<p>In traditional role-based access control (RBAC) models, roles are supposed to be <em>manually</em> assigned to users.
That&#8217;s the whole point of traditional RBAC: simplify access control by using roles instead of low-level permissions.
However, current access control models are all but traditional - they can be described as flexible, dynamic, adaptive, or by any similar term that a marketing team invented yesterday.
Whatever are the access control models called, they all rely on <em>dynamism</em>: ability to control privileges automatically as a reaction to changing environments.</p>
</div>
<div class="paragraph">
<p>Even though midPoint started with role-based access control mechanism, we have always considered this to be <em>dynamic</em> form of RBAC.
MidPoint RBAC is not fixed to static roles.
Roles can be assigned and unassigned automatically and dynamically.
This is a crucial element in all midPoint deployments, therefore this is the right place to describe the mechanisms.</p>
</div>
<div class="sect3">
<h4 id="_automatic_role_assignment_in_object_template">Automatic Role Assignment in Object Template</h4>
<div class="paragraph">
<p>Object templates are very flexible, they can be used for a lot of different things.
Yet, there is one particular usage of object template that appears in almost every deployment.
It is an ability to assign roles <em>automatically</em>.</p>
</div>
<div class="paragraph">
<p>The basic idea is quite simple.
When it comes to midPoint schema, an <code>assignment</code> is just an ordinary item.
Therefore, we can use object template mapping to populate that item with appropriate value.
When done properly, it gives us automatic assignment of roles.
Like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>assignment<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            ...
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The trick here is to set up the mapping properly.
The simplest case is a <em>conditional</em> assignment of a role.
Let’s suppose that we want to assign a <code>Hatter</code> role to everybody that has provided a hat size in user profile.
We already know how to do that, we can use mapping <em>condition</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c38a5e6e-b783-11e9-b82f-ebb94fb5b6ec</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Hatter<span class="tag">&lt;/name&gt;</span>
    ...
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">object-template-user.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>assignment<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>extension/hatSize<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;value&gt;</span>
                    <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c38a5e6e-b783-11e9-b82f-ebb94fb5b6ec</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;/value&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
            <span class="tag">&lt;condition&gt;</span>
                <span class="tag">&lt;script&gt;</span>
<span class="inline">                    <span class="tag">&lt;code&gt;</span>hatSize as Boolean<span class="tag">&lt;/code&gt;</span></span>
                <span class="tag">&lt;/script&gt;</span>
            <span class="tag">&lt;/condition&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Simple, isn’t it?
The <code>value</code> part in the expression is a content of a new <em>assignment</em> that we want to create.
The assignment will be created when <code>hatSize</code> property has a non-null, non-empty and non-zero value (that is a built-in evaluation of booleans in Groovy).
The real trick here is the <em>relativity</em> of mapping conditions.
Assignments are multi-valued.
We do not want to ruin all the other <em>assignments</em> that the user has.
We just want to add (or remove) one particular value, leaving other values untouched.</p>
</div>
<div class="paragraph">
<p>When it comes to multi-valued items, it is extremely important to know when to <em>add</em> a value and when to <em>remove</em> one.
Therefore, midPoint evaluates the condition <em>twice</em>.
The condition is evaluated for an object <em>before</em> a change is applied (old object) first.
The condition is evaluated for an object <em>after</em> the change is applied (new object) once again.
When the condition changes from <code>false</code> to <code>true</code>, <code>Hatter</code> role is assigned (<em>added</em>).
When the condition changes from <code>true</code> to <code>false</code>, <code>Hatter</code> role is unassigned (<em>removed</em>).
Other assignment values are not changed by this mapping.
Therefore, many assignment mappings can happily coexist.</p>
</div>
<div class="paragraph">
<p>However, this is a very simple case.
Typical midPoint deployments have large number of roles.
It is (theoretically) possible to create mappings like this for each and every role that has to be assigned automatically.
However, that would be a lot of repetitive work.
Even worse, it is likely to become a major maintenance nightmare in the future.
We engineers are creative people, we do not really like repetitive work - and we really hate maintenance nightmares.
Therefore, it is perhaps no big surprise that there is a better way to do this.</p>
</div>
<div class="paragraph">
<p>The most common use case for automatic role assignment is to look up the role using some of its properties.
For example, let’s suppose that our HR system provides <em>job codes</em> for our employees.
Therefore, we have extended midPoint schema with a custom property <code>jobCode</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;xsd:schema</span> <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/xml/ns/midpoint/schema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UserTypeExtensionType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:appinfo&gt;</span>
                <span class="tag">&lt;a:extension</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c:UserType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/xsd:appinfo&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:sequence&gt;</span>
            ...
            <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobCode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:string</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

            ...
        <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;/xsd:complexType&gt;</span>
<span class="tag">&lt;/xsd:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A user object that is created from an HR record looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>jones<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;extension&gt;</span>
        <span class="tag">&lt;exmpl:jobCode&gt;</span>S007<span class="tag">&lt;/exmpl:jobCode&gt;</span>
    <span class="tag">&lt;/extension&gt;</span>
    <span class="tag">&lt;fullName&gt;</span>Jack Jones<span class="tag">&lt;/fullName&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we do similar extension for roles.
We extend role schema with custom <code>autoassignJobCode</code> property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;xsd:schema</span> <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.com/xml/ns/midpoint/schema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleTypeExtensionType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:appinfo&gt;</span>
                <span class="tag">&lt;a:extension</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c:RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/xsd:appinfo&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:sequence&gt;</span>
            ...
            <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autoassignJobCode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:string</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

            ...
        <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;/xsd:complexType&gt;</span>
<span class="tag">&lt;/xsd:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we set up the roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a1572de4-b9b9-11e9-af3e-5f68b3207f97</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Sales Manager<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;extension&gt;</span>
        <span class="tag">&lt;exmpl:autoassignJobCode&gt;</span>S006<span class="tag">&lt;/exmpl:autoassignJobCode&gt;</span>
    <span class="tag">&lt;/extension&gt;</span>
    ...
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b93af850-b9b9-11e9-8c2c-dfb9a89635a0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Sales Agent<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;extension&gt;</span>
        <span class="tag">&lt;exmpl:autoassignJobCode&gt;</span>S007<span class="tag">&lt;/exmpl:autoassignJobCode&gt;</span>
    <span class="tag">&lt;/extension&gt;</span>
    ...
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b9d2b604-b9b9-11e9-bbc4-17d8e85623b4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Sales Assistant<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;extension&gt;</span>
        <span class="tag">&lt;exmpl:autoassignJobCode&gt;</span>S008<span class="tag">&lt;/exmpl:autoassignJobCode&gt;</span>
    <span class="tag">&lt;/extension&gt;</span>
    ...
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are almost there.
The final part of this puzzle is an object template <em>mapping</em> that automatically assigns the roles according to job code.
Naive solution would be to create one mapping for each job code.
We do not want that, we want something smarter.
We want a single mapping that can work for all these roles.
Such mapping needs to <em>dynamically</em> look up the role when it is evaluated.
Of course, it is possible to create such mapping in Groovy script.
However, that is not entirely straightforward.
As this use case is a very common one, there is quite an easy method to do that in midPoint.
Role <em>autoassignment</em> is a part of almost every identity management solution in one form or another.
Therefore, we have created a special <em>expression evaluator</em> to make this job easy.
Enter <code>assignmentTargetSearch</code>:</p>
</div>
<div class="listingblock">
<div class="title">object-template-user.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>assignment<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>extension/jobCode<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;assignmentTargetSearch&gt;</span>
                    <span class="tag">&lt;targetType&gt;</span>RoleType<span class="tag">&lt;/targetType&gt;</span>
                    <span class="tag">&lt;filter&gt;</span>
                        <span class="tag">&lt;q:text&gt;</span>extension/autoassignJobCode = $jobCode<span class="tag">&lt;/q:text&gt;</span>
                    <span class="tag">&lt;/filter&gt;</span>
                <span class="tag">&lt;/assignmentTargetSearch&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This may look a bit confusing at the first sight, but do not panic.
Not yet, anyway.
It all makes perfect sense once it is explained.
The code above is a part of user template.
It is a mapping that is producing <em>assignments</em>.
This mapping has an ordinary source which is user’s <code>jobCode</code> property.
This mapping also has an <em>expression</em>, even though that expression is somehow extraordinary.
It is not the usual <code>script</code>, <code>path</code> or <code>value</code> expression.
The <em>expression evaluator</em> is <code>assignmentTargetSearch</code> in this case.
This is a special evaluator that looks for <em>assignment target</em> (e.g. a role), creates a complete <em>assignment</em> from that target, and provides that assignment as an output.
The interesting part here is the way how <code>assignmentTargetSearch</code> looks for assignment target.
First of all, there is a <code>targetType</code> clause, which tells the expression to look for <em>roles</em> as assignment target.
Then there is a <em>search filter</em>.
We have already seen midPoint search filters a couple of times, for example as a method to look up connector reference.
This is yet another use for search filters.
In this case, the filter is used to look up suitable role in midPoint repository.
The filter looks up the roles by the <code>autoassignJobCode</code> value.
However, what <em>value</em> are we looking for?
Static value, such as <code>S007</code>, is not going to help here.
We need to make this query <em>dynamic</em> and smarter.
We simply use a <em>variable</em> instead of static value.
In this case, we use <code>$jobCode</code> variable.
Job code is a <em>source</em> for this mapping, therefore it is present as a variable in all the <em>expressions</em> of the mapping, including the <code>assignmentTargetSearch</code> expression.
When the expression is processed for Jack Jones, value <code>S007</code> is substituted.
That filter is used to look for a role, which results in the <code>Sales Agent</code> role.
This role is used to construct an assignment with the role as its <em>target</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;assignment&gt;</span>
    <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b93af850-b9b9-11e9-8c2c-dfb9a89635a0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/assignment&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is it!
That assignment is added to the user object.
Which means that Jack Jones has that role assigned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>jones<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;extension&gt;</span>
        <span class="tag">&lt;exmpl:jobCode&gt;</span>S007<span class="tag">&lt;/exmpl:jobCode&gt;</span>
    <span class="tag">&lt;/extension&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b93af850-b9b9-11e9-8c2c-dfb9a89635a0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    <span class="tag">&lt;fullName&gt;</span>Jack Jones<span class="tag">&lt;/fullName&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This single mapping works for all the cases of all the current job codes, and even for all future job codes.
That is how we like it.
One simple mapping solves many problems.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Why not Groovy?</div>
Of course, this could all have been done with one smart groovy script instead of <code>assignmentTargetSearch</code> expression.
You are free to do it in Groovy, if you prefer it that way.
It will work.
However, as assignment is a complex data structure, the <code>assignmentTargetSearch</code> expression makes work with assignment much easier.
It can set up validity constraints, relation and other assignment details.
It can also create the target on demand in case the target is not found.
It is quite powerful.
Perhaps the most important detail is that <code>assignmentTargetSearch</code> expression implements the use cases that are common in almost every identity management deployment.
Functionality of <code>assignmentTargetSearch</code> expression is maintained and tested as a native part of midPoint.
Therefore, you can simply reuse it in every midPoint deployment, instead of copying, adapting, testing and bugfixing one big groovy script over and over again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So far we have been talking about automatic <em>assignment</em> of roles.
However, the mapping works <em>both ways</em>.
It can automatically <em>assign</em> the roles, and it can also automatically <em>unassign</em> them.
This is an effect of <em>relativity</em> of midPoint mappings.
When mapping input changes, midPoint knows how it was changes, as it has a <em>delta</em>.
Therefore, midPoint can use the mapping to compute both the values that were <em>added</em> as well as values that were <em>removed</em>.
When <code>jobCode</code> of Jack Jones changes from <code>S007</code> to <code>X001</code>, midPoint evaluates the expression for both values, old and new.
Evaluation of the expression with <em>old</em> value <code>S007</code> produces assignment for <code>Sales Agent</code> role.
MidPoint knows that value <code>S007</code> was <em>removed</em>, therefore it also removes assignment of <code>Sales Agent</code> role from the user.</p>
</div>
<div class="paragraph">
<p>When it comes to security, automatic <em>unassignment</em> of roles is even more important than automatic <em>assignment</em>.
Principle of least privilege dictates that a users should have minimal access rights necessary for conducting their duties.
MidPoint <em>autoassignment</em> mechanism take care of that, applying a rule to <em>assign</em> a role when it is necessary, while also using the same rule to <em>unassign</em> the role when it is no longer necessary.
This mechanism is one of the building block of policy-driven RBAC mechanism, a dynamic role-based access control model which is a native part of midPoint.</p>
</div>
<div class="paragraph">
<p>MidPoint automatically <em>assigns</em> and <em>unassigns</em> the roles when there is appropriate <em>autoassignment</em> mapping.
This works very well, it even works when there are several mappings that manage roles automatically.
MidPoint executes them all and merges the results.
However, roles that are managed <em>automatically</em> may clash with roles that are managed <em>manually</em>.
Therefore, if a mapping specifies that a role should be unassigned, midPoint unassigns that role even if the role was assigned manually.
MidPoint 4.8 does not really know the difference between role that was assigned automatically and manually.</p>
</div>
<div class="paragraph">
<p>There is a mechanism that can be used to make sure that manually-assigned roles are never automatically removed.
Clever use of assignment <em>subtype</em> together with configuration of <em>mapping range</em> can be used to separate assignments that are managed manually from those that are managed automatically.
However, the specific configuration is not entirely simple.
Luckily, future versions of midPoint bring a significant improvement.
midPoint 4.9 is using <em>value meta-data</em> to record origin of values.
Such meta-data can be used to determine whether assignment was created automatically or manually.
Mappings in midPoint 4.9 are set up in such a way that they would remove only the values that they themselves created, making the mechanism seamless.
Therefore, if this situation is likely to occur in your deployment, it may be worth consider using midPoint 4.9.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The roles used in this section are in fact <em>business roles</em>, as they correspond to business responsibilities defined by job codes.
Even though the roles were not explicitly marked as <em>business roles</em> in the examples above, they are properly marked in the example files by applying <code>Business role</code> archetype.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_autoassignment_in_roles">Autoassignment in Roles</h4>
<div class="paragraph">
<p>Automatic assignment of roles in the <em>object template</em> is not the only option.
This is midPoint, therefore there are usually several ways to do the same thing.
The statements that control automatic assignment of roles can be placed in the roles themselves:</p>
</div>
<div class="listingblock">
<div class="title">role-cook.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9f6add7c-b9bf-11e9-abf6-2348fcd328f1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Cook<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;autoassign&gt;</span>
        <span class="tag">&lt;enabled&gt;</span>true<span class="tag">&lt;/enabled&gt;</span>
        <span class="tag">&lt;focus&gt;</span>
            <span class="tag">&lt;mapping&gt;</span>
                <span class="tag">&lt;source&gt;</span>
                    <span class="tag">&lt;path&gt;</span>locality<span class="tag">&lt;/path&gt;</span>
                <span class="tag">&lt;/source&gt;</span>
                <span class="tag">&lt;condition&gt;</span>
                    <span class="tag">&lt;script&gt;</span>
<span class="inline">                        <span class="tag">&lt;code&gt;</span>
                            locality?.norm == 'kitchen'
                        <span class="tag">&lt;/code&gt;</span></span>
                    <span class="tag">&lt;/script&gt;</span>
                <span class="tag">&lt;/condition&gt;</span>
            <span class="tag">&lt;/mapping&gt;</span>
        <span class="tag">&lt;/focus&gt;</span>
    <span class="tag">&lt;/autoassign&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The mapping in the <code>autoassign</code> part of the role is evaluated approximately at the same time as other object template mappings.
The mapping has no <em>expression</em>.
There is no need to.
MidPoint prepares complete assignment data structure for this mapping as an input.
The mapping just has to decide whether to apply that assignment to the user.
That is what the <em>condition</em> is for.
When the condition evaluates to <em>true</em>, the role is automatically assigned.
When it evaluates to <em>false</em>, the role is unassigned.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <em>expression</em> in this mapping is optional.
If an expression is specified, then such expression can be used to further set up the assignment.
For example, it can set assignment activation, relation, parameters and so on.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But wait, why is there this strange <code>norm</code> thing in the condition?
Remember about polystrings?
The <code>locality</code> property is a polystring.
Therefore, it has <code>orig</code> part and <code>norm</code> part.
In this case we want to compare the <code>norm</code> part, as the organizational unit name may be spelled as <code>Kitchen</code> or <code>KITCHEN</code>.
However, in all those cases, the <code>norm</code> part will be <code>kitchen</code>.</p>
</div>
<div class="paragraph">
<p>If fact, there is little trap for the unwary here.
The obvious way to specify the expression would be like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">locality == <span class="string"><span class="delimiter">'</span><span class="content">kitchen</span><span class="delimiter">'</span></span>       <span class="comment">// This is wrong!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, such expression always returns <code>false</code>.
The reason is that different data types are being compared.
The <code>locality</code> property is polystring, while <code>‘kitchen’</code> is a string literal.
Polystring and string are never equal regardless for their content.
Therefore, this form of the expression is wrong.
Following forms may be used instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">locality?.orig == <span class="string"><span class="delimiter">'</span><span class="content">Kitchen</span><span class="delimiter">'</span></span>
locality?.norm == <span class="string"><span class="delimiter">'</span><span class="content">kitchen</span><span class="delimiter">'</span></span>
basic.stringify(locality) == <span class="string"><span class="delimiter">'</span><span class="content">Kitchen</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The later form is using <code>stringify()</code> method from basic midPoint function library.
This method converts everything to string.
Whatever data type is passed to this method the result is always a string that can be safely compared.</p>
</div>
<div class="paragraph">
<p>Let’s get back to role <em>autoassignment</em>.
When <em>autoassign</em> mappings are specified in the roles, midPoint is processing the mappings in a way that is very similar to object template mappings.
This has benefits, but there are also drawbacks.</p>
</div>
<div class="paragraph">
<p>The benefit of role autoassignment is <em>manageability</em>.
The conditions are stored in roles themselves.
Therefore, they are bound to the object that they assign.
Autoassignment rule is right there, in front of administrator’s eyes.
It may also be a benefit if <em>delegated administration</em> is used.
E.g. a role owner manages both role definition and the autoassignment condition in the same object.
In that case, this encapsulation of autoassignment rule in role definition is a huge benefit.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Beware of the expressions</div>
Scripting expressions are very powerful.
In fact, they are way too powerful for secure delegated administration.
Unconstrained scripting expression can do pretty much anything.
It can bring down the system, read memory, modify data, it can do whatever it likes to do.
There are some safeguards that prohibit against accidental abuse, but a malevolent expression can easily circumvent them.
If you allow a user to specify any expression, you are pretty much giving away keys to the kingdom.
Therefore, do not do it.
At least not now.
MidPoint has ability to specify <em>expression profiles</em>.
The goal of the profiles is to constraint expression to only allow safe operations.
However, as scripting languages such as Groovy and JavaScript are very flexible and powerful, it is quite difficult to constraint them to a set of safe operations.
Therefore, use scripting expression with utmost care.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Role autoassignment has another drawback which is <em>performance</em>.
<em>All</em> the autoassignment mappings need to be evaluated every time a user is recomputed.
This means that <em>all</em> the <em>roles</em> that contain the mappings need to be retrieved from midPoint repository.
This may not be a big deal for a small deployment with thousands of users and hundreds of roles.
However, the performance hit is likely to be significant as the number of users and roles grows.
Therefore, role autoassignment is not enabled by default.
It has to be explicitly enabled in system configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;systemConfiguration&gt;</span>
    ...
    <span class="tag">&lt;roleManagement&gt;</span>
        <span class="tag">&lt;autoassignEnabled&gt;</span>true<span class="tag">&lt;/autoassignEnabled&gt;</span>
    <span class="tag">&lt;/roleManagement&gt;</span>
    ...
<span class="tag">&lt;/systemConfiguration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is one more significant drawback of role autoassingment, which is quite obvious.
The autoassignment mapping needs to be in every role.
There is no way to use this mechanism to handle autoassignment of many roles with just one mapping.
However, object template mappings can do that easily.
Therefore, many deployments chose to implement automatic assignment of roles by the means of object template or inbound mappings.</p>
</div>
<div class="paragraph">
<p>Role autoassignment mechanism is also part of midpoint dynamic role-based access control mechanism, the policy-based RBAC.
As such, autoassignment is an essential tool in midPoint access control policy toolbox.</p>
</div>
</div>
<div class="sect3">
<h4 id="_automatic_assignment_in_synchronization">Automatic Assignment in Synchronization</h4>
<div class="paragraph">
<p>Automatic assignment of roles can be based on user properties or other complex factors, as we have seen above.
However, it is far more common to assign privileges to users based on their <em>birthright</em>.
<em>Birthright</em> is a term used in identity management that refers to privileges that are given to the users based on their very nature.
This includes privileges given to <em>all</em> users, just because they are users.
This can be further refined to individual user types, such as employees, students and suppliers.
However, the overall principle of <em>birthright</em> is simple: privileges are assigned to user because the user has a specific <em>type</em>.
It also means that the privileges are automatically removed or changed when user type changes.</p>
</div>
<div class="paragraph">
<p>When we deal with object types, <em>archetypes</em> immediately come to mind.
Archetypes are indeed the right answer for management of <em>birthright</em> permissions.
Archetypes are <em>abstract roles</em>, therefore they work as roles.
We need to add some <em>inducements</em> into <code>Person</code> archetype, and all the <em>persons</em> automatically get the privileges.
It is as simple as that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000702</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;inducement&gt;</span>
        ...
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, how do we make sure that all users get the correct archetype?
We have already seen that, back in <a href="#05-synchronization">Synchronization</a> chapter.
This can be configured in the <em>schema handling</em> part of resource definition.</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>Default Account<span class="tag">&lt;/displayName&gt;</span>
            ...
            <span class="tag">&lt;focus&gt;</span>
                <span class="tag">&lt;type&gt;</span>UserType<span class="tag">&lt;/type&gt;</span>
                <span class="tag">&lt;archetypeRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000702</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/focus&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, the objects that midPoint creates when synchronizing from HR resource are going to be <em>users</em>.
Moreover, the users are going to have <code>Person</code> archetype.</p>
</div>
<div class="paragraph">
<p>However, this is company HR systems.
The users created by synchronization from this systems are no mere <em>persons</em>, they are <em>employees</em>.
We would like to assign <em>birthright</em> privileges to all <em>employees</em>, privileges that other users should not have.
E.g. we want all the <em>employees</em> to automatically have account in company LDAP server.</p>
</div>
<div class="paragraph">
<p>The best way to do that in midPoint 4.8 is to create an <em>employee role</em>.</p>
</div>
<div class="listingblock">
<div class="title">role-employee.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">86d3b462-2334-11ea-bbac-13d84ce0a1df</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Employee<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
            <span class="comment">&lt;!-- LDAP resource --&gt;</span>
            <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This role specifies <em>birthright</em> privileges for employees.
In this case there is just a single construction for a default LDAP account.
This is usually a good start.</p>
</div>
<div class="paragraph">
<p>Now, how do we make sure all employees have this role?
This is not an archetype, we cannot use the <code>archetypeRef</code> method as we have used above.
Even though we cannot use the built-in support for <em>birthright</em> archetypes, we can still use <em>inbound mapping</em>.
However, we have to use one little trick here.
We want <code>Employee</code> role to be assigned to all users that originate from the HR record.
Therefore, the mapping is not associated with any specific HR account attribute.
Unfortunately, midPoint inbound mapping always need to be configured for a specific attribute.
Therefore, we just choose one of the attributes that all employees have, such as <code>empno</code> attribute.</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource&gt;</span>
    <span class="tag">&lt;name&gt;</span>HR System<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>Default Account<span class="tag">&lt;/displayName&gt;</span>
            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>empno<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Employee number<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/personalNumber<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;value&gt;</span>
                            <span class="comment">&lt;!-- Employee role --&gt;</span>
                            <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">86d3b462-2334-11ea-bbac-13d84ce0a1df</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;/value&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>assignment<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two <em>inbound mappings</em> for <code>empno</code> attribute here.
One is the regular mapping copying value of <code>empno</code> HR attribute to <code>personalNumber</code> property of the user.
The other is the mapping for <code>Employee</code> role.
The mapping is not using the input value of <code>empno</code> at all, it always produces the same assignment for <code>Employee</code> role.
Hence, all employees are getting that role.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Auxiliary archetypes</div>
Clever user is uneasy here.
We have mentioned <em>auxiliary archetypes</em> before.
They look like an ideal concept for managing birthright privileges.
Indeed, they are ideal for that purpose - or rather <em>almost</em> ideal, at least in midPoint 4.8.
Support for auxiliary archetypes is quite limited in midPoint 4.8, especially support for management of auxiliary archetypes in midPoint user interface.
That is one thing that will certainly get improved in future midPoint versions.
Adventurous users may try to use auxiliary archetypes instead of birthright roles, especially in cases where user interface is not essential.
However, for general-purpose deployment, use of birthright <em>roles</em> is still recommended.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generating_unique_identifiers">Generating Unique Identifiers</h3>
<div class="paragraph">
<p>There are some use cases that pop out in identity management solutions all the time.
One such case is the problem of finding a <em>unique identifier</em>.
This is a concern for almost any type of identifier, but it is particularly painful when it comes to <em>usernames</em>.
In midPoint world, this means finding a value for <code>name</code> property.
This property must be unique for almost all the data types that midPoint supports.</p>
</div>
<div class="paragraph">
<p>The rational way would be to base <em>usernames</em> on something that is already unique and immutable such as employee numbers or student identifiers.
However, those tend to be long numbers, and people often hate them.
Therefore, many deployments chose to base usernames on real names of the user.
We can easily generate username for Alice Anderson.
Maybe <code>aanderson</code> would be a good fit?
It is nice, easy to remember and reasonably unique.
We can do that with a simple object template mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>name<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;script&gt;</span>
<span class="inline">                   <span class="tag">&lt;code&gt;</span>
                       givenName?.norm[0] + familyName?.norm
                   <span class="tag">&lt;/code&gt;</span></span>
                <span class="tag">&lt;/script&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This can indeed work quite well - until Albert Anderson is hired.
Then we need to get creative.
Obviously, <code>alanderson</code> will not work here.
What about <code>alianderson</code> and <code>albanderson</code>?
Oh no, we have this ancient application in our company.
That application allows only ten characters in the username, and <code>alianderson</code> is just too long.
What is even worse, we would need to change Alice’s username for this to work.
She will get really mad about it.
Not to mention that if we go on with this scheme, we may need to change usernames for pretty much everybody, eventually.
That won’t do.
Let’s go the usual way.
Let’s have <code>aanderson</code> and <code>aanderson1</code>.
It is not entirely elegant, but it will do the job.
Even better, Alice will not get mad.
You know, she is really scary when she gets mad.</p>
</div>
<div class="paragraph">
<p>This use case is so common that even very early midPoint versions supported it.
This feature is called <em>iteration</em> in midPoint terminology.
The name suggests how the mechanism works.
First step is an attempt to create a user object in a perfectly normal way.
This means that username <code>aanderson</code> is generated for Albert Anderson.
Then midPoint checks if that username is unique.
In this case the username is not unique, as it is already taken by Alice.
That is the point when midPoint starts <em>iterating</em>.
MidPoint creates <em>iteration token</em>.
<em>Iteration token</em> is a short string that changes in every iteration.
In our case, the iteration token is initially set to <code>1</code>.
Then midPoint re-evaluates all the object template mappings.
Mappings that are supposed to create unique values need to use that token.
They should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>name<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;script&gt;</span>
<span class="inline">                   <span class="tag">&lt;code&gt;</span>
                       givenName?.norm[0] + familyName?.norm + iterationToken
                   <span class="tag">&lt;/code&gt;</span></span>
                <span class="tag">&lt;/script&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When this mapping is evaluated for the first time, the iteration token is empty.
Therefore, it will make no difference for the normal processing.
When the mappings are re-iterated, the token is set to <code>1</code>.
Result of this mapping is <code>aanderson1</code>, which is <em>unique</em> username.
Therefore, iteration stops there and normal processing continues.
In case that even <code>aanderson1</code> is not unique, the iteration continues.
Usernames <code>aanderson2</code>, <code>aanderson3</code> and other variants are tried.
The iteration continues until a unique username is found, or until iteration limit is reached.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The expression to generate <code>name</code> as provided above is nice and simple.
However, reality is not <em>that</em> simple.
There are going to be users without given names or family names.
Using the script above would produce some ugly <code>null</code> strings in that case.
Some systems allow only certain number of characters in username.
Real-world script has to account for that, generating more sensible usernames.
Also, there is <code>administrator</code> user, which we usually do not want to rename.
More sophisticated version of the script is already part of <code>Person Object Template</code> in default midPoint installation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Iteration functionality is disabled by default.
Therefore, any conflict in username will result in hard error.
This makes sense, as no amount of iterations will make any difference until the iteration token is used in the expressions.
We also want to set maximum number of iterations.
E.g. there may be a bug in the mappings that may cause endless iterations.
The iteration functionality can be enabled by specifying <code>iterationSpecification</code> element and setting iteration limit:</p>
</div>
<div class="listingblock">
<div class="title">object-template-user.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;iterationSpecification&gt;</span>
        <span class="tag">&lt;maxIterations&gt;</span>5<span class="tag">&lt;/maxIterations&gt;</span>
    <span class="tag">&lt;/iterationSpecification&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Iteration tokens</em> are strings that are created from <em>iteration number</em>.
It is the iteration <em>number</em> that really matters for midPoint.
Iteration token can take variety of forms, it can be numeric, it may be alphanumeric, fixed length, variable length or anything else.
Some mappings will not use the token at all.
E.g. mappings that subsequently add letters from given name to the username.
Therefore, both iteration number and iteration token are exposed to the mappings.
There are two variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>iteration</code> variable contains iteration number in an integer form.
It is always numeric, starting with zero (<code>0</code>).
Iteration zero means normal processing.
Iteration one happens after the first conflict.</p>
</li>
<li>
<p><code>iterationToken</code> variable contains a string that is derived from the iteration number.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There is default algorithm that derives iteration tokens from iteration number.
The algorithm is illustrated in following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Iteration</th>
<th class="tableblock halign-left valign-top">The value of <code>iteration</code> variable</th>
<th class="tableblock halign-left valign-top">The value of <code>iterationToken</code> variable</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal processing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>""</code> <em>(empty string)</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">First iteration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"1"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Second iteration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"2"</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The algorithm is designed to put empty value in the <code>iterationToken</code> during normal processing.
The idea is that <code>iterationToken</code> variable can be safely used both for the normal processing and for the iterations.
This is just a default algorithm, and it is certainly not going to fit all the deployments.
Therefore, a custom mechanism to derive iteration token can be specified.
For example, we may not like to have <code>aanderson</code> and <code>aanderson1</code>.
Which one of these is number one and which is number two anyway?
Let’s skip <code>aanderson1</code> and let’s use <code>aanderson2</code> for the first iteration.
The iteration number cannot be changed as the iteration sequence is fixed.
However, there is no problem for iteration 1 to produce iteration token <code>"2"</code>.
This can be achieved by specifying a custom algorithm for the token:</p>
</div>
<div class="listingblock">
<div class="title">object-template-user.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;iterationSpecification&gt;</span>
        <span class="tag">&lt;maxIterations&gt;</span>5<span class="tag">&lt;/maxIterations&gt;</span>
        <span class="tag">&lt;tokenExpression&gt;</span>
            <span class="tag">&lt;script&gt;</span>
<span class="inline">                <span class="tag">&lt;code&gt;</span>
                    if (iteration == 0) {
                        return ''
                    } else {
                        return iteration + 1
                    }
                <span class="tag">&lt;/code&gt;</span></span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/tokenExpression&gt;</span>
    <span class="tag">&lt;/iterationSpecification&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This algorithm will produce sequence of <code>aanderson</code>, <code>aanderson2</code>, <code>aanderson3</code> and so on.</p>
</div>
<div class="paragraph">
<p><em>Iteration number</em> and <em>iteration token</em> is the same for the entire object template.
All the mappings see the same value and all the mappings are recomputed when there is a need to re-iterate.
Therefore, <em>iteration token</em> is not limited to username, it can be used in other mappings too.
For example, use of the token in e-mail address is a very common case:</p>
</div>
<div class="listingblock">
<div class="title">object-template-user.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>emailAddress<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;script&gt;</span>
<span class="inline">                   <span class="tag">&lt;code&gt;</span>
                       givenName?.norm + '.' + familyName?.norm
                           + iterationToken + '@example.com'
                   <span class="tag">&lt;/code&gt;</span></span>
                <span class="tag">&lt;/script&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This mapping produces a sequence of <code>albert.anderson@example.com</code>, <code>albert.anderson2@example.com</code>, <code>albert.anderson3@example.com</code> and so on (assuming that customized token expression is also applied).
Shared value of <code>iterationToken</code> means that the values of <em>e-mail address</em> are consistent with the values of <em>username</em>.
If username of <code>aanderson2</code> is generated, then the e-mail address is <code>albert.anderson2@example.com</code>.
The same iteration token is used.</p>
</div>
<div class="paragraph">
<p>However, it all becomes interesting when it comes to e-mail addresses and other identifiers that are publicly exposed.
It is one thing to have username <code>aanderson2</code>.
That username is used to log into the system, but is it not very visible outside the system.
However, an e-mail address is exposed to a lot of people.
It may be strange to have e-mail address of <code>albert.anderson2@example.com</code>, while there is no other <code>albert.anderson@example.com</code> in the company.
This can be solved by making the mapping for e-mail address smarter.
It can ignore the iteration token, and it may try to create an e-mail address on its own.
However, in that case it needs to explicitly check for uniqueness.
There are two ways to do that.
First method is to check for e-mail address uniqueness inside the e-mail mapping.
There is a <code>isUniquePropertyValue(&#8230;&#8203;)</code> method in <em>midPoint function library</em> that is designed for this purpose:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>name<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;script&gt;</span>
<span class="inline">                   <span class="tag">&lt;code&gt;</span>
                       def plainAddress = givenName?.norm + '.' + familyName?.norm
                                         + '@example.com'
                       if (midpoint.isUniquePropertyValue(focus, 'emailAddress',
                                         plainAddress)) {
                           // Bingo! We have unique address
                       } else {
                           // Address not unique.
                           // We have to use iteration token here.
                       }
                   <span class="tag">&lt;/code&gt;</span></span>
                <span class="tag">&lt;/script&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem with this approach is that there may be corner cases.
We might need to force another iteration even if the username is unique.
MidPoint checks only for uniqueness of username by default.
However, it is possible that even if <code>aanderson2</code> username is available, the <code>albert.anderson2@example.com</code> address is already taken.
This may be an error in the data, administrator’s mistake, or it may be an artefact of retired Albert Anderson <em>senior</em> who worked in the company years ago, yet his e-mail address was never deprovisioned.
The e-mail address mapping can detect this situation.
However, what is the mapping supposed to do when it detects a problem?
It makes no sense to have username <code>aanderson2</code>, and e-mail address <code>albert.anderson3@example.com</code> or <code>albert.anderson.X@example.com</code> or anything similar.
What would make sense is to re-iterate and produce username <code>aanderson3</code> and e-mail address <code>albert.anderson3@example.com</code>.
That would be nice and consistent.
However, the mapping cannot do that by itself.
Therefore, there is another iteration expression for this purpose: <em>post-iteration condition</em>.
It is a condition that gets executed after the iteration is completed.
If the condition returns <code>true</code>, then the iteration is accepted as valid, and the generated values are used.
If the condition returns <code>false</code>, then midPoint re-iterates and yet another iteration is tried.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate&gt;</span>
    ...
    <span class="tag">&lt;iterationSpecification&gt;</span>
        ...
        <span class="tag">&lt;postIterationCondition&gt;</span>
            <span class="tag">&lt;script&gt;</span>
<span class="inline">                <span class="tag">&lt;code&gt;</span>
                    def email = ... // Code to generate or retrieve e-mail
                    return midpoint.isUniquePropertyValue(focus,
                            'emailAddress', email)
                <span class="tag">&lt;/code&gt;</span></span>
            <span class="tag">&lt;/script&gt;</span>
    <span class="tag">&lt;/iterationSpecification&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above does not do much in case the e-mail address is unique.
It returns <code>true</code>, the iteration is accepted, and everything goes as usual.
In case that the e-mail address is not unique, the code returns <code>false</code>.
In that case, midPoint discards all the results of the iteration, increments iteration counter and re-tries the iteration.</p>
</div>
<div class="paragraph">
<p>There is yet another mechanism that can be used here: <em>pre-iteration condition</em>.
It is a condition that is executed prior to iteration.
If it returns <code>true</code>, then the iteration continues.
If it returns <code>false</code>, then midPoint immediately re-iterates.
The difference here is that this condition is executed <em>before</em> all the other mappings are evaluated.
Therefore, it may be used to avoid evaluation of expensive mappings just to discard the values that they produce.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Identifier uniqueness and consistency</div>
Finding identifier values and uniqueness checks are messy stuff.
They are not entirely reliable.
There is a delay between the time when uniqueness is checked and the time when the record is actually written into database.
Therefore, strange things can happen.
Duplicate identifiers may be generated or attempt to create a user may end up with an error, especially under high loads.
The delay between <em>check</em> and <em>write</em> cannot be entirely avoided.
We could lock the data during that time, but that would have significant impact on system performance.
What we can do to improve the situation is to check the uniqueness on database level and gracefully handle the errors.
This is currently implemented only for usernames and even for that the implementation is not perfect.
Implementation of strict uniqueness constraints for other properties is possible, but it is no easy endeavor.
The values need to be normalized, this can influence database schema and so on.
Nevertheless, it is still feasible.
In case you are interested, midPoint platform subscription is the best approach for you.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When it comes to human-friendly identifiers, there is yet another trouble.
People tend to change their minds.
They also like to have all kinds of crazy ideas, such as the urge to get married.
The result is that the names of people <em>change</em>.
In fact, they change surprisingly often.
When user-friendly identifiers are used, change in user’s name usually means a change in the identifiers.
This is known as the <em>rename problem</em>, and you can observe a glimpse of fear in the eyes of all experienced identity management engineers every time it is mentioned.
Overall, midPoint handles renames very well.
Primary identifier of any midPoint object is an <em>OID</em>, not a name.
OIDs do not change.
Therefore, as long as midPoint is concerned, nothing special happens when user’s name is changed.
The change is picked up by mappings, recomputed and stored.
However, iterations and uniqueness checks may complicate the things here.
MidPoint remembers the <em>iteration number</em> for all objects that went through an iteration process.
This is necessary to get the same results from the mappings every time that they are recomputed.
Otherwise the identifiers may get re-generated on every recompute.
However, there is a drawback to this approach.
Let’s suppose that Carol Cooper had username <code>ccooper2</code>.
She got married and now her name is Carol Cunningham.
Even though there is no <code>ccunningham</code> in the system, her generated username will be <code>ccunningham2</code>.
The iteration token is remembered and re-used during the rename process.
The rename scenarios can be very treacherous.
We always recommend to test them thoroughly in any project where user renames are possible.</p>
</div>
<div class="paragraph">
<p>Another drawback of those iterating algorithms is scalability and performance.
Every time there is a conflict, the algorithm need to go through all the iterations that correspond to all the taken usernames.
How many people named John Smith can be in a large user population?
We can easily get to <code>jsmith42</code>.
This means that the next John Smith needs to go through 42 iterations before the system figures out that the next available username is <code>jsmith43</code>.
This gets worse with every John Smith added to the system.
Therefore, this iterative approach is not suitable for generating identifiers that are likely to require a lot of iterations.
Generating UNIX user and group numbers is a good example for identifiers that would surely cause a disaster if an iterative approach is used.
Fortunately, there is another mechanism in midPoint that can support generation of such identifiers: <em>sequences</em>.
More on that later.</p>
</div>
<div class="paragraph">
<p>Overall, the best strategy is to avoid using those generated human-friendly identifiers altogether.
The best choice would be something that is already unique, immutable and reasonably short.
Something like employee number, student identifier or partner ID are usually suitable.
If that is not acceptable, then the second-best approach is to keep the algorithms simple.
The simpler it is the less likely it is to fail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_combining_the_ingredients">Combining the Ingredients</h3>
<div class="paragraph">
<p>It is time to put all the bits and pieces together.
So far we have been talking about provisioning, inbound synchronization, schema, RBAC, archetypes and object templates.
Let’s see how all the parts fit together:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/09-01-big-picture.png" alt="Big picture">
</div>
</div>
<div class="paragraph">
<p>Everything starts with a <em>synchronization</em> process, whether it is reconciliation or live synchronization.
Synchronization process invokes the <em>connector</em> for the source resource (<code>Resource A</code>).
The connector retrieves the data from the source system.
<em>Shadow objects</em> are created for all the source accounts as soon as the data set foot in midPoint.
<em>Correlation</em> is evaluated for all new accounts to find their owners.
Once we have owner of the account, we can execute <em>inbound mappings</em>.
This is the way how account data are reflected to midPoint user object, which is a <em>focus</em> of the computation.</p>
</div>
<div class="paragraph">
<p>Next couple of steps is all about the <em>focus</em>.
This is the part where object templates are executed, assignments and roles are evaluated.
Assignments and roles may contain <em>construction</em> statements.
Those statements are just collected at this stage.
They are not evaluated yet.
This <em>focus policy</em> phase of computation is all about the <em>focus</em>.
Which means that user object is both the input and output of this computation.</p>
</div>
<div class="paragraph">
<p><em>Outbound phase</em> takes place next.
In this phase, the <em>focus</em> of the computation (user) is <em>projected</em> to accounts.
This is the time when <em>constructions</em> are processed and the mappings inside them are evaluated.
Those constructions were collected from the assignments in the previous phase.
They are combined with <em>outbound mappings</em> specified in resource <em>schema handling</em>.
All of that is mixed together, sorted to resource accounts, all the values are computed.
This is also the time when attribute-level reconciliation takes place.
We know what attributes the account should have, therefore we can compare that with the values that the attributes have in reality.
When all of that is computed and processed, then a <em>connector</em> is used to update the target resource (<code>Resource B</code>).</p>
</div>
<div class="paragraph">
<p>This picture is still not entirely complete.
It does not show policy rules, existence mappings, approval processes, hooks and good deal of other advanced features.
Yet, this picture is good enough for now.
It is good enough to create a simple, yet complete solution.</p>
</div>
</div>
<div class="sect2">
<h3 id="_complete_deployment_example">Complete Deployment Example</h3>
<div class="paragraph">
<p>We have all that we need to create a simple but mostly complete identity management solution.
Our environment and solution outline:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HR system is a data input.
It exports <em>employee</em> data into a CSV file.
Employee number is a primary key, there are first and last names and job code.
There is no username or password.</p>
</li>
<li>
<p>We need to feed employee data into midPoint.
Which means that we need to configure <em>synchronization</em>.</p>
</li>
<li>
<p>We need to generate unique and user-friendly <em>username</em>, compute <em>full name</em> and generate a random <em>initial password</em>.</p>
</li>
<li>
<p>We need to automatically assign roles based on <em>job code</em> from the HR system.</p>
</li>
<li>
<p>We need to automatically provision account to <em>LDAP server</em> and <em>CRM database table</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can do that if we put together all that we have learned so far.
Even though this is still quite a simple example, the complete configuration is too large to put all of it into this book.
It will take too much space.
Moreover, after all the detailed explanation in the previous chapters, it would also get a bit boring.
Therefore, we will show only the interesting pieces of the configuration here.
Complete configuration can be found in the usual place.
Please see <a href="#92-additional-information">Additional Information</a> chapter for details.
These files represent the final configuration, the expected state at the end of this chapter.
Therefore, if you want to follow instructions in this chapter step-by-step, you have to choose appropriate parts of the files to import.
Alternatively, you can just import everything, and use the following text as an explanation of the effects that you see.</p>
</div>
<div class="paragraph">
<p>Let us start with an HR resource.
This is mostly the same resource definition as we have seen in the <a href="#05-synchronization">Synchronization</a> chapter.
However, there are few differences.
First of all, the data feed is a bit different.
We have a new <code>jobcode</code> column there.
It looks like this:</p>
</div>
<div class="listingblock">
<div class="title">hr.csv</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">&quot;empno&quot;,&quot;firstname&quot;,&quot;lastname&quot;,&quot;jobcode&quot;
&quot;001&quot;,&quot;Alice&quot;,&quot;Anderson&quot;,&quot;S006&quot;
&quot;002&quot;,&quot;Bob&quot;,&quot;Brown&quot;,&quot;S007&quot;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, the HR resource definition has to reflect those changes.
We have defined a new custom user property <code>jobCode</code> in our extension schema:</p>
</div>
<div class="listingblock">
<div class="title">extension-example.xsd</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;xsd:schema</span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
    <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UserExtensionType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:appinfo&gt;</span>
                <span class="tag">&lt;a:extension</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c:UserType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/xsd:appinfo&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:sequence&gt;</span>
            ...
            <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jobCode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:string</span><span class="delimiter">&quot;</span></span>
                                        <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                ...
            <span class="tag">&lt;/xsd:element&gt;</span>
        <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;/xsd:complexType&gt;</span>
    ...
<span class="tag">&lt;/xsd:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>jobcode</code> column is mapped to <code>jobCode</code> extension property in HR resource inbound mapping:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">03c3ceea-78e2-11e6-954d-dfdfa9ace0cf</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>jobcode<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Job code<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/extension/jobCode<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
    ...
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is one more interesting inbound mapping, a mapping that automatically assigns <code>Employee</code> role.
All the records that come from the HR resource are employee records.
Therefore, we want to assign Employee role to all of them.
The easiest way to do that is to use inbound mapping of HR resource:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">03c3ceea-78e2-11e6-954d-dfdfa9ace0cf</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>rempno<span class="tag">&lt;/ref&gt;</span>
                ...
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;value&gt;</span>
                            <span class="comment">&lt;!-- Employee role --&gt;</span>
                            <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">86d3b462-2334-11ea-bbac-13d84ce0a1df</span><span class="delimiter">&quot;</span></span>
                                       <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;/value&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>assignment<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
    ...
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This mapping is quite straightforward.
Its expression produces a static <code>targetRef</code> value that is placed in user’s assignment.
The strange thing here is the placement of this mapping.
It is placed in the section that corresponds to <code>empno</code> attribute.
This is inbound mapping, and it just has to be placed somewhere.
Any reasonable attribute would do.
It does not really matter into which attribute it is placed as it ignores attribute value anyway.</p>
</div>
<div class="paragraph">
<p>The rest of the mappings that are defined in the HR resource is a bit boring.
The interesting thing is the mapping that is not there at all.
The mapping for <em>username</em> (property <code>name</code> of the <em>user</em> object) is missing.
We are not generating username in the inbound phase.
We just do not have enough data to responsibly generate username just yet.
Inbound phase is still running, user object is not fully populated yet.
Let’s postpone the decision about username for later.</p>
</div>
<div class="paragraph">
<p>Synchronization part of the HR resource definition is also a pretty standard one.
This resource is an authoritative source.
Accounts are correlated by the <code>empno</code> column matching the <code>personalNumber</code> user property.
Linked accounts are updated and new users are created for unmatched accounts.
It is all the same routine as we have already described in <a href="#05-synchronization">Synchronization</a> chapter.</p>
</div>
<div class="paragraph">
<p>Perhaps the most interesting part of this setup is <em>object template</em>.
The template has several responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compute <em>full name</em> from first name and last name.</p>
</li>
<li>
<p>Generate unique <em>username</em>.</p>
</li>
<li>
<p>Generate <em>e-mail address</em>.</p>
</li>
<li>
<p><em>Automatically assign</em> the roles based on <em>job code</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All our users originating from the HR system have <code>Person</code> archetype.
This is quite a standard configuration, and it is a very suitable one.
We want to set up <em>object template</em> for users that represent <em>persons</em>.
We do not want the template to apply to system users, such as <code>administrator</code>.
Therefore, <code>Person</code> archetype is an ideal place to specify the template.
This configuration is so common, that this is already pre-configured in midPoint.
There is <code>Person Object Template</code> which is present in midPoint by default and it is already applied to <code>Person</code> archetype.
All we need to do is to modify that template.</p>
</div>
<div class="paragraph">
<p>Let’s start with the simple thing: generating <em>full name</em>.
At this point this almost a no-brainer:</p>
</div>
<div class="listingblock">
<div class="title">object-template-person.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000380</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person Object Template<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>fullName<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;name&gt;</span>generate-fullname<span class="tag">&lt;/name&gt;</span>
            <span class="tag">&lt;description&gt;</span>Generate fullName (enforcing on renames because of strong mapping)<span class="tag">&lt;/description&gt;</span>
            <span class="tag">&lt;strength&gt;</span>strong<span class="tag">&lt;/strength&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;script&gt;</span>
<span class="inline">                    <span class="tag">&lt;code&gt;</span>
                        basic.concatName(givenName, familyName)
                    <span class="tag">&lt;/code&gt;</span></span>
                <span class="tag">&lt;/script&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
            <span class="tag">&lt;target&gt;</span>
                <span class="tag">&lt;path&gt;</span>fullName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/target&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is almost the same mapping as we have seen before.
However, there is one difference: <code>concatName</code> function is used to concatenate the names.
The <code>concatName</code> is quite smart, it converts all inputs to strings, it trims them, handles cases where some parts of name are null or empty - overall, it saves a lot of trouble.
Perhaps the most interesting thing about this mapping is the fact, that it is already present in <code>Person Object Template</code> by default.
We do not need to change anything.</p>
</div>
<div class="paragraph">
<p><em>Full name</em> mapping is really simple, but it is a bit harder for <em>username</em>.
We want to generate a user-friendly username.
We could simply use user’s last name, but this is very likely to create conflicts.
Therefore, let’s combine last name with the first letter of first name.
That gives us nice usernames such as <code>aanderson</code>, <code>bbrown</code> and so on.
However, there is still a chance of username conflict.
So let’s add iteration tokens into the mix.
Like this:</p>
</div>
<div class="listingblock">
<div class="title">object-template-person.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000380</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person Object Template<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>name<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;name&gt;</span>generate-name-jsmith<span class="tag">&lt;/name&gt;</span>
            <span class="tag">&lt;lifecycleState&gt;</span>active<span class="tag">&lt;/lifecycleState&gt;</span>
            <span class="tag">&lt;strength&gt;</span>weak<span class="tag">&lt;/strength&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;script&gt;</span>
<span class="inline">                    <span class="tag">&lt;code&gt;</span>
                        tmpGivenName = basic.trim(basic.norm(basic.stringify(givenName)))
                        tmpFamilyName  = basic.trim(basic.norm(basic.stringify(familyName)))
                        tmpGivenNameInitial = tmpGivenName?.take(1)
                        return (tmpGivenNameInitial + tmpFamilyName?.replaceAll(&quot; &quot;, &quot;&quot;))?.take(8)
                                    + iterationToken
                    <span class="tag">&lt;/code&gt;</span></span>
                <span class="tag">&lt;/script&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This looks a bit more complicated that your have expected, doesn’t it?
The basic idea is simple, so why won’t equally simple expression work?
Maybe something like this?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">givenName[<span class="integer">0</span>] + familyName + iterationToken</code></pre>
</div>
</div>
<div class="paragraph">
<p>The devil is, as usual, in the details.</p>
</div>
<div class="paragraph">
<p>Firstly, good part of any programming is robustness and error handling.
All the <code>stringify</code> and <code>trim</code> functions deal with inputs that are <code>null</code>, formatted in a wrong way (e.g. extra spaces) or wrong data types (e.g. polystring instead of string).
We are also making sure there are no spaces in username (hence the <code>replaceAll</code> function).</p>
</div>
<div class="paragraph">
<p>Secondly, midPoint is built with multinational environment in mind.
It is 21<sup>st</sup> century already and Unicode is everywhere.
<em>Almost</em> everywhere, that is.
It is expected that the HR system stores names with full national characters, such as <code>Radovan Semančík</code>.
Yet, it is still not a common practice to use national characters in usernames, e-mail addresses and so on.
Therefore, we usually want to normalize the national characters to their ASCII-7 equivalents.
That is what PolyString is for and that is what the <code>norm</code> methods are doing.
The result is that the generated username will be <code>rsemanci</code> instead of <code>RSemančí</code>.</p>
</div>
<div class="paragraph">
<p>Then there is slightly annoying issue of legacy in information technologies.
Even though it is 21<sup>st</sup> century already, some systems are still quite behind.
For example, <code>sAMAccountName</code> identifier in Active Directory is limited to 10 characters in length.
Therefore, we are limiting the length of username to 8 characters, leaving last two characters for the iteration token.
This is what the <code>take(8)</code> function does.</p>
</div>
<div class="paragraph">
<p>The bad news is that reality always finds a way to bring surprises, therefore the expressions dealing with real-wold data need to be more complicated than it is perhaps expected.
However, there is also good news - at least when it comes to username generator mapping.
The mapping above is already pre-configured in default <code>Person Object Template</code> in midPoint.
It is not enabled by default.
Lifecycle state of the mapping is set to <code>draft</code>, which effectively inactivates the mapping.
Changing the lifecycle state to <code>active</code> enables it, and makes it ready to be used.</p>
</div>
<div class="paragraph">
<p>However, there is still one piece missing.
We want to <em>enable</em> iteration to resolve naming conflicts.
Otherwise poor Albert Anderson won’t have his accounts created because <code>aanderso</code> username is already taken by Alice.
We can enable iterations like this:</p>
</div>
<div class="listingblock">
<div class="title">object-template-person.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000380</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person Object Template<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;iterationSpecification&gt;</span>
        <span class="tag">&lt;maxIterations&gt;</span>99<span class="tag">&lt;/maxIterations&gt;</span>
        <span class="tag">&lt;tokenExpression&gt;</span>
            <span class="tag">&lt;script&gt;</span>
<span class="inline">                <span class="tag">&lt;code&gt;</span>
                    if (iteration == 0) {
                        return &quot;&quot;
                    } else {
                        return iteration + 1
                    }
                <span class="tag">&lt;/code&gt;</span></span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/tokenExpression&gt;</span>
    <span class="tag">&lt;/iterationSpecification&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>maxIteration</code> part up there is quite straightforward.
We want to have some limit on the number of iterations as we do not want to iterate forever.
Most iteration sequences are short in practice.
If the iterative approach cannot find a match in several steps, then perhaps the iteration is not a good method anyway.
Therefore, the limit is usually not a problem.
However, having a limit makes a huge difference for troubleshooting.
Most infinite iteration loops are caused by configuration errors.
It is way much better to get an error after a couple of seconds than to wait forever.</p>
</div>
<div class="paragraph">
<p>The second part of the iteration configuration is also quite clear for people that read this chapter carefully.
The default iteration token sequence is <code>""</code>, <code>"1"</code>, <code>"2"</code>, <code>"3"</code> and so on.
That would give us <code>aanderso</code>, <code>aanderso1</code>, <code>aanderso2</code> and so on.
We do not want to have <code>aanderso</code> and <code>aanderso1</code> as that would be confusing.
Therefore, we chose to skip the <code>"1"</code> token and start with <code>"2"</code>.
The custom iteration token expression does just that.</p>
</div>
<div class="paragraph">
<p>Similarly to the mappings, iteration specification is already part of default <code>Person Object Template</code>.</p>
</div>
<div class="paragraph">
<p>As soon as the above configuration is in place, we can start testing our little deployment.
Go ahead and import the HR resource, import object template, set the object template in the configuration and do not forget to replace the HR CSV file.
If you did any experiments with previous configuration, it can be helpful to clean up midPoint by using the "delete all identities" process (that little dropdown button in <b class="menuref">Repository objects</b> page).
When everything is set up, you can try to manually import a single account from the HR resource by using the btn:import[] button, located on the page where you can list resource accounts.
Once the basic configuration works, you can test username generator by adding Albert Anderson to the HR CSV file and importing the account.
Do not forget to explicitly fetch the accounts from the resource by clicking on the btn:Reload[] button on the bottom of the page.
There is no synchronization task running, therefore MidPoint have not seen Albert’s account yet.
You have to instruct midPoint to explicitly look at the resource.
Once Albert’s account is imported, a non-conflicting username should be generated for him:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/09-02-users-andersons.png" alt="Users">
</div>
</div>
<div class="paragraph">
<p>We need to generate e-mail address next.
In our case, the mapping for e-mail address is a bit similar to username mapping:</p>
</div>
<div class="listingblock">
<div class="title">object-template-person.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000380</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person Object Template<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>emailAddress<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;name&gt;</span>generate-email<span class="tag">&lt;/name&gt;</span>
            <span class="tag">&lt;strength&gt;</span>weak<span class="tag">&lt;/strength&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>givenName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>familyName<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;script&gt;</span>
<span class="inline">                    <span class="tag">&lt;code&gt;</span>
                        if ( givenName == null <span class="entity">&amp;amp;</span><span class="entity">&amp;amp;</span> familyName == null ) { return null }
                        if ( familyName == null ) { return givenName?.norm + iterationToken + '@example.com' }
                        if ( givenName == null ) { return familyName?.norm + iterationToken + '@example.com' }
                        givenName?.norm + '.' + familyName?.norm + iterationToken + '@example.com'
                    <span class="tag">&lt;/code&gt;</span></span>
                <span class="tag">&lt;/script&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This mapping should be quite understandable by now.
There are the same checks for special cases.
Then the main expression at the end combines <em>given name</em> and <em>family name</em> to get an e-mail address.
This is just a simple example for e-mail address that is a good fit for a book or for a simple deployment.
However, dealing with e-mail address is a bit more difficult in practice.
A clever reader can surely discover a couple of obvious issues.
Firstly, the expression is using the same iteration token than the username mapping is using.
Therefore, the e-mail address for Albert Anderson will be <code>albert.anderson2@example.com</code>.</p>
</div>
<div class="paragraph">
<p>This is what we get when we re-import or reconcile both Andersons:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/09-03-users-andersons-email.png" alt="Users">
</div>
</div>
<div class="paragraph">
<p>This is not exactly what we want.
Ideally, we would like to use much simpler versions <code>albert.anderson@example.com</code>.
In this case there is no conflict with <code>alice.anderson@example.com</code>.
However, midPoint does not consider e-mail address to be an identifier, therefore it does not check for its uniqueness.
Also, there is only one iteration token that is reused for all the expressions in all object template mappings.
There are also primary e-mail accounts and account aliases, dealing with account renames and temporary assignment of e-mail aliases and so on.
Overall, dealing with e-mail addresses is far from easy.
Some of those issues can be solved with pre-iteration or post-iteration conditions.
However, it is quite likely that a completely custom code will be needed for a more complex cases.</p>
</div>
<div class="paragraph">
<p>That is also one of the reasons to set strength of this mapping to <em>weak</em>.
We want to set an e-mail address automatically, but only in case that an address was not already specified manually.
Weak mapping does not overwrite existing value.
Sometimes it is best not to automate everything, leave the complex cases to system administrators to deal with.</p>
</div>
<div class="paragraph">
<p>Similarly to the <em>full name</em> and <em>username</em> mappings, the mapping for <em>e-mail address</em> is also part of <code>Person Object Template</code> by default.</p>
</div>
<div class="paragraph">
<p>Role autoassignment is the next step.
We are going to handle role autoassignment based on <em>job code</em> using the object template method described above.
Our object template works with user object both as input and output.
It cannot (or rather <em>should not</em>) reach out to the HR account to get the value of <code>jobcode</code> attribute.
We have to do that the other way around.
We have to map HR account attribute <code>jobcode</code> to midPoint user property <code>jobCode</code> by using an inbound mapping:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">03c3ceea-78e2-11e6-954d-dfdfa9ace0cf</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>HR System<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        <span class="tag">&lt;objectType&gt;</span>
            ...
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>jobcode<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/extension/jobCode<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            ...
        <span class="tag">&lt;/objectType&gt;</span>
    <span class="tag">&lt;/schemaHandling&gt;</span>
    ...
<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As the job code is synchronized to <em>user</em>, we can easily use it in object template mapping now:</p>
</div>
<div class="listingblock">
<div class="title">object-template-person.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objectTemplate</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">00000000-0000-0000-0000-000000000380</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Person Object Template<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;item&gt;</span>
        <span class="tag">&lt;ref&gt;</span>assignment<span class="tag">&lt;/ref&gt;</span>
        <span class="tag">&lt;mapping&gt;</span>
            <span class="tag">&lt;name&gt;</span>autoassign-jobcode<span class="tag">&lt;/name&gt;</span>
            <span class="tag">&lt;strength&gt;</span>strong<span class="tag">&lt;/strength&gt;</span>
            <span class="tag">&lt;source&gt;</span>
                <span class="tag">&lt;path&gt;</span>extension/jobCode<span class="tag">&lt;/path&gt;</span>
            <span class="tag">&lt;/source&gt;</span>
            <span class="tag">&lt;expression&gt;</span>
                <span class="tag">&lt;assignmentTargetSearch&gt;</span>
                    <span class="tag">&lt;targetType&gt;</span>RoleType<span class="tag">&lt;/targetType&gt;</span>
                    <span class="tag">&lt;filter&gt;</span>
                        <span class="tag">&lt;q:text&gt;</span>extension/autoassignJobCode = $jobCode<span class="tag">&lt;/q:text&gt;</span>
                    <span class="tag">&lt;/filter&gt;</span>
                <span class="tag">&lt;/assignmentTargetSearch&gt;</span>
            <span class="tag">&lt;/expression&gt;</span>
        <span class="tag">&lt;/mapping&gt;</span>
    <span class="tag">&lt;/item&gt;</span>
    ...
<span class="tag">&lt;/objectTemplate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the same principle as we have used earlier in this chapter.
The mapping is using <code>assignmentTargetSearch</code> expression to look for roles where user’s <code>jobCode</code> and role’s <code>autoassignJobCode</code> match.
This mapping is <em>strong</em>, as we want to recompute the mapping and set the value all the times.
If the mapping would be normal-strength, then the values are recomputed only when <code>jobCode</code> changes.
Which actually might be enough during normal operation of the system.
However, making this mapping <em>strong</em> makes things much easier during testing.
That is all that we need to do for the mapping.
Now we need to prepare the <em>roles</em> for this mapping to work with.
We need to extend role <em>schema</em> first:</p>
</div>
<div class="listingblock">
<div class="title">extension-example.xsd</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;xsd:schema</span> <span class="attribute-name">...</span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;xsd:complexType</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleExtensionType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;xsd:annotation&gt;</span>
            <span class="tag">&lt;xsd:appinfo&gt;</span>
                <span class="tag">&lt;a:extension</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">c:RoleType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/xsd:appinfo&gt;</span>
        <span class="tag">&lt;/xsd:annotation&gt;</span>
        <span class="tag">&lt;xsd:sequence&gt;</span>
            <span class="tag">&lt;xsd:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autoassignJobCode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xsd:string</span><span class="delimiter">&quot;</span></span>
                                                  <span class="attribute-name">minOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxOccurs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                ...
            <span class="tag">&lt;/xsd:element&gt;</span>
        <span class="tag">&lt;/xsd:sequence&gt;</span>
    <span class="tag">&lt;/xsd:complexType&gt;</span>
    ...
<span class="tag">&lt;/xsd:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we need a couple of roles with <em>job codes</em> in their extension:</p>
</div>
<div class="listingblock">
<div class="title">role-sales-manager.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a1572de4-b9b9-11e9-af3e-5f68b3207f97</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Sales Manager<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;extension&gt;</span>
        <span class="tag">&lt;exmpl:autoassignJobCode&gt;</span>S006<span class="tag">&lt;/exmpl:autoassignJobCode&gt;</span>
    <span class="tag">&lt;/extension&gt;</span>
    ...
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">role-sales-agent.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b93af850-b9b9-11e9-8c2c-dfb9a89635a0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Sales Agent<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;extension&gt;</span>
        <span class="tag">&lt;exmpl:autoassignJobCode&gt;</span>S007<span class="tag">&lt;/exmpl:autoassignJobCode&gt;</span>
    <span class="tag">&lt;/extension&gt;</span>
    ...
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">role-sales-assistant.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b9d2b604-b9b9-11e9-bbc4-17d8e85623b4</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Sales Assistant<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;extension&gt;</span>
        <span class="tag">&lt;exmpl:autoassignJobCode&gt;</span>S008<span class="tag">&lt;/exmpl:autoassignJobCode&gt;</span>
    <span class="tag">&lt;/extension&gt;</span>
    ...
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is all the configuration needed for autoassignment to work.
The roles should be automatically assigned to users when the users are recomputed.
Just make sure that the users have their <code>jobCode</code> properly set in the user object.
If they do not have it, then re-import them from the HR resource or run a reconciliation task.
Then go ahead and create some more roles for the missing job codes.
The mappings do not need to be changed at all to support more job codes.
Just create new roles and recompute.
That is the beauty of this solution - it is so easy to maintain.</p>
</div>
<div class="paragraph">
<p>So far we have tackled the inbound phase and focus policy phase.
However, we have not talked about the outbound (provisioning) phase much.
Now it is the right time to have a look at that.</p>
</div>
<div class="paragraph">
<p>We are going to reuse the LDAP and CRM resources from previous chapters.
Those resources are used here in a pretty much unchanged form.
There is no need to change them.
Outbound mappings in the resource definitions specify the basic framework of the account.
The key to provisioning flexibility is usually not in the resource definition, it is in the <em>roles</em>.
Let’s start in the simplest way possible - with the <code>Employee</code> role.
ExAmPLE company policy states that every employee should have a very basic LDAP account.
Therefore, all we need is a very simple LDAP account <em>construction</em> that we place into an <em>inducement</em> in the <code>Employee</code> role:</p>
</div>
<div class="listingblock">
<div class="title">role-employee.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">86d3b462-2334-11ea-bbac-13d84ce0a1df</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Employee<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
            <span class="comment">&lt;!-- OpenLDAP --&gt;</span>
            <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="comment">&lt;!-- just basic account. Nothing special here. --&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All employees get this role, by the means of <em>inbound mapping</em> defined for HR resource.
Therefore, all employees automatically get basic LDAP account.
It is as simple as that.
Put the construction in the role, reconcile the HR resource or just recompute the users, then LDAP accounts are created for all employees.</p>
</div>
<div class="paragraph">
<p>We want something a bit more fancy next.
Salespeople tend to be a bit sensitive when it comes to their professional image.
Therefore, they insist on having proper titles set up in company directory.
Not a problem.
We can do that easily in their "job" roles.
This is how it looks like for a sales manager:</p>
</div>
<div class="listingblock">
<div class="title">role-sales-manager.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a1572de4-b9b9-11e9-af3e-5f68b3207f97</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Sales Manager<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
            <span class="comment">&lt;!-- OpenLDAP --&gt;</span>
            <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>title<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;value&gt;</span>Sales Manager<span class="tag">&lt;/value&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                <span class="tag">&lt;/outbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This construction refers to the same account as the <code>Employee</code> role.
MidPoint knows that, therefore it does not attempt to create a new account.
It just updates existing account with appropriate title.
However, we are not done yet.
We need to provide access to CRM system for the salespeople.
Should we create a new role for that?
Absolutely not.
We do not want to have too many roles as every role is a maintenance burden.
Let’s just add new construction to an existing job role:</p>
</div>
<div class="listingblock">
<div class="title">role-sales-manager.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a1572de4-b9b9-11e9-af3e-5f68b3207f97</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Sales Manager<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
            <span class="comment">&lt;!-- OpenLDAP --&gt;</span>
            ...
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
            <span class="comment">&lt;!-- CRM --&gt;</span>
            <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">04afeda6-394b-11e6-8cbe-abf7ff430056</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>accesslevel<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;value&gt;</span>MANAGER<span class="tag">&lt;/value&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                <span class="tag">&lt;/outbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/role&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a role that gives access to the CRM system for a sales manager.
MidPoint knows that, and it automatically creates a new CRM account when the role is assigned.
Outbound mappings from the CRM resource definition are used to set basic properties of CRM account, such as account identifiers and password.
In addition to that, the <code>Sales Manager</code> role sets appropriate <em>access level</em> to the CRM system.</p>
</div>
<div class="paragraph">
<p>Our setup is almost complete now.
We have inbound synchronization, object template, roles and outbound mappings.
This is the right time to test everything.
Select few representative HR accounts and try to import them.
Check that everything is provisioned correctly.
If it works, then it is the time for roll-out.
Set up a synchronization task for the HR resource, and we are done.
We have running system:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/09-04-users-final.png" alt="Users">
</div>
</div>
<div class="paragraph">
<p>Users are imported from the HR system.
Roles are assigned, which can be checked by navigating to user details page and opening the <b class="menuref">Assignements</b> tab.
Accounts are provisioned according to the roles, which is the reason for variations in number of accounts for individual users.
The basic stuff works now.
Go ahead and try it out, add more roles and mappings, modify the configuration.
Have some fun.</p>
</div>
<div class="paragraph">
<p>Even this simple identity management deployment is a huge improvement for many organizations already.
However, there is still a lot of things to improve here.
Maybe we want to set up a formalized organizational structure.
Maybe we need delegated administration.
We almost certainly want to manage groups, privileges and other entitlements.
This is still just a beginning.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_7">Conclusion</h3>
<div class="paragraph">
<p>This chapter concludes one whole part of the book.
If you have followed the book so far, you should be able to set up a simple working identity management deployment at this point.
We have covered all the basic mechanisms: resources, mappings, roles, schema and object templates.
This is a good time to stop reading and get your hands dirty.
Take the examples from this book and play a bit with them.
Explore the examples that come with midPoint distribution.
Watch videos on Evolveum YouTube channel.
Now it is time for experiments.
You will surely do a lot of things that are suboptimal or even outright wrong.
That does not really matter now.
This is part of the learning process.
If you get to dead end, just scrap everything and start over, or maybe rework everything from the ground up.
MidPoint is designed for this.
Evolutionary approach is deeply embedded in midPoint philosophy and design.
Just go ahead, have fun, conduct experiments and explore.
Such experience will help a lot when you get back and read through following chapters.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="10-orgstruct">10. Organizational Structures</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
If life is going to exist in a Universe of this size, then the one thing it cannot afford to have is a sense of proportion.
</blockquote>
<div class="attribution">
&#8212; Douglas Adams<br>
<cite>The Restaurant At The End Of The Universe</cite>
</div>
</div>
<div class="paragraph">
<p>Organizations come in all shapes and sizes.
Unless your organization is extremely unusual, there is always some form of recognizable internal structure.
There may be the usual corporate divisions, departments and sections.
Perhaps there are dynamic teams, projects, work groups and task forces.
One way or another, some kind of <em>organizational structure</em> is always there, and it matters.
While many organizational structures are quite far from the ideal, organizational structure is seldom completely useless.
Membership in some organizational units is a reason to automatically grant privileges to users.
Managers can usually access quite a wide set of data about employees in organizational units that they are managing.
Team leaders and project managers often exercise elevated privileges over their teams and projects.
Moreover, organizational structure is not limited to users.
Roles are often organized into <em>role catalog</em>.
Services and devices may be organized by geographical location.
There are many things that need to be organized, and there are many ways to organize them.</p>
</div>
<div class="paragraph">
<p>Organizational structure affects almost every part of the identity management deployment.
We have realized that in very early stages of midPoint development.
Therefore, organizational structure is an integral part of midPoint functionality.
It permeates almost every part of midPoint functionality.
Unlike most other systems, organizational structure in midPoint is a very flexible and almost universal concept.
It can be used to build functional organizational hierarchies as well as flat project-based structures.
The same mechanism can be used to sort roles in a role catalog, or to manage devices by geographical location.
All of those organizational structures may co-exist at the same time in the same system.</p>
</div>
<div class="paragraph">
<p>The concept of organizational structure is a very powerful one, but it is implemented by just a handful of simple components.
Let us have a look at those building blocks now.</p>
</div>
<div class="sect2">
<h3 id="_organizational_units">Organizational Units</h3>
<div class="paragraph">
<p>Basic building blog of all organizational structures is just one simple object type.
Due to the lack of poetic talent and because of critical shortage of abstract words in our dictionary, we have decided to call that object simply an <em>org</em>.
It is a nice and short name.
<em>Org</em> can represent any kind of organizational unit: company, division, department, section, project, team, role category, geographical location or anything else.
Orgs can be used to create hierarchical structures.
For example, a top-level org may represent a company.
A couple of other orgs can represent divisions.
Those orgs can be put "inside" the company org.
Other orgs can represent departments, these can be put "inside" the division orgs.
That process can be repeated until complete organizational structure is formed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-01-org-tree.png" alt="Organizational tree">
</div>
<div class="title">Figure 1. Organizational tree</div>
</div>
<div class="paragraph">
<p><em>Org</em> is quite a basic thing with a very simple anatomy:</p>
</div>
<div class="listingblock">
<div class="title">org-example-top.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4d12c1ac-440c-11ea-80af-2b314d06ba95</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>F10000<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>ExAmPLE, Inc.<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Strictly speaking, the only two things that an org really needs are <em>name</em> and <em>OID</em>.
The example above adds <code>displayName</code> to make the presentation of the org nicer.
As all regular midPoint objects, a <code>name</code> of an org must be unique.
This often leads to a practice that org names are in fact identifiers, or that they are generated automatically.
This is also our case.
We have decided to set <code>F1000</code> as the <code>name</code> of this org.
The value <code>1000</code> is an identifier of the company in our HR system.
As we are building a functional organizational structure of the company, we have prefixed the identifier with <code>F</code> which stands for <em>functional</em>.
However, names such as <code>F1000</code> are not very friendly.
Therefore, there is a mechanism to set nicer display name that does not need to be unique.
The display name is used instead of the ordinary <code>name</code> whenever this org is displayed to a user.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-02-org-top.png" alt="Top-level organizational unit">
</div>
<div class="title">Figure 2. Top-level organizational unit</div>
</div>
<div class="paragraph">
<p>We have an organizational unit now, but how do we put users in it?
Clever reader already knows the answer: <em>assignment</em>.
All we need is to <em>assign</em> the org to a user.
This is done in almost the same way as you would assign a role, just select the <code>Org</code> tab in assignment dialog.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-03-top-org-assignment.png" alt="Assignment of an organizational unit">
</div>
<div class="title">Figure 3. Assignment of an organizational unit</div>
</div>
<div class="paragraph">
<p>The assignment looks like this in XML form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>eevans<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4d12c1ac-440c-11ea-80af-2b314d06ba95</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The user is a part of our minimalistic organizational unit now:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-04-top-org-assignment-tree.png" alt="Assigned top-level organizational unit">
</div>
<div class="title">Figure 4. Assigned top-level organizational unit</div>
</div>
</div>
<div class="sect2">
<h3 id="_organizational_structure_hierarchy">Organizational Structure Hierarchy</h3>
<div class="paragraph">
<p>There is very little structure in our tiny organizational structure yet.
Orgs would not be very useful, unless they can be placed inside each other, creating a hierarchy.
It is this hierarchy that makes organizational structures attractive.
Therefore, let us go corporate and create some hierarchy now.
It is a well-known fact that all self-respecting corporations need sales and marketing division:</p>
</div>
<div class="listingblock">
<div class="title">org-sales-and-marketing-division.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7a1feb50-471f-11ea-8aab-1b2627541f15</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>F11000<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Expensive people that make money.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Sales and Marketing Division<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;identifier&gt;</span>11000<span class="tag">&lt;/identifier&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have pimped up this organizational unit a little.
We have seen <code>name</code> and <code>displayName</code> before.
The <code>description</code> is no stranger either.
Then there is an <code>identifier</code>.
The value of the <code>identifier</code> is usually an official "code" of the organizational unit assigned by HR people.
Why do we need yet another identifier?
OID is an identifier, <code>name</code> is an identifier of sorts, why do we need another one?
For now, let&#8217;s just say that the identifier is going to be very useful later on, when we synchronize organizational structures.</p>
</div>
<div class="paragraph">
<p>If we import the org above into midPoint it becomes the <em>top</em> org.
MidPoint puts it at the same level as the ExAmPLE company org.
We do not want that.
We want to create a <em>hierarchy</em>.
We want to tell midPoint to put the department <em>inside</em> the company.
How do we do that?
We use an <em>assignment</em>, of course:</p>
</div>
<div class="listingblock">
<div class="title">org-sales-and-marketing-division.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7a1feb50-471f-11ea-8aab-1b2627541f15</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">'</span><span class="content">http://midpoint.evolveum.com/xml/ns/public/common/common-3</span><span class="delimiter">'</span></span>
       <span class="attribute-name">xmlns:org</span>=<span class="string"><span class="delimiter">'</span><span class="content">http://midpoint.evolveum.com/xml/ns/public/common/org-3</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>F11000<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Expensive people that make money.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Sales and Marketing Division<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;identifier&gt;</span>11000<span class="tag">&lt;/identifier&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
       <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4d12c1ac-440c-11ea-80af-2b314d06ba95</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have our minimalistic hierarchy:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-05-small-org-tree.png" alt="Small organizational structure tree">
</div>
<div class="title">Figure 5. Small organizational structure tree</div>
</div>
<div class="paragraph">
<p>This makes perfect sense, doesn&#8217;t it?
Users become part of organizational units when the units are assigned to them.
Therefore, also organizational units become part of other organizational units when they are assigned to them.
This principle applies to everything: roles, services, tasks, resources and other object types.
Every object type that can be <em>assignment holder</em> can be placed in organizational structure, by assigning an organizational unit to it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Assignment holders</div>
Almost all midPoint object types are <em>assignment holders</em>, and therefore they can be placed into organizational structure.
Theoretically.
However, midPoint user interface has some limits.
Convenient management of the assignments is currently possible only for <em>focal</em> types: user, role, org and service.
Other objects can be placed in organizational structure, and they should behave up to the expectations.
However, that cannot be done by few convenient clicks in midPoint user interface
Not yet.
You have to use a different approach.
You either add the assignment manually in the XML/JSON/YAML form.
You may also try to use mappings to create the assignments automatically, or perhaps use the REST interface to do that.
Maybe it would be a good idea to send some money in the direction of midPoint development team to motivate them to add this functionality to user interface.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We know how to create a simple organizational hierarchy.
All we need to do now is to repeat the process <em>ad nauseam</em> to create something that resembles real corporate organizational structure.
Let us add marketing department to our division:</p>
</div>
<div class="listingblock">
<div class="title">org-marketing-department.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">a0c7d92c-4722-11ea-bc8d-d79a6cefb1bf</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">'</span><span class="content">http://midpoint.evolveum.com/xml/ns/public/common/common-3</span><span class="delimiter">'</span></span>
       <span class="attribute-name">xmlns:org</span>=<span class="string"><span class="delimiter">'</span><span class="content">http://midpoint.evolveum.com/xml/ns/public/common/org-3</span><span class="delimiter">'</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>F11300<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Creative bunch that spends money to get more money.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Marketing Department<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;identifier&gt;</span>11300<span class="tag">&lt;/identifier&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
       <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7a1feb50-471f-11ea-8aab-1b2627541f15</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is the same process over and over again.
However, there are so many organizational units, there are so many files to import.
We like to be efficient in all the things that we do.
Therefore, let&#8217;s put the entire organizational structure into a single file:</p>
</div>
<div class="listingblock">
<div class="title">org-tree-functional.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;objects&gt;</span>

    <span class="comment">&lt;!-- Functional organizational structure of ExAmPLE company --&gt;</span>

    <span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4d12c1ac-440c-11ea-80af-2b314d06ba95</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;name&gt;</span>F10000<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;displayName&gt;</span>ExAmPLE, Inc.<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;/org&gt;</span>

    <span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7a1feb50-471f-11ea-8aab-1b2627541f15</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;name&gt;</span>F11000<span class="tag">&lt;/name&gt;</span>
        <span class="tag">&lt;description&gt;</span>Expensive people that make money.<span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;displayName&gt;</span>Sales and Marketing Division<span class="tag">&lt;/displayName&gt;</span>
        <span class="tag">&lt;identifier&gt;</span>11000<span class="tag">&lt;/identifier&gt;</span>
        <span class="tag">&lt;assignment&gt;</span>
            <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4d12c1ac-440c-11ea-80af-2b314d06ba95</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/assignment&gt;</span>
    <span class="tag">&lt;/org&gt;</span>

    ...

<span class="tag">&lt;/objects&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It would be no big surprise to find out that laziness was a driving force behind many improvements in life, would it?
Now, let us use this convenient approach to create a nice and rich corporate organizational tree:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-06-org-tree-page.png" alt="Organizational tree">
</div>
<div class="title">Figure 6. Organizational tree</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Of course, you can create and manage organizational structure in midPoint user interface.
In fact, people do that quite often.
However, now we are talking about the <em>initial</em> organizational structure.
It is the structure that gets created in midPoint at the beginning of the deployment.
There is usually a lot of <em>trial and error</em> until you get your midPoint configuration right.
It is quite likely you will have to purge all midPoint configuration and start clean.
In that case, it is very convenient to have organizational structure in one file that can be easily imported after the clean-up.
Also, it is a common practice to have several environments: development, testing and production.
You probably want the same organizational structure in all of them.
Having organizational structure in a file makes that job easy.
Of course, you can also create organizational structure in the user interface and then export it into a file.
However, according to our experience, many engineers prefer text editor to graphical user interfaces.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_orgs_in_the_database">Orgs in the Database</h3>
<div class="paragraph">
<p>Organizational structures tend to form <em>hierarchies</em> - data structures that look like trees.
However, databases are usually designed to store <em>relational</em> data - data structures that look like tables.
If you ever tried to express hierarchical data in a spreadsheet application you know that these paradigms are not entirely easy to align.
It is not entirely easy to express tree-like data structure in relational tables.
Moreover, hierarchical data tend to have some specific requirements.
For example, we usually want to look for people in <em>Operations Division</em> and all the departments and sections that belong to it.
This is known as <em>subtree searches</em>, and it is usually not possible to execute them directly on data that are stored in relational form.</p>
</div>
<div class="paragraph">
<p>This is further complicated by the fact that midPoint <em>assignment</em> is a very flexible data structure.
Assignments can be valid from a specific time to a specific time.
Assignments can be parametric and conditional.
Assignment is just too complex for the database to understand and use efficiently.</p>
</div>
<div class="paragraph">
<p>MidPoint is solving these problems with <code>parentOrgRef</code> operational data item.
As the name suggests, <code>parentOrgRef</code> is an object reference that points to <em>parent org</em>.
Any <em>assignment holder</em> in midPoint can have <em>parentOrgRef</em>, and it points to the org (or orgs) that the object belongs to.
This somehow duplicating the data in the assignment.
Yet, there are several crucial differences.</p>
</div>
<div class="paragraph">
<p>Firstly, <code>parentOrgRef</code> points to the orgs that the object is <em>currently</em> member of.
I.e. it only reflects those assignments that are currently active and valid.
Therefore, there will be no <code>parentOrgRef</code> value for assignment that is expired or not valid yet.</p>
</div>
<div class="paragraph">
<p>Secondly, <code>parentOrgRef</code> represents all organizational assignments, both direct and indirect.
Orgs that are directly assigned to users are present in <code>parentOrgRef</code>.
Orgs that are induced in a role that is assigned to the user are also present in <code>parentOrgRef</code>.
Everything is there.</p>
</div>
<div class="paragraph">
<p>Thirdly, <code>parentOrgRef</code> is a very simple data structure.
This simplicity allows efficient <em>indexing</em> of the <code>parentOrgRef</code> values in the database (repository) layer.
The indexes are designed to allow efficient subtree searches over organizational structure hierarchies.</p>
</div>
<div class="paragraph">
<p>This is our trick to fit hierarchical data into flat data tables.
The details may be a bit complicated, but it usually works quite well.
The <code>parentOrgRef</code> is automatically maintained by midPoint under the hood.
Therefore, its use is usually completely transparent.
The user does not even notice that there is a special mechanism working in the background.</p>
</div>
<div class="paragraph">
<p>However, there are also downsides to this approach.
The index that is build on <code>parentOrgRef</code> is designed to work even if organizational structure is re-organized.
The index has to be continually maintained.
Maintenance overhead of the index is usually very low for small or mid-sized structures that do not change often.
However, maintenance of massive organizational structures can be painful.
Similarly, it may be problematic to maintain organizational structures that change very frequently.
Therefore, it is perhaps a good idea to prototype the design of organizational structure before putting the system into production.
Also, the <code>parentOrgRef</code> is in fact a copy of the primary data (assignment).
As it is a copy, there is a risk that it may get out of synchronization.
MidPoint is designed to keep <code>parentOrgRef</code> and all the indexes strictly consistent during normal operations.
However, midPoint allows systems administrators to do a lot of non-standard things.
Some of those things may lead to data inconsistencies.
Therefore, it is a good idea to check whether the values of <code>parentOrgRef</code> make sense in case you notice that organizational structures are behaving strangely.</p>
</div>
<div class="paragraph">
<p>Overall, organizational structures work very well in midPoint, and you usually do not need to care about the mechanisms under the hood.
However, management of organizational structures is much more complex than it seems.
If you try to do strange and unusual things, you should better be sure you fully understand what you are doing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_orgs_and_roles">Orgs and Roles</h3>
<div class="paragraph">
<p>Organizations and roles have many things in common.
Roles are granting privileges to its members.
Usually, people that are members of an organization are granted privileges too.
People that have the same role usually have the same set of privileges.
People in an organization often have the same privileges too.
In fact, organizations behave in almost the same way as roles.</p>
</div>
<div class="paragraph">
<p>MidPoint has fully embraced this similarity.
Orgs are designed to behave in almost the same way as roles.
Orgs are <em>abstract roles</em>, therefore they may have <em>inducements</em>, there may be <em>constructions</em> in them, orgs may contain <em>authorizations</em> and so on.
Org can do everything that a role can do.</p>
</div>
<div class="paragraph">
<p>Therefore, there is no need to set up complicated configurations that assign a particular role to all members of an organization.
The <em>organization</em> itself acts as a role.
All the privileges that organization members need can be simply added as <em>inducements</em> in the organization itself.
This is very simple, elegant and mostly fool-proof solution.</p>
</div>
<div class="paragraph">
<p>We have <em>Sales and Marketing Division</em> in ExAmPLE, Inc.
We want to make things simple, and therefore we want to grant access to CRM system to all the members of this division.
It is very easy to do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7a1feb50-471f-11ea-8aab-1b2627541f15</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>F11000<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Expensive people that make money.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Sales and Marketing Division<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;identifier&gt;</span>11000<span class="tag">&lt;/identifier&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="comment">&lt;!-- Assignment of parent organizational unit --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4d12c1ac-440c-11ea-80af-2b314d06ba95</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="comment">&lt;!-- Inducement that grants CRM privileges to all members of this department --&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
            <span class="comment">&lt;!-- CRM resource --&gt;</span>
            <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">04afeda6-394b-11e6-8cbe-abf7ff430056</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            ...
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Clever reader certainly wonders whether the CRM privileges apply also to <em>Indirect Sales Department</em>, which is located below <em>Sales and Marketing Division</em> in our organizational structure.
However, clever reader is clever enough to figure out that the privileges are not "inherited" in this case.
To follow the thoughts of clever reader, you have to think about orgs in the same way as you would think about roles.
There is an assignment from <em>Indirect Sales Department</em> to <em>Sales and Marketing Division</em>.
However, there is no <em>inducement</em>.
Role hierarchies are built using <em>inducements</em>.
Therefore, privileges of <em>Sales and Marketing Division</em> are not included in <em>Indirect Sales Department</em>.
This may seem to be counter-intuitive, but in fact it is completely correct.
Orgs and roles form separate hierarchies (see note below).
However, if you want to "inherit" privileges of a parent org, there is a very simple way how to do it: add explicit <em>inducement</em>.
For example, this is how we can "inherit" the CRM privileges in <em>Indirect Sales Department</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8887e0b0-4726-11ea-96b0-5f5ced221e42</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>F11200<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Suits that talk to other suits that talk to customers.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Indirect Sales Department<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;identifier&gt;</span>11200<span class="tag">&lt;/identifier&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="comment">&lt;!-- Assignment of parent organizational unit --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7a1feb50-471f-11ea-8aab-1b2627541f15</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="comment">&lt;!-- Inducement to parent organizational unit. This creates &quot;inheritance&quot; of privileges. --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7a1feb50-471f-11ea-8aab-1b2627541f15</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This has to be done for every org that needs to inherit privileges from parent, which may be quite daunting for large organizational structures.
Fortunately, there is a clever way how to avoid placing inducements everywhere.
The solution involves the concept of <em>meta-roles</em>, as parent org is technically a meta-role for child orgs.
However, this involves an advanced thinking about application of assignment and inducements.
Even a clever reader may not be ready for such abstract thoughts yet.
This has to come later when the basic principles have enough time to sink in.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Org and role hierarchies</div>
Both orgs are roles are <em>hierarchical</em> in a way.
However, they form a separate hierarchies.
Org hierarchy is used to model organizational trees.
Role hierarchy is used to build access control structures.
Those hierarchies have completely different purpose.
They are also built using different mechanism.
Role hierarchy is used to group privileges, and therefore it is built using <em>inducements</em>.
Org hierarchy is used to group subjects (users), and it is built using <em>assignments</em>.
There are also different internal mechanisms, indexing and data storage properties.
For example, role hierarchy does not use <code>parentOrgRef</code>, therefore there is much lower overhead as compared to org hierarchy.
However, this means that the capabilities to query role hierarchy is limited.
Both hierarchies have their respective place and purpose.
Even though the difference may not be entirely obvious now, it is quite substantial.
Hopefully, this will get much more clear later when there will be more examples for both org and role structures.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_multiple_organizational_structures">Multiple Organizational Structures</h3>
<div class="paragraph">
<p>Tree is a simple and very elegant structure in many ways.
However, it is a rare sight to see a lone tree growing in the field.
When we think of trees, we usually think about a forrest.
It takes a lot of trees to make a forrest.</p>
</div>
<div class="paragraph">
<p>This is also the case when it comes to organizational structures.
It is a very rare sight when an entire organizational structure of an organization can be modeled in a single tree.
There is always the usual <em>functional</em> organizational structure with divisions, departments, sections, companies, branches, schools and faculties.
Then there is a <em>project</em> organizational structure that is often completely orthogonal to functional organizational structure.
This is sometimes spiced up with workgroups, task forces, focus groups, research teams, interest groups, clubs and similar collective life forms.
There are many trees that make a forrest of organizational structures.</p>
</div>
<div class="paragraph">
<p>Fortunately, midPoint is not very picky when it comes to organizational structures.
MidPoint is not limited to a single organizational tree.
You can have as many organizational trees as you like.
You can have functional organizational tree, as we have seen in previous sections.
Then you can have independent project organizational structure.
Just create new root <em>org</em> for projects and place the projects under it:</p>
</div>
<div class="listingblock">
<div class="title">org-tree-project.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">832e37e4-edfd-11ea-9f8c-ef736d6646a2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Projects<span class="tag">&lt;/name&gt;</span>
<span class="tag">&lt;/org&gt;</span>

<span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9c1b8464-edfd-11ea-87b8-db467c5ae301</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>PBD2020<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Make money fast.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Big Deal<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;identifier&gt;</span>BD2020<span class="tag">&lt;/identifier&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">832e37e4-edfd-11ea-9f8c-ef736d6646a2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span>

<span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">22dc2bd4-edfe-11ea-a904-5be54dda2e46</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>PLS<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Make sure our marketing message gets across.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Loudspeaker<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;identifier&gt;</span>LS<span class="tag">&lt;/identifier&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">832e37e4-edfd-11ea-9f8c-ef736d6646a2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span>

<span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1954d496-f6ad-11ea-a96a-8bfa569f5fff</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>PWL2<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Second generation wonderland. We are all mad here.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Wonderland 2.0<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;identifier&gt;</span>WL2<span class="tag">&lt;/identifier&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">832e37e4-edfd-11ea-9f8c-ef736d6646a2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have two organizational trees now, each neatly stowed under its own tab:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-09-org-tree-projects.png" alt="Project organizational tree">
</div>
<div class="title">Figure 7. Project organizational tree</div>
</div>
<div class="paragraph">
<p>This is a nice <em>project</em> organizational structure.
However, our users are members of <em>functional</em> organizational structure already.
How can we add our users to the projects?
The answer is <em>assignment</em>, of course.
User can belong to any number of organizational units at the same time.
It makes no difference whether they are in the same organizational tree or in different trees.
We can simply assign the projects to the users.
In fact, midPoint does not even recognize the difference between <em>functional</em> and <em>project</em> organizational structures.
They look all the same to midPoint, and midPoint treats them in the same way.
If there is a need for the structures to behave differently, it has to be explicitly configured.
Which is usually done by using <em>archetypes</em>.</p>
</div>
<div class="paragraph">
<p>There are two organizational structures now.
You can have three organizational structures if you want to, or five of them.
Any number you like - as long as all the tabs for organizational structures fit on the screen.
The structures can be a deep trees with many branches, or they can be completely flat, with just a single level.
The structure may not even be a tree.
As long as it is an <em>acyclic directed graph</em> it will work just fine.
It can have multiple roots, it may have alternate paths, it can do all the crazy stuff.
Just avoid <em>cycles</em>.
Cycles break the maths which is the foundation of organizational structure indexing and evaluation.
Cycles won&#8217;t work, but pretty much all the other arrangements are perfectly fine.</p>
</div>
</div>
<div class="sect2">
<h3 id="_archetypes_2">Archetypes</h3>
<div class="paragraph">
<p>Org is such a flexible creature.
It can represent variety of concepts: divisions, sections, departments, teams, projects, companies, branches, schools, faculties, zones, locations - you name it.
However, it would be very easy to get lost if all these fine shades of orgs looked and behaved the same.
Fortunately, we already know what we can use to apply some character to individual subtypes of objects.
We are going to apply archetypes to orgs.</p>
</div>
<div class="paragraph">
<p>In theory, application of an archetype to org is easy.
First, we need a suitable archetype.</p>
</div>
<div class="listingblock">
<div class="title">archetype-project.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5c2c123e-86ff-11ef-9f50-ab1904c498f6</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Project<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;archetypePolicy&gt;</span>
        <span class="tag">&lt;display&gt;</span>
            <span class="tag">&lt;label&gt;</span>Project<span class="tag">&lt;/label&gt;</span>
            <span class="tag">&lt;pluralLabel&gt;</span>Projects<span class="tag">&lt;/pluralLabel&gt;</span>
            <span class="tag">&lt;icon&gt;</span>
                <span class="tag">&lt;cssClass&gt;</span>fa fa-chart-gantt<span class="tag">&lt;/cssClass&gt;</span>
                <span class="tag">&lt;color&gt;</span>#ffc107<span class="tag">&lt;/color&gt;</span>
            <span class="tag">&lt;/icon&gt;</span>
            <span class="tag">&lt;tooltip&gt;</span>Project<span class="tag">&lt;/tooltip&gt;</span>
        <span class="tag">&lt;/display&gt;</span>
    <span class="tag">&lt;/archetypePolicy&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;identifier&gt;</span>holderType<span class="tag">&lt;/identifier&gt;</span>
        <span class="tag">&lt;description&gt;</span>This archetype can be applied to orgs (OrgType).<span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;assignmentRelation&gt;</span>
            <span class="tag">&lt;holderType&gt;</span>OrgType<span class="tag">&lt;/holderType&gt;</span>
        <span class="tag">&lt;/assignmentRelation&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can apply the archetype to objects.</p>
</div>
<div class="listingblock">
<div class="title">org-tree-project.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9c1b8464-edfd-11ea-87b8-db467c5ae301</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>PBD2020<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;description&gt;</span>Make money fast.<span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Big Deal<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;identifier&gt;</span>BD2020<span class="tag">&lt;/identifier&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">832e37e4-edfd-11ea-9f8c-ef736d6646a2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5c2c123e-86ff-11ef-9f50-ab1904c498f6</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ArchetypeType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the archetype is applied, the projects have nice icon and custom color.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-10-project-list.png" alt="List of archetyped projects">
</div>
<div class="title">Figure 8. Archetyped projects</div>
</div>
<div class="paragraph">
<p>Archetypes are easy to apply.
However, it may not be entirely easy to choose <em>what</em> archetypes to apply to orgs.
For example, the traditional enterprise functional organizational structure has <em>divisions</em> at the top, <em>sections</em> at the bottom and <em>departments</em> in between.
It may be tempting to create three archetypes: <code>Division</code>, <code>Department</code> and <code>Section</code>.
However, this is usually not necessary.
Single <code>Organizational unit</code> archetype should be enough.
Having a single archetype for all kinds of functional organizational units is usually much simpler and more flexible.
Perhaps the only reason to go for <code>Division</code>, <code>Department</code> and <code>Section</code> would be a need to modify behavior and policies of individual types of organizational units - which is not very common.</p>
</div>
<div class="paragraph">
<p>While single <code>Organizational unit</code> archetype is usually the best option, it is a good idea to create a separate archetype for top-level org.
The top-level org usually represents an <em>organization</em>, such as company, university or agency.
While individual organizational units are usually similar to each other, the top-level organization is likely to be quite different.
Therefore, having a separate <code>Organization</code> archetype is a good idea.</p>
</div>
<div class="listingblock">
<div class="title">org-tree-project.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">886bfa6e-8702-11ef-9c40-6fce51f54b0d</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Organization<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;archetypePolicy&gt;</span>
        <span class="tag">&lt;display&gt;</span>
            <span class="tag">&lt;label&gt;</span>Organization<span class="tag">&lt;/label&gt;</span>
            <span class="tag">&lt;pluralLabel&gt;</span>Organizations<span class="tag">&lt;/pluralLabel&gt;</span>
            <span class="tag">&lt;icon&gt;</span>
                <span class="tag">&lt;cssClass&gt;</span>fa fa-building-flag<span class="tag">&lt;/cssClass&gt;</span>
                <span class="tag">&lt;color&gt;</span>#ffc107<span class="tag">&lt;/color&gt;</span>
            <span class="tag">&lt;/icon&gt;</span>
            <span class="tag">&lt;tooltip&gt;</span>Organization<span class="tag">&lt;/tooltip&gt;</span>
        <span class="tag">&lt;/display&gt;</span>
    <span class="tag">&lt;/archetypePolicy&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;identifier&gt;</span>holderType<span class="tag">&lt;/identifier&gt;</span>
        <span class="tag">&lt;assignmentRelation&gt;</span>
            <span class="tag">&lt;holderType&gt;</span>OrgType<span class="tag">&lt;/holderType&gt;</span>
        <span class="tag">&lt;/assignmentRelation&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, while organizations do not change often, when they change the change is usually quite substantial.
For example, companies are occasionally re-structured, re-branded or merged with other companies.
In such cases, separate top-level root object comes very handy.
E.g. in case of merger, it is quite easy to add another top-level <code>Organization</code> object for the other company, and then take your time to gradually move people and organizational units around.</p>
</div>
<div class="listingblock">
<div class="title">org-example-top.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">4d12c1ac-440c-11ea-80af-2b314d06ba95</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>F10000<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>ExAmPLE, Inc.<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">886bfa6e-8702-11ef-9c40-6fce51f54b0d</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ArchetypeType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Having a separate archetype for the top-level root orgs is generally a good idea due to the definition of <em>assignment relations</em>, as is explained below.
However, first we need to talk a bit about the <em>relation</em> itself.</p>
</div>
</div>
<div class="sect2">
<h3 id="_managers">Managers</h3>
<div class="paragraph">
<p>Placing people in organizational structures has a significant value on its own.
However, all the people usually do not have the same <em>relation</em> to the organizational unit.
Most people are ordinary <em>members</em> of organizational unit.
Then there are people that are somehow special: departmental managers, team leaders, project managers, supervisors and similar life forms.</p>
</div>
<div class="paragraph">
<p>How do we designate a manager of an organizational unit?
You probably guessed it already.
In a typical midPoint fashion, we are re-using <em>assignment</em>, of course.
There is just one small detail.
We are specifying <code>relation</code> in assignment target reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>aanderson<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="comment">&lt;!-- Direct Sales Department --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">832f409a-4726-11ea-b0be-8b8eab99c1ed</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This assignment makes Alice a <em>manager</em> of Sales and Marketing Division.
It is as simple as that.
All the power of assignment is at your disposal.
Therefore, it is easy to assign a manager for a temporary time period, suspend a manager and so on.</p>
</div>
<div class="paragraph">
<p>Manager <em>assignment</em> is created in the user interface in almost the same way as normal assignment is created.
The only difference is selection of <em>manager relation</em> at the bottom of the assignment target dialog:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-07-assign-org-manager.png" alt="Assign organizational unit manager">
</div>
<div class="title">Figure 9. Assign organizational unit manager</div>
</div>
<div class="paragraph">
<p>After the assignment is in place, midPoint knows that Alice is a manager of Sales and Marketing Division.
This is also displayed in the organizational tree:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-08-org-tree-manager.png" alt="Organizational unit with a manager">
</div>
<div class="title">Figure 10. Organizational unit with a manager</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
MidPoint assigns managers to organizational units.
That is the right way to do it.
However, we have often seen a different approach.
In these cases the manager is "assigned" to users.
I.e. each user has a reference to his or her manager.
This approach is wrong.
Organizational structures change.
People come and go.
Everything is changing all the time.
It is very easy to change one assignment in organizational structure in case that a manager is replaced.
However, it is extremely difficult to replace a manager in the direct user-manager data structure.
Maybe the former manager was managing several organizational units, and now we are replacing him with two managers.
Maybe there is a re-organization going on at the same time.
The result is going to be a mess.
Avoid the direct user-manager approach whenever possible.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can congratulate Alice on her new position in management.
However, she still has the same access rights as ordinary workers.
That is not right!
Managers wear suits and ties, which means that they need to have more privileges than mere mortals.
As managers usually control funding of software development, it is perfectly understandable that midPoint has a way to set up privileges that apply to managers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7a1feb50-471f-11ea-8aab-1b2627541f15</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>F11000<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Sales and Marketing Division<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;identifier&gt;</span>11000<span class="tag">&lt;/identifier&gt;</span>
    ...
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
            ... Privileges exclusive to managers are specified here ...
        <span class="tag">&lt;/construction&gt;</span>
        <span class="tag">&lt;orderConstraint&gt;</span>
            <span class="tag">&lt;order&gt;</span>1<span class="tag">&lt;/order&gt;</span>
            <span class="tag">&lt;relation&gt;</span>manager<span class="tag">&lt;/relation&gt;</span>
        <span class="tag">&lt;/orderConstraint&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This inducement grants special privileges to manager of the Sales and Marketing Division.
The <code>orderConstraint</code> makes sure that only the users that have <code>manager</code> relation to this organization unit get the privileges.</p>
</div>
<div class="paragraph">
<p>Wait a minute!
Clever reader does not like that.
This approach to manager privileges is not going to be very practical.
Managers usually do not have special privileges in each organizational unit.
In most organizations, managers have the same privileges regardless of the unit they manage.</p>
</div>
<div class="paragraph">
<p>One way to implement this approach is to create a <code>Manager</code> role, put the special privileges there, and assign the role to every manager of every organizational unit.
However, that creates redundancy.
We have to make sure this role is assigned whenever a person becomes manager, and that it is unassigned when the person is no longer manager.
This is the "standard" method used to manage privileges in other identity management platforms.
However, it is quite a fragile mechanism.
This is not a way how we do things in midPoint, we do not like fragile and tedious things here.</p>
</div>
<div class="paragraph">
<p>The <code>orderConstraint</code> data structure in our example looks suspiciously complex.
That impression is correct, as it indeed is quite a complex concept.
What we see here is the first glimpse at high-order "assignment algebra" that is a work-horse of complex midPoint deployments.
This mechanism is often employed when working with <em>meta-roles</em> and <em>archetypes</em>.
As organizational units are <em>abstract roles</em>, and organizational structures are just a trees formed by <em>assignments</em>, they technically form meta-role structures.</p>
</div>
<div class="paragraph">
<p>Therefore, the right way to set up manager privileges is to move privilege definition to a central place.
It may be top-level root org, or it may be an <code>Organizational unit</code> <em>archetype</em>.
In such case our <em>inducement</em> can apply to all the managers, regardless of organizational unit.
However, the exact configuration is a bit complex, and we still need to learn more about midPoint to be able to use it.
Therefore, we leave the details for later chapters.</p>
</div>
<div class="paragraph">
<p>Organizational structure may have almost any form.
A user can be a member of many organizational units.
Which also means that a user may <em>manage</em> many organizational units.
That also applies the other way around: an organizational unit may have many managers.
As member and manager assignments are independent, users may belong to a different organizational unit that they manage.
MidPoint can support all kind of bizarre organizational arrangements.
MidPoint was deliberately designed in this way, because reality has an annoying habit to bring surprises, especially when organizational structures are involved.
However, you may not like all this liberalism in organizational management.
<em>Ordnung muss sein!</em>
If you want to constraint organizational management to allow only a single manager for each organizational unit, you can do it.
However, you have to explicitly specify a policy by setting up <em>assignment relation</em>, <em>policy rules</em> and <em>archetypes</em>.
<em>Policy rules</em> provide a very generic and very powerful mechanism to constraint and control midPoint in many ways, and <em>archetypes</em> provide flexible typing mechanism.</p>
</div>
</div>
<div class="sect2">
<h3 id="_relation">Relation</h3>
<div class="paragraph">
<p>In midPoint, we like to design generic re-usable mechanisms.
You did not think that we made the concept of <em>manager</em> in a way that would be hardcoded to organizational structure, did you?
As you have got so far through this book, you would probably suspect there is more to this <em>relation</em> thing that we have seen so far.</p>
</div>
<div class="paragraph">
<p>The <em>relation</em> parameter specifies the nature of a relation between two objects.
For example a user may be a member of an organizational unit, manager of a project, owner of a role or approver of role assignment requests.
In such cases, <em>member</em>, <em>manager</em>, <em>owner</em> and <em>approver</em> are relations that a user can have to an object.</p>
</div>
<div class="paragraph">
<p>The most common way to use relation is to specify it in <code>targetRef</code> in an assignment.
The following example illustrates the usual way to assign an <em>owner</em> for a role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user&gt;</span>
    <span class="tag">&lt;name&gt;</span>aanderson<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="comment">&lt;!-- Business Analyst role --&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aaa6cde4-0471-11e9-9b50-c743da469067</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RoleType</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">relation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">owner</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
    ...
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several built-in relations in midPoint:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Relation</th>
<th class="tableblock halign-left valign-top">Usually used for</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Everything</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the most ordinary, most common, non-specific relation to an object.
When used with a role, it simply means that the user <em>has</em> the role.
Usually interpreted as <em>member</em> when used with organizational units.
It is the usual, normal relation.</p>
<p class="tableblock">As the name suggests, this is the default relation.
If no other relation is specified, this relation is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>manager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Orgs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager of an organizational unit, project manager, teamleader, etc.
Usually entitles a person (or a group) that have leading position in an org.
This usually specifies executive or operational privileges (cf. <code>owner</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>owner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Roles, Orgs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Person responsible for <em>governance</em> of the object.
Often used to nominate role owners that are responsible for role definition and maintenance.
May be used with organizational units to specify project sponsor or business owner.
Specifies a person responsible for governance and high-level policy decisions rather than day-to-day management (cf. <code>manager</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>approver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Roles, Orgs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Person responsible for deciding <em>membership</em> in roles and orgs, a gatekeeper or moderator.
Approvers usually decide whether someone can have a role, or may be a member of organizational unit.
Unlike owners, approvers do not create or modify role definition.
They cannot change the role.
They can only decide who can have that role and who cannot.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>meta</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Meta-roles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Special-purpose relation that is sometimes used with meta-roles.
Meta-role structures can be complex and confusing.
However, such structures and especially policies that govern them may sometimes be simplified, if role-metarole relations are marked in a special way.
This relation is designed specifically for that purpose.</p>
<p class="tableblock">The <code>meta</code> relation is not mandatory.
Meta-role functionality will work just fine without it.
In fact, almost all the meta-role configuration are not using this relation.
Yet, it may come handy if the situation becomes too complicated.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Those are built-in relations.
There are some pre-configured policies that work with them.
However, you are free to specify and use your own relations.
However, that is quite an advanced topic, and the majority of deployments are perfectly fine using just the built-in relations.</p>
</div>
<div class="paragraph">
<p>As you can see, the built-in relations do not have overly strict specifications.
There is a lot of <em>usually</em>, <em>often</em> and <em>almost</em> in the description of relations.
The reason is that the relations do not do anything just by themselves.
They just specify how one object relates to another object.
There are no strict <em>policies</em> or <em>behavior</em> associated with them.</p>
</div>
<div class="paragraph">
<p>The policies are specified elsewhere.
Assignments and inducements may behave differently for different relations, as we have seen in previous section.
Similarly, <em>policy rules</em> are often sensitive to relations.
For example, the policy that assignment of some roles has to be approved is implemented by a policy rule that is aware of <code>approver</code> relation.
Authorizations are often sensitive to relations.
Archetypes influence how the system behaves based on relations.
User interface may behave differently for some relations.
And so on.
Relations do nothing just by themselves.
However, good part of the system is usually configured to recognize relations and behave accordingly.
It is a matter of that <em>configuration</em> that determines how exactly will the system behave.
This is also the reason for such vague definition of relations, even those built-in relations.
They will do what you make them do.</p>
</div>
</div>
<div class="sect2">
<h3 id="_assignment_relation_limitations">Assignment Relation Limitations</h3>
<div class="paragraph">
<p>MidPoint is very flexible platform - which is usually a huge advantage.
However, there are downsides to flexibility.
It may be difficult to choose correct option from large number of possibilities.
This is especially true when it comes to assignments and relations.
By default, midPoint does not constrain the assignments, which means any object can be assigned to any other object using any <em>relation</em>.
However, this makes it difficult to create a reasonable user interface, as there are just too many options to choose from.
Users can be confused what relation to choose, which relations make sense.
Even worse, users may to choose to do the same thing in two different ways.
As midPoint deployment matures, it is more than desired to constraint the use of assignments and relations only to those combinations that make sense.</p>
</div>
<div class="paragraph">
<p><em>Assignment relation</em> mechanism is used for that purpose.
We have already seen basic usage of assignment relation in archetypes.
The assignment relation was used to constraint object type that an archetype can be assigned to.
Following example of <code>Project</code> archetype is using <code>holderType</code> clause of the <code>assignmentRelation</code> to limit application of archetype to orgs.</p>
</div>
<div class="listingblock">
<div class="title">archetype-project.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5c2c123e-86ff-11ef-9f50-ab1904c498f6</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Project<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;identifier&gt;</span>holderType<span class="tag">&lt;/identifier&gt;</span>
        <span class="tag">&lt;description&gt;</span>This archetype can be applied to orgs (OrgType).<span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;assignmentRelation&gt;</span>
            <span class="tag">&lt;holderType&gt;</span>OrgType<span class="tag">&lt;/holderType&gt;</span>
        <span class="tag">&lt;/assignmentRelation&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>assignmentRelation</code> constraints ability to create assignment to the <code>Project</code> archetype, in this case the <em>holder</em> of the assignment must be of <code>OrgType</code> type.
However, <em>assignment relation</em> can be used to further constraint use of assignments.
We probably want to constraint the <em>relations</em> that can be applied to a project.
It is quite resonable to constraint the relations to members, managers and owners of projects.
This can simplify things, as we probably do to want approvers and "meta" as a relations to projects.
Also, we want to put only <em>users</em> in the project.
In theory, midPoint organizational structure can hold almost any type of object.
However, it does not make much sense for a project to contain roles or services.
We can constrain both relations and object types using <code>assignmentRelation</code> in the <code>Project</code> archetype.</p>
</div>
<div class="listingblock">
<div class="title">archetype-project.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5c2c123e-86ff-11ef-9f50-ab1904c498f6</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Project<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;identifier&gt;</span>membership<span class="tag">&lt;/identifier&gt;</span>
        <span class="tag">&lt;description&gt;</span>Projects are flat (no sub-teams), have members and manager. May have owner (sponsor).<span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;assignmentRelation&gt;</span>
            <span class="tag">&lt;description&gt;</span>User can be direct member of project, as well as manager and owner.<span class="tag">&lt;/description&gt;</span>
            <span class="tag">&lt;holderType&gt;</span>UserType<span class="tag">&lt;/holderType&gt;</span>
            <span class="tag">&lt;relation&gt;</span>org:default<span class="tag">&lt;/relation&gt;</span>
            <span class="tag">&lt;relation&gt;</span>org:manager<span class="tag">&lt;/relation&gt;</span>
            <span class="tag">&lt;relation&gt;</span>org:owner<span class="tag">&lt;/relation&gt;</span>
        <span class="tag">&lt;/assignmentRelation&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike the <code>holderType</code> case above, in this case the <code>assignmentRelation</code> is placed in <em>inducement</em> instead of <em>assignment</em>.
In the previous case, we were constraining assignment of <em>projects</em> to <em>archetypes</em>.
Whereas in this case we are trying to constraint assignments of <em>users</em> to the <em>projects</em>.
This is one degree of indirection farther, therefore <em>inducement</em> is used instead of <em>assignment</em>.
The arechetype acts as a meta-role, the content of the inducement is applied to the <em>projects</em> (archetyped objects), not to the archetype itself.</p>
</div>
<div class="paragraph">
<p>The <em>assignment relation</em> specification is used by the user interface.
User interface is going to present only those object types and relation that make sense for the operation that user has initiated.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-11-assignment-relation.png" alt="Selection of assignment relations">
</div>
<div class="title">Figure 11. Assignment relations</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Support for <em>assignment relation</em> in midPoint 4.8 user interface is not yet completed.
Some parts of user interface use <em>assignment relation</em>, while others are not using it yet.
However, it is a good practice to specify <em>assignment relation</em> in archetypes quite early in midPoint deployment.
The specification is going to be very useful after upgrade to a newer midPoint version.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_beyond_users">Beyond Users</h3>
<div class="paragraph">
<p>MidPoint organizational structure can do a lot of crazy stuff.
Organizational structures are usually build to contain <em>people</em>.
However, midPoint is quite different.
MidPoint organizational structure can contain a broad range of object types.
Users, roles and services are the most common object types, but almost any other midPoint object can be placed in organizational structure.</p>
</div>
<div class="paragraph">
<p><em>Role catalog</em> is a common use of organizational structure that does not (directly) involve people.
Role catalog is used to sort the roles into categories, much like a catalog in electronic shop is used to sort the products.
The catalog is used to present roles to users in organized form, so users may easily find the roles when request them in self-service interface.</p>
</div>
<div class="paragraph">
<p>MidPoint role catalog is simply an organizational structure.
It does not have divisions, sections or projects, but it has <em>categories</em>.
Categories are (almost) ordinary orgs that form the hierarchy.</p>
</div>
<div class="listingblock">
<div class="title">org-role-catalog.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">945315a6-fc23-11ea-832e-1f9945adb481</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Role catalog<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;displayOrder&gt;</span>500<span class="tag">&lt;/displayOrder&gt;</span>
<span class="tag">&lt;/org&gt;</span>

<span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">b7e4cd0c-fc23-11ea-a79a-079cad42b39b</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>RC001<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Client acquisition<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">945315a6-fc23-11ea-832e-1f9945adb481</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span>

<span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">259625ee-fc24-11ea-8bae-1bfdce011faf</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>RC002<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Customer support<span class="tag">&lt;/displayName&gt;</span>
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;targetRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">945315a6-fc23-11ea-832e-1f9945adb481</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Role catalog configuration with several roles can be found in <code>org-role-catalog.xml</code> file in the samples.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Role catalog is displayed in used interface as a new organizational structure.
However, as most organizational structures are built for people, midPoint user interface displays only users as members of organizational units by default.
You have to explicitly change the type to <em>role</em> to see content of the catalog.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-12-role-catalog.png" alt="Role catalog">
</div>
<div class="title">Figure 12. Role catalog</div>
</div>
<div class="paragraph">
<p>Primary use of the catalog is related to <em>access request process</em>.
The catalog makes it easier for a user to find appropriate role when requesting its assignment in self-service part of midPoint user interface.
Root org of the role catalog has to be configured in <code>adminGuiConfig</code> section of system configuration object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> <span class="tag">&lt;systemConfiguration&gt;</span>
    ...
    <span class="tag">&lt;adminGuiConfiguration&gt;</span>
        ...
        <span class="tag">&lt;accessRequest&gt;</span>
            <span class="tag">&lt;roleCatalog&gt;</span>
                <span class="tag">&lt;roleCatalogRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">945315a6-fc23-11ea-832e-1f9945adb481</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OrgType</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                ...
            <span class="tag">&lt;/roleCatalog&gt;</span>
        <span class="tag">&lt;/accessRequest&gt;</span>
    <span class="tag">&lt;/adminGuiConfiguration&gt;</span>
<span class="tag">&lt;/systemConfiguration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While the primary use of role catalog is the <em>access request process</em>, the catalog can also be used to apply policies to a whole group of roles.
Owner of the category may be considered to be a default approver for all the roles in the category.
Category owner may be authorized to modify roles in the category.
And so on.</p>
</div>
<div class="paragraph">
<p>Similar approach can be applied to most objects in midPoint.
Organizational structure can be used to organize roles, services, resources, function libraries and other objects.
Orgs are also crucial mechanism in supporting midPoint multi-tenancy.
Not everything is perfectly supported in user interface yet.
Nevertheless, the organizational structure is a powerful mechanism to systematically and consistently apply policies and organize the system.</p>
</div>
</div>
<div class="sect2">
<h3 id="_organizational_structure_synchronization">Organizational Structure Synchronization</h3>
<div class="paragraph">
<p>MidPoint can manage organizational structure, but where that structure comes from?
Back in 20<sup>th</sup> century there were entire teams dedicated to drawing organizational charts on paper.
However, it is 21<sup>st</sup> century already.
We do not use paper anymore.
We are using computers to manage organizational charts now.
Which means that dedicated teams are drawing organizational charts in Excel and distributing them by e-mail.</p>
</div>
<div class="paragraph">
<p>Fortunately, there are some organizations that have truly progressed into 21<sup>st</sup> century.
Such organizations store their organizational structures in a machine-processable form, usually in database tables.
When exported to a CSV file, the structure may look like this:</p>
</div>
<div class="listingblock">
<div class="title">org.csv</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">&quot;orgnum&quot;,&quot;name&quot;,&quot;description&quot;,&quot;parentOrgNum&quot;
&quot;11000&quot;,&quot;Sales and Marketing Division&quot;,&quot;Expensive people that make money.&quot;,&quot;10000&quot;
&quot;11100&quot;,&quot;Direct Sales Department&quot;,&quot;Suits that talk to customers directly.&quot;,&quot;11000&quot;
&quot;11200&quot;,&quot;Indirect Sales Department&quot;,&quot;Suits that talk to other suits that talk to customers.&quot;,&quot;11000&quot;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, each organizational unit has a unique identifier, such as <code>11000</code>.
Each organizational unit has a reference to parent organizational unit.
When all the lines are processed, they form a complete organizational tree.</p>
</div>
<div class="paragraph">
<p>This is quite a good information source.
Of course, we would like to automatically pull the data from this source instead of managing organization tree manually.
How could we do it?
Clever reader is smiling, remembering that we like to create generic re-usable mechanisms in midPoint.
We already know how to synchronize <em>user</em> records from the HR system.
As we are using midPoint, it is perhaps no big surprise that the same mechanisms can be easily reused to synchronize <em>organizational unit</em> records as well.</p>
</div>
<div class="paragraph">
<p>MidPoint synchronization mechanism can work with almost any type of object.
It can synchronize HR records to <em>users</em>, organizational unit records to <em>orgs</em>, application inventory database to <em>services</em>, Active directory groups to <em>roles</em> or pretty much anything to anything.
This is what we call <em>generic synchronization</em>.</p>
</div>
<div class="paragraph">
<p>Similarly to ordinary synchronization, we need to start with a <em>resource</em>.
However, this resource does not contain accounts, it contains organizational units.</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-org.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">81ec779e-13b2-11eb-8e47-dfbfd542db3e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;name&gt;</span>Organizational Chart<span class="tag">&lt;/name&gt;</span>

    <span class="tag">&lt;connectorRef</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectorType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;filter&gt;</span>
            <span class="tag">&lt;q:text&gt;</span>connectorType = &quot;com.evolveum.polygon.connector.csv.CsvConnector&quot;<span class="tag">&lt;/q:text&gt;</span>
        <span class="tag">&lt;/filter&gt;</span>
    <span class="tag">&lt;/connectorRef&gt;</span>

    <span class="tag">&lt;connectorConfiguration&gt;</span>
        <span class="tag">&lt;icfc:configurationProperties&gt;</span>
            <span class="tag">&lt;icfccsvfile:filePath&gt;</span>/opt/midpoint/var/resources/org.csv<span class="tag">&lt;/icfccsvfile:filePath&gt;</span>
            <span class="tag">&lt;icfccsvfile:encoding&gt;</span>utf-8<span class="tag">&lt;/icfccsvfile:encoding&gt;</span>
            <span class="tag">&lt;icfccsvfile:fieldDelimiter&gt;</span>,<span class="tag">&lt;/icfccsvfile:fieldDelimiter&gt;</span>
            <span class="tag">&lt;icfccsvfile:multivalueDelimiter&gt;</span>;<span class="tag">&lt;/icfccsvfile:multivalueDelimiter&gt;</span>
            <span class="tag">&lt;icfccsvfile:uniqueAttribute&gt;</span>orgnum<span class="tag">&lt;/icfccsvfile:uniqueAttribute&gt;</span>
        <span class="tag">&lt;/icfc:configurationProperties&gt;</span>
    <span class="tag">&lt;/connectorConfiguration&gt;</span>

    <span class="tag">&lt;schemaHandling&gt;</span>

        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>Organizational unit<span class="tag">&lt;/displayName&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>AccountObjectClass<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
            <span class="tag">&lt;kind&gt;</span>generic<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;intent&gt;</span>orgunit<span class="tag">&lt;/intent&gt;</span>
            <span class="tag">&lt;focus&gt;</span>
                <span class="tag">&lt;type&gt;</span>OrgType<span class="tag">&lt;/type&gt;</span>
                <span class="tag">&lt;archetypeRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">99fa4b3c-8702-11ef-896e-0b7221540b8b</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/focus&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>orgnum<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/identifier<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;script&gt;</span>
<span class="inline">                            <span class="tag">&lt;code&gt;</span>'F' + input<span class="tag">&lt;/code&gt;</span></span>
                        <span class="tag">&lt;/script&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/name<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>name<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/displayName<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>description<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/description<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>parentOrgNum<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;assignmentTargetSearch&gt;</span>
                            <span class="tag">&lt;targetType&gt;</span>OrgType<span class="tag">&lt;/targetType&gt;</span>
                            <span class="tag">&lt;filter&gt;</span>
                                <span class="tag">&lt;q:text&gt;</span>identifier = $input<span class="tag">&lt;/q:text&gt;</span>
                            <span class="tag">&lt;/filter&gt;</span>
                        <span class="tag">&lt;/assignmentTargetSearch&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/assignment<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            <span class="tag">&lt;correlation&gt;</span>
                <span class="tag">&lt;correlators&gt;</span>
                    <span class="tag">&lt;items&gt;</span>
                        <span class="tag">&lt;item&gt;</span>
                            <span class="tag">&lt;ref&gt;</span>identifier<span class="tag">&lt;/ref&gt;</span>
                        <span class="tag">&lt;/item&gt;</span>
                    <span class="tag">&lt;/items&gt;</span>
                <span class="tag">&lt;/correlators&gt;</span>
            <span class="tag">&lt;/correlation&gt;</span>
            <span class="tag">&lt;synchronization&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>linked<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;synchronize</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>deleted<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;deleteFocus</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>unlinked<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;link</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
                <span class="tag">&lt;reaction&gt;</span>
                    <span class="tag">&lt;situation&gt;</span>unmatched<span class="tag">&lt;/situation&gt;</span>
                    <span class="tag">&lt;actions&gt;</span>
                        <span class="tag">&lt;addFocus</span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/actions&gt;</span>
                <span class="tag">&lt;/reaction&gt;</span>
            <span class="tag">&lt;/synchronization&gt;</span>
        <span class="tag">&lt;/objectType&gt;</span>

    <span class="tag">&lt;/schemaHandling&gt;</span>

    <span class="tag">&lt;projection&gt;</span>
        <span class="tag">&lt;assignmentPolicyEnforcement&gt;</span>none<span class="tag">&lt;/assignmentPolicyEnforcement&gt;</span>
    <span class="tag">&lt;/projection&gt;</span>

<span class="tag">&lt;/resource&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This should all look very familiar by now.
It is almost the same resource as we have seen in the synchronization chapter.
However, there are few differences, which are described in the following sections.</p>
</div>
<div class="sect3">
<h4 id="_kind_and_intent">Kind and Intent</h4>
<div class="paragraph">
<p>The definition of <code>Organizational unit</code> resource object contains specification of <em>kind</em> and <em>intent</em>:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-org.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        ...
        <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>Organizational unit<span class="tag">&lt;/displayName&gt;</span>
            <span class="tag">&lt;default&gt;</span>true<span class="tag">&lt;/default&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>AccountObjectClass<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
            <span class="tag">&lt;kind&gt;</span>generic<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;intent&gt;</span>orgunit<span class="tag">&lt;/intent&gt;</span>
            ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kind and intent identify the type of resource object for use by midPoint.
There are three possible values for <em>kind</em>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Kind</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource object that represents identity of a person, either physical such as computer user or virtual such as <code>administrator</code>, <code>root</code>, <code>daemon</code> or similar special-purpose identities.
<em>Accounts</em> are usually linked to the <em>user</em> objects.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entitlement</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource object that represents groupings or privileges of an account.
Entitlement resource objects represent groups, resource-specific roles, permissions or privileges.
Entitlements are meant to be <em>associated</em> to an account.
For example a <code>group</code> entitlement may have accounts as its members.
<em>Entitlements</em> are usually linked to <em>role</em> objects, creating <em>application roles</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any other type of resource object.
This is used for resource objects that cannot be classified as <em>account</em> or <em>entitlement</em>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can choose any of these <em>kinds</em> for your resource objects.
Values of <em>kind</em> are pre-defined in midPoint, as midPoint makes some assumptions about them.
For example, midPoint expects that <em>accounts</em> can be associated with <em>entitlements</em>, for example accounts may be members of groups.
Therefore, it is recommended to properly categorize your resource objects to kinds.
This also helps to make the configuration understandable for mere mortals.</p>
</div>
<div class="paragraph">
<p>Then there is <em>intent</em>.
There are no pre-defined values for <em>intent</em> in midPoint, perhaps except for value <code>default</code> which is used in case there is no explicit definition of <em>intent</em>.
You can choose any <em>intent</em> value that you like.
However, it is recommended to choose a value that describes the intended use of the resource object.
For example:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Kind</th>
<th class="tableblock halign-left valign-top">Example intent</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default account.
This usually means the usual, very ordinary user account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration account.
Used in situations where administrators get dedicated accounts with administrator privileges.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testing account.
Used when testers are given special-purpose accounts to use for testing, to avoid interference with their usual accounts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entitlement</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The usual, most ordinary, boring group of users.
It can have accounts or other groups as its members.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entitlement</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>posixGroup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP <code>posixGroup</code>, used to assign UNIX group membership in LDAP.
It has a different structure than ordinary group, hence we would like to use a different <em>kind</em> for it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entitlement</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>privilege</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource object that represents system privilege.
Can be "given" to an account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>locality</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource object that represents physical location in our organization.
Such as branch office, campus building or meeting room.
It has no formal association to the account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>orgunit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource object that represents organizational unit.
In our case, it represents one record in the organizational chart database.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These are just examples.
You can choose any kind/intent combination that makes sense for your deployment.
For example, you may choose to use <code>entitlement</code> kind for organizational units instead of <code>generic</code>.
MidPoint would work fine even in that case.
However, our <code>Organizational Chart</code> resource does not have any accounts, therefore the organizational units cannot be associated to anything in this resource.
Also, membership in an organizational unit does not really look like an entitlement.
Therefore, we have chosen to use <code>generic</code> kind here.
You are free to make your own choices.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Why <code>AccountObjectClass</code>?</div>
Why is there <code>AccountObjectClass</code> in the configuration?
We are not working with accounts here, we work with organizational units.
So, why <code>AccountObjectClass</code>?
The reason is the CSV connector that we are using.
The CSV connector is quite simplistic, it considers everything to be an account.
Object classes are determined by the connector, hence we need to use <code>AccountObjectClass</code> as the connector specified this object class.
However, the <em>kind</em> and <em>intent</em> definition is "overriding" the notion that this is an account, making it more understandable for midPoint users.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Kind</em> and <em>intent</em> behave like coordinates when midPoint has to identify resource object that is assigned to a user.
Given normal circumstances, a user may have at most one <em>default account</em> on a resource (which means kind=<code>account</code>, intent=<code>default</code>).
That same user may also have <em>admin account</em> on the same resource (kind=<code>account</code>, intent=<code>admin</code>).
A role may be represented by at most one <em>LDAP group</em> on a resource (kind=<code>entitlement</code>, intent=<code>ldapGroup</code>).
MidPoint logic is heavily based on such assumptions.
Whenever there are two <em>constructions</em> that have the same combination of <em>kind</em> and <em>intent</em>, midPoint assumes that they are describing the same resource object.
MidPoint automatically merges the constructions.
If the constructions have different combination of <em>kind</em> and <em>intent</em>, midPoint assumes that they are describing different resource objects, therefore the constructions are processed separately.
Correct configuration of <em>kind</em> and <em>intent</em> is crucial for midPoint to work correctly.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Tag (a.k.a. "multiaccounts")</div>
The requirement that there may be at most one resource object for each <em>kind</em>+<em>intent</em> combination works very well in most cases.
However, there are also cases when more than one resource object is needed.
<em>Kind</em> and <em>intent</em> has to be specified in the configuration, therefore this mechanism will not work for resource objects that appear and disappear dynamically.
Therefore, new concept of <em>tag</em> was introduced in midPoint 4.0.
The <em>tag</em> can supplement the <em>kind</em>+<em>intent</em> combination with a dynamic value, thus allowing multiple resource objects to exist for any particular <em>kind</em>+<em>intent</em> combination.
This feature is colloquially known as "multiaccounts".
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_archetype">Archetype</h4>
<div class="paragraph">
<p>It would be acceptable to create our <em>org</em> just as plain <em>org</em>.
Most things would work quite right.
However, it is a very good practice to apply archetype to objects, especially those objects that are created automatically.
Automation can create many objects very quickly.
It may be tedious to modify all these objects when you figure out that you need to do something about them differently.
Re-import of the objects do not always work, as not all the mappings may be <em>strong</em>.
Of course, you can delete all the objects and re-import.
However, that is going to change the OIDs, and manually created assignments are going to break - not to mention losing all manual changes to descriptions and documentation that you might have done.
This is all too much inconvenience and manual work.
We are using midPoint, we can do better.</p>
</div>
<div class="paragraph">
<p>When archetype is applied to the objects, common parts of object configuration and behavior can be specified in the archetype.
Therefore update and maintenance of the objects is much easier.
Really, there is no excuse for not applying the archetype, as it is very easy to do.
All we need is to mention the archetype in the specification of <em>object type</em> in the <em>schema handling</em>.</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-org.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;resource&gt;</span>
    ...
    <span class="tag">&lt;schemaHandling&gt;</span>
        ...
        <span class="tag">&lt;objectType&gt;</span>
            ...
            <span class="tag">&lt;focus&gt;</span>
                <span class="tag">&lt;type&gt;</span>OrgType<span class="tag">&lt;/type&gt;</span>
                <span class="tag">&lt;archetypeRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">99fa4b3c-8702-11ef-896e-0b7221540b8b</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/focus&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case we are using <code>Organizational unit</code> archetype.
For now, the archetype is almost empty, it just specifies some cosmetics for nicer look and feel of organizational units.</p>
</div>
<div class="listingblock">
<div class="title">archetype-organizational-unit.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">99fa4b3c-8702-11ef-896e-0b7221540b8b</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Organizational unit<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;archetypePolicy&gt;</span>
        <span class="tag">&lt;display&gt;</span>
            <span class="tag">&lt;label&gt;</span>Organizational unit<span class="tag">&lt;/label&gt;</span>
            <span class="tag">&lt;pluralLabel&gt;</span>Organizational units<span class="tag">&lt;/pluralLabel&gt;</span>
            <span class="tag">&lt;icon&gt;</span>
                <span class="tag">&lt;cssClass&gt;</span>fa fa-sitemap<span class="tag">&lt;/cssClass&gt;</span>
                <span class="tag">&lt;color&gt;</span>#ffc107<span class="tag">&lt;/color&gt;</span>
            <span class="tag">&lt;/icon&gt;</span>
            <span class="tag">&lt;tooltip&gt;</span>Organizational unit<span class="tag">&lt;/tooltip&gt;</span>
        <span class="tag">&lt;/display&gt;</span>
    <span class="tag">&lt;/archetypePolicy&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_names_and_identifiers">Names and Identifiers</h4>
<div class="paragraph">
<p>Synchronization of <em>organizational structure</em> is the same as synchronization of <em>users</em>.
Theoretically.
However, there are some subtle differences in practice, mostly caused by the differences of <code>User</code> and <code>Org</code> schemas.</p>
</div>
<div class="paragraph">
<p>The first difference originates from the fact, that <code>name</code> of the org has to be unique.
This uniqueness is usually not a problem for users, as username is naturally unique among the entire user base.
However, this is slightly different for orgs, as there may be several parallel organizational structures.
There may be <code>Security</code> department, <code>Security</code> project and <code>Security</code> workgroup at the same time.
This may be partially solved by using identifiers instead of names.
However, this still does not solve the problem of department <code>123</code> and project <code>123</code>.
The simple solution is to prefix the identifier with a code of the organizational tree that it belongs to, thus creating department <code>F123</code> and project <code>P123</code>.
However, users looking for project <code>123</code> may have difficulty finding it, as the <code>P</code> prefix in <code>P123</code> name is usually just a deliberate decision of midPoint administrator.
Therefore, we still want to store the original identifier value (<code>123</code>) into the <code>identifier</code> property of the org object.
There is no uniqueness constrain on the <code>identifier</code> property, therefore both department <code>123</code> and project <code>123</code> can co-exist and both can be easily discovered by searching the identifier.
The result is that we need two inbound mappings for the <code>orgnum</code> attribute:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-org.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>orgnum<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/identifier<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;script&gt;</span>
<span class="inline">                            <span class="tag">&lt;code&gt;</span>'F'+input<span class="tag">&lt;/code&gt;</span></span>
                        <span class="tag">&lt;/script&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/name<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Storing original organizational unit identifier in the <code>identifier</code> property makes it easier to correlate organizational units.
The <code>idenfier</code> property can be used by the correlators.
If the identifier is reasonably persistent, this is a huge benefit.</p>
</div>
<div class="paragraph">
<p>Changes in organizational structure can be quite nasty.
Organizational units are often renamed or moved in organizational trees.
Simplistic synchronization configuration may not be able to interpret such events correctly.
Rename of an organizational unit may look like new organizational unit was created, and the old unit was deleted.
This is likely to wreak havoc to organizational unit assignments, especially if there were special privileges configured for renamed organizational unit.
Even worse, organizational tree data are sometimes acquired from a different source than the user data, which is causing timing problems.
If organizational tree is updated first, there will be new empty organizational unit, old unit will be deleted, and user assignments will become invalid.
If user data are updated first, the synchronization routines may not be able to update the assignments as the new organizational unit does not exist yet.
This is going to cause a whole lot of problems, most of them requiring manual intervention of midPoint administrator.
Additionally, reorganizations usually happen in cycles, each cycle changing a number of units at the same time.
Which means that every few months the organizational structure is going to break down, everybody is going to complain, and it is likely to take several days to fix all the problems manually.</p>
</div>
<div class="paragraph">
<p>All of that can be avoided if there are reasonably persistent organizational unit identifiers.
Which means that every organizational unit has an identifier that does not change when the unit is renamed or moved.
In that case midPoint can reliably detect the rename, change organizational unit name and keep the assignments intact.
MidPoint can also detect that the unit was moved, change the parent unit and still keep all the assignments.
Organizational unit identifiers make everything so much easier.
Therefore, try really hard to use the identifier when setting up synchronization of organizational structure.
If there is no such identifier, talk to the business people to add it.
This is usually not an easy discussion, as the solution often involves changes in business processes.
However, it is absolutely essential to get it right.
All the effort will be repaid many times over during the course of identity program.</p>
</div>
</div>
<div class="sect3">
<h4 id="_nesting_organizational_units">Nesting Organizational Units</h4>
<div class="paragraph">
<p>We can synchronize the organizational units into midPoint.
We can use mappings to set up the properties of organizational units, such as names and identifiers.
However, that is still not enough, as organizational structures are usually hierarchical.
How to do we nest organizational units to create organizational tree?</p>
</div>
<div class="paragraph">
<p>In midPoint, organizational tree is formed by <em>assignments</em>.
Therefore, the answer is quite simple: create the right assignments.
Clever reader is not paying attention anymore, being busy re-reading the sections on automatic role assignments.
Clever reader is quite right, the same techniques that are used for automatic assignments of roles can be used to form organizational assignments.
Perhaps the best way to set the assignments for organizational hierarchies is to use inbound mappings:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-org.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>parentOrgNum<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;assignmentTargetSearch&gt;</span>
                            <span class="tag">&lt;targetType&gt;</span>OrgType<span class="tag">&lt;/targetType&gt;</span>
                            <span class="tag">&lt;filter&gt;</span>
                                <span class="tag">&lt;q:text&gt;</span>identifier = $input<span class="tag">&lt;/q:text&gt;</span>
                            <span class="tag">&lt;/filter&gt;</span>
                        <span class="tag">&lt;/assignmentTargetSearch&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/assignment<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This mapping automatically sets up an assignment to parent organizational unit.
We are lucky as we have almost ideal source of organizational data.
Our CSV file contains an identifier of a parent organizational unit in the <code>parentOrgNum</code> column.
All we need to do is to look for midPoint <em>org</em> that has that particular value in its <code>identifier</code> property.
This is done by the <code>assignmentTargetSearch</code> that we have already used for automatic assignment of roles.
The same mechanism is reused here.</p>
</div>
<div class="paragraph">
<p>All that remains is to set up a synchronization task.
Make sure that you specify <em>kind</em> and <em>intent</em> in the synchronization task.
This is important, otherwise the tasks are not going work.
Setting the right <em>kind</em> and <em>intent</em> was not emphasized before when we were synchronizing accounts.
The <code>account</code> <em>kind</em> is the default, and midPoint is usually smart enough to use default <em>intent</em>.
However, the defaults do not work any longer when we go beyond the accounts.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Troubleshooting</div>
Generic synchronization can be confusing as there may be non-obvious configuration complexities.
When mis-configured, the synchronization mechanism often does nothing.
There is no error or any other obvious indication as to what exactly went wrong.
<em>Logging</em> is your best friend in that case.
Try to enable logging of <em>synchronization service</em> (<code>com.evolveum.midpoint.model.impl.sync</code>) at <code>debug</code> level.
MidPoint will log a reasonable amount of information about the synchronization process.
That information is very likely to lead you to the solution.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration above works for simple cases, yet there is still a room for improvement.
The search filter in <code>assignmentTargetSearch</code> expression is quite simplistic.
It matches <em>orgs</em> from several trees if they have the same identifier.
Similar problem is in the correlation settings.
However, clever reader would surely find a way how to improve it.</p>
</div>
<div class="paragraph">
<p>Also, this method works only if the data feed is correctly ordered.
Everything works as long as parent organizational units are synchronized before child organizational units.
However, that is not always the case.
If ordering is wrong, child organizational units will not be able to find parent units, and the tree disintegrates.
As we are living in a networked concurrent world, data ordering is usually difficult to guarantee.</p>
</div>
<div class="paragraph">
<p>MidPoint has a mechanism to handle unordered data sources.
There is a way to create parent organizational units <em>on demand</em>.
When a child organizational unit looks for a parent that is not there yet, the parent object can be created at that moment.
Of course, this can only create <em>stub</em> parent, a very minimal object that has only the essential data.
Yet, even such a <em>stub</em> object is sufficient to create an organizational hierarchy.
The <em>stub</em> can be updated later, when the details about parent organizational unit are retrieved from the data feed.
The details of the <em>create on demand</em> mechanism is beyond the scope of this chapter.
We will get back to it later.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_users_to_organizational_units">Adding Users To Organizational Units</h4>
<div class="paragraph">
<p>We have a nice hierarchical organizational structure now.
Yet, something is still missing.
The organizational structure is all about the people, but there are no people in our organizational tree.
Let&#8217;s fix this.</p>
</div>
<div class="paragraph">
<p>In our ExAmPLE case, people data are coming from HR resource.
So far we do not have any data in this data source to automatically assign people to the organizational tree.
We need to modify the HR resource to add information about organizational units into our HR feed.
It went quite well.
After several phone calls, tens of e-mails and a quick 3-hour meeting, the HR department agreed to add a new <code>orgnum</code> column to the CSV file:</p>
</div>
<div class="listingblock">
<div class="title">hr.csv</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">&quot;empno&quot;,&quot;firstname&quot;,&quot;lastname&quot;,&quot;jobcode&quot;,&quot;orgnum&quot;
&quot;001&quot;,&quot;Alice&quot;,&quot;Anderson&quot;,&quot;B002&quot;,&quot;11000&quot;
&quot;002&quot;,&quot;Bob&quot;,&quot;Brown&quot;,&quot;O302&quot;,&quot;12000&quot;
&quot;003&quot;,&quot;Carol&quot;,&quot;Cooper&quot;,&quot;S101&quot;,&quot;11310&quot;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The 'orgnum' column contains an identifier of the organizational unit the person belongs to.
This looks quite familiar, and clever reader is working on the configuration already.
Of course, we can use the same approach we have used to build up organizational hierarchy.
We just need to apply it to the <em>users</em> instead of <em>orgs</em>.
Therefore, we are going to add new inbound mapping to the HR resource:</p>
</div>
<div class="listingblock">
<div class="title">resource-csv-hr.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>orgnum<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;inbound&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;assignmentTargetSearch&gt;</span>
                            <span class="tag">&lt;targetType&gt;</span>OrgType<span class="tag">&lt;/targetType&gt;</span>
                            <span class="tag">&lt;filter&gt;</span>
                                <span class="tag">&lt;q:text&gt;</span>identifier = $input<span class="tag">&lt;/q:text&gt;</span>
                            <span class="tag">&lt;/filter&gt;</span>
                        <span class="tag">&lt;/assignmentTargetSearch&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                    <span class="tag">&lt;target&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/assignment<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/target&gt;</span>
                <span class="tag">&lt;/inbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>assignmentTargetSearch</code> expression looks for the right organizational unit.
Then the mapping creates an assignment to that unit.
We are done, as easily as that.
Run the HR synchronization task, and all the users are going to be neatly organized in the organizational tree.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Get your data structures right at the beginning.</div>
<div class="paragraph">
<p>That 3-hour meeting with HR was in fact really useful and necessary.
The result was that ExAmPLE HR department did the right thing.
They put <em>identifier</em> of organizational unit in the HR feed, instead of organizational unit <em>name</em>.
Having organizational unit <em>identifier</em> makes everything much more stable.</p>
</div>
<div class="paragraph">
<p>There is a lesson to be learned.
Every hour spent designing the data structures will be repaid many times over.
Getting it wrong will cost you days or months spent dealing with data inconsistencies.
It is also very difficult to change data formats in the future, as they effectively become data integration interfaces.
Take your time and get it right at the beginning.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_organizational_structure_provisioning">Organizational Structure Provisioning</h3>
<div class="paragraph">
<p>We have seen how we can synchronize organizational structure into midPoint.
We are talking about midPoint here.
What goes in, can also go out.
It is very simple to provision organizational structure to an ordinary target system, such as database table.
However, we have already learned a thing or two, and doing that would be almost boring.
Therefore, let&#8217;s do something a bit more challenging.
Let us synchronize the organizational structure into an LDAP directory tree.</p>
</div>
<div class="paragraph">
<p>The basic principles of <em>organizational structure</em> provisioning are the same as for <em>user</em> provisioning.
We need to set up <em>outbound mappings</em> for organizational units.
We already know how to do that.
There are just few little differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We will use <code>organizationalUnit</code> object class instead of <code>inetOrgPerson</code>.</p>
</li>
<li>
<p>We will use <em>kind</em>/<em>intent</em> combination that describes organizational units.</p>
</li>
<li>
<p>We have to be a bit smarter about creating LDAP distinguished names (DNs) for the entries, as we want them to create a hierarchical data structure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Everything else is essentially the same as for users and accounts.
Let us go over all the details, step by step.</p>
</div>
<div class="paragraph">
<p>First of all, we need to add new <code>objectType</code> definition to the LDAP resource:</p>
</div>
<div class="listingblock">
<div class="title">resource-ldap.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">         <span class="tag">&lt;objectType&gt;</span>
            <span class="tag">&lt;kind&gt;</span>generic<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;intent&gt;</span>ou<span class="tag">&lt;/intent&gt;</span>
            <span class="tag">&lt;displayName&gt;</span>Organizational Unit<span class="tag">&lt;/displayName&gt;</span>
            <span class="tag">&lt;delineation&gt;</span>
                <span class="tag">&lt;objectClass&gt;</span>organizationalUnit<span class="tag">&lt;/objectClass&gt;</span>
            <span class="tag">&lt;/delineation&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>dn<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;displayName&gt;</span>Distinguished Name<span class="tag">&lt;/displayName&gt;</span>
                <span class="tag">&lt;limitations&gt;</span>
                    <span class="tag">&lt;minOccurs&gt;</span>0<span class="tag">&lt;/minOccurs&gt;</span>
                    <span class="tag">&lt;maxOccurs&gt;</span>1<span class="tag">&lt;/maxOccurs&gt;</span>
                <span class="tag">&lt;/limitations&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    <span class="tag">&lt;name&gt;</span>ldap-ou-dn<span class="tag">&lt;/name&gt;</span>
                    <span class="tag">&lt;trace&gt;</span>true<span class="tag">&lt;/trace&gt;</span>
                    <span class="tag">&lt;source&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/name<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/source&gt;</span>
                    <span class="tag">&lt;expression&gt;</span>
                        <span class="tag">&lt;script&gt;</span>
<span class="inline">                            <span class="tag">&lt;code&gt;</span>
                                import javax.naming.ldap.Rdn
                                import javax.naming.ldap.LdapName

                                // We will collect names of the org units in the orgpath list
                                // We cannot add them to dn yet as we need their order to be reversed
                                def orgpath = []
                                def node = focus
                                while (true) {
                                    log.debug(&quot;processing node {}&quot;, node)
                                    orgpath.add(node.displayName.orig)
                                    if (node.parentOrgRef == null || node.parentOrgRef.isEmpty()) {
                                        break
                                    } else {
                                        node = midpoint.resolveReference(node.parentOrgRef[0])
                                    }
                                }

                                log.debug(&quot;orgpath={}&quot;, orgpath)
                                def dn = new LdapName('ou=org,dc=example,dc=com')
                                orgpath.reverse().each { ouname -<span class="error">&gt;</span> dn.add(new Rdn('ou',ouname)) }
                                return dn.toString()
                            <span class="tag">&lt;/code&gt;</span></span>
                        <span class="tag">&lt;/script&gt;</span>
                    <span class="tag">&lt;/expression&gt;</span>
                <span class="tag">&lt;/outbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
            <span class="tag">&lt;attribute&gt;</span>
                <span class="tag">&lt;ref&gt;</span>ou<span class="tag">&lt;/ref&gt;</span>
                <span class="tag">&lt;limitations&gt;</span>
                    <span class="tag">&lt;maxOccurs&gt;</span>1<span class="tag">&lt;/maxOccurs&gt;</span>
                <span class="tag">&lt;/limitations&gt;</span>
                <span class="tag">&lt;outbound&gt;</span>
                    <span class="tag">&lt;source&gt;</span>
                        <span class="tag">&lt;path&gt;</span>$focus/displayName<span class="tag">&lt;/path&gt;</span>
                    <span class="tag">&lt;/source&gt;</span>
                <span class="tag">&lt;/outbound&gt;</span>
            <span class="tag">&lt;/attribute&gt;</span>
        <span class="tag">&lt;/objectType&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Except for that big piece of Groovy code, this configuration is relatively simple.
The <code>delineation</code> definition specifies <code>organizationalUnit</code> value for object class.
This is a standard LDAP object class for "ou" entries.
There is also specification of kind (<code>generic</code>) and intent (<code>ou</code>).
These are midPoint "coordinates" for this object type.
Then we have two <em>outbound</em> mappings, one for LDAP distinguished name (<code>dn</code>), the other for naming attribute (<code>ou</code>).
The <code>ou</code> mapping is very simple, using a value of org&#8217;s <code>displayName</code>.
On the other hand, the <code>dn</code> mapping looks somehow scary.
There is no need to be afraid.
We are going to explain everything, and there are some really interesting parts here.</p>
</div>
<div class="paragraph">
<p>The purpose of the <code>dn</code> mapping is to construct LDAP distinguished name in a hierarchical manner.
We want to put the organizational tree under the <code>ou=org,dc=example,dc=com</code> entry, with the entry for ExAmPLE company at the top.
Therefore, the <code>dn</code> of Operations Division need to be <code>ou=Operations Division,ou=ExAmPLE,ou=org,dc=example,dc=com</code>.
IT Department goes under the Operations Division, therefore we need its <code>dn</code> to be <code>ou=IT Department,ou=Operations Division,ou=ExAmPLE,ou=org,dc=example,dc=com</code>.
We need to process the tree from the organizational unit all the way through all the parent units to the very top of organizational structure.
That is exactly the thing that the Groovy expression does.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s skip the <code>import</code> statements for now.
The first thing that the expression has to do is to figure out the "path" from the current organizational unit to the top of the tree.
The expression gets the current organizational unit in the <code>focus</code> variable.
However, the <em>org</em> object does not contain its complete path in the tree.
All it has is a reference to its parent organizational unit (<code>parentOrgRef</code>).
Therefore, the expression has to iterate over all the levels in the tree until it gets to the top.
The top organizational unit does not have any parent, that is where the iteration stops.
Display names of each organizational unit at the "path" is collected in the <code>orgpath</code> list.
As the org contains only a reference to the parent, we need to explicitly read the parent object from midPoint repository.
We do that with an explicit call to <code>midpoint.resolveReference(&#8230;&#8203;)</code> method.
This method reads the object from midPoint repository and returns it.
When the loop stops, <code>orgpath</code> contains all the display names that we want in our <code>dn</code>.
Now we need to encode the names in LDAP DN format.
This can be done by simple string operations.
However, there are some intricate details about escaping the names as they are encoded.
It would be nice if someone else could do the encoding for us.
Turns out, there is someone else to do it.
Java platform comes with Java Naming and Directory Interface (JNDI), which is supposed to be a generic library to access broad range of directory services.
JNDI is not the best library that the world has ever seen, but it is part of Java platform, and it can do formatting of LDAP DN.
It is good enough for our purposes.
We take advantage of JNDI <code>LdapName</code> and <code>Rdn</code> classes to encode the DN.
The <code>import</code> statements at the beginning made use of these classes quite convenient.
The last detail is the ordering.
We want our names in the DN to be in a different order, therefore we just reverse <code>orgpath</code> before processing.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Tracing and logging</div>
Clever reader has noticed a couple of interesting things in that mapping.
Especially the <code>&lt;trace&gt;</code> element looks very useful, which it is.
It turns on detailed tracing of the mapping.
MidPoint will record the details of mapping evaluation in the log file.
Similar <code>&lt;trace&gt;</code> element can also be applied at the expression level.
Then there are the <code>log</code> statements in the Groovy code, such as <code>log.debug("processing node {}", node)</code>.
These are explicit logging statements.
The <code>processing node &#8230;&#8203;</code> message is recorded to the log file at debug level.
This is a very useful tool for diagnosing execution of complex expressions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Our outbound mappings are ready to go.
However, nothing happens yet.
MidPoint does not know that it is supposed to create LDAP objects for our organizational units.
MidPoint does not automatically create accounts for all the users either.
We need a <em>construction</em> to do that.
The <em>orgs</em> need to have an <em>assignment</em> with a <em>construction</em> - similar to these that we have used to create accounts, just with different <em>kind</em> and <em>intent</em>.
We want to archive something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;org</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7a1feb50-471f-11ea-8aab-1b2627541f15</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>F11000<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;displayName&gt;</span>Sales and Marketing Division<span class="tag">&lt;/displayName&gt;</span>
    ...
    <span class="tag">&lt;assignment&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
            <span class="comment">&lt;!-- LDAP resource --&gt;</span>
            <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;kind&gt;</span>generic<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;intent&gt;</span>ou<span class="tag">&lt;/intent&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/assignment&gt;</span>
<span class="tag">&lt;/org&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can test your configuration by creating this assignment manually in the GUI, or by editing the XML/JSON/YAML version of the <em>org</em>.
However, manual method is not going to work in production.
We need to create these assignments automatically.
There are several ways to do it.</p>
</div>
<div class="paragraph">
<p>Perhaps the most obvious way would be to add a mapping to create this assignment in the object template for <em>Organization unit</em> objects.
As there is an object template for users (<code>UserType</code>), there may be an object template for any other midPoint object or archetype.
Therefore, you can create object template for <code>Organizational unit</code> archetype and configure the mapping there.
This would be an acceptable solution.</p>
</div>
<div class="paragraph">
<p>An alternative way would be to add <em>inbound</em> mapping to create this assignment.
That would be in fact quite easy, as it would is very similar to the mapping that we have used to create organizational hierarchy.
However, that would not be an ideal configuration, as we would mix the <em>concerns</em> here.
The mapping would be an <em>inbound</em> mapping in the <code>Organizational Chart</code> resource.
It would not be entirely appropriate for this <em>inbound</em> mapping to control provisioning (i.e. <em>outbound</em> flow) of organizational structure.
It could work, but such configuration would be difficult to understand and maintain.
We do not like that.</p>
</div>
<div class="paragraph">
<p>Clever reader is now thinking about the <em>meta-role</em> principle, looking at the <code>Organizational unit</code> archetype.
As usual, cleaver reader is absolutely right.
All we need is to add the <em>construction</em> into the <code>Organizational unit</code> archetype in a form of <em>inducement</em>.</p>
</div>
<div class="listingblock">
<div class="title">archetype-organizational-unit.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;archetype</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">99fa4b3c-8702-11ef-896e-0b7221540b8b</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>Organizational unit<span class="tag">&lt;/name&gt;</span>
    ...
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
            <span class="comment">&lt;!-- LDAP resource --&gt;</span>
            <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8a83b1a4-be18-11e6-ae84-7301fdab1d7c</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;kind&gt;</span>generic<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;intent&gt;</span>ou<span class="tag">&lt;/intent&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/archetype&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Back when we were configuring inbound synchronization of organizational units, we have do the right thing and assigned an archetype to the <em>orgs</em> we have created.
Now it pays back ist dues, archetype makes is very easy to control behavior of all the <em>organizational units</em>.
All we need to do now is to re-run the synchronization task.
The result is a nice organizational structure in LDAP directory:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-13-ldap-org-tree.png" alt="Organizational strucutre in LDAP">
</div>
<div class="title">Figure 13. Organizational structure in LDAP</div>
</div>
<div class="paragraph">
<p>This is a nice result.
However, there are still several remarks to make.</p>
</div>
<div class="paragraph">
<p>If you are going to try this scenario with a real LDAP server, you would need to create a root entry for the organizational structure (<code>ou=org,dc=example,dc=com</code>), as well as entry for ExAmPLE company (<code>ou=ExAmPLE,ou=org,dc=example,dc=com</code>).
You would also need to update access control lists (ACLs).
However, be warned that this is not a very ideal method to maintain organizational structure in LDAP directory.
We are using display names here, which are part of LDAP identifiers (DNs).
Therefore, even a minor correction in organizational unit name will trigger LDAP rename operation.
It will change the identifier of the organizational unit, and also all the organizational units below it.
Perhaps the only thing that can make it worse is to place <em>users</em> in that structure as well.
Which some people actually do.
The only real reason to put organizational structure in this form is to satisfy the needs of legacy applications.
Avoid this approach whenever you can.
We are presenting it here only for demonstration purposes, to explain a method for provisioning hierarchical structures.</p>
</div>
<div class="paragraph">
<p>The clever reader have surely noticed that the big Groovy expression above is explicitly fetching objects from midPoint repository database.
This may cause a performance problem in case that such expression is evaluated often or if the structure is very deep.
This is usually not the case with ordinary organizational structures, therefore this approach is usually not problematic.
However, it is always a good thing to keep performance in mind, especially if your user population is bigger than few thousands of users.</p>
</div>
<div class="paragraph">
<p>Finally, we still depend on ordering of the data feed.
We want to create "higher" entries in LDAP first, otherwise an attempt to create "lower" entries would fail.
This can be solved by using the "create on demand" approach mentioned above.
However, it is going to be problematic and cumbersome when organizational unit display names are used instead of identifiers.
However, in that case this little details does not matter that much anyway, as it is likely you will suffer for many different reasons if organizational display names are used instead of identifiers.
Always use organizational unit identifiers if you can.
We really mean it.
You can thank us later.</p>
</div>
</div>
<div class="sect2">
<h3 id="_focus_and_projection">Focus and Projection</h3>
<div class="paragraph">
<p>Synchronization of an organizational structure is an application of a <em>generic synchronization</em> principle.
Almost any <em>resource object</em> can be synchronized with almost any <em>midPoint object</em> - and vice versa.
Principle of the synchronization is essentially the same as in user-account case, as we have seen in previous chapters.
In that case, the <em>accounts</em> were linked to <em>user</em>, midPoint synchronized the data from account to user and from user to accounts.
The synchronization follows user-account <em>links</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/04-04-hub-and-spoke.png" alt="User and accounts">
</div>
<div class="title">Figure 14. User and accounts</div>
</div>
<div class="paragraph">
<p>Synchronization of an organizational structure is based on the same principle.
However, there is an <em>org</em> instead of user, and there are various <em>resource objects</em> instead of accounts.
It may look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-14-org-projections.png" alt="Org and projections">
</div>
<div class="title">Figure 15. Org and projections</div>
</div>
<div class="paragraph">
<p>There may be user, org, service, role or similar <em>midPoint object</em> on the midPoint side.
These may be synchronized with account, group, role, privilege, organizational unit or almost any <em>resource object</em> on resource side.
As you can see, the terminology becomes quite cumbersome.
Saying "similar midPoint object" and "almost any resource object" is not very natural or precise.
Therefore, we have decided to use <em>focus</em> and <em>projection</em> terms:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/10-15-focus-projections.png" alt="Focus and projections">
</div>
<div class="title">Figure 16. Focus and projections</div>
</div>
<div class="paragraph">
<p>The object that is "in the middle" is called <em>focus</em> or <em>focal object</em>.
It is in the centre of the synchronization, it is its focal point.
Every relevant piece of data is reflected onto the focal object by the synchronization mechanisms.</p>
</div>
<div class="paragraph">
<p><em>User</em> is a very typical focal object.
Other midPoint objects can be focal objects as well, most notably <em>org</em>, <em>role</em> and <em>service</em>.</p>
</div>
<div class="paragraph">
<p>The state of focal object is <em>projected</em> back to the resources.
Therefore, the objects that reside on the resources are called <em>projections</em>.
An <em>account</em> is a typical projection object, but there is wide variety of other object classes such as groups, organizational units, (resource-side) roles, privileges, access control lists, teams and so on.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Focus and projection</div>
<em>Focus</em> and <em>projection</em> may sound like strange words to use for identity management concepts.
However, it is very difficult to find the right words.
Many identity management systems work with just <em>user</em> and <em>account</em>.
However, midPoint is more flexible, much more generic.
When we designed the generic synchronization mechanism, we needed to find good names for the generalization of <em>user</em> and <em>account</em> concepts.
We tried hard, but we could not find anything better than <em>focus</em> and <em>projection</em>.
The names may not be ideal, yet we are able to live with them.
There are only two hard problems in computer science, after all.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is always one <em>focus</em>, one focal object in the center.
There may be any number of <em>projections</em> linked to the <em>focus</em>.
There may be several <em>projections</em> on one resource.
However, each <em>projection</em> has to be unique, it needs to have a unique combination of <em>kind</em> and <em>intent</em> (or <em>kind</em>, <em>intent</em> and <em>tag</em> when "multi-accounts_ are used).
This is the reason that we consider <em>kind</em> and <em>intent</em> to be coordinates, as they uniquely identify a <em>projection</em> on a particular resource.</p>
</div>
<div class="paragraph">
<p>This is a very flexible concept that can be used for various purposes.
We have already seen how it can be used for synchronization of organizational structure.
Similar principle can be used to synchronize Active Directory groups, automatically creating application role for each Active Directory group.
This principle provides a mechanism to create multiple accounts for one user on one resource.
For example, it can be used to create administration accounts for some users.
In this case, we would use explicit <em>kind</em> and <em>intent</em> in the construction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;role</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0e9c448c-1f87-11eb-9703-b3d28c537192</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;name&gt;</span>System Administrator<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;inducement&gt;</span>
        <span class="tag">&lt;construction&gt;</span>
            <span class="comment">&lt;!-- Active Directory resource --&gt;</span>
            <span class="tag">&lt;resourceRef</span> <span class="attribute-name">oid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1e1e5a1c-1f87-11eb-8ace-1fbd338f61c5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;kind&gt;</span>account<span class="tag">&lt;/kind&gt;</span>
            <span class="tag">&lt;intent&gt;</span>admin<span class="tag">&lt;/intent&gt;</span>
        <span class="tag">&lt;/construction&gt;</span>
    <span class="tag">&lt;/inducement&gt;</span>
<span class="tag">&lt;/user&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>System Administrator</code> role above specifies that a special <code>admin</code> account should be created for system administrators.
When this role is combined by an ordinary <code>Employee</code> role, the administrator will get two accounts: the usual employee account (intent=<code>default</code>) and a special-purpose administration account (intent=<code>admin</code>).</p>
</div>
<div class="paragraph">
<p>Overall, the concept of <em>focus</em> and <em>projections</em> is a generic principle that permeates entire midPoint platform.
It applies to generic synchronization, access control models such as RBAC, provisioning, policy management and to almost any other aspect of midPoint functionality.
It is one of the basic principles that midPoint is built on.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_8">Conclusion</h3>
<div class="paragraph">
<p>MidPoint organizational structure is a versatile and powerful mechanism.
It can be used to organize users in units, teams and projects.
It can be used to group variety of other midPoint objects.
However, organizational structure becomes incredibly powerful when combined with other midPoint mechanisms.
Authorizations can take advantage of organizational structures to implement delegated administration schemes.
Organizational structures are used in certification campaigns.
MidPoint multi-tenancy mechanism also relies on organizational structures.
Organizational structure is a universal mechanism to organize midPoint objects.</p>
</div>
<div class="paragraph">
<p>There are many universal mechanisms in midPoint, synchronization mechanism being one of the prominent ones.
Synchronization was designed to work with many types of midPoint objects, including organizational structure.
Expressions and mappings bring the power to transform organizational structure data during synchronization, supporting diverse set of use cases.
Similar mechanisms can be used to synchronize roles and services, granting midPoint enormous flexibility in identity management deployment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="90-troubleshooting">11. Troubleshooting</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
The problem is not that there are problems. The problem is expecting otherwise and thinking that having problems is a problem.
</blockquote>
<div class="attribution">
&#8212; Theodore Rubin
</div>
</div>
<div class="paragraph">
<p>MidPoint is a big and comprehensive system.
Generally speaking, identity governance systems tend to be big and complex.
They have a lot of things to do.
There is a lot of data mapping, synchronization, policies, access control models, expressions and all such stuff.
While each individual mechanism in itself is relatively simple, the combination of those mechanisms often creates something that would put the famous labyrinth of Knossos to shame.
Especially junior engineers tend to create configurations that are unnecessarily complex.
Those configurations may work for common cases.
Then there comes a corner case and the result is a puzzled look at junior engineer’s face and a mysterious smile of his senior colleagues.
At that point, junior engineers tend to panic and switch to high-energy trial-and-error mode, which usually does even more harm.
What is really needed here is to stand back, to think about the situation and start to troubleshoot the problem in a systematic way.</p>
</div>
<div class="paragraph">
<p>However, even senior engineers often get into trouble.
This is no weakness.
MidPoint is really flexible, and sometimes it is hard to figure out what is going on exactly.
In fact, midPoint has surprised even its authors on more than one occasion.
When midPoint misbehaves, then the cause is almost always a configuration problem.
However, there are usually thousands upon thousands of users, roles, policies and expressions.
There is a lot of places where a little treacherous problem can hide and live happily ever after.</p>
</div>
<div class="paragraph">
<p>All of that was perfectly clear to midPoint developers even before midPoint project started.
MidPoint developers are more than just programmers.
Writing midPoint code takes a good part of developer’s day.
But there is also testing, diagnostics of bugs and helping our colleagues and partners to figure out what is going on when the things get really tough.
The developers would be lost without an efficient method to diagnose the behavior of midPoint.
Therefore, diagnostic mechanisms were an integral part of midPoint design from the very beginning.</p>
</div>
<div class="paragraph">
<p>This chapter provides an overview of the diagnostics mechanisms in midPoint.
Even more importantly, it describes the method that can help to find the problem in a systematic and reliable way.
That is what every engineer should learn and use every day.
In fact, troubleshooting is perhaps the most important skill for smooth deployment of any software system.</p>
</div>
<div class="sect2">
<h3 id="_designed_for_visibility">Designed for Visibility</h3>
<div class="paragraph">
<p>MidPoint is designed, developed and maintained by a completely unique team.
Expert identity management engineers were part of midPoint development team very early in midPoint design.
Several key people that took part in midPoint design were involved in identity management projects since early 2000s.
That experience was crucial – especially <em>bad</em> experience from the use of the technologies that were available at the time.
One of the most important lessons that can be learned from fist-generation identity management systems is a lesson of <em>visibility</em>.
All those early systems were closed, their vendors jealously guarding all the secrets of inner workings of their systems.
This made troubleshooting a very demanding task.
Engineers often had to resort to desperate measures, such as calling vendor’s support help desk.
Unfortunately, even such drastic actions usually did not help much.
It was a real struggle.</p>
</div>
<div class="paragraph">
<p>When midPoint project started, the team agreed to take a different approach.
MidPoint is radically <em>open</em>.
It is an open source project from the day one.
There is a reasonable documentation, even including architectural documentation and design notes.
All of that is public.
Most importantly, the visibility goes deep down in midPoint implementation.
Great attention was paid for proper <em>logging</em>, as that is the primary troubleshooting mechanism.
There are various diagnostic mechanisms in midPoint user interface, performance metrics and so on.
All of that is improved in every midPoint release.</p>
</div>
<div class="paragraph">
<p>However, the most important thing is to know how to use those mechanisms properly.
Even the best diagnostics mechanism does not do any good for you if it shows the data that you do not need at the moment.
It is important to know where to start, where to look, and what to look for.
These are the questions that this chapter should answer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_systematic_approach">Systematic Approach</h3>
<div class="paragraph">
<p>Where to even start the troubleshooting?
That is a question that troubles most engineers who are new to midPoint.
Senior engineers would probably think that this is a silly question and the answer is obvious.
Yet, it is not.
It gets even harder to figure out how to follow the trace of the problem deeper into midPoint configuration.</p>
</div>
<div class="paragraph">
<p>Let us start with the obvious.
Maybe there is an <em>error message</em> right in front of your eyes.
MidPoint usually provides a lot of details that come with error message.
Then there are <em>log files</em>.
MidPoint logs a huge amount of information, it just needs to be enabled.</p>
</div>
<div class="paragraph">
<p>The usual troubleshooting sequence goes like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>What exactly is the problem?</strong>
What are the symptoms?
Does the operation fail?
Is there an error message?
Does it crash?
Did it produce wrong results, or are there no results at all?
What was the supposed result?
Can this be an error in the input data?</p>
</li>
<li>
<p>If there is an <strong>error message</strong>, what is that message saying?
Is there any additional information in the message or in the operation result that comes with the message?
Where is the error coming from?
Is it an error from a connector?
Is it an error from an expression?</p>
</li>
<li>
<p>Is there any additional information in the <strong>log file</strong>?
Are there any errors or warnings in the log file that may cause the problem?
Are there any suspicious errors or warnings before in the log file before the problem happened?</p>
</li>
<li>
<p><strong>What was midPoint doing</strong>, exactly?
Is there any information about the operation progress when log level is set to <code>DEBUG</code>?
What are the intermediary results of the processing?
Are those results correct?
At which point in the operation are data getting wrong?</p>
</li>
<li>
<p><strong>Where exactly is the problem?</strong>
Which component, configuration, mapping or expression are causing it?
What are the details of the operation?
Are there any hints if you set logging level of that component to <code>TRACE</code>?</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first step is perhaps obvious – even though too many people fail to see what is right in front of their eyes.
Once you have opened your eyes and checked for the obvious causes, then there is time to go deeper.</p>
</div>
<div class="paragraph">
<p>Once you have ruled out the obvious cases you need to have a look at midPoint <em>log files</em>.
You need to follow the trace and examine the operations that midPoint was doing.
The best strategy here is one of <em>divide and conquer</em>.
In other words, start in the middle.
Find a convenient starting point in the middle of the processing.
Where exactly that middle is depends on the nature of the problem.
If the problem is related to a connector, then the best starting point is probably a connector framework.
Does the operation make sense?
Are the values correct?
If the answer is "yes", then the problem is probably in the connector.
If the answer is "no", then the problem is in midPoint configuration.
Either way you know where you should focus your investigation.
If that problem is in midPoint, then in which part it is?
Are data in the user object correct?
If they are, then the problem is probably in the outbound mappings.
Have a look at those.
And so on.
Start with a big thing, and then follow the clues and dive into the details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_error_messages_and_operation_results">Error Messages and Operation Results</h3>
<div class="paragraph">
<p>Error messages are the most obvious troubleshooting mechanisms.
MidPoint error messages usually provide enough information to diagnose and fix trivial problems right away.</p>
</div>
<div class="paragraph">
<p>MidPoint error messages are in fact part of a more complex system of <em>operation results</em>.
Operation result is a data structure that accompanies every midPoint operation.
The operation records important points during the processing in the operation result.
Operation result is hierarchical.
There is one big operation at the top.
The top-level operation usually consists of smaller operations which in turn consist of even smaller operations.
Connector operations are somewhere at the bottom.
If the top-level message does not provide information about the problem, then dig deeper.
Expand the sub-operations until you find the root cause.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/90-01-operation-result-expanded.png" alt="Operation result">
</div>
</div>
<div class="paragraph">
<p>Operation result can be used to get a rough idea what midPoint was doing and what are the results.
Each of the operations in the result has a status:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUCCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation completed.
The operation has finished successfully.
There are no errors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WARNING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation completed, but there are warnings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PARTIAL_ERROR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation completed.
Some parts of the operation were successful, other parts of the operations resulted in an error.
However, the operation was not stopped and the execution continued despite the errors.</p>
<p class="tableblock">Partial error is often indicated in case that user modification is successful but account modification fails.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FATAL_ERROR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation was interrupted due to an error.
The error prohibited completion of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HANDLED_ERROR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation completed.
An error was experienced during execution of the operation.
However, the error was handled and the system was able to compensate the effects of the error.
The results should be equivalent to a successful operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT_APPLICABLE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation was not even started because the operation is not applicable to the inputs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IN_PROGRESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation is in progress.
The operation was started, but it was not yet finished.</p>
<p class="tableblock">This status is seen for operations that execute “in the background”, in running tasks and so on.
It may also be used for operations that are waiting for an external event, such as approval operations or operation retries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UNKNOWN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status of the operation is not known.</p>
<p class="tableblock">This status code should not be normally seen.
However, it may happen under special circumstances.
For example, if a bug in midPoint or a connector leaves the operation in an uncertain state or in case that unforeseen error appeared, and it was not handled properly.
This status usually indicates a programming bug.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Operation result is a very useful data structure.
It has many purposes.
For example, it is stored in the tasks and provides data for later diagnostics.
It can summarize the operations, provide performance data and so on.
That means that the operation result cannot be too big.
Therefore, the granularity of the operation result is usually quite rough to pinpoint serious issues.
Issues that are really tricky usually cannot be resolved by examination of operation results.
For that we need to go deeper still.</p>
</div>
</div>
<div class="sect2">
<h3 id="_logging_2">Logging</h3>
<div class="paragraph">
<p>Logging is the best tool in the troubleshooting toolbox.
Logging provides information about all the important things that happen in the system.
It also goes very deep, and it can provide very fine details about midPoint operations.
Logging is universal and very powerful tool.
It is the best hope to find the cause even for the trickiest of problems.</p>
</div>
<div class="paragraph">
<p>Similarly to every other tool, the most important thing is to know how to use it properly.
MidPoint logs only a very little information by default.
This is a reasonable setting for a production system that has been properly configured and tested.
It is not enough in case that you are chasing a configuration problem.
In that case, the logging system needs to be reconfigured to log more information.
Beware, if logging system is set to its full power, you will get a huge stream of data that is likely to completely overwhelm you.
The important information is certainly going to be there.
However, it will be completely lost in the flood of other data.
Therefore, logging needs some skill and experience to manage it correctly.</p>
</div>
<div class="paragraph">
<p>MidPoint is using logging approach that is well established in the industry.
MidPoint logging principles should be quite familiar to any deployment engineer.
However, it is perhaps worth to provide a quick overview of those basic principles.</p>
</div>
<div class="paragraph">
<p>MidPoint log files are located in midPoint <em>home directory</em>.
This is usually <code>var</code> sub-directory of midPoint installation directory.
When using docker compose, midPoint home directory is available as <code>midpoint_home</code> directory, located in the same directory as is your <code>docker-compose.yml</code> file.
MidPoint <em>home directory</em> contains subdirectory <code>logs</code>.
That is where midPoint logfiles are located.
There are usually several files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>midpoint.log</code> is the primary midPoint log file.
Almost all log messages from midPoint are be recorded here.
This is the right file to examine.
The truth is in there.</p>
</li>
<li>
<p><code>midpoint.out</code> is file where the standard output of midPoint process is recorded in some deployment scenarios.
Only a very few things are usually logged here.
Those are the things that happen before midPoint logging system is enabled, therefore midPoint cannot control and redirect logging of those messages.
Which that the messages usually describe events that happen before midPoint starts and after it stops.
This file does not need to be inspected routinely.
However, it is a useful place to look while experiencing startup issues.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Log files are usually rotated.
Which means that when there is too much data in one log file the file is renamed.
Oldest files are removed.
Otherwise the log files would fill all available disk space.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Docker logs</div>
Logs are handled in somehow special way in the <em>docker</em> environment.
Perhaps the easiest way to look at the logs is to simply start the containers in foreground, e.g. by using <code>docker compose up</code> without the <code>-d</code> switch.
This can provide nice overview that the container are running, but it is not very practical for log analysis.
The usual method of locating the log file in <em>midPoint home directory</em> can still be used in docker environment.
If you prefer using native docker tools, there is <code>docker compose logs</code> command to access the logs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Log messages have a structured format.
They look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2019-08-16 16:40:25,863 [PROVISIONING] [main] INFO (com.evolveum.midpoint.provisioning.impl.ProvisioningServiceImpl): Discovered local connector connector: ConnId com.evolveum.polygon.connector.ldap.LdapConnector v2.3 (OID:268678c0-b5b3-4b13-a399-c2fbd903e51d)</pre>
</div>
</div>
<div class="paragraph">
<p>The fields are described in the following table.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of a moment when the message was generated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-08-16 16:40:25,863</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the component where the message originated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[PROVISIONING]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thread name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of thread in which the message originated.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[main]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Severity level of the message.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INFO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logger name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is usually package name or a fully-qualified name of the class that produced the message.
There may also be special-purpose loggers with special names.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.provisioning.impl.ProvisioningServiceImpl</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content of log message.
This is usually single-line message.
However, multi-line messages are common on finer log levels.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Discovered local connector connector: ConnId com.evolveum.polygon.connector.ldap.LdapConnector v2.3 (OID:268678c0-b5b3-4b13-a399-c2fbd903e51d)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As midPoint takes advantage of parallel processing, the thread name is often useful to filter out messages that belong to a single operation.
The logger name is sometimes abbreviated, therefore <code>com.evolveum.midpoint.provisioning.impl.ProvisioningServiceImpl</code> becomes <code>c.e.m.provisioning.impl.ProvisioningServiceImpl</code>.
Otherwise, the log message format is similar to message formats of other products, and it should be quite familiar to most system engineers.
The log format can be customized if needed.</p>
</div>
<div class="paragraph">
<p>The most important aspect of efficient usage of logging as a diagnostic tool is to control granularity of logging.
This is both a science and an art.
It requires some instincts and experience.
The granularity can be controlled in two "dimensions":</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Log level</strong> determines the level of details that is logged.
<code>INFO</code> log level will log only the important events.
<code>TRACE</code> level will log huge amount of information that is primarily interesting for developers.
This controls <em>depth</em> of logging.</p>
</li>
<li>
<p><strong>Package</strong> determines which midPoint components log their messages.
Setting a log level for a particular package also enables logging of all sub-packages and classes.
This controls the <em>breadth</em> of logging.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Logging setting is a combination of a package and level.
Therefore, it is possible to get a very detailed logging from a single package while keeping logging of other packages at a very rough-grained level.
And this is exactly what is needed when chasing a bug.
We want to have a very precise look at the component where the problem occurs without being overwhelmed by a flood of data from other parts of midPoint.
The trick is to know which package and level to use.</p>
</div>
<div class="paragraph">
<p>Let’s start with log levels.
Each level has a precise definition of the amount of details it provides.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Level</th>
<th class="tableblock halign-left valign-top">Circumstances</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FATAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Critical errors.
The system cannot continue operation, it is about to crash or stop working.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is bad.
The system is going down.
There is no way that the system can run.
Big problem.
This should not happen.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ERROR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error that seriously affects the system, but the system as a whole can recover.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Typically caused by errors in the data, network errors and so on.
This is not good.
Sometimes the system can recover just by itself.
However, manual intervention of system administrator is usually needed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WARNING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspicious situation.
System may be able to operate normally, but there may be a hidden or temporary problem or an indication of future error.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Important messages that should not occur in a well-configured and tuned systems.
If they appear they should be investigated.
However, the investigation can wait.
Immediate action is usually not required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INFO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Important changes in system state, start/stop of important system tasks, etc.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Those events occur normally in almost all running systems.
Unless you have a very busy system, this log level can be enabled all the time in production.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEBUG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution messages, state changes, expression evaluation messages and similar messages for system administrator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This log level is dedicated for system administrators to debug the configuration.
It will provide reasonable amount of messages that can be used to find configuration problems.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRACE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fine-grained messages about execution details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This log level will provide a lot of data, lots of details.
Its primary purpose is to allow developers to find a bug in production systems.
However, this can also provide precious details for system administrators when troubleshooting really tricky problems.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The levels are organized in a hierarchy.
When <code>DEBUG</code> level is set for a particular package, the package also logs all messages with higher (rough-grain) levels.
The usual log level to start with when chasing a bug is <code>DEBUG</code> log level.
This may be too much for some packages or too little for other packages.
Yet, it is a good overall starting point.</p>
</div>
<div class="paragraph">
<p>Log levels are simple and well-defined.
However, figuring out proper package name is much harder.
Engineers that understand midPoint architecture and source code have a huge advantage here.
Logging package names are directly derived from Java packages and classes used in midPoint source code.
However, even non-developers can learn how to use the package names efficiently.</p>
</div>
<div class="paragraph">
<p>The first thing to keep in mind is that midPoint is composed of subsystems and components.
Each subsystem and component has its own package name.
Those can be used to control logging of individual parts of midPoint.
Following table provides an overview of those architectural blocks.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Subsystem/component</th>
<th class="tableblock halign-left valign-top">Package name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GUI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.gui</code><br>
<code>com.evolveum.midpoint.web</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User interface. This subsystem drives all interaction with the user.</p>
<p class="tableblock"><strong>Note:</strong> the <code>*.web</code> package is legacy, but it is still used by a lot of code.
Both packages are needed for complete GUI logging.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Model</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This subsystem implements most of the identity management logic in midPoint.
User processing, RBAC, organizational structure, policies – everything is processed here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provisioning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.provisioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Communication with external systems.
This subsystem is responsible for communication with the connectors, management of shadow objects, driving live synchronization, manual connectors, operation retries, management of resources and connectors and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConnId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.identityconnectors.framework</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConnId connector framework.
This is responsible for running the connectors and passing operation to the connectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.repo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Primary responsibility is to store midPoint objects in the database.
But there is also task management, authorization processing, expression evaluation and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schema</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition of midPoint data model and various utilities.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prism</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.prism</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Library that is parsing and storing objects in representation data formats (XML/JSON/YAML).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Those package names can provide rough boundaries for logging.
Enabling <code>TRACE</code> level on an entire subsystem can still provide a lot of data, but it is better than enabling <code>TRACE</code> for whole midPoint.
The best approach here involves a look at midPoint source code.
However, there is a still a way to do it without a source code:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable <code>DEBUG</code> level on the entire subsystem.
This is likely to provide a log of data, but it should not be overwhelming.</p>
</li>
<li>
<p>Look at the log file and try to figure out in which part the interesting things happen.
Where the things are getting out of control.
Observe name of the packages that are used in those messages.</p>
</li>
<li>
<p>Set <code>TRACE</code> level only for those packages or classes where interesting things happen.
You will get much more details.</p>
</li>
<li>
<p>Optionally mute some packages that show too much data by setting their log level to <code>INFO</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is a good overall approach.
However, there are few very specific packages that tend to attract problems.
Therefore, they are often set to finer log levels.
Below is a list of those packages.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Package name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clockwork</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model.impl.lens.Clockwork</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The "controller" that drives computation of all changes in midPoint.
Change of every object is passing through clockwork (unless it is "raw").</p>
<p class="tableblock">Enabling logging on clockwork will provide rough overview of the processing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Projector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model.impl.lens.projector.Projector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The "brain" that computes all effects of the change.
It is invoked as part of the clockwork.</p>
<p class="tableblock">Enabling logging will provide overview of the computation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change Executor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model.impl.lens.ChangeExecutor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The "hand" that executes all the computed changes.</p>
<p class="tableblock">Enabling logging will provide an overview of computed changes and the result of their application (success or failure).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lens</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model.impl.lens</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sub-component responsible for computing and processing all ordinary changes on objects.
It includes clockwork, projector and executor.</p>
<p class="tableblock">Setting <code>TRACE</code> level here will provide all the gory details about the processing.
Lots of data.
Use only in deep despair.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mappings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model.common.mapping.Mapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code that is processing mappings.</p>
<p class="tableblock">Enabling logging provides a short overview of mapping inputs and outputs with some insights into the inner processing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expressions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model.common.expression.Expression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expression evaluation code.
Enabling logging will provide a lot of details about expression evaluation.
This is likely to produce a log of data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script expressions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model.common.expression.script.ScriptExpression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logs a lot of details about script expression evaluation (Groovy, JavaScript, &#8230;&#8203;).</p>
<p class="tableblock">Provides a lot of details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConnId API Operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.identityconnectors.framework.api.operations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Special package used to log summary of all connector operations that go through ConnId framework.
This is the API side of the framework (midPoint-ConnId boundary).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ConnId SPI Operations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.identityconnectors.framework.spi.operations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Special package used to log summary of all connector operations that go through ConnId framework.
This is the SPI side of the framework (ConnId-connector boundary).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.security</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Package that contains security-related components.</p>
<p class="tableblock">This is especially useful for debugging authorizations.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Setting <code>DEBUG</code> log level to clockwork, projector or change executor is a good starting point for diagnostics of problems related to mappings and assignments.
The ConnId operation log is a good starting point for connector related problems.
Security package is perhaps the only really efficient mechanism to debug misbehaving authorizations.</p>
</div>
<div class="paragraph">
<p>Logging is the best troubleshooting tool to handle even the most complex issues.
Therefore, make sure you take full advantage of this tool.
The importance of logging can hardly be overstated.
Make sure you know how to set up logging properly and how to interpret log messages.
This is a skill that takes some time to learn.
Yet, it is a crucial investment to make.
The time will be repaid many times over.
Therefore, if you have any problem that looks strange, remember one simple rule: <strong>always look at the log files</strong>.
The answer will be there.</p>
</div>
</div>
<div class="sect2">
<h3 id="_auditing">Auditing</h3>
<div class="paragraph">
<p>Purpose of the auditing mechanism is to record all operations in midPoint for <em>accountability</em> purposes.
Auditing is used by security officers to inspect system activity, it may be used for forensic purposes, or it can simply provide a data for statistical analyses.
However, the fact that auditing records <em>all</em> operations in the system can be a significant benefit for troubleshooting.</p>
</div>
<div class="paragraph">
<p>MidPoint user interface is quite comprehensive.
Despite that complexity, most operations of the user interface should be easily understandable in an intuitive way.
However, there are cases when it is not clear what exactly is user interface trying to do.
Some operations can even be quite counter-intuitive.
For example, designation of a deputy is an operation on a different user than most people would intuitively expect.
It is always an advantage to see all the details of an operation that user interface tries to initiate.
That is where auditing mechanism comes in.
The auditing subsystem records all the operations in a precise, structured way.
Maybe midPoint does unexpected thing just because the operation request itself does not make sense.
Audit trail can be examined to make sure that the operation is correct.
Also, the results of the operation are recorded in the audit trail.
Audit may be a quick and efficient way to get an overview about the operation as a whole.</p>
</div>
<div class="paragraph">
<p>Audit may also be very handy when exploring bulk operations, such as results of synchronization or reconciliation runs.
The tasks in which those operations run provide overview of the results, e.g. they provide the number of errors.
However, the task data structure holds only limited details of each operation.
Data structures providing all the details would be huge.
However, there are audit records for each of those operations.
Those records can be used to figure out what went wrong exactly: which objects have failed, what operations were attempted, what exactly is the outcome.</p>
</div>
<div class="paragraph">
<p>Audit trail is one of the few places in midPoint where historical data are kept.
All other parts of midPoint are concerned about <em>here and now</em>, historical data are usually kept only for informational purposes.
Audit log is different.
Audit log stores historical data, therefore it can be used to get an overview of midPoint operations in the past.
Common use of audit trail is to get overview of daily operations.
For example, audit records can provide data on how many operations were processed during the past day, which operations have failed during last few hours and so on.
There is a special type of report to show such information.
There is also a dashboard widget that is designed to show such audit-based information for monitoring purposes.</p>
</div>
<div class="paragraph">
<p>However, please keep in mind that midPoint is an identity management system.
It is not a security information and event management (SIEM) system or a data warehouse.
MidPoint is not designed to keep and process massive amount of historical data.
Therefore, even the use of audit trails has its limits.
Keeping audit trail in midPoint database for a short period of time is usually perfectly acceptable.
However, a more suitable system should be used for a long-term storage and processing of audit trail data.</p>
</div>
<div class="paragraph">
<p>Typical midPoint deployment records audit trails in the database table.
This is the right method to use for production deployment.
However, there is another option.
Audit records can be also recorded in the log files.
This approach is not recommended for a production deployment.
It is quite likely that audit records would flood the logs, and it may even disclose sensitive data.
However, directing audit records into system logs may provide interesting benefits in development environments.
For example, in case that a detailed debug logging is used, audit records will provide summary of operation and the outcome in the same log together with all the details.
It makes it easier to analyze the log files.
As audit data is recorded close to the operation start and operation end, audit log entries also provide a “frame” for the operation.
It may be easier to find start and end of the operation in the logfile.</p>
</div>
<div class="paragraph">
<p>Recording audit messages can be enabled in user interface, in the part where ordinary logging is configured.
There is an "Audit" section on that page.
Audit log message looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2019-08-19 15:02:05,367 [MODEL] [pool-3-thread-6] INFO (com.evolveum.midpoint.audit.log): 2019-08-19T15:02:05.367+0200 eid=1566219725367-0-1, et=MODIFY_OBJECT, es=REQUEST, sid=DF97547B47BC6795D941B8C28AFB6089, rid=d0c90fdf-d101-457b-baf9-ea0371637a1d, tid=1566219725331-0-1, toid=null, hid=localhost, nid=DefaultNode, raddr=127.0.0.1, I=FocusType:00000000-0000-0000-0000-000000000002(user), T=PRV(oid=df2210ad-3eec-4f59-9b11-46479b9ebc7c, targetType={.../common/common-3}UserType, targetName=alice, relation={.../common/org-3}default), TO=null, D=[df2210ad-3eec-4f59-9b11-46479b9ebc7c:MODIFY], ch=http://midpoint.evolveum.com/xml/ns/public/gui/channels-3#user, o=null, p=null, m=</pre>
</div>
</div>
<div class="paragraph">
<p>This is a semi-structured message that provides summary of significant fields of the audit record.
Detailed audit logging can also be enabled.
In that case the deltas will be dumped in the log files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_clockwork_and_projector">Troubleshooting Clockwork and Projector</h3>
<div class="paragraph">
<p>MidPoint has many components that have diverse responsibilities.
However, there is one set of components that can be described as a heart (or rather a brain) of midPoint.
It is the set of components known as "lens".
Clockwork and Projector are two most prominent classes in that set.
<em>Projector</em> is responsible for computing the values, running the mappings, processing assignment and almost anything else related to the computation of identity data.
<em>Clockwork</em> is responsible for controlling the process.
It invokes Projector as many times as is needed to complete the computation.
Clockwork also invokes <code>ChangeExecutor</code> to carry out the changes.</p>
</div>
<div class="paragraph">
<p>The overall request processing in midPoint works like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>User clicks on <b class="button">Save</b> button in midPoint user interface.
User interface code computes what operation needs to be done.</p>
</li>
<li>
<p>Operation on <code>ModelService</code> is invoked.
This is usually <code>executeChanges(&#8230;&#8203;)</code> operation.
Deltas that describe requested changes are passed as a parameter of this operation.</p>
</li>
<li>
<p>The operation is passed to <code>Clockwork</code> to control the operation.</p>
</li>
<li>
<p><code>Projector</code> is invoked to compute all the changes.
The changes are recorded in <em>model context</em>.
The changes are computed, but not executed yet.
Mappings and expressions are evaluated at this point.</p>
</li>
<li>
<p><code>Clockwork</code> figures out what to do with the operation.
There may be a need to drive the operation through approval process.
Special hooks may need to be invoked.
Maybe the operation violates the policy rules therefore it needs to be stopped.
<code>Clockwork</code> does what needs to be done.</p>
</li>
<li>
<p><code>ChangeExecutor</code> is invoked to carry out the changes.
Changes to users, roles and other focal objects are carried out by changing the data in midPoint repository.
That is quite straightforward.
However, changes to <em>projections</em> (objects that reside in resources) are much more complicated.</p>
</li>
<li>
<p><code>Provisioning</code> service is invoked to carry out changes to <em>projections</em>.
The changes are expressed as changes to shadow objects (<code>ShadowType</code>).
Some of those changes are recorded in midPoint database, such as changes in identifier or metadata.
However, most of the changes need to be carried out on a resource by using a connector.</p>
</li>
<li>
<p>Connector framework (ConnId) is invoked to initiate resource operation by using appropriate connector.</p>
</li>
<li>
<p>Connector is invoked.
Connector initiates the operation on resources and gets the results.</p>
</li>
<li>
<p>Operation results get back to <code>ChangeExecutor</code> and then to <code>Clockwork</code>.
Results are summarized.
If there is an error it is decided whether to continue or whether to stop the operation.
At the end <code>Clockwork</code> records the final audit record and returns control back to the caller.
Operation is finished.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Sometimes it is not possible to compute everything in a single pass.
There may be dependencies between resources, result of one operation may be an input to another operation.
For that reason clockwork and projector work in <em>waves</em>.
Therefore, several steps described above may be repeated in each wave.
Clockwork and projector exchange control in each wave until the operation is done.</p>
</div>
<div class="paragraph">
<p>Following picture provides a structural view of this setup.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/90-02-lens-provisioning-structure.png" alt="Model and provisioning structure">
</div>
</div>
<div class="paragraph">
<p>This process is moving around a lot of data.
Those data are recorded in <em>model context</em>.
It is a data structure that describes the operations, it holds all related objects, intermediary computation results and all other important data.
This data structure is absolutely crucial for the entire process.
It also provides valuable troubleshooting information.
When appropriate log packages and levels are enabled, the model context is dumped to log files at important moments during the computation.
Often the best way how to find a problem is to watch how the model contest changes during the computation.</p>
</div>
<div class="paragraph">
<p>The model context is putting together the <em>focus</em> and <em>projections</em> that belong together.
Focus is usually a user, projections are accounts.
In such case, the model context groups together a user with all the accounts are associated with that accounts.
These are usually accounts that are linked to the user, new accounts that were not yet created, or old accounts that were recently deleted.
MidPoint groups all these objects together to allow efficient computation of assignments and mappings and other policies.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/90-03-model-context.png" alt="Model context">
</div>
</div>
<div class="paragraph">
<p>Model Context has three parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>context</strong> itself contains information about the entire computation (such as computation state and wave number).</p>
</li>
<li>
<p><strong>Focus</strong> part which contains information about focal object.
There is at most one focus.</p>
</li>
<li>
<p><strong>Projection</strong> part which contains information about each projection.
There may be multiple projections.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Focus and projection parts have similar structure.
Both of these parts contain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Old object:</strong> the object (focus or projection) as it was before the computation.
This means really the beginning of computation.
Please note that the computation can take several days e.g. if the request waits for approval.</p>
</li>
<li>
<p><strong>Current object:</strong> the object as it was last time the Projector loaded the object.
This is usually quite recent information (at most few seconds old).</p>
</li>
<li>
<p><strong>New object:</strong> the expected form of new object after the computation.
This item is here mostly for informational purposes and for diagnostics.
The actual value of the result may be slightly different (e.g. if two operations are carried out over the same object in parallel).</p>
</li>
<li>
<p><strong>Primary delta:</strong> The request delta.
This is the delta that was explicitly entered in the GUI, supplied to the web service or otherwise specified in IDM Model Interface invocation.
This is the "command" that midPoint should execute.
This defines what user wants.
This delta will be executed exactly as it was specified.</p>
</li>
<li>
<p><strong>Secondary delta:</strong> The computed delta.
Secondary delta originates from execution of mappings or hooks or other automated mechanisms.
This describes what midPoint has computed.
This delta will be executed, but it can be recomputed several times during the process.</p>
</li>
<li>
<p><strong>Synchronization delta:</strong> The detected delta.
The delta that was detected by synchronization.
MidPoint assumes that this delta was already executed and all it can do is to react to this.
It is used as an input to the computation.
This delta will not be executed again.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This description is slightly simplified, the real thing is a bit more complex.
However, this description should be sufficient to understand the overall process.</p>
</div>
<div class="paragraph">
<p>Model context is dumped at strategic places during clockwork and projector computation.
The dumps look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>---[ PROJECTOR (INITIAL) context projection values and credentials of resource:10000000-0000-0000-0000-000000000204(Dummy Resource Blue)(default) ]--------------------------------
LensContext: state=INITIAL, Wave(e=0,p=0,max=0), focus, 1 projections, 2 changes, fresh=true
  Channel: null
  Options: null
  Settings: assignments=FULL
  FOCUS:
    User, oid=c0c010c0-d34d-b33f-f00d-111111111116, syncIntent=null
      User old:
        user: (c0c010c0-d34d-b33f-f00d-111111111116, v5, UserType) name: guybrush .....</code></pre>
</div>
</div>
<div class="paragraph">
<p>Those dumps provide crucial information for troubleshooting.
Their importance for diagnosing really hard problems cannot be overstated.
It is more than recommended to get used to read and follow those dumps through the computation process.
It will save a huge amount of time.</p>
</div>
<div class="paragraph">
<p>Why is it so important to know all of this?
You need to know this to find your way through this labyrinth.
MidPoint provides quite a lot of diagnostic data for each step and each sub-step of each step.
You can try to enable full logging to get all the details.
In that case you get a digital equivalent of a flash flood, and you are very likely to get drowned.
The information that you are looking for will be almost certainly there, but it will be lost among all the innocent-looking data.
This is a good way to spend a lot of time and lose your sanity in the process.
It is not an efficient debugging method.</p>
</div>
<div class="paragraph">
<p>The efficient debugging method is to proceed in steps.
Start with high-level information.
Then focus your eyes a bit deeper.
Try to figure out which steps of the processing are working well and which steps are wrong.
Then have a closer look at those steps by enabling more detailed logging.
The look deeper and deeper until the problem is found.</p>
</div>
<div class="paragraph">
<p>The process usually goes like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Have a look at input and output of the operation as a whole.
There are several ways to do that.
You can use "preview" operation of user interface to see the input.
You can examine the operation result in the user interface to see the outcome of the operation, or you may have a look at the audit trail.
Enabling auditing to a log files may also help.</p>
</li>
<li>
<p>Have a look at clockwork.
Clockwork can provide a summary of the operation when <code>DEBUG</code> log level on <code>com.evolveum.midpoint.model.impl.lens.Clockwork</code> package is enabled.
The summary is an important branch in the troubleshooting process.
The summary may suggest whether the problem with the operation is in the computation (Projector) or whether it is in the connectors and resources (Provisioning).</p>
</li>
<li>
<p>Have a detailed look at the Clockwork process.
Clockwork summary provides only a brief summary in a very compact form.
That information may not be detailed enough to figure out what is going on.
Therefore, you may need to go deeper.
Enabling <code>TRACE</code> log level on Clockwork provides detailed data about all the stages of clockwork processing.
Model context is dumped in each step.
It is this dump of model context that provides valuable troubleshooting data.
Have a look at those dumps and try to figure out where exactly the operation goes wrong.
After that you should be able to decide whether the problem is in computation (Projector) or execution (Provisioning).</p>
</li>
<li>
<p>In case you suspect provisioning issues but you are not sure, it may be helpful to have a detailed look at <code>ChangeExecutor</code>.
This component is responsible to carry out all the changes from Projector and Clockwork.
Enabling <code>DEBUG</code> or <code>TRACE</code> logging on <code>com.evolveum.midpoint.model.impl.lens.ChangeExecutor</code> provides details about each operation and its outcome.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Overall, clockwork summary is a good starting point.
The summary looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>###[ CLOCKWORK SUMMARY ]######################################
Triggered by focus primary delta ObjectDelta(UserType:c0c010c0-d34d-b33f-f00d-111111111111,MODIFY: PropertyDelta( / {.../common/common-3}organizationalUnit, REPLACE), PropertyDelta(metadata / {.../common/common-3}modifyTimestamp, REPLACE))
Focus: focus(user:c0c010c0-d34d-b33f-f00d-111111111111(jack))
Projections (1): account(ID {.../connector/icf-1/resource-schema-3}uid = [ jack ], type 'default', resource:10000000-0000-0000-0000-000000000104(Dummy Resource Red)): KEEP
Executed:
 ObjectDelta(UserType:c0c010c0-d34d-b33f-f00d-111111111111,MODIFY: PropertyDelta( / {.../common/common-3}organizationalUnit, REPLACE), PropertyDelta(metadata / {.../common/common-3}modifyTimestamp, REPLACE)): SUCCESS
 ObjectDelta(ShadowType:a3ebbe89-227b-42ff-9d00-f42bee3cf151,MODIFY: PropertyDelta(attributes / {.../resource/instance-3}ship, REPLACE), PropertyDelta(metadata / {.../common/common-3}modifyTimestamp, REPLACE)): SUCCESS
##############################################################</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point you should know the rough outline of the problem. At the very least you should know whether the problem is in:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Projector:</strong> the problem is that midPoint does not compute the values correctly.</p>
</li>
<li>
<p><strong>Provisioning:</strong> the values are computed correctly, but there is a problem when midPoint tries to execute the operation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the problem is in the computation, then you need to have a closer look at Projector.
The first step should be to enable <code>DEBUG</code> logging of <code>com.evolveum.midpoint.model.impl.lens.projector.Projector</code>.
The output of this logging is similar to the output of Clockwork trace.
Each step of Projector computation is recorded and model context is dumped.
Watch the changes in model context closely and try to figure out where wrong results occur.
This is usually all that is needed to figure out the nature of the problem.
The problem is often in the mappings.
In that case, follow the instructions in the next section to debug the mappings.
If you still cannot figure out what is going on there are still finer details that can be enabled.
The projector consists of many "processor" classes, such as <code>ActivationProcessor</code> or <code>AssignmentProcessor</code>.
Each of those are responsible for one part of the computation.
Enabling <code>TRACE</code> logging on them provides a very fine details about the computation.
Package names of those classes can be found in midPoint source code.
However, it is usually more convenient to enable <code>TRACE</code> logging on the entire <code>com.evolveum.midpoint.model.impl.lens</code> package at this point.
Doing so also shows all the names of all the "processors" that take place during the computation.
Those names can be used to focus the logging output only to specific parts of computation.</p>
</div>
<div class="paragraph">
<p>The things may get quite messy if the problem is in the execution of the operation.
There are many components to consider.
There is midPoint provisioning code, ConnId connector framework, connector and then the target system itself.
There is almost uncountable number of combinations, configurations, network conditions and other circumstances where things may go wrong.
The first step should be to figure out whether the problem is on midPoint side or on the resource side.
Once again the best strategy is to find a suitable point in the entire process and to check operation status here.
Connector framework is such a suitable point.
There is special logger that can be used to record summary of all the operations of connector framework: <code>org.identityconnectors.framework.spi.operations</code>.
Enabling <code>TRACE</code> logging on this logger will record all the operation requests and results that pass between ConnId framework and the connector.
Some connectors provide similar facility that can provide even more details.
For example, LDAP and AD connectors can log details of all LDAP operations by enabling <code>TRACE</code> logging on <code>com.evolveum.polygon.connector.ldap.OperationLog</code>.
This method is usually preferable as it can clearly indicate whether the problem is caused by wrong operation request or whether the problem occurs on the LDAP or AD server.
If case that the problem is in the connector or somewhere on the resource side there is a separate troubleshooting guide below.
In case that the problem is in midPoint, then the best strategy would be to enable logging of midPoint provisioning components: <code>com.evolveum.midpoint.provisioning</code>.
Setting the logging to <code>DEBUG</code> level should provide enough information to locate the problem.
Desperate engineers can try to use <code>TRACE</code> level here.
But in that case, it is perhaps a good idea to leave some provisioning classes to <code>DEBUG</code> level (such as <code>ResourceManager</code>) as they are usually too loud at <code>TRACE</code> level.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<em>Lens</em>, <em>Clockwork</em> and <em>Projector</em>.
Where do those names come from?
Naming is a notoriously hard thing.
Software engineers create things that are not alike anything in the real world.
Therefore, it is often very hard to find good names for components.
The recommended practice is to find appropriate metaphor for the system.
In other words: find something in the real world that something similar as you do.
When midPoint was young we were implementing a component that mapped user data to accounts.
However, this component was supposed to be generic.
It mapped user to accounts, but also role to entitlements, org to OUs and so on.
The obvious name "Mapper" was problematic, as we had a concept of "mapping" already.
Such name would be confusing.
Therefore, we have chosen a concept of <em>projecting</em> user data to accounts in the same way as movie is projected to a screen in a theater.
That was also a reason for "focus" and "projection" and to use name "lens" for the whole package.
Some time later we needed a name for a controller that will drive the projector.
We thought about a planetarium or a telescope driven by a clockwork mechanism.
MidPoint has evolved since then and those names may no longer be a perfect metaphor.
However, they are there, and we got used to them.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_mappings_and_expressions">Troubleshooting Mappings and Expressions</h3>
<div class="paragraph">
<p>Mappings and expressions often contain custom scripting code.
This ability makes midPoint very flexible, satisfying diverse requirements.
Yet, it also means that mappings and expressions are often the source of problems.
Creating, testing and maintaining the expressions would be almost impossible without any debugging and troubleshooting facilities.</p>
</div>
<div class="paragraph">
<p>MidPoint contains code that can be used to trace execution of mappings and expressions on a very detailed level.
The trace shows inputs and outputs and deltas that are taken into consideration when the expression or mapping is evaluated.
There are two options to enable this tracing.</p>
</div>
<div class="paragraph">
<p>First option is to enable the tracing globally for all expressions and mappings by setting one or more of the following loggers to <code>TRACE</code> level:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Package name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Verbosity</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mappings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model.common.mapping.Mapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code that is processing mappings.</p>
<p class="tableblock">Enabling logging will provide a short overview of mapping inputs and outputs with some insights into the inner processing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expressions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model.common.expression.Expression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expression evaluation code.</p>
<p class="tableblock">Enabling logging will provide a lot of details about expression evaluation.
This is likely to produce a log of data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script expressions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.evolveum.midpoint.model.common.expression.script.ScriptExpression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logs a lot of details about script expression evaluation (Groovy, JavaScript, &#8230;&#8203;).</p>
<p class="tableblock">Provides a lot of details.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Very high</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Setting logger levels to <code>TRACE</code> logs all execution of mappings and expressions.
However, this may be a huge amount of information, especially in complex deployments with many mappings and expressions.
Therefore, there is an alternative way that can be used to trace mappings and expressions individually.
There is a special-purpose <code>trace</code> property in the mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mapping&gt;</span>
      ...
      <span class="tag">&lt;trace&gt;</span>true<span class="tag">&lt;/trace&gt;</span>
      ...
<span class="tag">&lt;/mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a similar property in expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mapping&gt;</span>
      ...
      <span class="tag">&lt;expression&gt;</span>
          <span class="tag">&lt;trace&gt;</span>true<span class="tag">&lt;/trace&gt;</span>
          ...
      <span class="tag">&lt;/expression&gt;</span>
      ...
<span class="tag">&lt;/mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a nice method to look at one particular troublesome mapping without flooding the log files with traces of all the mappings in the system.
However, it still may not be entirely easy to locate the dump of the mapping in the log files.
Therefore, it is a good practice to name your mappings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mapping&gt;</span>
      <span class="tag">&lt;name&gt;</span>my-pretty-mapping<span class="tag">&lt;/name&gt;</span>
      ...
<span class="tag">&lt;/mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mapping name is recorded in the mapping and expression dumps, therefore it can be easily located in the log files.
Mapping names are also used in error messages, and they are likely to be used in diagnostic outputs that will be developed in midPoint in the future.
Therefore, it is a very good practice to put names to mappings.</p>
</div>
<div class="paragraph">
<p>Dumping a mapping or expression provides overview of inputs and outputs.
However, that alone may not be enough to figure out what is wrong inside the expression.
Therefore, script expressions can explicitly invoke a logging facility.
MidPoint has script expression functions that can be used to log messages from the scripting code.
It works like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mapping&gt;</span>
      ...
      <span class="tag">&lt;expression&gt;</span>
          <span class="tag">&lt;script&gt;</span>
<span class="inline">              <span class="tag">&lt;code&gt;</span>
                  ...
                  log.error('The {} is broken, {} is to blame', thing, reason)
                  ...
              <span class="tag">&lt;/code&gt;</span></span>
          <span class="tag">&lt;/script&gt;</span>
      <span class="tag">&lt;/expression&gt;</span>
      ...
<span class="tag">&lt;/mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Such messages are recorded in the system log using special-purpose logger <code>com.evolveum.midpoint.expression</code> and the appropriate level.
The message itself is composed of several parts using <code>{}</code> placeholders.</p>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_connectors">Troubleshooting Connectors</h3>
<div class="paragraph">
<p>MidPoint is using the <em>ConnId identity connector framework</em> to manage identity connectors.
All ordinary connectors are running under the control of this framework.
It means that midPoint calls the ConnId framework and the framework calls the connector.
Therefore, when it comes to troubleshooting connector problems there are several places where a problem can occur and also several places where you can get diagnostic data:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>MidPoint:</strong> midPoint may invoke wrong operation at the first place.
This may be caused by a misconfiguration or a bug.
We have already covered most of those cases.</p>
</li>
<li>
<p><strong>ConnId:</strong> the framework may misinterpret the operation.
The framework also simulates some operations, and it may post-process the results.</p>
</li>
<li>
<p><strong>Connector:</strong> this is the tricky part of the story.
Each connector is different.
Very different.
Yet, there are ways.
More on this below.</p>
</li>
<li>
<p><strong>Resource:</strong> it is possible that the problem is caused by resource misconfiguration.
E.g. the connector is not allowed to see all data, there are some limits, etc.
We will not go into details here.
See the documentation that goes with the resource for troubleshooting details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The ConnId connector framework stands between midPoint and the connectors.
It knows about every operation that midPoint invokes on every connector, and it knows about all the return values.
This can be easily enabled by using the following log configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>org.identityconnectors.framework.api.operations: TRACE
org.identityconnectors.framework.spi.operations: TRACE
org.identityconnectors.framework.common.objects.ResultsHandler: TRACE</pre>
</div>
</div>
<div class="paragraph">
<p>The ConnId operation traces look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>TRACE (org.identityconnectors.framework.api.operations.SearchApiOp): method: search msg:Enter: search(ObjectClass: inetOrgPerson, null, com.evolveum.midpoint.provisioning.ucf.impl.ConnectorInstanceIcfImpl$2@643dc940, OperationOptions: {ALLOW_PARTIAL_ATTRIBUTE_VALUES:true,PAGED_RESULTS_OFFSET:1,PAGE_SIZE:20})
...
TRACE (org.identityconnectors.framework.api.operations.SearchApiOp): method: search msg:Return: org.identityconnectors.framework.common.objects.SearchResult@a90221a</pre>
</div>
</div>
<div class="paragraph">
<p>This is a very useful mechanism.
It logs every operation of every connector.
If you suspect that the connector is not executing the right operation, this is the right place to check it.
You can see the operation that midPoint is passing to the connector.
If that operation looks good, then the problem is most likely in the connector (see below).
If the operation does not make sense, then the problem is usually in the provisioning component of midPoint (see above).</p>
</div>
<div class="paragraph">
<p>However, the operation is logged by the ConnId framework on relatively high level and the operation is still quite abstract.
If you need more details about what really gets executed you have to rely on the connector logging.</p>
</div>
<div class="paragraph">
<p>Please note that the ConnId framework has two "faces": API and SPI. The API is facing midPoint.
MidPoint invokes ConnId API operations.
The SPI is facing the connector.
Connector implements SPI operations, and ConnId framework is invoking them.
You can see the distinction in the class names that are written in the logfiles, e.g. <code>SearchApiOp</code> vs <code>SearchOp</code> (if there is no <code>Api</code> or <code>Spi</code> in the operation name then it is assumed to be SPI).
There is also similar distinction in the package name of the logger.
Most API and SPI operations are direct equivalents, but there may be subtle differences.
E.g. the <em>get</em> API operation is executed as <em>search</em> (<code>executeQuery</code>) SPI operation.</p>
</div>
<div class="paragraph">
<p>Most connector operations are "pure" request-response operations: there is one request and one response.
These are operations such as create, modify, delete.
In this case you will see one request in the log files and one response.
That is the whole operation.
Like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2017-02-01 10:44:16,622 [main] TRACE (o.i.framework.api.operations.CreateApiOp): method: create msg:Enter: create(ObjectClass: inetOrgPerson, [Attribute: {Name=uid, Value=[will]}, Attribute: {Name=__NAME__, Value=[uid=will,ou=People,dc=example,dc=com]}, Attribute: {Name=cn, Value=[Will Turner]}, Attribute: {Name=sn, Value=[Turner]}, Attribute: {Name=givenName, Value=[Will]}], OperationOptions: {})
2017-02-01 10:44:16,623 [main] TRACE (o.i.framework.spi.operations.CreateOp): method: create msg:Enter: create(ObjectClass: inetOrgPerson, [Attribute: {Name=uid, Value=[will]}, Attribute: {Name=__NAME__, Value=[uid=will,ou=People,dc=example,dc=com]}, Attribute: {Name=cn, Value=[Will Turner]}, Attribute: {Name=sn, Value=[Turner]}, Attribute: {Name=givenName, Value=[Will]}], OperationOptions: {})
...
2017-02-01 10:44:16,641 [main] TRACE (o.i.framework.spi.operations.CreateOp): method: create msg:Return: Attribute: {Name=__UID__, Value=[675f7e48-c0ee-4eaf-9273-39e67df4cd2c]}
2017-02-01 10:44:16,641 [main] TRACE (o.i.framework.api.operations.CreateApiOp): method: create msg:Return: Attribute: {Name=__UID__, Value=[675f7e48-c0ee-4eaf-9273-39e67df4cd2c]}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example illustrates a very common <code>create</code> operation.
It should be interpreted like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>&#8230;&#8203;api.operations.CreateApiOp Enter</code>: MidPoint invokes ConnId API.
The object to create is logged as an operation parameter.
This is what midPoint sends.</p>
</li>
<li>
<p><code>&#8230;&#8203;spi.operations.CreateOp Enter</code>: ConnId invokes the connector.
This is what the connector receives.</p>
</li>
<li>
<p>Connector executes the operation.
Logs from the connector are here (if connector logging is enabled).</p>
</li>
<li>
<p><code>&#8230;&#8203;spi.operations.CreateOp Return</code>: Connector operation is finished.
The connector returns the result to ConnId.</p>
</li>
<li>
<p><code>&#8230;&#8203;api.operations.CreateApiOp Return</code>: Operation is finished and post-processed by the framework.
Framework returns the result to midPoint.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is quite straightforward, and it applies to the vast majority of connector operations.
However, there are some peculiarities.
For example, there are four <em>update</em> operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>update(&#8230;&#8203;)</code> in <code>UpdateOp</code>: This replaces attribute values.
It is (roughly) an equivalent to midPoint modify/replace deltas.</p>
</li>
<li>
<p><code>addAttributeValues(&#8230;&#8203;)</code> and <code>removeAttributeValues(&#8230;&#8203;)</code> in <code>UpdateAttributeValuesOp</code>.
This adds or deletes attribute values.
It is (roughly) an equivalent to midPoint modify/add and modify/delete deltas.</p>
</li>
<li>
<p><code>updateDelta(&#8230;&#8203;)</code> in <code>UpdateDeltaOp</code>: This operation allows complex combinations of add, delete and replace values.
This is a new operation designed to replace older operations above.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>New connectors implement <code>updateDelta(&#8230;&#8203;) </code>operation only.
Other update operations are considered to be obsolete.
However, they are still used by many connectors.</p>
</div>
<div class="paragraph">
<p><em>Search</em> operations are also a bit strange.
First of all, the SPI provides only one operation for all search and get operation and that operation is <code>executeQuery(&#8230;&#8203;)</code>.
Then the results of each object found by the search operations is passed back to midPoint by using a callback method: <code>handle(&#8230;&#8203;)</code>.
Therefore, interpreting search operations takes a keen eye and a bit of practice.</p>
</div>
<div class="paragraph">
<p>ConnId framework logs should indicate whether the problem is on the "connector-side".
Which means that the problem is either in the connector or that the resource itself is not behaving according to expectations.
The next step should be to have a look inside the connector.
However, each connector is different.
The connectors have to adapt to the resource communication protocol, and therefore they are expected to use variety of client and protocol libraries.
Each library may have its own method of troubleshooting.
Therefore, there is no universal way to troubleshoot a connector.
However, there is (almost) always some way.
Connector documentation should provide some details about troubleshooting.
Unfortunately, most connectors do not provide troubleshooting details.
The best way is to have a look at connector source code.
Enabling logging by using the connector package name is usually quite a safe bet.
The logger name is usually the same as the package name of the connector classes.
Look in the documentation or directly inside the connector JAR file to find out the package name.
You may also need to enable logging of the libraries that come with the connector.
You can examine these if you look in the <code>lib</code> directory inside the connector JAR file.</p>
</div>
<div class="paragraph">
<p>Some connectors have really good logging, such as the connectors in the LDAP connector family.
The LDAP connector logs all the LDAP operations if you set the <code>com.evolveum.polygon.connector.ldap.OperationLog</code> logger to <code>DEBUG</code> level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>2016-08-30 17:14:20,043 [main] DEBUG [](c.evolveum.polygon.connector.ldap.OperationLog): method: null msg:ldap://localhost:10389/ Add REQ Entry:
Entry
    dn: uid=jack,ou=People,dc=example,dc=com
    objectClass: inetOrgPerson
    uid: jack
    userPassword: deadmentellnotales
    sn: Sparrow
    cn: Jack Sparrow
    description: Created by IDM
    givenName: Jack
    l: Black Pearl
    displayName: Jack Sparrow

2016-08-30 17:14:20,091 [main] DEBUG [](c.evolveum.polygon.connector.ldap.OperationLog): method: null msg:ldap://localhost:10389/ Add RES uid=jack,ou=People,dc=example,dc=com:         Ldap Result
            Result code : (SUCCESS) success
            Matched Dn : ''
            Diagnostic message : ''</code></pre>
</div>
</div>
<div class="paragraph">
<p>This logging can be used in two connectors that are used in the majority of midPoint deployments: LDAP connector and Active Directory connector.
This logging is much more natural and easier to understand than the ConnId framework logging.
Therefore, a look at this log should be the first thing to do when there are problems with LDAP and AD connectors.</p>
</div>
<div class="paragraph">
<p>However, not all connectors are built with troubleshooting in mind.
Some connectors barely log anything at all.
This is all connector-dependent.
If the connector author did a good job you will get what you are looking for.
If the author did a poor job, you are mostly out of luck.
One way or another, this is the best chance to learn what the connector is doing.
If that fails, you have to resort to packet sniffer and similar tools.</p>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_authorizations">Troubleshooting Authorizations</h3>
<div class="paragraph">
<p>MidPoint authorizations provide a very powerful mechanism for a fine-grained access control.
This mechanism is quite simple in principle.
However, the configuration can get very complex especially if a sophisticated RBAC structure is in place.
Setting the authorization up is not entirely easy task.
It is often quite difficult to tell why the user is not authorized for a specific action or why the user can access more than he is supposed to.
Therefore, this page describes basic mechanisms how to troubleshoot authorizations.</p>
</div>
<div class="paragraph">
<p>The basic troubleshooting steps are simple in theory:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable logging of authorization processing.</p>
</li>
<li>
<p>Initiate midPoint operation to examine.</p>
</li>
<li>
<p>Look at the logs, figure out which authorization is wrong.</p>
</li>
<li>
<p>Fix it.</p>
</li>
<li>
<p>Rinse and repeat.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Yet, the practice is much more complex.
As always.</p>
</div>
<div class="paragraph">
<p>The authorizations are processed in midPoint <em>security</em> component.
The processing of every authorization is logged.
Therefore, to see the authorization processing trace simply enable the logging of security component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>com.evolveum.midpoint.security: TRACE</pre>
</div>
</div>
<div class="paragraph">
<p>However, please keep in mind that this is quite intense logging.
It can easily impact the system performance and flood the logs on a busy system with a lot of authorization.
It is better to troubleshoot the configuration in a development or testing environment.</p>
</div>
<div class="paragraph">
<p>When the security logging is enabled then you can see following messages in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2017-01-23 14:32:37,824 [main] TRACE (c.e.m.security.impl.SecurityEnforcerImpl): AUTZ: evaluating security constraints principal=MidPointPrincipal(user:c0c010c0-d34d-b33f-f00d-111111111111(jack), autz=[[http://midpoint.evolveum.com/xml/ns/public/security/authorization-model-3#read])]), object=user:c0c010c0-d34d-b33f-f00d-111111111111(jack)
2017-01-23 14:32:37,824 [main] TRACE (c.e.m.security.impl.SecurityEnforcerImpl): Evaluating authorization 'read-some-roles' in role:7b4a3880-e167-11e6-b38b-2b6a550a03e7(Read some roles)
....
2017-01-23 14:32:37,824 [main] DEBUG (c.evolveum.midpoint.security.api.SecurityUtil): Denied access to user:c0c010c0-d34d-b33f-f00d-111111111111(null) by jack because the subject has not access to any item</pre>
</div>
</div>
<div class="paragraph">
<p>There is a set of similar messages for every operation that midPoint attempts.
First message describes the operations and its "context": who has executed it (principal), what was the object and target of the operation (if applicable).
The last line usually summarizes the decision: allow or deny.
The lines between describe the processing of each individual authorization statement.
If you examine that part carefully, then you can figure out which authorizations were used.
The result of authorization evaluation can be one of these:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authorization <strong>denies</strong> the operation.
That&#8217;s a dead end.
If any authorization denies the operation then the operation is denied.
No other authorizations need to be evaluated.</p>
</li>
<li>
<p>Authorization <strong>allows</strong> the operation.
That&#8217;s a green light.
However, other authorizations are still evaluated to make sure that there is no other authorization that denies the operation.</p>
</li>
<li>
<p>Authorization is <strong>not applicable</strong>.
The authorization does not match the constraint for object or target, or it is not applicable for other reasons.
Such authorization is skipped.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If there is a single <em>deny</em> then the evaluation is done.
The operation is denied.
<em>Deny</em> is also a default decision.
I.e. if there is no decision at the end of the evaluation, then the operation is denied.
At least one explicit <em>allow</em> is needed to allow the operation.</p>
</div>
<div class="paragraph">
<p>All authorization processing is recorded in the log.
There is a record of processing of every operation, every authorization, evaluation of every authorization clause, whether the authorization is applicable or not, whether it denies or allows the operation.</p>
</div>
<div class="paragraph">
<p>Authorization of operations such as <em>add</em> or <em>delete</em> is quite easy.
The result is simple: the operation is either allowed or denied.
However, it is a bit different for <em>get</em> operations.
The entire <em>get</em> operation can still be denied if the user does not have any access to the object that he is trying to retrieve.
However, the common case is that the user has some access to the object, but not to all the items (properties).
In such a case the operation must be <em>allowed</em>.
However, the retrieved object needs to be post-processed to remove the fields that are not accessible to the user.
This is done in two steps.</p>
</div>
<div class="paragraph">
<p>Firstly, the set of <em>object security constraints</em> is compiled from the authorizations.
The <em>object security constraints</em> is a data structure that describes which properties of an object are accessible to the user.
There is a map (<code>itemConstraintMap</code>) with an entry for every item (property) which is explicitly mentioned in the authorizations.
This entry contains explicit decisions given by the authorizations for every basic access operation (read, add, modify, delete).
Then there are default decisions (<code>actionDecisionMap</code>).
These decisions are applied if there is no explicit entry for the item.
This <em>object security constraints</em> data structure is logged when it is compiled.</p>
</div>
<div class="paragraph">
<p>Secondly, the <em>object security constraints</em> are applied to the retrieved object.
The constraints are used to remove the properties that are not accessible to the user.
This process is not easy to follow in the logs.
Therefore, it is better to inspect the <em>object security constraints</em> structure.
If it is correct then also the resulting object will be most likely correct.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Object security constraints and the user interface.</div>
The <em>object security constraints</em> has much broader application than just authorization of the read operations.
This data structure is (indirectly) used by midPoint user interface when displaying edit forms for objects.
The data from this structure are used to figure out which fields are displayed as read-write, which fields are read only and which fields are not displayed at all.
The <em>object security constraints</em> structure is always produced by the same algorithm in the security component.
Therefore, the interaction of authorizations and GUI forms can be diagnosed in the same way as the <em>get</em> operations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Search operations are very different from common operations such as <em>add</em> or <em>delete</em> and they are also different from <em>get</em> operations.
Search operations does <strong>not</strong> result in an access denied error (except for few special cases).
If the user that is searching has access only to some objects, then only those objects are returned.
There is no error, because this is a perfectly normal situation.
The extreme case is that user has access to no object at all.
Even though this situation is not entirely "normal", it is also not in any way special.
The search simply returns empty result set and no error is indicated.
You need to keep this in mind when troubleshooting the <em>read</em> authorizations.
Attempt to <em>get</em> inaccessible object results in a security violation error.
However, <em>searching</em> for them simply returns empty result set and there is no error.</p>
</div>
<div class="paragraph">
<p>The <em>search</em> operations are interesting for another reason.
Operations such as <em>get</em>, <em>add</em> or <em>delete</em> have precise specification of object: the object that is being retrieved, added or modified.
However, it is entirely different for <em>search</em> operations.
The <em>object</em> is a result of the search operation, not the parameter.
We cannot examine the <em>object</em> before the search and decide whether we allow or deny the operation.
There is no <em>object</em> before search operation.
Also, we cannot simply search all objects and then filter out those that are denied.
That would be totally inefficient, and it will completely ruin paging mechanisms.
A completely different strategy is needed for search operations.</p>
</div>
<div class="paragraph">
<p>Search authorizations work the other way around: at first, the authorizations statements are compiled to a <em>search filter</em>.
For example, if the authorization allows access only to active roles the authorization is compiled to a filter <code>activation/effectiveStatus = "enabled"</code>.
Then this filter is appended to the normal search filter and the search operation is performed.
This approach ensures that the search returns only the objects that the user is authorized to see.
It also makes the search as efficient as possible and maintains page boundaries.
In addition to that, another round of post-processing is needed to filter out the <em>items</em> that are not visible to the user.
This is the same filter as is applied to <em>get</em> operations.</p>
</div>
<div class="paragraph">
<p>Finally, there is a couple of things to keep in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The authorizations are designed to be <strong>additive</strong>.
Each role should allow the minimum set of operations needed for the users to complete their job.
MidPoint "merges" all the authorizations from all the roles.
Use <em>allow</em> operations, avoid <em>deny</em> operations if possible.
It is much better <em>not to allow</em> an operation than to <em>deny</em> it.</p>
</li>
<li>
<p><strong>Deny always wins.</strong>
If there is a single <em>deny</em> in any applicable authorization in any roles, then the operation is denied.
It does not matter if there are thousands of <em>allow</em> authorizations, <em>deny</em> always wins.
What was once denied cannot be allowed again.
We need this approach because we do not have any way to order the authorization in many roles.
Do not use <em>deny</em> unless really needed.</p>
</li>
<li>
<p>There are two phases: <strong>request and execution</strong>.
The operation needs to be allowed in both phases to proceed.
Please keep in mind that object may be changed between request and execution due to mappings, metadata and properties that are maintained by midPoint.
This is also the reason why we have separate authorizations for request and execution.</p>
</li>
<li>
<p><strong>Name</strong> the authorizations.
Each authorization statement can have an optional name.
Specify a reasonably unique name there.
Then use that name as a string to find the appropriate trace in the log files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Authorization traces are quite verbose and there is quite a lot of them.
Many traces need to be examined to figure out what exactly is going on.
Troubleshooting is a hard work in general, troubleshooting of authorizations is even harder.
This mechanism of recording authorization processing in the log is the best way that we have figured out to troubleshoot the authorizations.
We know that it is not ideal, yet it is the best we have.
If you have any better idea we are more than open to suggestions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reporting_a_bug">Reporting a Bug</h3>
<div class="paragraph">
<p>MidPoint is perfect.
There are no bugs.
Therefore, you can skip this section entirely.</p>
</div>
<div class="paragraph">
<p>No, that is not really the case.
MidPoint is a real software deployed in a real world.
While we spend a huge amount of time and effort to maintain midPoint, test it and fix the bugs, the bugs have ways to always get in.
This is also given by the very nature of midPoint.
MidPoint is flexible and comprehensive.
It is nearly impossible to test midPoint for all the conceivable configurations and use cases.
Whenever you deploy midPoint, there is a chance that some parts of your configuration or usage patterns are unique to your deployment.
Those parts might not be used by anybody else yet.
Therefore, there may be bugs that nobody ever experienced yet.
That is the fate of all flexible software products that live in the real world.</p>
</div>
<div class="paragraph">
<p>In case that you find a bug which needs to be fixed you have several options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Fix the bug yourself.</strong> MidPoint is an open source product.
We will gladly accept bugfixes.
However, midPoint is also a substantial product and we need to keep it maintainable and secure.
Therefore, all contributions including the bug fixes have to be reviewed.
The fixes need to be good enough to be accepted.
Writing an automated test for the bug is usually required as part of the bugfix contribution.</p>
</li>
<li>
<p><strong>Report the bug and wait.</strong> The bug will be fixed by someone, eventually.
However, there is no telling how long you will need to wait.
If it is a security-related bug, then it will be fixed as soon as possible.
If the bug is severe and it affects a lot of users, then it is likely to be fixed relatively soon.
However, such bugs are very rare.
It is likely that your bug is quite exotic, and it can only be reproduced in your deployment.
In that case, it is almost certain that you will need to wait for a very long time.
Several years may pass before someone finds the time to have a look at your problem.
Those issues are known as <em>community issues</em>, and they are usually seen at the very tail of developer’s work queues.
Except for one case: security issues.
Security issues are always prioritized regardless of who the reporter is.</p>
</li>
<li>
<p><strong>Purchase midPoint support from Evolveum.</strong> This dramatically increases the priority of your bug reports.
Software development cannot be easily predicted, therefore we still cannot guarantee precise time period to fix the bug.
However, typical fix time will be counted in days, weeks or in very rare and complicated cases in months.
Those issues are known as <em>subscriber issues</em>, and they are always prioritized over community issues.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In any of those cases, there is a recommended procedure for bug diagnostics and reporting.
There are bug reporting standards that apply to anybody, even midPoint subscribers.
Evolveum provides 3<sup>rd</sup>-line support only.
This means that it is expected that the issues has already passed through 1<sup>st</sup> and 2<sup>nd</sup> lines of support.
The bug report should be really a report of midPoint bug, it should not be a configuration issue.
Proper diagnostics techniques should be employed to investigate the issue before it is reported.
The rest of this section will describe the recommended procedure.</p>
</div>
<div class="paragraph">
<p><strong>Diagnostics</strong> is the first step that is absolutely mandatory.
Troubleshooting techniques described in this chapter should be used to find out what is going on.
MidPoint is a very flexible product and the vast majority of midPoint issues are caused by wrong configuration.
Therefore, please make sure that your problem is not one of those.
Simple mis-configuration may easily look like a bug.
Try to go through midPoint documentation and understand how midPoint works.
Re-read relevant parts of this book.
MidPoint development team invests a huge amount of time and effort to make the error messages and log entries are understandable.
Therefore, please make sure you use those facilities.
Please follow the troubleshooting guides above.
They are usually very helpful.</p>
</div>
<div class="paragraph">
<p><strong>Reproducing the problem</strong> is a second step.
The easiest way for us to fix a problem is being able to reproduce it.
In such case, we do not just blindly fix the problem, but we can also make sure it is really gone.
In most cases we create a test case in our automated test suite to make sure the problem is gone and it will not appear again.
Therefore, your best strategy to make sure that the problem is fixed quickly and does not appear again is to show us how to reproduce the problem in our environment.
Saying that "this and that does not work" usually does not help, as the same use case may work perfectly in other configurations.
Please describe your configuration in the report.</p>
</div>
<div class="paragraph">
<p>Try to figure out what is the minimal configuration necessary to reproduce the problem.
We appreciate if you could reproduce the problem using our sample resources and objects with minimal customization.
This saves you a lot of time describing your environment to us, and it also saves us a lot of time to try to re-create your environment in our lab.
This approach also helps you to check your configuration and to make sure you are not reporting mis-configuration as a bug.</p>
</div>
<div class="paragraph">
<p>In a very rare cases the problem cannot be easily reproduced using samples or similar simple setup.
In that case we need to work with what we have.
Therefore, we either need to know quite a lot about your environment to be able to set it up in our lab.
If that fails, we may need access to your environment or your cooperation with diagnosing the problem.
In such case, please use your common sense in what comes into the bug report.
Please keep in mind that midPoint is open source project and the bug reports are public, therefore please be careful when providing sensitive information in bug reports.</p>
</div>
<div class="paragraph">
<p>When you are sure that the problem is not caused by mis-configuration, it is time to <strong>report the issue</strong>.
The best way to submit a bug report is to use Evolveum bug tracking system.
The registration is open to everyone.
This is also the only bug reporting method available for community issues.
Evolveum tracker allows you to track the progress of issue resolution, add additional information, etc.
Just please keep in mind that the tracker is public and open to anyone, following the spirit of open source.
Therefore, be careful about submitting sensitive information.</p>
</div>
<div class="paragraph">
<p>Please note that security issues revealing a potential security vulnerability should <strong>not</strong> be reported by using the tracker.
Information in the tracker is public and this may lead to unintentional disclosure of sensitive information.
Special e-mail address is provided for responsible disclosure of security-related issues:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>security@evolveum.com</pre>
</div>
</div>
<div class="paragraph">
<p>Typical bug report contains following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What operation have you tried or what do you want to achieve.
Some "bugs" may be caused by trying to achieve something using the wrong mechanism.
Having a broader perspective helps us to help you.</p>
</li>
<li>
<p>If there is a form or other input to the operation, then please describe how it was set up or filled in.
E.g. an XML snippet used to import, data entered into input field, request deltas retrieved from an audit log and so on.</p>
</li>
<li>
<p>What kind of resource definition was used, how it was modified, etc.
We need to know only the relevant parts.
We prefer if you reproduce the problem with the simplest configuration possible (see above).</p>
</li>
<li>
<p>Any other special configuration that you feel can influence the outcome, such as custom schema, strange things in expressions, etc.</p>
</li>
<li>
<p>If the operation produced an error message in GUI, include that error message as well.</p>
</li>
<li>
<p>If there is an exception in the log files, please make sure that you include full stack trace of the exception.
The exception stack trace is usually a very efficient pointer to likely cause of the problem.</p>
</li>
<li>
<p>Relevant part of the log files.
You may want to have a look at the list of useful loggers above to correctly set up your logging to get the most useful data in the logs.</p>
</li>
<li>
<p>Your environment: operating system, Java platform version, target system type and version.
You do not need to bother with this if the bug is obviously not environment-specific.</p>
</li>
<li>
<p>Indication of midPoint version (release) or git branch/revision that was used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not all of the above is required in a bug report.
Use your common sense.
As a rule of the thumb too much information is usually better than too little information.
However, sometimes too much non-relevant information may obscure the tiny problem that would be obvious if just the right amount of information is provided.</p>
</div>
</div>
<div class="sect2">
<h3 id="_useful_troubleshooting_tips">Useful Troubleshooting Tips</h3>
<div class="paragraph">
<p>Finally, there are some generic troubleshooting tips.
Those are not specific to midPoint and those tips should be a second nature to any experienced engineer.
Some of those were already covered.
However, it may still be useful to summarize.</p>
</div>
<div class="paragraph">
<p>First of all, try to keep your troubleshooting effort methodical and systematic.
It makes very little sense to just randomly poke around and hope that the bug shows its ugly head.
Even though such random methods may work occasionally, they often require a lot of effort in the end.
Try to follow a divide-and-conquer method.
Find a boundary in the middle of midPoint, e.g. Clockwork component.
Examination of clockwork traces will show you whether the problem is in the mappings or it is in the provisioning.
Is the problem in provisioning?
Then select another boundary.
LDAP connector operation traces may be a good bet in that case.
That shows you whether the problem is in midPoint or it is in the LDAP server.
Are operation parameters wrong?
It means that problem is in midPoint, somewhere between model and the connector.
Have a look at debug logs of provisioning component.
Maybe there is wrong object class in the resource definition.
Have a look at debug logs on the connector.
Maybe connector configuration is wrong?
The log files will guide you to the problem.</p>
</div>
<div class="paragraph">
<p>MidPoint log files may look like a maze.
However, it all makes sense.
MidPoint has good component structure and the log files reflect that.
You just need to understand how midPoint works, and you will not get lost.
Just make sure that you never forget to look at the log files.
Always look at the log files.
When it comes to troubleshooting logfiles are your best friends.</p>
</div>
<div class="paragraph">
<p>There is one troubleshooting method that is universally applicable to almost any problem.
The method involves some specialist equipment.
However, this method provides surprising, almost unbelievable results.
To make this method work you have to strictly follow those steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Describe your problem to a rubber duck.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Yes, a rubber duck.
That strange object that usually floats in bubble baths.
The duck is a good listener.
Therefore, just go ahead and describe you problem to the duck.
Step by step.
Talk about every detail that you have explored.
Every possible solution that you have tried.
Do not hurry.
The duck has unlimited patience.
You have to literally talk to the duck.
Doing it just in your head does not work.
Talk to the duck.
The duck will help.
It is a wise animal.</p>
</div>
<div class="paragraph">
<p>As ridiculous as this process might sound, it really works.
It does wonders.
It is known as <em>rubber duck debugging</em> method.
Of course, it does not have to be a rubber duck.
Any object will work as long as you really talk to it.
However, choosing an object with eyes make you feel less stupid while you talk to it.
Rubber duck is a popular choice.</p>
</div>
<div class="paragraph">
<p>That is it.
Troubleshooting is not an easy work to do.
Although it may sometime resemble witchcraft, it is in fact a science - and an art.
It needs some time to find your way.
However, it is a time well spent.
It will be repaid many times over.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="91-devel">12. MidPoint Development, Maintenance and Support</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Those who do nothing but observe from the shadows cannot complain about the brightness of the sun.
</blockquote>
<div class="attribution">
&#8212; Frank Herbert
</div>
</div>
<div class="paragraph">
<p>MidPoint is a <em>professional open source project</em>.
This means that midPoint is developed by using professional methods by professional developers, but the product is still available under open source license.</p>
</div>
<div class="sect2">
<h3 id="_professional_development">Professional Development</h3>
<div class="paragraph">
<p>MidPoint is developed by professional developers.
The development is lead by senior developers in the midPoint core team that have decades of software engineering experience.
There are also few younger developers in early stages of their careers.
MidPoint development team is first of all a community of developers that enjoy working together on a next-generation software.
Professionalism is a strict requirement for all midPoint development, but it is mostly the engineering passion that really moves the project forward.</p>
</div>
<div class="paragraph">
<p>All midPoint core developers work for Evolveum.
Evolveum is the company that created midPoint.
Evolveum also maintains midPoint.
Vast majority of work on midPoint is being done by midPoint core team.
All the core developers are paid fair wages for their work on midPoint.
Evolveum income from midPoint is necessary to make sure that the developers have all their time available for midPoint development.
This means that midPoint can be properly maintained.</p>
</div>
<div class="paragraph">
<p>Professional development also means that professional software engineering methods are used to develop and maintain midPoint.
MidPoint development is firmly founded on principles of continuous integrations.
There are literally thousands of automated integration tests that are part of midPoint build process.
Thousands of additional automated tests are running every day.
There are tests that closely reflect real-world configurations and use cases.
There are tests with real resources.
All of that is an integral part of midPoint development.
MidPoint is a comprehensive and very flexible system.
Professional quality assurance is essential for midPoint to work reliably.</p>
</div>
</div>
<div class="sect2">
<h3 id="_open_source">Open Source</h3>
<div class="paragraph">
<p>MidPoint is an <em>open source</em> project.
All of midPoint source code is available under two open source licenses.
We have chosen <em>Apache License 2.0</em> as this is one of the most liberal licenses out there.
We are also based in European Union and therefore midPoint is also under the terms of <em>European Union Public License (EUPL)</em>.
However, there is much more to open source than just a license.
Evolveum is fully committed to the open source approach.
MidPoint is completely developed in public.
Entire history of midPoint source code is public.
Every commit of every developer is immediately available to anyone.
Complete midPoint source code is available.
There are no private parts that are held back by purpose.
There are no private branches with extra features.
Even all the support branches are completely public.
When it comes to the source code midPoint is as true to the open source methods as it gets.</p>
</div>
<div class="paragraph">
<p>Even though vast majority of midPoint development is done by Evolveum, open source approach is absolutely critical for the success of midPoint.
Open source is the only way that allows midPoint users to understand midPoint completely.
All non-trivial software needs to be customized in some way and open source brings the ultimate power of customization.
Open source allows participation.
Open source is great approach to avoid vendor lock-in.
Open source brings longevity to the project.
Open source has so much advantages.
Evolveum is completely committed to the open source approach.</p>
</div>
<div class="paragraph">
<p>MidPoint has started as an open source project.
MidPoint source code was available from the day one.
And as far as we have something to say about it midPoint will remain open source forever.</p>
</div>
</div>
<div class="sect2">
<h3 id="_midpoint_release_cycle">MidPoint Release Cycle</h3>
<div class="paragraph">
<p>MidPoint has stable development cycle.
There is a <em>feature releases</em> every year.
As the name suggests, such releases are bringing new features and major improvements.</p>
</div>
<div class="paragraph">
<p>In addition to that, there are several <em>maintenance releases</em>.
Those releases bring bugfixes and minor improvements.
Maintenance releases are published as needed, there is no strict schedule.
Timing of maintenance releases is influenced by midPoint subscribers.</p>
</div>
<div class="paragraph">
<p>Every couple of years there is a special long-term support (LTS) release.
This release is supported for a longer time than usual.
This release is ideal for people who prefer stability over new features.</p>
</div>
</div>
<div class="sect2">
<h3 id="_midpoint_support_and_subscriptions">MidPoint Support and Subscriptions</h3>
<div class="paragraph">
<p>MidPoint support and subscription is a service provided by Evolveum.
There are several service offerings with different scope and service level.
But generally speaking, the most common service is 3<sup>rd</sup>-line support.
Which basically means that we will fix midPoint bugs.
Obviously, this includes assistance with diagnostics of difficult issues where it is not entirely clear whether it is a bug or configuration issue.
Simply speaking, midPoint support service is a way how to make sure that your midPoint deployment will run without any problems.
There are also subscription offerings designed to help you deploy midPoint in the first place.
Some subscription offerings also contain feature development and improvements (a.k.a. 4<sup>th</sup>-line support).
Those subscriptions are an ideal way to make sure midPoint will be able to do anything that you need for your project.</p>
</div>
<div class="paragraph">
<p>MidPoint support and subscription services provide primary source of funding for midPoint development and maintenance.
Therefore, it is perfectly natural that midPoint subscribers get high priority for resolution of their issues, feature requests and so on.
This limits the time that midPoint core team has available for other tasks.
Therefore, there are some rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Evolveum decides midPoint roadmap, the features and improvements that are going to be developed in each version.
MidPoint subscribers and Evolveum partners have a chance to influence the roadmap.</p>
</li>
<li>
<p>MidPoint architecture and quality is the primary responsibility of Evolveum team.
Part of Evolveum income is reserved to maintain midPoint - to keep the architecture up to date, to make systemic quality improvements, to maintain midPoint in the long run and so on.</p>
</li>
<li>
<p>Evolveum will fix security issues immediately.
Security issues have absolute priority.
Those will be fixed immediately regardless of who reported them (subscriber or non-subscriber).
Fixes for severe security issues will also get automatically backported to all active support branches.</p>
</li>
<li>
<p>Evolveum will fix any bugs in midPoint, eventually.
Those bugfixes will be committed to midPoint primary development branch (<em>master branch</em>).
The fixes that make it into development branch will be part of the next feature release.
However, as midPoint release cycle is fixed, not all the bugs will be fixed in each release.
The bugs that were reported as part of subscription or support service will be fixed first.
If there is still some time, then other (non-subscriber) bugs will be fixed as well.
However, there are no guarantees for that.
If the time before the release runs out, bugs reported by non-subscribers will not get fixed.
In fact, such non-subscriber fixes may have to wait for several releases until they finally get fixed.</p>
</li>
<li>
<p>Every feature release has a <em>support branch</em>.
This is where the maintenance releases come from.
However, every bugfix or improvement is developed on master branch first.
It has to be backported to the support branch.
Which takes time.
Therefore, there are very strict rules for backporting.
Any bugfix, improvement or any other update will go to the support branch only if:</p>
<div class="ulist">
<ul>
<li>
<p>Backport to support branch is explicitly requested by customer with active support or subscription service.</p>
</li>
<li>
<p>It is a security issue.</p>
</li>
<li>
<p>It fixes a severe issue that affect large number of users.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Simply speaking, if you want to make sure that midPoint works for you, then purchase a support or subscription.
Those services will help you, that is what they are for.
However, the money from support and subscription services also enable long-term midPoint maintenance and new feature development.
Getting midPoint support or subscription is the right thing to do.</p>
</div>
</div>
<div class="sect2">
<h3 id="_midpoint_community">MidPoint Community</h3>
<div class="paragraph">
<p>MidPoint is a proper open source project.
As all good open source projects, midPoint has a vibrant community.
This is both engineering community and business community.
The primary communication channel of the engineering community is midPoint mailing list.
Mailing list is used to discuss midPoint futures, announce new releases, discuss configuration issues, provide feedback to the development team and so on.
MidPoint community is open to anyone.</p>
</div>
<div class="paragraph">
<p>Business community is formed mostly from Evolveum partners.
Evolveum partners deliver midPoint solutions, provide 1<sup>st</sup>-line and 2<sup>nd</sup>-line support services, provide professional services, customized solutions based on midPoint and so on.
The possibilities are endless.
Even the business community is open.
Entry-level partnership is open to anyone.
However, there are several partnership levels, and it takes some effort for a partner to level up.
There is a rich (and growing) network of midPoint partners.
The partners can deliver solutions based on midPoint almost anywhere on planet Earth.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="92-additional-information">13. Additional Information</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Logic&#8217;s useless unless it&#8217;s armed with essential data.
</blockquote>
<div class="attribution">
&#8212; Leto II<br>
<cite>Children of Dune by Frank Herbert</cite>
</div>
</div>
<div class="paragraph">
<p>We have tried to make this book as comprehensive as possible.
However, no book can possibly include all the information that an identity management engineer would ever need.
Therefore, this chapter describes the sources of additional information about midPoint.</p>
</div>
<div class="sect2">
<h3 id="_midpoint_documentation_site">MidPoint Documentation Site</h3>
<div class="paragraph">
<p>MidPoint documentation site (a.k.a. <em>docs</em>) is the most comprehensive information about midPoint.
This is where all the midPoint reference documentation is stored.
Yet, there is even more.
There is connector documentation, midPoint architecture, developer documentation, midPoint internals and all kinds of information including midPoint release planning and roadmap.
Everything is public.</p>
</div>
<div class="paragraph">
<p>However, the <em>docs</em> are so comprehensive that it is often not entirely easy to find the right page.
We have done what we could to organize the information.
The pages are organized hierarchically.
Many pages have "See Also" section that points to additional information.
Yet, the practice shows that if you want to find something in the docs, you need to have at least a faint idea what you are looking for.
This book should give you that idea what to look for.
If you know what you are looking for, then the <em>docs</em> search bar is your friend.
If you enter the correct search term, then there is high probability that you will quickly find the right page.</p>
</div>
<div class="paragraph">
<p>URL: <a href="https://docs.evolveum.com/">https://docs.evolveum.com/</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_samples">Samples</h3>
<div class="paragraph">
<p>The midPoint projects maintains quite a rich collection of samples.
These are sample resource definitions, role and organizational structure examples and other various samples.
They are usually provided in the XML form.
The samples are maintained in a separate project on GitHub.
Those samples are also part of midPoint distribution package.</p>
</div>
<div class="paragraph">
<p>URL&#160;(version&#160;4.8.5):&#160;<a href="https://github.com/Evolveum/midpoint-samples/support-4.8.5/master/samples">https://github.com/Evolveum/midpoint-samples/support-4.8.5/master/samples</a><br>
URL&#160;(latest&#160;development&#160;version):&#160;<a href="https://github.com/Evolveum/midpoint-samples/tree/master/samples">https://github.com/Evolveum/midpoint-samples/tree/master/samples</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_book_samples">Book Samples</h3>
<div class="paragraph">
<p>This book contains many examples and configuration snippets that are taken from various places.
Some smaller snippets are taken from midPoint docs or from the sample files (see above).</p>
</div>
<div class="paragraph">
<p>Some chapters contain mostly complete configurations of the midPoint deployment.
These configurations have a separate folder in the midPoint samples.
Look for a <code>samples</code> folder in the github repository in which source code of this books is maintained.
All the important files used in this book are there, sorted by chapter number.
There are also special-purpose <em>docker compose</em> configurations that simulate configuratin used in this book.
The <em>readme</em> files in individual directories provide more details.</p>
</div>
<div class="paragraph">
<p>URL&#160;(version&#160;4.8.5):&#160;<a href="https://github.com/Evolveum/midpoint-book/tree/support-4.8.5/samples">https://github.com/Evolveum/midpoint-book/tree/support-4.8.5/samples</a><br>
URL&#160;(latest&#160;development&#160;version):&#160;<a href="https://github.com/Evolveum/midpoint-book/tree/master/samples">https://github.com/Evolveum/midpoint-book/tree/master/samples</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_story_tests">Story Tests</h3>
<div class="paragraph">
<p>MidPoint developers like to create and maintain complete end-to-end automated tests.
These tests are usually inspired by real-world midPoint deployments.
We call them <em>story tests</em>.
These tests are important to maintain midPoint quality and continuity.
They are also excellent source of inspiration, and they have often proved useful as examples of midPoint configuration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Documentation:&#160;<a href="https://docs.evolveum.com/midpoint/reference/samples/story-tests/">https://docs.evolveum.com/midpoint/reference/samples/story-tests/</a></p>
</li>
<li>
<p>Code&#160;and&#160;configuration:&#160;<a href="https://github.com/Evolveum/midpoint/tree/master/testing/story">https://github.com/Evolveum/midpoint/tree/master/testing/story</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_midpoint_mailing_list">MidPoint Mailing List</h3>
<div class="paragraph">
<p>MidPoint project attracted a vibrant community during the years.
The main community communication channel is <em>midPoint mailing list</em> <code>midpoint@lists.evolveum.com</code>.
The mailing list is used for announcements, user suggestions, and also for <em>community support</em>.
The mailing list is used to ask questions about midPoint.
Experienced community members usually answer these questions and provide pointers to additional information.
The whole midPoint development team is also subscribed to the mailing list, and they provide answers when needed.
However, this is a best effort service.
Please do not abuse this communication channel and try to keep the following community guidelines:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Be polite.</strong> Mailing list is a best effort service.
Nobody is (directly) paid to answer mailing list questions.
The engineers that answer the questions are doing that in addition to their day-to-day responsibilities, they are doing that because they want to help the community.
Therefore, if you are asking for help, do so politely.
If you are answering a question, please respect other members.
Everybody started somewhere, it is natural that novice users do not know everything.
Please tolerate the differences in skill sets.</p>
</li>
<li>
<p><strong>Do some research before asking a question.</strong>
Do not ask trivial question that can be easily answered by googling the question, by searching for it in the midPoint <em>docs</em> or mailing list archive.
If you are getting an error, try to read error message very carefully, and try to think about the possible causes.
Try to experiment with the configuration a bit.
Look at the troubleshooting section in the <em>docs</em>.
Spend at least a couple of minutes to make your own research before asking the question.
If that research does not provide the answer, then it is a good question for the mailing list.</p>
</li>
<li>
<p><strong>Provide context.</strong>
If your post looks like "<em>my midpoint is broken, please help</em>" then it is very unlikely that you will get any answers.
Try to describe your problem in more details.
Make sure to describe relevant bits of your configuration.
Be sure to include error message.
Look in the log files if necessary.
Most importantly of all: state your goal, describe what you are trying to achieve.
Maybe the root of your problem is that you are using completely wrong approach.
The community may point your nose in the right direction - but only if they know what is your goal.</p>
</li>
<li>
<p><strong>Give back.</strong>
Mailing list is not one way communication channel where users ask questions and developers answer them.
There is already a significant body of knowledge distributed among community members that are not midPoint developers.
If you adhere to these guidelines and ask a question, it will most likely be answered.
However, for that to happen there needs to be someone who is answering.
Therefore, do not just ask the questions.
If you know the answer to the question that someone else asks, then please go ahead and answer it.
Do not worry that your answer may not be perfect.
Even a partial answer will be greatly appreciated by any novice user.
Simply speaking: Do not only take from the community.
Try to repay what the community gave you.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You may also be tempted to send your questions directly to Evolveum or midPoint developers.
However, the developers have many midPoint users, partners, customers and contributors to deal with in their day-to-day job.
The first responsibility of any midPoint core developer is to make sure that midPoint development continues.
The developers naturally prefer to spend time doing tasks that bring funding to the midPoint project.
Therefore, the developers strictly prioritize the communication.
Answers to midPoint subscribers are the highest priority, mailing list is second and answers to private messages from the community are absolutely the lowest priority.
We prefer efficient spread of knowledge about midPoint.
Mailing list is good for that, but private communication is not.
That’s the primary reason for this priority setup.
Besides, if you contact a developer directly, then only that developer can answer your question.
However, if you send the question to the mailing list, there are more people that can potentially answer the question.
Therefore, unless you have active subscription, the mailing list is your best option.</p>
</div>
<div class="paragraph">
<p>Mailing list URL: <a href="http://lists.evolveum.com/mailman/listinfo/midpoint" class="bare">http://lists.evolveum.com/mailman/listinfo/midpoint</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_evolveum_video_channel">Evolveum Video Channel</h3>
<div class="paragraph">
<p>Some of the midPoint related information was recorded in a form of videos.
There are also recordings of midPoint-related Evolveum webinars, presentation and talks.
All videos as published on Evolveum YouTube channel.</p>
</div>
<div class="paragraph">
<p>Evolveum YouTube channel URL: <a href="https://www.youtube.com/@Evolveum">https://www.youtube.com/@Evolveum</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_evolveum_blog">Evolveum Blog</h3>
<div class="paragraph">
<p>Vast majority of midPoint development and maintenance is conducted by Evolveum team.
The people of Evolveum present their professional opinions by the means of Evolveum blog.
The blog is very technology-friendly.
The information provided on the blog goes often quite deep.
This is also a channel how Evolveum shares information about midPoint development plans and business activities related to midPoint.
It is a very valuable resource for anyone that has a professional interest in midPoint.</p>
</div>
<div class="paragraph">
<p>Evolveum blog URL: <a href="https://evolveum.com/blog/" class="bare">https://evolveum.com/blog/</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_social_networks">Social Networks</h3>
<div class="paragraph">
<p>Evolveum is moderately active on social networks, publishing information about the company and midPoint.
Content published on social networks is made suitable for this environment, therefore it is usually lighter that can be consumed quickly.
Despite that, it is well worth subscribing to be kept updated with latest news.</p>
</div>
<div class="paragraph">
<p>LinkedIn: <a href="https://www.linkedin.com/company/evolveum">https://www.linkedin.com/company/evolveum</a><br>
Twitter(X): <a href="https://twitter.com/evolveum">https://twitter.com/evolveum</a><br>
Facebook: <a href="https://www.facebook.com/evolveum">https://www.facebook.com/evolveum</a><br>
Instagram: <a href="https://www.instagram.com/evolveum_midpoint/">https://www.instagram.com/evolveum_midpoint/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="98-to-be-continued">To Be Continued</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Hanc marginis exiguitas non caperet.<br>
(There is not enough space in the margin to write it.)
</blockquote>
<div class="attribution">
&#8212; Pierre de Fermat
</div>
</div>
<div class="paragraph">
<p>This is it, then.
That was the last real chapter of this book.
Yet, we have not yet covered all capabilities of midPoint.
In fact, we are not even close.
We have only scratched the surface of what midPoint can provide.
The other chapters of this book are not written yet.
There is still so much to write about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authorizations:</strong> MidPoint works with sensitive data and there is a need to strictly control access to that data.
Therefore, midPoint has a fine-grained authorization system for controlling access to itself.
Authorization mechanisms are very powerful allowing many scenarios from delegated administration to partial multi-tenancy.</p>
</li>
<li>
<p><strong>MidPoint queries:</strong> MidPoint often needs to find objects in the repository.
There is a special-purpose query language that is used in many places in midPoint.</p>
</li>
<li>
<p><strong>Security:</strong> MidPoint works with quite a sensitive data, therefore it is quite important to keep midPoint secure.
There are many security-related settings, ranging from the usual network security mechanisms, through authentication to a midPoint-specific settings.</p>
</li>
<li>
<p><strong>Identity management miscellanea:</strong> There are various interesting features that were not mentioned yet: password policies, notifications, auxiliary object classes, provisioning dependencies, deputies, constants, function libraries, provisioning scripts and so on.
Those may be little features, but they are essential pieces of the puzzle.
It is almost impossible to have a complete identity management solution and not to use any of those features.</p>
</li>
<li>
<p><strong>Requests and approvals:</strong> Browse available roles, select role, request role, approve role, assign role, provision accounts.
That is the basic mantra of many identity management deployments.
Of course this is easy to do in midPoint.
There is even more: multi level approvals, optional approval steps, dynamic approver selection, escalation and so on.
MidPoint has most of the features already built-in, you just need to configure them.</p>
</li>
<li>
<p><strong>Entitlements:</strong> Managing accounts if fine.
Yet, it is not the whole story.
There is huge difference between a regular account and an administrator account.
Fortunately, midPoint can easily manage membership in groups, roles, assignment of privileges and other entitlements.
In this case we really mean entitlements on the resources, such as Active Directory groups, distribution lists, Unix groups and so on.
MidPoint is designed to this quite easily.</p>
</li>
<li>
<p><strong>Manual resources:</strong> Obviously, you want most of the resource to be connected to midPoint by a connector so they can be automatically managed.
However, there are always few bothersome resources that just won’t comply.
Maybe they are too small to justify the cost of building a connector.
Maybe there is just no good way for the connector to manage the resource.
MidPoint one again comes to the rescue.
MidPoint has a concept of <em>manual resource</em> where the work is done by system administrator instead of connector.
There is even a way how to create semi-manual resource that can read the data, but provisioning is still manual.
There is a way how to integrate this with ITSM system.</p>
</li>
<li>
<p><strong>Auditing and history:</strong> No identity management system can be complete without an auditing facility.
MidPoint can store every operation to the audit trail: changes in users, accounts, roles - even internal configuration changes.
This is stored in a format that can be used to integrate midPoint with a data warehouse or a SIEM system.
Also, midPoint user interface has a facility to display the audit trail.
MidPoint can even look into the past: it can reconstruct the objects as they were at a certain point in time.</p>
</li>
<li>
<p><strong>Policy rules:</strong> MidPoint is much more than just an identity management system.
The identity governance features of midPoint are based on a powerful and universal concept of <em>policy rules</em>.
The rules can be used to express role exclusions, thus defining a segregation of duties (SoD) policy.
The rules can be used to define policy-based approval.
The rules can control role lifecycle.
The rules can define compliance policies.
The rules can do it all.
The rules are here to <em>govern</em> the identities.</p>
</li>
<li>
<p><strong>Access certification:</strong> This is known by many names: certification, re-certification, attestation, &#8230;&#8203; but whatever the name is it is still the same process.
Simply speaking, this is a method to review roles assigned to the users to make sure the users still need the roles that they have.
This is a method how to get a grip on the <em>principle of least privilege</em> even in environments that are naturally inclined to ad-hoc operation.
However, it is very useful mechanism in almost all environments.
MidPoint provides many flavors of certification mechanisms from a scheduled mass recertification campaigns focused on roles assignments to an ad-hoc recertification of a single used after he is moved to a new organization.</p>
</li>
<li>
<p><strong>Regulatory compliance:</strong> midPoint, being an identity governance platform, is an essential component for regulatory compliance of any mid-size or large organization.
MidPoint can manage identity lifecycle, govern access control policies, maintain oversight of certain aspects of security policies, support information classification, even assist in business continuity and incident response.</p>
</li>
<li>
<p><strong>Data protection:</strong> Identity management is no longer a wild west where anybody can do anything.
Now there are strict data protection rules, regulations and legislation.
Being a good identity governance system, midPoint can assist in managing the data protection and privacy policies.
MidPoint can be really helpful in managing compliance to the data protection regulations such as European GDPR legislation.</p>
</li>
<li>
<p><strong>Role mining and outlier detection:</strong> It is very difficult to manually maintain a complex access control model.
It is almost impossible to deal with thousands upon thousands of roles one-by-one.
Therefore, midPoint contains AI-based tools to help deal with the complexity.
<em>Role mining</em> provides ability to discover role definitions from existing access data.
<em>Outlier detection</em> looks for users and access patterns that are different, and thus suspicious.
Both mechanisms are making life with midPoint easier and more sustainable.</p>
</li>
<li>
<p><strong>User interface customizations:</strong> MidPoint has a general-purpose user interface that can be used for user self-service, identity administration and system configuration.
The user interface is designed to be dynamic.
It automatically adapts to resource schemas, extension of midPoint schema, authorizations and so on.
Therefore, usually there is no need to customize user interface at all.
However, there are cases when the deployment need to deviate from the default behavior, and midPoint is prepared to that.
There are many ways to customize user interface: colors, stylesheets, localization, custom forms, tabs, whole new custom pages.
In extreme cases midPoint can be customized beyond recognition.</p>
</li>
<li>
<p><strong>Integration with midPoint services:</strong> MidPoint is an excellent platform.
However, even great software does not live in isolation.
There is always need to integrate the systems together.
Integration runs through midPoint veins, because that is what the connectors really do.
Yet, often there is a need to integrate midPoint with other systems in a way that is beyond the capabilities of a connector.
Maybe there is a password reset application that needs to interact with midPoint.
Maybe there is an analytic software that needs to get midPoint data.
MidPoint was designed from the day one to be a service-based application.
Therefore, there is REST services packed with features.
Actually almost anything that midPoint does can be controlled by using those services.</p>
</li>
<li>
<p><strong>Advanced concepts:</strong> There are still some features that were not explained in previous chapters: consistency mechanisms, personas, multi-connector resources and so on.
Some of those features are seldom used, but they may save your project.
Other features are used all the times, but they are a natural part of midPoint and therefore they are almost invisible.
All those features deserve explanation.
There is also a need to describe how midPoint itself is developed – as there is a lot of experimental and incomplete features.
However, as this is midPoint, even those features may be extremely useful.
This chapter may also be interesting to people who would like to extended midPoint in an unusual way or those that want to contribute to midPoint development.</p>
</li>
<li>
<p><strong>MidPoint Deployment:</strong> There are many paths from downloading midPoint packages to a working system.
Some of those paths are easier than others.
MidPoint design was build on many years of practical identity management experience.
Therefore, midPoint has mechanisms that can be used to efficiently overcome some notorious problems in identity management – provided that midPoint is used correctly.
This chapter aims at giving advice how midPoint should be used in practical projects.
How to plan the project, what information to gather, how to design the deployment, how to prepare the environment, plan the migration, handle project extensions and changes and so on.</p>
</li>
<li>
<p><strong>Management of IAM program:</strong> Identity management is very similar to information security: Identity management has no end.
Identity management is not a project.
It is a <em>program</em>.
It is an endless cycle of gathering data, planning and execution.
The environment around identity management is always changing, therefore identity management must change as well.
MidPoint is designed for this kind of longevity.
This chapter will describe how to handle this endless cycle.
How to make midPoint configuration open to extensions.
How to gather data.
How to handle new feature requests.
How to do upgrades.
How to keep identity management solution sustainable.</p>
</li>
<li>
<p><strong>Deployment examples:</strong> This book uses a lot of examples in all the chapters.
However, those are examples designed to demonstrate one specific aspect of midPoint functionality.
This chapter will be different.
There will be complete examples of practical midPoint solutions.
After all, the way that copying and pasting is one of the best ways how to learn.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those chapters are still missing.
They are not written yet.
Obviously, the best people to write those chapters are the people from the Evolveum team: people that designed and implemented midPoint, people that support midPoint deployments, people that work with midPoint every day, people that eat, breathe and sleep midPoint.
However, those people are just engineers.
They need to pay their bills.
They cannot put away their day-to-day responsibilities to work on this book.
Obviously, funding is needed to finish the book.
As this book is available for free there is no direct income that could provide the funding for next chapters.
There is only one way: sponsoring.</p>
</div>
<div class="paragraph">
<p>If you like this book, then please consider sponsoring some of the next chapters.
The market economy is, unfortunately, quite ruthless.
Therefore, it is pretty straightforward: if there are no sponsors, it is very unlikely that there will be any new chapters.
Therefore, please sponsor this book if you can.
If you cannot afford to sponsor this book, then please at least help us to spread the word: a word about midPoint and a word about this book.
Any form of help is more than appreciated.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion_9">Conclusion</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
A conclusion is the place where you get tired of thinking.
</blockquote>
<div class="attribution">
&#8212; Steven Wright
</div>
</div>
<div class="paragraph">
<p>This book is not finished yet.
In fact, it is just a beginning.
The book is developed in the same fashion as midPoint, it is written continually, in an incremental and iterative fashion, as fast as time and money allow.</p>
</div>
<div class="paragraph">
<p>Your contributions and donations will surely speed up completion of this book.
Also consider getting midPoint subscription.
That is the source of funding for midPoint development.
Evolveum is no mega-corporation that can fund open source development from huge profits in other areas.
There are no other areas.
Evolveum is open-source-only company.
Everything we do is focused on open source projects.
Evolveum is not a start-up either.
We are not funded by venture capital, and we do not have millions to spend.
Evolveum is a self-funded, sustainable company.
We can spend only what we earn on subscriptions, sponsored features and services.
There is no other income.
MidPoint development can only go as fast as the money allow.
The same principle applies to midPoint documentation and this book.
It will grow proportionally to the Evolveum income.
Therefore, if you liked this book please consider supporting us.
Both money and your time are more than appreciated.</p>
</div>
<div class="paragraph">
<p>We hope that you enjoyed reading this book at least as much as we enjoyed writing it – and as we enjoy creating midPoint in the first place.
MidPoint is quite a unique software project.
It would not be possible to maintain and develop this project without you.
The whole Evolveum team would like to thank all past, present and future midPoint supporters for making this exciting project a reality.
Together we have created interesting and useful software product.
We hope that together we can make midPoint even better.</p>
</div>
<div class="paragraph">
<p>Thank you all.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_glossary">Glossary</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Eskimos had over two hundred different words for snow, without which their conversation would probably have got very monotonous.
</blockquote>
<div class="attribution">
&#8212; So Long, and Thanks for All the Fish by Douglas Adams
</div>
</div>
<div class="paragraph">
<p>Identity management and governance parlance may sound like an alien language to a newcomer.
Therefore, perhaps preparing IDMish-to-english dictionary might be a good idea.</p>
</div>
<div class="paragraph">
<p>There are a lot of terms listed in this part of the book.
Many of the terms have several meanings, some of them might be confusing, and there are alternative terms and various "dialects".
Identity management, similarly to many fields of technology, is also riddled by many buzzwords, invented by marketing departments rather than scientists and engineers.
Therefore, compiling a clear, simple, exact and consistent terminology is almost an impossible task.
We have tried to do our best here.</p>
</div>
<div class="paragraph">
<p>Individual terms are accompanied by acronyms and alternative terms where appropriate.
There is also a reference to vocabularies used by standards.
Some terms have specific meaning when used in midPoint ecosystem.
In that case the midPoint-specific meaning is explained as well.</p>
</div>
<div class="paragraph">
<p>Although the glossary is certainly incomplete, and we reserve the right for our own interpretation, we hope that this will help you safely navigate the stormy waters of identity management letter soup.</p>
</div>
<div class="dlist glossary">
<dl>
<dt><a id="glossterm-abac"></a>Attribute-Based Access Control (ABAC)</dt>
<dd>
<p>A mechanism for managing user access to information systems based on user attribute values. Attribute-Based Access Control (ABAC) evaluates access dynamically using an algorithm that takes 'attributes' as input and outputs an access decision (allow/deny). The attributes are usually user profile attributes, supplemented with context attributes such as time of access and the user&#8217;s current location.</p>
<div class="paragraph">
<p>Alternative terms: Claims-based Access Control, CBAC</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-access-control">Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-abstract-role"></a>Abstract Role</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Abstract role means any type of object that acts as a role. This means that abstract tole can be used to hold inducements, which give privileges to other objects. Role, org, service, archetype are abstract roles in midPoint.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/architecture/concepts/abstract-role/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-inducement">Inducement</a>, <a href="#glossterm-role">Role</a>, <a href="#glossterm-org">Org</a>, <a href="#glossterm-archetype">Archetype</a></p>
</div>
</dd>
<dt><a id="glossterm-access-certification"></a>Access Certification</dt>
<dd>
<p>Access certification helps with management of access rights. These rights also called privileges, role assignments, authorities or authorizations need to be assigned to the right users in the right systems at the right time. Access Certification means reviewing the settings such as assignments of roles to users to make sure that employees have accesses to the systems they need.</p>
<div class="paragraph">
<p>Certifications are often conducted in a form of certification campaigns, certifying access of many users in each campaign, distributing the work among many reviewers to keep amount of work per person reasonable. Despite that, the overall effort necessary for completion of certification campaign can be huge. Therefore, certification campaigns are being replaced by microcertifications, certifying specific users or privileges on as-needed basis.</p>
</div>
<div class="paragraph">
<p>Access certification is often used to address over-provisioning of privileges, in a attempt to maintain the principle of least privilege.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Access Re-certification, Re-certification, Attestation, Access Review</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-least-privilege">Least Privilege Principle</a>, <a href="#glossterm-over-provisioning">Over-provisioning</a>, <a href="#glossterm-microcertification">Microcertification</a></p>
</div>
</dd>
<dt><a id="glossterm-access-cloning"></a>Access Cloning</dt>
<dd>
<p>Access cloning is a practice of assigning a user the same access rights as another user has. It is often used to provision new users with initial access rights, copying access rights of an existing donor user.</p>
<div class="paragraph">
<p>Access cloning is an undesirable practice (see ISO/IEC 27002 5.18), as it often leads to over-provisioning. Even if the cloned access rights are justified, business role (RBAC) or similar mechanism should be used instead of cloning. Although the practice is generally undesirable, it is often employed due to its simplicity.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Access Rights Cloning, Donor user</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-least-privilege">Least Privilege Principle</a>, <a href="#glossterm-over-provisioning">Over-provisioning</a>, <a href="#glossterm-rbac">Role-Based Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-access-control"></a>Access Control</dt>
<dd>
<p>Access control is an abstract concept of controlling access of users to applications. It is a very broad and general term, however it usually refers to a mechanism to define and evaluate authorization policies. Two commonly-used access control mechanisms are role-based access control (RBAC) and attribute-based access control (ABAC).</p>
<div class="paragraph">
<p>X.1252 term: access control</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-rbac">Role-Based Access Control</a>, <a href="#glossterm-abac">Attribute-Based Access Control</a>, <a href="#glossterm-pbac">Policy-Based Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-access-management"></a>Access Management (AM)</dt>
<dd>
<p>Access Management (AM) is a security discipline that provides access to authorised users to enter particular resources. It also prevents non-authorised users from accessing the resources. Thus the goal of Access Management is to unify the security mechanisms that take place when a user is accessing specific system or functionality. Single Sign-On (SSO) is sometimes considered to be a part of Access Management.</p>
</dd>
<dt><a id="glossterm-access-request"></a>Access Request Process</dt>
<dd>
<p>Access request process is a business process used to request additional access or privileges for information systems and applications. It is usually a semi-manual process. It starts with a user requesting access or privileges for applications. The request is usually routed through approval steps. When approved, the access is provisioned.</p>
<div class="paragraph">
<p>Access request is very frequently used to provide necessary access to users, addressing access under-provisioning situations. As clear and complete access control policy is usually not known, access request process is a practical measure to compensate for this limitation. In fact, the access request process is often over-used, leading to systematic over-provisioning of access. Access certification mechanisms are usually used to compensate such over-provisioning.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Access Request Management</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-provisioning">Identity Provisioning</a>, <a href="#glossterm-under-provisioning">Under-provisioning</a>, <a href="#glossterm-over-provisioning">Over-provisioning</a>, <a href="#glossterm-access-certification">Access Certification</a></p>
</div>
</dd>
<dt><a id="glossterm-account"></a>Account</dt>
<dd>
<p>Data structure in a database, file or a similar data store that describes characteristics of a user of a particular system (resource). Accounts are used to control access of users to applications, databases and so on. Account is a persistent data record, stored in an application or a database. This term is usually not used to describe ephemeral information about user&#8217;s identity, such as information temporarily stored only for the duration of user&#8217;s session. Such information is often referred to as "principal".</p>
<div class="paragraph">
<p>Account is different from a generic data record (e.g. "identity" or "principal"). The purpose of account is to provide user&#8217;s access to the system, generic data record may not provide such access.</p>
</div>
<div class="paragraph">
<p>In midPoint terminology: An account strictly means a data structure in source/target system (resource). Term "user" is used to describe a similar data structure in midPoint itself.</p>
</div>
<div class="paragraph">
<p>Alternative terms: User account</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-user">User</a>, <a href="#glossterm-principal">Principal</a></p>
</div>
</dd>
<dt><a id="glossterm-acl"></a>Access Control List (ACL)</dt>
<dd>
<p>Mechanism for controlling access to information system, based on a simple sequential list of access control instructions. Instructions in access control list are evaluated sequentially. If the instruction matches current access control situation (user, accessed object, operation), then the instruction is applied, either allowing or denying the access.</p>
<div class="paragraph">
<p>There is no standardized form or language for access control lists and instructions, making ACLs not interoperable across implementations. There are also numerous variations to the basic idea, e.g. always evaluating entire list, deny instructions always taking precedence, and so on.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-access-control">Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-active-directory"></a>Active Directory</dt>
<dd>
<p>An identity repository created by Microsoft that stores and arranges identity information. Based on this information, it provides access and permissions to users to enter particular resources and therefore improves organization&#8217;s security.</p>
</dd>
<dt><a id="glossterm-agent"></a>Agent</dt>
<dd>
<p>Active entity, usually a software component that plays an active part.</p>
<div class="paragraph">
<p>In identity management field, the term "agent" often means an active software component installed into a controlled system, used to mediate management of identities. It is similar in function to identity connector, however unlike the connector, the agent has to be installed into a controlled system.</p>
</div>
<div class="paragraph">
<p>X.1252 term: agent</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-connector">Identity Connector</a></p>
</div>
</dd>
<dt><a id="glossterm-anonymity"></a>Anonymity</dt>
<dd>
<p>A situation when an object cannot be distinguished from similar objects, where an identity of an object cannot be determined.</p>
<div class="paragraph">
<p>X.1252 term: anonymity</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity">Identity</a></p>
</div>
</dd>
<dt><a id="glossterm-api"></a>Application Programming Interface (API)</dt>
<dd>
<p>Set of procedures, functions or methods that can be used by another program or component. APIs are usually interfaces exposed by an application, meant to be used by other application. Therefore APIs are important integration points between applications and services. In the past, APIs were usually created as a programming language library, such as C or Java library. Since c. 2010, APIs usually take form of HTTP-based RESTful service.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-restful-service">RESTful Service</a></p>
</div>
</dd>
<dt><a id="glossterm-archetype"></a>Archetype</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Archetype is a formal definition of object subtype in midPoint. Archetypes can give specific characters to basic midPoint types such as user, role or org. For example, archetypes can be used to further refine concept of user to represent employees, students, contractors and partners.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/reference/schema/archetypes/">more information at docs.evolveum.com</a>.</p>
</div>
</dd>
<dt><a id="glossterm-asset"></a>Asset</dt>
<dd>
<p>Assert is an integral collection of information, data, systems, services, equipment, knowledge and any other means that provide value to an organization. It may take form of customer database, results of a research project, trade secret, proprietary software package, essential business process or any form that is considered valuable. Assets are subjects to risk, realized by threats exploiting asset vulnerabilities. Protection of assets is the primary objective of cybersecurity.</p>
<div class="paragraph">
<p>Alternative terms: Information asset</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-threat">Threat</a>, <a href="#glossterm-vulnerability">Vulnerability</a>, <a href="#glossterm-risk-assessment">Risk assessment</a></p>
</div>
</dd>
<dt><a id="glossterm-assignment"></a>Assignment</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Assignment is a relation that directly assigns privileges, organizational membership, policy elements or other midPoint concepts to assignment holder objects (usually users). Assignment is quite a rich, flexible and universal mechanism. Assignments can be conditional, there may be time constraints, parameters and other details specifying the relation between assignment holder (usually user) and target (usually role or org). Many types of objects can be a target of an assignment, allowing for a significant expressive power.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/reference/roles-policies/assignment/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-inducement">Inducement</a>, <a href="#glossterm-assignment-holder">Assignment Holder</a>, <a href="#glossterm-focus">Focus</a></p>
</div>
</dd>
<dt><a id="glossterm-assignment-holder"></a>Assignment Holder</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: An object that can hold assignments. Assignment holder can be considered a "source" of an assignment, a source of a relation that an assignmnt represents. Almost all object types in midPoint are assignment holder, capable of containing an assignment.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-assignment">Assignment</a>, <a href="#glossterm-focus">Focus</a></p>
</div>
</dd>
<dt><a id="glossterm-audit"></a>Audit</dt>
<dd>
<p>Audit is an systematic and documented process for reviewing specific processes, organizations or regulatory compliance. It involves obtaining and objective processing of evidence, including evidence stored in special-purpose audit trails. Audit can be internal, conducted by an organization, reviewing its own processes or compliance. It can also be external, conducted by an independent trusted party.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-audit-trail">Audit trail</a></p>
</div>
</dd>
<dt><a id="glossterm-audit-scope"></a>Audit scope</dt>
<dd>
<p>Extent and boundaries of audit review.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-audit">Audit</a></p>
</div>
</dd>
<dt><a id="glossterm-audit-trail"></a>Audit trail</dt>
<dd>
<p>Audit trail is a record of essential information, meant to be used as an evidence in audit reviews. Audit trail is usually a structured, chronological record of operations or observations of an information system. It records important actions taken by users of the system, including actions taken by system administrators.</p>
<div class="paragraph">
<p>Alternative terms: Audit log</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-audit">Audit</a></p>
</div>
</dd>
<dt><a id="glossterm-authentication"></a>Authentication</dt>
<dd>
<p>Authentication is a mechanism by which a computer system checks that the user is really the one she or he claims to be. Authentication can be implemented by a broad variety of mechanisms broadly divided into three categories: something you know, something you have, something you are. Traditionally, authentication is done by the means of by username and password. Authentication is often followed by authorization, however, authentication and authorization are two separate mechanisms.</p>
<div class="paragraph">
<p>ISO 24760 term: authentication</p>
</div>
<div class="paragraph">
<p>X.1252 term: authentication</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identification">Identification</a>, <a href="#glossterm-authorization">Authorization</a>, <a href="#glossterm-mfa">Multi-factor authentication</a></p>
</div>
</dd>
<dt><a id="glossterm-authenticated-identity"></a>Authenticated Identity</dt>
<dd>
<p>ISO 24760 term, describing "identity information" created to record result of authentication. This may mean data such as authentication strength, timestamps and similar information. In software development, it is often referred to as "authenticated user" or "authenticated principal".</p>
<div class="paragraph">
<p>Alternative terms: Authenticated user, Authenticated principal</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: authenticated identity</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authentication">Authentication</a>, <a href="#glossterm-principal">Principal</a></p>
</div>
</dd>
<dt><a id="glossterm-authenticator"></a>Authenticator</dt>
<dd>
<p>Something the subject possesses and controls, which is used to prove the identity during authentication. Authenticator can be digital (information), physical (an object such as ID card or authentication device) or a combination of both (an ID card with a tamper-proof chip containing cryptographic keys). Perhaps the most common type of authenticator is a password.</p>
<div class="paragraph">
<p>The term "authenticator" is closely related to term "credential" - which is even more confusing as many authenticators are also credentials. The difference is that credential is bound to the authenticated identity, while authenticator does not need to be. E.g. password is not inherently bound to authenticated identity, as the same password can be used to authenticate many identities at various sites. Therefore, strictly speaking, password is an authenticator but not a credential. On the other end, digital certificate (X.509) with associated private key is bound to a specific identity, therefore it is both an authenticator and a credential. There are also credentials that are not authenticators, such as records in the authentication database linking identity identifiers. However, in common usage, the term "credential" is often used to refer to authenticators as well.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Authentication token</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: credential</p>
</div>
<div class="paragraph">
<p>X.1252 term: credential</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-credential">Credential</a>, <a href="#glossterm-password">Password</a>, <a href="#glossterm-passkey">Passkey</a>, <a href="#glossterm-pin">Personal identification number</a>, <a href="#glossterm-authentication">Authentication</a></p>
</div>
</dd>
<dt><a id="glossterm-authenticity"></a>Authenticity</dt>
<dd>
<p>Authenticity is a property of a data, and also an assurance, that the data are valid and true. Simply speaking, it tells that data are what they claim to be. Authenticity may also mean assurance of data origin (provenance) and their integrity.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-integrity">integrity</a></p>
</div>
</dd>
<dt><a id="glossterm-authorization"></a>Authorization</dt>
<dd>
<p>Authorization is a mechanism by which a computer system determines whether to allow or deny specific action to a user. Authorization is often controlled by rather complex rules and algorithms, usually specified as part of an access control model. Authorization often follows (and required) authentication, however, authentication and authorization are two separate mechanisms.</p>
<div class="paragraph">
<p>In rare cases, "authorization" is understood as a process of allowing access, granting permissions or giving approval. Such as "authorization" of a request to join a group.</p>
</div>
<div class="paragraph">
<p>X.1252 term: authorization</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authentication">Authentication</a>, <a href="#glossterm-rbac">Role-Based Access Control</a>, <a href="#glossterm-abac">Attribute-Based Access Control</a>, <a href="#glossterm-coarse-grain-authorization">Coarse-grain Authorization</a>, <a href="#glossterm-fine-grain-authorization">Fine-Grain Authorization</a>, <a href="#glossterm-access-control">Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-authorization-service"></a>Authorization Service</dt>
<dd>
<p>A system that provides authorization information to an application. It usually makes a decision whether a specific operation should be allowed or denied by the application. I.e. authorization system is performing the authorization decision instead of the application. Authorization systems often use complex policy, user roles or additional attributes to make the decision. Authorization servers usually implement functionality of Policy Decision Point (PDP). Typical protocols and frameworks: XACML, Open Policy Agent (OPA), SAML authorization assertions, proprietary mechanisms</p>
<div class="paragraph">
<p>Alternative terms: Authorization Server</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authorization">Authorization</a></p>
</div>
</dd>
<dt><a id="glossterm-availability"></a>Availability</dt>
<dd>
<p>Availability is a property of network service or information system, ensuring that all the necessary functions are available to the user. I.e. it is a property that ensures that systems and the data are available to users as intended, that the service is not interrupted by an attacker.</p>
<div class="paragraph">
<p>Availability, together with confidentiality and integrity form a "CIA triad", a classical model of information security (cybersecurity).</p>
</div>
<div class="paragraph">
<p>Alternative terms: Service availability</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-confidentiality">Confidentiality</a>, <a href="#glossterm-integrity">integrity</a></p>
</div>
</dd>
<dt><a id="glossterm-biometrics"></a>Biometrics</dt>
<dd>
<p>Automated recognition of persons, based on their biological or behavioral characteristics.</p>
<div class="paragraph">
<p>Alternative terms: Biometric authentication</p>
</div>
<div class="paragraph">
<p>X.1252 term: biometric recognition</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authentication">Authentication</a></p>
</div>
</dd>
<dt><a id="glossterm-birthright"></a>Birthright</dt>
<dd>
<p>Privileges or access granted to users based on their inherent characteristic, such as user type (employee, contractor, student). It also includes a set of privileges automatically given to all users ("all users" access). Privileges and access that are automatically assigned due to organizational structure membership (e.g. access to departmental systems) is sometimes also considered to be a birthright.</p>
<div class="paragraph">
<p>In midPoint terminology: Archetypes are usually used to manage birthright in midPoint, by placing appropriate inducements in archetype definition. Birthright originating from organizational structure can be implemented by placing inducements in organizational units (orgs).</p>
</div>
<div class="paragraph">
<p>Alternative terms: Birthright provisioning</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-provisioning">Identity Provisioning</a>, <a href="#glossterm-archetype">Archetype</a>, <a href="#glossterm-org">Org</a>, <a href="#glossterm-inducement">Inducement</a></p>
</div>
</dd>
<dt><a id="glossterm-blinded-affirmation"></a>Blinded Affirmation</dt>
<dd>
<p>A method to provide strictly limited information to another party, without revealing any unintended information. Blinded affirmation is often used to demonstrate that a certain user is a member of an organization, without revealing any additional information about the user to a third party. Blinded affirmation usually relies on ephemeral identifiers or pseudonyms.</p>
<div class="paragraph">
<p>ISO 24760 term: blinded affirmation</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-ephemeral-identifier">Ephemeral Identifier</a>, <a href="#glossterm-pseudonym">Pseudonym</a></p>
</div>
</dd>
<dt><a id="glossterm-certificate-authority"></a>Certificate Authority (CA)</dt>
<dd>
<p>Entity that issues digital certificates. Certificate authority is usually a trusted third party, certifying correctness of the data presented in certificates that it issues. The most common form of certificate authority is an authority that issues X.509 digital certificates, containing public keys. Certificate authority signs the certificates, thus certifying that a specified public key belongs to a specified identity.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-certificate">Digital Certificate</a>, <a href="#glossterm-trusted-third-party">Trusted Third Party</a></p>
</div>
</dd>
<dt><a id="glossterm-claim"></a>Claim</dt>
<dd>
<p>Statement about an entity, provided in a form which can be verified by other parties. Verification of a claim provides reliable information about the entity that created the claim (issuer), and it provides assurance that the claim content was not modified. However, claim verification does not provide assurance that a claim is correct, or that it is an unquestionable truth. Technically, claims are often digital identity attributes, secured by cryptography mechanisms for network transfer.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a>, <a href="#glossterm-triangle-of-trust">Triangle Of Trust</a>, <a href="#glossterm-issuer">Issuer</a>, <a href="#glossterm-holder">Holder</a>, <a href="#glossterm-verifier">Verifier</a></p>
</div>
</dd>
<dt><a id="glossterm-clockwork"></a>Clockwork</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: MidPoint component responsible for evaluation of lifecycle, activation, object templates, assignments, roles, policies, mappings and many other aspects of midPoint configuration. Clockwork is the main workhorse of midPoint synchronization, making sure that objects are properly recomputed and policies are enforced. It also computes the data for synchronization, both in inbound and outbound direction.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/reference/concepts/clockwork/clockwork-and-projector/">more information at docs.evolveum.com</a>.</p>
</div>
</dd>
<dt><a id="glossterm-cloud-computing"></a>Cloud Computing</dt>
<dd>
<p>Internet-based computing when resources like storage, applications or servers are used by organizations or users via Internet. Data could be accessed any time from any place, without any installations and is stored and processed in third-party data centers which could be located anywhere in the world. Cloud computing is considered to lower organization&#8217;s costs by avoiding the need of purchasing servers as well as to speed up the processes with less maintenance needed. Due to data being centralized at one place, it is considered to be secure and easily shared across bigger amount of users.</p>
</dd>
<dt><a id="glossterm-coarse-grain-authorization"></a>Coarse-grain Authorization</dt>
<dd>
<p>Authorization concerning big architectural blocks, such as entire applications or systems. E.g. coarse-grain authorization usually decides whether a user can access an application, or access should be denied, without providing any additional details. Coarse-grained authentication is usually being made at the "perimeter" of the system, e.g. by infrastructure components, when a user is accessing an application. Typically, this authorization is based on simple policy rules, such as a role or group assigned to the user.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-authentication">Authentication</a>, <a href="#glossterm-fine-grain-authorization">Fine-Grain Authorization</a></p>
</div>
</dd>
<dt><a id="glossterm-competence"></a>Competence</dt>
<dd>
<p>Ability to perform certain function, or to achieve intended results. It may refer to the ability of people, an ability to apply knowledge, skills and effort to reach results. It may also apply to systems, describing an ability of the system to perform functions to achieve results.</p>
<div class="paragraph">
<p>Alternative terms: Capability</p>
</div>
</dd>
<dt><a id="glossterm-compliance"></a>Compliance</dt>
<dd>
<p>Fulfillment of a requirement, or a system of requirements. It usually refers to conformity with a regulation, or an industry standard.</p>
<div class="paragraph">
<p>In identity and access management (IAM) field, the term "compliance" may refer to a set of IAM platform features that aid with regulation and standards compliance.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Conformity</p>
</div>
</dd>
<dt><a id="glossterm-confidentiality"></a>Confidentiality</dt>
<dd>
<p>Confidentiality is a property of communication channel or data, ensuring that they are available only to intended actors. I.e. it is a property that ensures that the data are seen only by communicating parties, and no other party can access and read the data. Confidentiality is usually implemented by using encryption.</p>
<div class="paragraph">
<p>Confidentiality, together with integrity and availability form a "CIA triad", a classical model of information security (cybersecurity).</p>
</div>
<div class="paragraph">
<p>Alternative terms: Secrecy</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-availability">Availability</a>, <a href="#glossterm-integrity">integrity</a></p>
</div>
</dd>
<dt><a id="glossterm-connid"></a>ConnId</dt>
<dd>
<p>ConnId is an open source identity connector framework project. It originated from Identity Connector Framework (ICF) developed by Sun Microsystems in late 2000s. ConnId is now an independent open source project, used by several identity management platforms.</p>
<div class="paragraph">
<p>Alternative terms: ConnId Framework</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-connector">Identity Connector</a>, <a href="#glossterm-identity-connector-framework">Identity Connector Framework</a></p>
</div>
</dd>
<dt><a id="glossterm-consent-for-personal-data-processing"></a>Consent for Personal Data Processing</dt>
<dd>
<p>Consent for personal data processing is given by a user, to indicate agreement for processing of personal data. In personal data protection frameworks (such as GDPR), consent has a strict structure, it is given for a very specific processing scope. Consent can be revoked by the user any time. Consent is just one of several personal data processing bases (lawful bases). Consent is perhaps the most well know, and also the most misused basis for personal data processing.</p>
<div class="paragraph">
<p>Alternative terms: Consent</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-personal-data-protection">Personal Data Protection</a>, <a href="#glossterm-personal-data-processing-basis">Personal Data Processing Basis</a>, <a href="#glossterm-gdpr">General Data Protection Regulation</a></p>
</div>
</dd>
<dt><a id="glossterm-consequence"></a>Consequence</dt>
<dd>
<p>Outcome of an event or an activity.</p>
<div class="paragraph">
<p>Alternative terms: Outcome, Result</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-event">Event</a></p>
</div>
</dd>
<dt><a id="glossterm-continual-improvement"></a>Continual improvement</dt>
<dd>
<p>Continuous or recurring activity to enhance performance or results.</p>
</dd>
<dt><a id="glossterm-control"></a>Control</dt>
<dd>
<p>Control is a measure that affects risk. Controls are used in security management programs to lower risk, and manage overall and residual risks. Controls may take variety of forms, including processes, technology, policies and people,</p>
<div class="paragraph">
<p>Alternative terms: Countermeasure, Cybersecurity measure, Measure</p>
</div>
</dd>
<dt><a id="glossterm-control-objective"></a>Control objective</dt>
<dd>
<p>Control objective is an intended effect of an control. It is a description of the effect that a control should have when implemented.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-control">Control</a></p>
</div>
</dd>
<dt><a id="glossterm-corrective-action"></a>Corrective action</dt>
<dd>
<p>Corrective action is an action to eliminate causes of non-compliance and prevent recurrence. Unlike remediation (correction) which is focused on correcting the effects, corrective action aims at correction of the causes (e.g. updating the policy).</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-compliance">Compliance</a>, <a href="#glossterm-remediation">Remediation</a></p>
</div>
</dd>
<dt><a id="glossterm-credential"></a>Credential</dt>
<dd>
<p>Information used to prove the identity of a subject during authentication, which is bound to that particular identity. Credentials can be digital (information), physical (an object such as ID card) or a combination of both (an ID card with a tamper-proof chip containing cryptographic keys). Perhaps the most common type of digital credential is a password-based credential.</p>
<div class="paragraph">
<p>The term "credential" is closely related to term "authenticator" - which is even more confusing as many authenticators are also credentials. The difference is that credential is bound to the authenticated identity, while authenticator does not need to be. E.g. password is not inherently bound to authenticated identity, as the same password can be used to authenticate many identities at various sites. Therefore, strictly speaking, password is an authenticator but not a credential. However, when password is established as a shared secret at a particular site, and bound to a particular identity in that site&#8217;s authentication database, a password-based credential is created. On the other end, digital certificate (X.509) with associated private key is bound to a specific identity, therefore it is both an authenticator and a credential. There are also credentials that are not authenticators, such as records in the authentication database linking identity identifiers. However, in common usage, the term "credential" is often used to refer to authenticators as well.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Digital credential, Credentials</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: credential</p>
</div>
<div class="paragraph">
<p>X.1252 term: credential</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authenticator">Authenticator</a>, <a href="#glossterm-password">Password</a>, <a href="#glossterm-passkey">Passkey</a>, <a href="#glossterm-pin">Personal identification number</a>, <a href="#glossterm-authentication">Authentication</a></p>
</div>
</dd>
<dt><a id="glossterm-credential-issuer"></a>Credential Issuer</dt>
<dd>
<p>An entity that creates and provisions credentials to entities.</p>
<div class="paragraph">
<p>ISO 24760 term: credential issuer</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-credential">Credential</a>, <a href="#glossterm-issuer">Issuer</a>, <a href="#glossterm-trust-service">Trust service</a></p>
</div>
</dd>
<dt><a id="glossterm-credential-service-provider"></a>Credential Service Provider (CSP)</dt>
<dd>
<p>ISO 24760 term, describing an entity responsible for management of credentials in a domain.</p>
<div class="paragraph">
<p>ISO 24760 term: credential service provider</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-credential">Credential</a></p>
</div>
</dd>
<dt><a id="glossterm-cross-domain"></a>Cross-domain</dt>
<dd>
<p>Anything that involves interaction between two or more domains. Specifically in context of identity and access management, it usually means transfer of information between domains that are under separate control, or transfer of information that needs to be somehow limited (e.g. only a subset of attributes is transferred).</p>
<div class="paragraph">
<p>Cross-domain techniques employ special mechanism to protect the information, or to make transfer between domains more reliable or secure. For example, special identifiers (often ephemeral pseudonyms) are used to refer to identity data.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-domain">Domain</a>, <a href="#glossterm-identity-provider">Identity Provider</a>, <a href="#glossterm-relying-party">Relying Party</a>, <a href="#glossterm-identity-federation">Identity Federation</a></p>
</div>
</dd>
<dt><a id="glossterm-cyberattack"></a>Cyberattack</dt>
<dd>
<p>Cyberattack is a an intentional effort to steal, destroy, expose, alter, disable or gain unauthorized access to information systems and data (information asset). Cyberattack is a cybersecurity breach.</p>
<div class="paragraph">
<p>Alternative terms: Cyber attack</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity">Cybersecurity</a>, <a href="#glossterm-cybersecurity-incident">Cybersecurity incident</a></p>
</div>
</dd>
<dt><a id="glossterm-cybersecurity"></a>Cybersecurity</dt>
<dd>
<p>Cybersecurity is a protection of information systems, usually focused on systems connected to the Internet. It is a broad practice, including protection of systems, networks, software and data. It involves technology as well as people, policies and processes. Cybersecurity is a continuous, never-ending effort to make the systems secure, and keep them secure. Most comprehensive and systematic cybersecurity techniques are based on risk-based approach.</p>
<div class="paragraph">
<p>Alternative terms: Information security</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity-governance">Cybersecurity governance</a>, <a href="#glossterm-cyberattack">Cyberattack</a>, <a href="#glossterm-risk-based-approach">Risk-based approach</a></p>
</div>
</dd>
<dt><a id="glossterm-cybersecurity-event"></a>Cybersecurity event</dt>
<dd>
<p>Cybersecurity event is a event affecting cybersecurity of an organization. It is an occurrence of system, service or network state, indicating possible breach of information security.</p>
<div class="paragraph">
<p>Alternative terms: Information security event</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-event">Event</a>, <a href="#glossterm-cybersecurity-incident">Cybersecurity incident</a>, <a href="#glossterm-cyberattack">Cyberattack</a></p>
</div>
</dd>
<dt><a id="glossterm-cybersecurity-governance"></a>Cybersecurity governance</dt>
<dd>
<p>Cybersecurity governance is a set of systematic activities to direct and control implementation of cybersecurity. Governance is a process of setting up and maintaining policies and rules to govern cybersecurity activities. It includes cybersecurity programs, policies, processes, decision-making hierarchies, mitigation plans, cybersecurity systems and especially oversight processes and procedures. Cybersecurity governance assumes existence and systemic application of cybersecurity strategy.</p>
<div class="paragraph">
<p>Alternative terms: Information security governance</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity">Cybersecurity</a>, <a href="#glossterm-isms">Information security management system</a>, <a href="#glossterm-cybersecurity-resilience">Cybersecurity resilience</a>, <a href="#glossterm-risk-management">Risk management</a></p>
</div>
</dd>
<dt><a id="glossterm-cybersecurity-incident"></a>Cybersecurity incident</dt>
<dd>
<p>Cybersecurity incident is unwanted or unexpected cybersecurity event, impacting cybersecurity of an organization. Cyberattack is the usual type of cybersecurity incidents. Cybersecurity incidents include situations, where security breach cannot be proven, however there is a siginificant probability that security of information and systems might have been affected.</p>
<div class="paragraph">
<p>Alternative terms: Information security incident, Incident</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-event">Event</a>, <a href="#glossterm-cybersecurity-event">Cybersecurity event</a>, <a href="#glossterm-cyberattack">Cyberattack</a>, <a href="#glossterm-cybersecurity-incident-management">Cybersecurity incident management</a></p>
</div>
</dd>
<dt><a id="glossterm-cybersecurity-incident-management"></a>Cybersecurity incident management</dt>
<dd>
<p>Cybersecurity incident management is set of processes and systems to manage cybersecurity incidents. It includes detection, recording, reporting, assessing and responding to incidents. Cybersecurity incident management systems are also used to learn from the incidents, with the goal to improve information security management system (ISMS).</p>
<div class="paragraph">
<p>Alternative terms: Information security incident management, Incident management</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity-incident">Cybersecurity incident</a></p>
</div>
</dd>
<dt><a id="glossterm-cybersecurity-professional"></a>Cybersecurity professional</dt>
<dd>
<p>Cybersecurity professional is a competent person who implements, maintains and improves cybersecurity practices.</p>
<div class="paragraph">
<p>Alternative terms: Information security professional, ISMS professional, Information security practitioner</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity">Cybersecurity</a>, <a href="#glossterm-cybersecurity-governance">Cybersecurity governance</a></p>
</div>
</dd>
<dt><a id="glossterm-cybersecurity-resilience"></a>Cybersecurity resilience</dt>
<dd>
<p>Cybersecurity resilience is a combination of processes, procedures and governance measures to ensure continuous operation of cybersecurity mechanism. It includes mechanisms to maintain appropriate levels of cybersecurity, as well as necessary improvement of cybersecurity measures to reflect increased threats.</p>
<div class="paragraph">
<p>Alternative terms: Information security resilience, Information security continuity</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity">Cybersecurity</a>, <a href="#glossterm-cybersecurity-governance">Cybersecurity governance</a></p>
</div>
</dd>
<dt><a id="glossterm-cybersecurity-standard"></a>Cybersecurity standard</dt>
<dd>
<p>Cybersecurity standard is a formal specification describing requirements and methods for appropriate implementation of cybersecurity.</p>
<div class="paragraph">
<p>Alternative terms: Information security standard</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-compliance">Compliance</a>, <a href="#glossterm-risk-criteria">Risk criteria</a></p>
</div>
</dd>
<dt><a id="glossterm-cyber-hygiene"></a>Cyber hygiene</dt>
<dd>
<p>Cyber hygiene is a cybersecurity principle and/or practice. As an analogy to personal hygiene, cyber hygiene requires users to establish routine measures to minimize their cybersecurity risk. It often refers to personal cybersecurity routines such as proper password management, malware protection and data back-up. However, in a broader organizational scope, it also includes infrastructural cybersecurity measures, such as zero-trust principles, software updates, device configuration, network segmentation, identity and access management and user awareness trainings.</p>
<div class="paragraph">
<p>Alternative terms: Digital hygiene</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-zero-trust">Zero trust</a></p>
</div>
</dd>
<dt><a id="glossterm-data-governance"></a>Data Governance</dt>
<dd>
<p>Data governance is a data management concept aimed at maintenance of high data quality, through management of data lifecycle and implementation of appropriate data quality controls. Identity governance and administration (IGA) field is concerned with governance of identity data.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-data-provenance">Data Provenance</a>, <a href="#glossterm-data-minimization">Data Minimization</a>, <a href="#glossterm-metadata">Metadata</a>, <a href="#glossterm-iga">Identity Governance and Administration</a>, <a href="#glossterm-privacy">Privacy</a></p>
</div>
</dd>
<dt><a id="glossterm-data-minimization"></a>Data Minimization</dt>
<dd>
<p>A process of reducing the amount of data to the necessary minimum required for processing.</p>
<div class="paragraph">
<p>Data minimization often takes place in context of privacy and personal data protection, minimizing identity data to the necessary minimum.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Minimization</p>
</div>
<div class="paragraph">
<p>X.1252 term: data minimization</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-privacy">Privacy</a>, <a href="#glossterm-personal-data-protection">Personal Data Protection</a>, <a href="#glossterm-data-governance">Data Governance</a></p>
</div>
</dd>
<dt><a id="glossterm-data-origin"></a>Data Origin</dt>
<dd>
<p>Organization or entity that have created or assigned a particular value. Origin is often part of data provenance, description of the method how a value was acquired by a system.</p>
<div class="paragraph">
<p>Origin may be relative, describing only an immediate origin of the information, a "previous hop, a system that have relayed the information to our system. Such origin may not have created or assigned the information, it may have only relayed or copied the information originated in a third system. Origin is often recorded in a form of metadata.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Origin, Domain of Origin</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: domain of origin</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a>, <a href="#glossterm-data-provenance">Data Provenance</a></p>
</div>
</dd>
<dt><a id="glossterm-data-provenance"></a>Data Provenance</dt>
<dd>
<p>Description of the method how a value was acquired by a system. Provenance information almost always contains description of data origin. It is supplemented by additional information, such as timestamps and assurance information.</p>
<div class="paragraph">
<p>Provenance may be relative, describing only an immediate origin of the information, a "previous hop, a system that have relayed the information to our system. In other cases, provenance information may include a complete path from the ultimate origin of the information, describing all the systems that it has passed and all the transformations that were applied. Provenance is often recorded in a form of metadata.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Provenance</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-data-origin">Data Origin</a>, <a href="#glossterm-metadata">Metadata</a>, <a href="#glossterm-data-governance">Data Governance</a></p>
</div>
</dd>
<dt><a id="glossterm-decentralized-identifier"></a>Decentralized Identifier (DID)</dt>
<dd>
<p>An identifier that does not require centralized registration authority. Technologies supporting decentralized identifiers vary, many of them are based on distributed ledger technologies (e.g. blockchain).</p>
<div class="paragraph">
<p>X.1252 term: decentralized identifier</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-decentralized-identity">Decentralized Identity</a>, <a href="#glossterm-self-sovereign-identity">Self-Sovereign Identity</a></p>
</div>
</dd>
<dt><a id="glossterm-decentralized-identity"></a>Decentralized Identity (DID)</dt>
<dd>
<p>An identity that does not require centralized registration authority, identity provider, identity data store or any other centralized system to function. Decentralized identity systems are usually built to be self-sovereign.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-decentralized-identifier">Decentralized Identifier</a>, <a href="#glossterm-self-sovereign-identity">Self-Sovereign Identity</a>, <a href="#glossterm-verifiable-credentials">Verifiable Credentials</a></p>
</div>
</dd>
<dt><a id="glossterm-delegated-administration"></a>Delegated Administration</dt>
<dd>
<p>Type of administration where chosen users have administrator permissions. They can manage other users, create passwords for them, move them into groups, assign them roles, etc.</p>
</dd>
<dt><a id="glossterm-delta"></a>Delta</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Delta is a data structure describing a change in data. It describes the data items (and values) that were added, removed or replaced. Delta is a relativistic data structure, it contains only the data that were changed.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/devel/prism/concepts/deltas/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Prism Delta</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-prism">Prism</a></p>
</div>
</dd>
<dt><a id="glossterm-digital-identity"></a>Digital Identity</dt>
<dd>
<p>Digital representation of identity: set of characteristics, qualities, believes and behaviors of en entity, usually represented as a set of attributes. Digital identity forms unique representation of a subject engaged in an online transaction. While digital identity is always unique in the context of a digital service, but does not necessarily need to be traceable back to a specific real-life subject (linkability).</p>
<div class="paragraph">
<p>Digital identity should not be confused with identifier. Digital identity is a set of characteristics (complex data), while identifier is (usually simple) value used to refer to digital identity.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Identity, Network Identity, User Profile</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity information</p>
</div>
<div class="paragraph">
<p>X.1252 term: digital identity</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity">Identity</a>, <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a>, <a href="#glossterm-entity">Entity</a>, <a href="#glossterm-linkability">Linkability</a></p>
</div>
</dd>
<dt><a id="glossterm-digital-identity-attribute"></a>Digital Identity Attribute</dt>
<dd>
<p>A value representing a characteristic or property of an entity. An attribute is a part of digital identity.</p>
<div class="paragraph">
<p>Alternative terms: Attribute</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: attribute</p>
</div>
<div class="paragraph">
<p>X.1252 term: attribute</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity">Digital Identity</a>, <a href="#glossterm-identifier">Identifier</a>, <a href="#glossterm-entity">Entity</a>, <a href="#glossterm-claim">Claim</a></p>
</div>
</dd>
<dt><a id="glossterm-digital-certificate"></a>Digital Certificate</dt>
<dd>
<p>Digital document, containing an information protected by cryptographic means. Digital certificates are usually used to bind an information to a digital identity. Perhaps the most common use of certificates are certificates of public keys, binding public key to identity of the owner, signed by a trusted third party (certificate authority). The most prominent specification of a format of such digital certificate is X.509.</p>
<div class="paragraph">
<p>Alternative terms: Certificate</p>
</div>
<div class="paragraph">
<p>X.1252 term: certificate</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-certificate-authority">Certificate Authority</a>, <a href="#glossterm-trusted-third-party">Trusted Third Party</a></p>
</div>
</dd>
<dt><a id="glossterm-digital-wallet"></a>Digital Wallet</dt>
<dd>
<p>Physical or virtual device designed to securely store small amount of sensitive information, usually storing credentials. Digital wallets can have variety of forms, ranging from tamper-proof physical devices, to simple programming libraries. It is expected that appropriate level of mechanisms to protect the data exist in all such forms. E.g. virtual wallets usually protect the data using a key or a passphrase.</p>
<div class="paragraph">
<p>Digital wallets are often used to store verifiable credentials or credentials for cryptocurrency schemes. The actual information that the wallet protects is usually a private or secret key associated with the credential.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-verifiable-credentials">Verifiable Credentials</a></p>
</div>
</dd>
<dt><a id="glossterm-directory-service"></a>Directory Service</dt>
<dd>
<p>A database intended as a store of simple objects, shared between applications. Directory services are often used to store identity data. The data are used by other applications, that are accessing the directory service by using a well-known protocol. Lightweight Directory Access Protocol (LDAP) is the most common protocol used to access directory services.</p>
<div class="paragraph">
<p>Directory services used to be the usual method to implement functionality of identity data store. However, other databases and technologies are used to implement similar functionality.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Directory Server</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-data-store">Identity Data Store</a>, <a href="#glossterm-ldap">Lightweight Directory Access Protocol</a></p>
</div>
</dd>
<dt><a id="glossterm-documented-information"></a>Documented information</dt>
<dd>
<p>Information required to be created and maintained by an organization, usually for the purposes of compliance. Documented information may be in form of documents, documented processes, content of information systems, records of activities or any similar information.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-compliance">Compliance</a>, <a href="#glossterm-audit-trail">Audit trail</a></p>
</div>
</dd>
<dt><a id="glossterm-domain"></a>Domain</dt>
<dd>
<p>An environment under an autonomous control. A domain is often an organization, managing a set of information systems and databases, keeping the information consistent. However, it may also refer to a smaller information set within an organization, such as a single database or directory server.</p>
<div class="paragraph">
<p>Identifiers are often designed to be unique within a particular domain, such as an organization or a database.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Domain of applicability, Realm, Context, Scope</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: domain</p>
</div>
<div class="paragraph">
<p>X.1252 term: domain</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity">Digital Identity</a>, <a href="#glossterm-identifier">Identifier</a>, <a href="#glossterm-internal-context">Internal context</a></p>
</div>
</dd>
<dt><a id="glossterm-effectiveness"></a>Effectiveness</dt>
<dd>
<p>Effectiveness is a measure of extent to which activities are realized and desired results are achieved.</p>
</dd>
<dt><a id="glossterm-enrollment"></a>Enrollment</dt>
<dd>
<p>A process of entering new identity data into a specific system (usually in a domain). Enrollment usually involves validation and verification of the information and its origin, such as verification of identity assertion that relied the information to the system.</p>
<div class="paragraph">
<p>The terms "enrollment", "registration" and "onboarding" are overlapping and they are often used as synonyms. Strictly speaking, "enrollment" is the verification process, "registration" is an act of recording information to data store, and "onboarding" is a complete business process making sure that a new person in an organization is well-equipped for activities within the organization.</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: enrollment</p>
</div>
<div class="paragraph">
<p>X.1252 term: enrollment</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-registration">Identity Registration</a>, <a href="#glossterm-onboarding">Onboarding</a>, <a href="#glossterm-identity-assertion">Identity Assertion</a></p>
</div>
</dd>
<dt><a id="glossterm-entitlement"></a>Entitlement</dt>
<dd>
<p>A privilege or right of access given to the user. An "entitlement" is a very overloaded term. It can be used to represent any kind of privilege, ranging from a very high-level business role to the finest filesystem permission in a specific system.</p>
<div class="paragraph">
<p>In midPoint terminology: An Entitlement is a resource object representing privilege, access right, resource-side role, group or any similar concept. However, unlike account, the entitlement does not represent a user.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Privilege, Access Right, Permission</p>
</div>
<div class="paragraph">
<p>X.1252 term: privilege</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-privileged-entitlement">Privileged entitlement</a>, <a href="#glossterm-static-entitlement">Static Entitlement</a></p>
</div>
</dd>
<dt><a id="glossterm-entity"></a>Entity</dt>
<dd>
<p>Being (such as person or animal), thing, concept or anything else that has recognizably distinct existence. An entity is usually described by a set of characteristics, known as its identity. An entity can have several identities.</p>
<div class="paragraph">
<p>In some interpretations (usually legislation), "entity" is limited to natural and legal persons that are recognized in context of the legislation, able to exercise its rights and be subject to obligations.</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: entity</p>
</div>
<div class="paragraph">
<p>X.1252 term: entity</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity">Identity</a>, <a href="#glossterm-digital-identity">Digital Identity</a></p>
</div>
</dd>
<dt><a id="glossterm-ephemeral-identifier"></a>Ephemeral Identifier</dt>
<dd>
<p>An identifier used only for a very short duration. Ephemeral identifiers are valid usually only during a single session, or even during a single protocol exchange (e.g. authentication). Ephemeral identifiers are almost always randomly-chosen. When ephemeral identifiers refer to a digital identity, they are efficiently a short-lived pseudonyms.</p>
<div class="paragraph">
<p>ISO 24760 term: ephemeral identifier</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identifier">Identifier</a>, <a href="#glossterm-pseudonym">Pseudonym</a></p>
</div>
</dd>
<dt><a id="glossterm-event"></a>Event</dt>
<dd>
<p>Event is a significant occurrence or change of circumstances. In cybersecurity, "event" usually means a negative action or occurrence, an incident, such as cyberattack. An event may have several causes and many consequences (outcomes). In a strict sense, an event can consist of something not occurring, e.g. a back-up procedure not running as planned.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity-event">Cybersecurity event</a>, <a href="#glossterm-consequence">Consequence</a>, <a href="#glossterm-cyberattack">Cyberattack</a></p>
</div>
</dd>
<dt><a id="glossterm-external-context"></a>External context</dt>
<dd>
<p>Circumstances external to the organization, which affect the way an organization achieves objectives. It includes broad context, such as national and international environment, including regulatory, legal, technological, economic and natural aspects.</p>
<div class="paragraph">
<p>Alternative terms: Global environment, Externalities</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-internal-context">Internal context</a></p>
</div>
</dd>
<dt><a id="glossterm-federated-identity"></a>Federated Identity</dt>
<dd>
<p>Digital identity intended to be used in several domains, usually by the means of identity federation. Information about federated identity is transferred between domains, usually in a form of identity assertions exchanged between identity providers and relying parties.</p>
<div class="paragraph">
<p>ISO 24760 term: federated identity</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-federation">Identity Federation</a>, <a href="#glossterm-digital-identity">Digital Identity</a></p>
</div>
</dd>
<dt><a id="glossterm-fine-grain-authorization"></a>Fine-Grain Authorization</dt>
<dd>
<p>Authorization made on very detailed information and is providing more detail control within the application operation. E.g. authorization to approve the transaction in an accounting system, with amount up to a certain limit. Typically, fine-grain authorization requires detailed knowledge of both the user profile (attributes) and the operation context (operation name, parameters and their meaning). Due to this requirement, fine-grain application is often implemented directly in application code.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-authorization">Authorization</a>, <a href="#glossterm-coarse-grain-authorization">Coarse-grain Authorization</a></p>
</div>
</dd>
<dt><a id="glossterm-focus"></a>Focus</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: An object that can is a focus of computation, an object central to midPoint computation. The focus is usually a user, but it can be a role, org or a service. Focus is the center of a computation, the hub in hub-and-spoke (star) data synchronization in midPoint. The "spokes" in the computation are represented by projections.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/reference/schema/focus-and-projections/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Focal Object</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-assignment">Assignment</a>, <a href="#glossterm-projection">Projection</a></p>
</div>
</dd>
<dt><a id="glossterm-fulfillment"></a>Fulfillment</dt>
<dd>
<p>Fulfillment is a functionality of identity management (IDM) system, making sure that users have appropriate access to systems. Simply speaking, this is the functionality that creates accounts, associates them with entitlements (e.g. groups), modifies passwords, enables/disables accounts and deletes them in the end. Fulfillment is a name used for identity provisioning together with deprovisioning and associated activities.</p>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/iam/iga/fulfillment/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Provisioning/deprovisioning</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-management">Identity Management</a>, <a href="#glossterm-identity-management-system">Identity Management System</a>, <a href="#glossterm-identity-provisioning">Identity Provisioning</a>, <a href="#glossterm-identity-deprovisioning">Identity Deprovisioning</a>, <a href="#glossterm-manual-fulfillment">Manual Fulfillment</a></p>
</div>
</dd>
<dt><a id="glossterm-gbac"></a>Graph-Based Access Control (GBAC)</dt>
<dd>
<p>Access control model based on a semantic graph modeling an organization. The organization is modeled as a semantic graph. Nodes represent organizational units, functional units (roles) and agents (users), edges represent relationships (e.g. membership, deputy). The model includes a query language, which is used to build the access control matrix.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-rebac">Relationship-Based Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-gdpr"></a>General Data Protection Regulation (GDPR)</dt>
<dd>
<p>General Data Protection Regulation 2016/679 (GDPR) is European Union regulation on personal data protection and privacy. It defines rules for processing of personal data in European Union, European Economic Area, with provisions of the regulation applicable to other parties as well.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-personal-data-protection">Personal Data Protection</a></p>
</div>
</dd>
<dt><a id="glossterm-generic-synchronization"></a>Generic Synchronization</dt>
<dd>
<p>Advanced model of synchronization where not only users and accounts are synchronized, but also groups to roles, organizational units to groups, roles to ACLs and so on.</p>
</dd>
<dt><a id="glossterm-grc"></a>Governance, risk management and compliance (GRC)</dt>
<dd>
<p>Governance, risk management and compliance (GRC) is a discipline that helps organizations to have more control over processes and be more effective. Governance is the set of decisions and actions by which individual processes as well as the whole organization are lead to achieve specific goals. Risk management identifies, predicts and prioritizes risks with aim to minimize them or avoid their negative influence on organizations' aims. Compliance means following certain rules, regulations or procedures. A GRC software facilitates this problematic by taking care of all three parts by one single solution. It is a very helpful tool for business executives, managers or IT directors. Thanks to it it is possible to define, enforce, audit and review policies responsible for the exchange of information between internal systems as well as between the external ones.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity-governance">Cybersecurity governance</a>, <a href="#glossterm-risk-management">Risk management</a>, <a href="#glossterm-compliance">Compliance</a></p>
</div>
</dd>
<dt><a id="glossterm-governing-body"></a>Governing body</dt>
<dd>
<p>Governing body is a person or a group of persons who are responsible and accountable for the performance of an organization, mostly for the purposes of financial performance and regulatory compliance.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-compliance">Compliance</a></p>
</div>
</dd>
<dt><a id="glossterm-holder"></a>Holder</dt>
<dd>
<p>An entity that holds credentials or claims, which usually describe the holder entity. In Triangle of Trust scenarios, the credentials/claims are issued by the issuer and verified by the verifier.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-principal">Principal</a>, <a href="#glossterm-subject">Subject</a>, <a href="#glossterm-triangle-of-trust">Triangle Of Trust</a>, <a href="#glossterm-issuer">Issuer</a>, <a href="#glossterm-verifier">Verifier</a>, <a href="#glossterm-trusted-third-party">Trusted Third Party</a>, <a href="#glossterm-credential">Credential</a>, <a href="#glossterm-claim">Claim</a></p>
</div>
</dd>
<dt><a id="glossterm-identifier"></a>Identifier</dt>
<dd>
<p>A value, or a set of values, that uniquely identify an identity in a certain scope.</p>
<div class="paragraph">
<p>An identity usually have several identifiers, used in various situations and contexts. Identifiers may be compound, composed of several values.</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identifier</p>
</div>
<div class="paragraph">
<p>X.1252 term: identifier</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity">Identity</a>, <a href="#glossterm-digital-identity">Digital Identity</a>, <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a>, <a href="#glossterm-entity">Entity</a></p>
</div>
</dd>
<dt><a id="glossterm-identification"></a>Identification</dt>
<dd>
<p>A process of recognizing an identity as distinct from other identities in a particular scope or context. Identification is almost always performed by processing identifiers, using them to reference an identity in an identity database.</p>
<div class="paragraph">
<p>Identification is a process distinct from authentication. Authentication is a process of proving an identity (verification), whereas identification does not assume any such proof.</p>
</div>
<div class="paragraph">
<p>The term "identification" usually refers to a process of looking up identity data based on a simple identifier, such as username or reference identifier. In some cases, process of identification involves a correlation, looking up or matching identity information in a more complex way. For example, a system may compare registration data entered by the user with the content of its identity database, in an attempt to determine whether such user is already registered.</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identification</p>
</div>
<div class="paragraph">
<p>X.1252 term: identification</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity">Digital Identity</a>, <a href="#glossterm-identifier">Identifier</a>, <a href="#glossterm-authentication">Authentication</a>, <a href="#glossterm-identity-correlation">Identity Correlation</a></p>
</div>
</dd>
<dt><a id="glossterm-identity"></a>Identity</dt>
<dd>
<p>The fact of being who or what a person or thing is. Set of characteristics, qualities, believes, behaviors and other aspects of en entity. Identity can be applied to persons, things, even intangible concepts, known as entities. An entity can have several identities (often known as personas). In context of information technologies, parts of identity can be usually represented in a form of digital record, known as digital identity.</p>
<div class="paragraph">
<p>Identity should not be confused with identifier. Identity is a set of characteristics, while identifier is a value used to refer to identity.</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity</p>
</div>
<div class="paragraph">
<p>X.1252 term: identity</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identifier">Identifier</a>, <a href="#glossterm-digital-identity">Digital Identity</a>, <a href="#glossterm-entity">Entity</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-and-access-management"></a>Identity and Access Management (IAM)</dt>
<dd>
<p>Identity and access management (IAM) is a field concerned with managing identities (e.g. users) and their access to systems and applications. IAM is concerned with all the aspects dealing with "identity", with many subfields that specialize in selected aspects. Access management deals (AM) especially with access to applications, including authentication and (partially) authorization. Identity management and governance (IGA) deals with management of user data (e.g. user profiles), synchronization of identity data and applying policies. Other IAM subfields deal with storage of identity data, transfer of the data over the network and so on.</p>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/iam/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-management">Identity Management</a>, <a href="#glossterm-iga">Identity Governance and Administration</a>, <a href="#glossterm-access-management">Access Management</a>, <a href="#glossterm-identity-data-store">Identity Data Store</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-assertion"></a>Identity Assertion</dt>
<dd>
<p>Statement made by an identity provider regarding properties or behavior of an identity. Assertions are used by relying parties. The most common assertion is perhaps authentication assertion, relying information about authentication event from identity provider to relying party. Assertions may contain other information as well, usually identity attributes and authorization decisions.</p>
<div class="paragraph">
<p>Alternative terms: Assertion, Claim</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity assertion</p>
</div>
<div class="paragraph">
<p>X.1252 term: claim</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a>, <a href="#glossterm-identity-provider">Identity Provider</a>, <a href="#glossterm-relying-party">Relying Party</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-based-security"></a>Identity-based Security</dt>
<dd>
<p>Identity-based security is a approach to cybersecurity, focused on concept of identity. It places identities in the center of cybersecurity mind-set, adjusting cybersecurity design and practices around identities. Identity-based security is concerned with the identity that initiates an action, or identity that is responsible for an action, object or configuration. Simply speaking, identity-based security tries to make sure that access to service or information is provided to a specific identity, and only to the identity that is entitled for such access. Identity-based security is not limited to identity of persons. Identities of machines, services, devices, networks and similar technological and virtual concepts (non-human identities, NHI) are included as well.</p>
<div class="paragraph">
<p>Identity-based security relies on dynamic policies based on the identity of the actor, as well as context of the operation or situation. Unlike traditional approaches, identity-based security is not fixed, it does not assume static world where an operation is allowed once and for all, and stays allowed for ever. Policies in identity-based security are dynamic, they are meant to be continuously applied, maintained, reviewed and improved, dynamically adapting to the environment and requirements.</p>
</div>
<div class="paragraph">
<p>Identity-based security is fundamental foundation for zero-trust approach.</p>
</div>
<div class="paragraph">
<p>Note: Identity-based security should not be confused with "identity security", which is a vastly overloaded term used mostly for marketing purposes.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Identity-first security, Identity-centric security, Identity-defined security, Identity defense in depth</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity">Cybersecurity</a>, <a href="#glossterm-iga">Identity Governance and Administration</a>, <a href="#glossterm-zero-trust">Zero trust</a>, <a href="#glossterm-identity-security">Identity Security</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-correlation"></a>Identity Correlation</dt>
<dd>
<p>Process of comparing identity information, with an aim to find a matching identity. Correlation is usually employed during identity enrollment or registration, when a system determines whether the new identity is already known to the system. For example, a system may compare registration data entered by the user with the content of its identity database, in an attempt to determine whether such user is already registered. If such a comparison involves simple and reliable identifiers (such as username or employee number), it is called "identification". However, in many cases such identifiers are not available, and the system needs to combine several identifiers or employ sophisticated techniques to find matching identity. Some identity correlation techniques involve probabilistic matching techniques or machine learning methods to find suitable candidates, which are later reviewed by human operator.</p>
<div class="paragraph">
<p>Alternative terms: Identity Matching</p>
</div>
<div class="paragraph">
<p>X.1252 term: correlation</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identification">Identification</a>, <a href="#glossterm-enrollment">Enrollment</a>, <a href="#glossterm-identity-registration">Identity Registration</a>, <a href="#glossterm-identifier">Identifier</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-connector"></a>Identity Connector</dt>
<dd>
<p>Usually small and simple unit of code that connects to a remote system. The purpose of identity connector is to retrieve and manage identity information, such as information about user accounts, groups and organizational units. The connectors are usually written for and managed by a particular connector framework.</p>
<div class="paragraph">
<p>Alternative terms: Connector</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-connector-framework">Identity Connector Framework</a>, <a href="#glossterm-connid">ConnId</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-connector-framework"></a>Identity Connector Framework</dt>
<dd>
<p>Generally speaking, a programing framework (library) for creating and managing identity connectors. However, this rather generic term often refers to the Identity Connector Framework (ICF), originally developed by Sun Microsystem in 2000s. The ICF was releases as an open source project by Sun, only to be later abandoned after Sun-Oracle merger. The ICF was a base for several forks, including ConnId and OpenICF.</p>
<div class="paragraph">
<p>Alternative terms: Connector Framework, ICF</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-connector">Identity Connector</a>, <a href="#glossterm-connid">ConnId</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-data-source"></a>Identity Data Source</dt>
<dd>
<p>A system that is the source of identity data, usually data about users. The data are usually created and maintained in such systems manually. There are often multiple identity data sources in an organization with various characteristics. Some data sources are considered authoritative, providing reliable information about identities. Other data sources usually contain user-provided information, such as data entered by the user during registration process. Almost all data sources contain partial information only, information that is limited both in breadth (only some identity types) and depth (only some attributes). Data source may be an intermediary, providing information acquired from other systems.</p>
<div class="paragraph">
<p>Alternative terms: Source System</p>
</div>
</dd>
<dt><a id="glossterm-identity-data-store"></a>Identity Data Store</dt>
<dd>
<p>A database, designed and/or dedicated to store identity-related data. Identity data store is usually shared among many applications, it is accessed by many systems reading the data. Applications read data from identity data stores, often using them for authorization, and sometimes even authentication purposes. Structure of data in the data store is often application-friendly, containing pre-processed and derived information. Identity data store also usually contain entitlements, or similar information that can be used for authorization purposes. There are usually several identity data stores in an organization, managed and synchronized by an identity management system.</p>
<div class="paragraph">
<p>Traditionally, directory servers (such as LDAP serves) are used as identity data stores.</p>
</div>
<div class="paragraph">
<p>Identity data store is similar to identity register, and in fact many identity data stores are identity registers. The difference is that identity register has a more formal data structure, usually functioning as an authoritative data source. Whereas identity data store usually contains information copied from other system, including application-friendly derived data. However, the exact boundary between functions of identity register and identity data store is not exactly defined.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Identity Store, Identity Database, Directory Service</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-register">Identity Register</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-deprovisioning"></a>Identity Deprovisioning</dt>
<dd>
<p>Identity deprovisioning is as well as identity provisioning a subfield of Identity and Access Management (IAM). It is an opposite to identity provisioning. While identity provisioning takes care of creating new accounts, determining the roles for individual users and their rights or making changes in them, deprovisioning works oppositely. When an employee leaves the company, his account is deactivated or deleted and he loses all the accesses to both internal and external systems. This way organization minimizes information theft and stays secure. Identity provisioning together with deprovisioning and associated activities is known as "fulfillment".</p>
<div class="paragraph">
<p>Alternative terms: Deprovisioning, Revocation</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-fulfillment">Fulfillment</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-evidence"></a>Identity Evidence</dt>
<dd>
<p>Data and documents that support verification of identity data (identity proofing). Identity evidence is used in identity proofing process to achieve higher level of assurance of identity information.</p>
<div class="paragraph">
<p>Alternative terms: Evidence of Identity, Identity Proof</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity evidence</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-proofing">Identity Proofing</a>, <a href="#glossterm-level-of-assurance">Level of Assurance</a>, <a href="#glossterm-verification">Verification</a>, <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-federation"></a>Identity Federation</dt>
<dd>
<p>Identity federation is an agreement between several domains, specifying the details of exchange and use of shared identity information. The information in identity federation is usually transferred by the means of identity assertions, exchanged between identity providers and relying parties.</p>
<div class="paragraph">
<p>From user&#8217;s point of view, identity federation is a process of sharing user&#8217;s identification and personal data between multiple systems and between organizations, so the user doesn&#8217;t have to register for each organization separately and can seamlessly access systems in federated organizations.</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity federation</p>
</div>
<div class="paragraph">
<p>X.1252 term: federation</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-domain">Domain</a>, <a href="#glossterm-federated-identity">Federated Identity</a>, <a href="#glossterm-identity-assertion">Identity Assertion</a>, <a href="#glossterm-identity-provider">Identity Provider</a>, <a href="#glossterm-relying-party">Relying Party</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-governance"></a>Identity Governance</dt>
<dd>
<p>Business aspect of managing identities including business processes, rules, policies and organizational structures. Any complete solution for management of identities consists of two major parts â€“ identity governance and identity management. Identity governance is primarily concerned with establishing and maintaining policies and rules, while identity management is implementing such policies. As such, identity governance is closer to high-level business environment, while identity management is concerned mostly with underlying technology.</p>
<div class="paragraph">
<p>Alternative terms: Governance</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-iga">Identity Governance and Administration</a>, <a href="#glossterm-grc">Governance, risk management and compliance</a>, <a href="#glossterm-identity-management">Identity Management</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-information-authority"></a>Identity Information Authority (IIA)</dt>
<dd>
<p>ISO 24760 term, referring to an entity related to a particular domain that can make provable statements on the validity and/or correctness of one or more attribute values in an identity.</p>
<div class="paragraph">
<p>ISO 24760 term: identity information authority</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-provider">Identity Provider</a>, <a href="#glossterm-domain">Domain</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-lifecycle"></a>Identity Lifecycle</dt>
<dd>
<p>Set of identity stages from creation to its deactivation or deletion. It contains creation of an account, assignment of correct groups and permissions, setting and resetting passwords and in the end deactivation or deletion of the account.</p>
<div class="paragraph">
<p>Alternative terms: Identity lifecycle management</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-deprovisioning">identity-provisioning,</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-management"></a>Identity Management (IDM)</dt>
<dd>
<p>Identity Management (IDM) is a process of managing digital identities and their accesses to specific resources in the cyberspace. It ensures appropriate access in appropriate time and helps to manage user accounts as well as to synchronize data. Identity management deals with digital identity lifecycle, managing values of digital identity attributes and entitlements.</p>
<div class="paragraph">
<p>Alternative terms: Identity Administration, User management, User provisioning</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity management</p>
</div>
<div class="paragraph">
<p>X.1252 term: identity management</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-access-management">Access Management</a>, <a href="#glossterm-identity-lifecycle">Identity Lifecycle</a>, <a href="#glossterm-identity-provisioning">Identity Provisioning</a>, <a href="#glossterm-iga">Identity Governance and Administration</a>, <a href="#glossterm-digital-identity">Digital Identity</a>, <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-management-system"></a>Identity Management System (IDMS)</dt>
<dd>
<p>A system that provides identity management functionality: it is managing identities and their accesses to specific resources in the cyberspace. It ensures appropriate access in appropriate time and helps to manage user accounts as well as to synchronize data.</p>
<div class="paragraph">
<p>Identity management (IDM) systems are concerned about the "management" side, maintaining user data, policies, roles, entitlements and so on. IDM systems usually do not "apply" or enforce the policies. The policies are transformed as needed and provisioned to other systems (a.k.a. "target systems") that interpret and enforce the policies. The process of provisioning (and "deprovisioning") of data and policies is known as "fulfillment".</p>
</div>
<div class="paragraph">
<p>In a broad sense, IDM systems are used to manage the policies and data in all connected systems in the organization. IDM systems make sure that the data are consistent, that all the policies are applied, that user profile data are up-to-date, detecting and removing illegal access and generally keep all identity-related information in order across all the systems.</p>
</div>
<div class="paragraph">
<p>Note: ISO 24760 definition seems to include identification and authentication as functions of identity management systems. While almost all IDM systems implement such functions, they are mostly used for internal purposes, e.g. for system administration access. IDM system usually do not provide identification and authentication services to other systems. ISO 24760 definition is closer to definition of identity and access management (IAM) system. However, complete IAM functionality is usually provided by a combination of several systems in practice.</p>
</div>
<div class="paragraph">
<p>Alternative terms: IDM System, Provisioning System, User Provisioning System</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity management system</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-management">Identity Management</a>, <a href="#glossterm-identity-lifecycle">Identity Lifecycle</a>, <a href="#glossterm-identity-provisioning">Identity Provisioning</a>, <a href="#glossterm-iga">Identity Governance and Administration</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-proofing"></a>Identity Proofing</dt>
<dd>
<p>Verification of evidence to make sure that identity information are true and up-to-date. Identity proofing is used to achieve higher level of assurance of identity information.</p>
<div class="paragraph">
<p>Identity proofing should not be confused with authentication. Identity proofing is used to establish the link between identities and/or subjects/entities. However, identity proofing does not necessarily provide assurance that the entity currently interacting with a service is in fact the same entity that was initially established.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Initial Entity Authentication</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity proofing</p>
</div>
<div class="paragraph">
<p>X.1252 term: identity proofing</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a>, <a href="#glossterm-level-of-assurance">Level of Assurance</a>, <a href="#glossterm-linkability">Linkability</a>, <a href="#glossterm-authentication">Authentication</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-provider"></a>Identity Provider (IdP)</dt>
<dd>
<p>System that provides identity-related information to applications (known in this context as "relying party" or "service provider"). Such information usually includes user identifiers (which may be ephemeral), user name(s) and affiliation. The information is usually provided in form of identity assertions (claims).</p>
<div class="paragraph">
<p>Identity providers are often authenticating the users. In that case, identity providers usually include information describing the authentication, such as statement that user was authenticated and indication of authentication mechanism strength. Identity provider authenticates the users in its own capacity, it never reveals user&#8217;s credentials to the application (relying party). In fact, many identity providers are focused on authentication only, providing only a very minimal identity information (often just a single identifier), in which case the authentication-related information forms the most important part of provided information. Such identity providers effectively work as cross-domain single sign-on (SSO) systems.</p>
</div>
<div class="paragraph">
<p>Although most identity providers include user authentication, there are also providers that do not (directly) authenticate the users, sometimes called "attribute providers". Identity provider may provide also additional information of the user to the application, such as information about user attributes and entitlements.</p>
</div>
<div class="paragraph">
<p>Identity provider is often managed by a different organization than the relying applications (service providers), thus providing cross-domain identity mechanism. Typical protocols and frameworks used by identity providers include: SAML, OpenID Connect, CAS</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity information provider</p>
</div>
<div class="paragraph">
<p>X.1252 term: identity service provider</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-relying-party">Relying Party</a>, <a href="#glossterm-identity-federation">Identity Federation</a>, <a href="#glossterm-cross-domain">Cross-domain</a>, <a href="#glossterm-identity-assertion">Identity Assertion</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-provisioning"></a>Identity Provisioning</dt>
<dd>
<p>In broad sense, identity provisioning is a subfield of Identity Management (IDM), concerned with technical aspects of creating user accounts, groups and other objects in target systems. It is a technology thanks to which many identity stores are synchronized, merged and maintained. Identity provisioning takes care of technical tasks during the whole user lifecycle - when new employee is hired, when his responsibilities change or he leaves the company (deprovisioning). It helps the organization to work more effectively as its goal is to automate as much as possible.</p>
<div class="paragraph">
<p>The provisioning system usually takes information about employees from the Human Resource (HR) system. When new employee is recorded into HR system, this information is detected and pulled by the provisioning system. After that, it is processed to determine set of roles each user should have. These roles determine and create accounts users should have, so everything is ready for new users on the very first day. If a user is transferred to another department or his privileges change, similar processes happen again. If an employee leaves the company, identity provisioning systems makes sure all his accounts are closed.</p>
</div>
<div class="paragraph">
<p>In a specific sense, identity provisioning means a process of creating accounts, assigning entitlements and similar actions, making sure a user has appropriate access to information systems. Identity provisioning together with deprovisioning and associated activities is known as "fulfillment".</p>
</div>
<div class="paragraph">
<p>Alternative terms: User provisioning, Provisioning</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-management">Identity Management</a>, <a href="#glossterm-identity-lifecycle">Identity Lifecycle</a>, <a href="#glossterm-fulfillment">Fulfillment</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-register"></a>Identity Register</dt>
<dd>
<p>A repository (database) of identity information, usually structured in a formal manner. Identity registers are almost always indexed using a reference identifier. They are usually designed for a specific purpose of being an authoritative data sources for other systems.</p>
<div class="paragraph">
<p>Identity register is similar to identity data store, and in fact many identity registers function as identity data stores. The difference is that identity data store has less formal, usually application-friendly data structure, containing pre-processed and derived information. Identity data store also usually contain entitlements, or information that can be used for authorization purposes. However, the exact boundary between functions of identity register and identity data store is not exactly defined.</p>
</div>
<div class="paragraph">
<p>Alternative terms: IMS Register, Reference Register</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity register</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-registration">Identity Registration</a>, <a href="#glossterm-reference-identifier">Reference Identifier</a>, <a href="#glossterm-identity-data-source">Identity Data Source</a>, <a href="#glossterm-identity-data-store">Identity Data Store</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-registration"></a>Identity Registration</dt>
<dd>
<p>A process of recording new identity data into identity register or identity data store. Registration process may involve storing the information is several distinct data stores or registers. The recording process may be indirect, e.g. mediated by synchronization process of an identity management system.</p>
<div class="paragraph">
<p>Informally, the registration process often involves the data acquisition process as well, such as asking user for the data using a form.</p>
</div>
<div class="paragraph">
<p>The terms "enrollment", "registration" and "onboarding" are overlapping and they are often used as synonyms. Strictly speaking, "enrollment" is the verification process, "registration" is an act of recording information to data store, and "onboarding" is a complete business process making sure that a new person in an organization is well-equipped for activities within the organization.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Registration</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: identity registration</p>
</div>
<div class="paragraph">
<p>X.1252 term: registration</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-enrollment">Enrollment</a>, <a href="#glossterm-onboarding">Onboarding</a>, <a href="#glossterm-identity-register">Identity Register</a>, <a href="#glossterm-identity-data-store">Identity Data Store</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-resource"></a>Identity Resource</dt>
<dd>
<p>In IAM field, a Resource is usually a network-accessible asset capable of managing identity information.</p>
<div class="paragraph">
<p>In midPoint terminology: An Resource is a system that is either identity data source or provisioning target. IDM system (midPoint) is managing accounts in that system, feeding data from that system or doing any other combination of identity management operations. Identity resource should not be confused with "web resource" that is used by RESTful APIs.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Provisioning Resource, Resource</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-resource">Resource</a>, <a href="#glossterm-identity-connector">Identity Connector</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-security"></a>Identity Security</dt>
<dd>
<p>Identity security is a vastly overloaded term, usually used for marketing purposes. Depending on the entity describing "identity security", its meaning can range from low-level network security to a high-level identity governance. The common motif seems to be focus on securing the identities, whether the identities represent persons, services or devices, which is a very broad and vague description. Overall, "identity security" does not bring any significant new concept or approach, it is mostly just a marketing description of pre-existing technology and methods.</p>
<div class="paragraph">
<p>Identity security should not be confused with identity-based security, which is a valid approach to cybersecurity.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-based-security">Identity-based Security</a>, <a href="#glossterm-iga">Identity Governance and Administration</a></p>
</div>
</dd>
<dt><a id="glossterm-identity-vigilance"></a>Identity Vigilance</dt>
<dd>
<p>Identity vigilance is a practice of appropriate and responsible management of identity data. It includes proper synchronization of data among information systems and databases, identification of duplicates, handling of data inconsistencies, application of privacy protection and all other practices necessary to ensure that the data are always correct, up-to-date and protected. Identity vigilance is especially important in healthcare, where patient mis-identification or data errors may lead to fatal consequences.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-iga">Identity Governance and Administration</a></p>
</div>
</dd>
<dt><a id="glossterm-iga"></a>Identity Governance and Administration (IGA)</dt>
<dd>
<p>Identity governance and administration (IGA) si a subfield of identity and access management (IAM) dealing with management and governance of identity-related information. IGA systems store, synchronize and manage identity information, such as user profiles. Complex data, entitlement and governance polices can be defined, applied to identity data. IGA system are responsible for evaluating the policies, making sure the data are compliant, addressing policy violations. IGA is often considered an umbrella term covering identity management, identity governance, compliance management, identity-based risk management and other aspects related to management of identities. Identity Governance and Administration (IGA) includes both the technical and business aspects of identity management.</p>
<div class="paragraph">
<p>IGA provides basic foundational platform for identity-based security, zero trust approach, and many other cybersecurity techniques and approaches.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/iam/iga/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-management">Identity Management</a>, <a href="#glossterm-identity-governance">Identity Governance</a>, <a href="#glossterm-grc">Governance, risk management and compliance</a>, <a href="#glossterm-identity-and-access-management">Identity and Access Management</a>, <a href="#glossterm-identity-based-security">Identity-based Security</a></p>
</div>
</dd>
<dt><a id="glossterm-inducement"></a>Inducement</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Inducement is an indirect representation of an assignment, a relation that assigns privileges, organizational membership, policy elements or other midPoint concepts to assignment holder objects (usually users). Inducement has the same data structure as assignment, and very similar functionality. However, while assignment represents direct relation, inducement is indirect. For example, assignment can be used to assign an account or a group membership directly to a user. Inducement can facilitate the same functionality, however it is usually placed in role. As the role is assigned (using an assignment) to the user, inducements placed in the role are indirectly applied to a user.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/reference/roles-policies/assignment/assignment-vs-inducement/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-assignment">Assignment</a>, <a href="#glossterm-role">Role</a></p>
</div>
</dd>
<dt><a id="glossterm-information-classification"></a>Information classification</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Information classification is a process in which organisations assess their data and systems, with regard to the necessary level of protection. The information is classified by assigning information <em>labels</em> or <em>classifications</em> to individual assets, such as databases, filesystems, applications or even individual files.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/reference/classification/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Information labeling, Labeling</p>
</div>
</dd>
<dt><a id="glossterm-information-need"></a>Information need</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Information need is an information necessary to perform certain activity or a task. It is often a basis of "least privilege" principle, providing the minimum necessary information and access to users.</p>
</div>
<div class="paragraph">
<p>Alternative terms: As-needed basis</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-least-privilege">Least Privilege Principle</a></p>
</div>
</dd>
<dt><a id="glossterm-information-processing-facilities"></a>Information processing facilities</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Information processing facilities are all systems processing and storing information, including services, infrastructure and physical locations housing it. They include hardware, software, networks and all necessary equipment to operate them.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-information-system">Information system</a></p>
</div>
</dd>
<dt><a id="glossterm-information-system"></a>Information system</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Information systems are technological systems and applications built for processing and storing information. Information systems include hardware, software, networks and all necessary equipment to operate them. In some context, the "system" also includes the technological and physical environment (e.g. a network) as well as the information (data) processes by the system.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-information-processing-facilities">Information processing facilities</a></p>
</div>
</dd>
<dt><a id="glossterm-integrity"></a>integrity</dt>
<dd>
<p>Integrity is a property of data or a communication channel, describing that the data or content of a communication channel were not modified in unintended way. I.e. it is a property that ensures that data are received in the same exact form as they were transmitted, without any modification or tampering.</p>
<div class="paragraph">
<p>Integrity, together with confidentiality and availability form a "CIA triad", a classical model of information security (cybersecurity).</p>
</div>
<div class="paragraph">
<p>Alternative terms: Data integrity, Integrity of communication</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-confidentiality">Confidentiality</a>, <a href="#glossterm-availability">Availability</a></p>
</div>
</dd>
<dt><a id="glossterm-interested-party"></a>Interested party</dt>
<dd>
<p>Person or organization that can affect, be affected or in any way perceive itself to be involved or affected by a decision, activity or an event. The term "stakeholder" usually describes a person or organization that holds a "stake" in an activity, such as investors or directors of an organization.</p>
<div class="paragraph">
<p>Alternative terms: Stakeholder</p>
</div>
</dd>
<dt><a id="glossterm-internal-context"></a>Internal context</dt>
<dd>
<p>Circumstances internal to the organization, which affect the way an organization achieves objectives. It includes all internal parts and mechanisms of an organization, such as governance, organizational structure, management hierarchy, policies, objectives, responsibilities, resources and capabilities.</p>
<div class="paragraph">
<p>Alternative terms: Local environment, Internals</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-external-context">External context</a>, <a href="#glossterm-domain">Domain</a></p>
</div>
</dd>
<dt><a id="glossterm-isms"></a>Information security management system (ISMS)</dt>
<dd>
<p>Information security management system (ISMS) is a set of policies and procedures for systematically managing cybersecurity of an organization. ISMS includes risk assessment, risk treatment (implementation of controls), risk communication and incident response. Management of cybersecurity is a continuous, never-ending effort, which is meant to be constantly improving. Cybersecurity governance is meant to establish and maintain rules and policies for ISMS, and to provide oversight and consistent improvement of ISMS processes.</p>
<div class="paragraph">
<p>Alternative terms: Cybersecurity management system</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity">Cybersecurity</a>, <a href="#glossterm-cybersecurity-governance">Cybersecurity governance</a>, <a href="#glossterm-risk-assessment">Risk assessment</a>, <a href="#glossterm-risk-treatment">Risk treatment</a>, <a href="#glossterm-risk-communication">Risk communication</a></p>
</div>
</dd>
<dt><a id="glossterm-issuer"></a>Issuer</dt>
<dd>
<p>An entity that issues credentials or claims, usually describing another entity (holder). In Triangle of Trust scenarios, issuer is considered to be trusted third party.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-triangle-of-trust">Triangle Of Trust</a>, <a href="#glossterm-holder">Holder</a>, <a href="#glossterm-verifier">Verifier</a>, <a href="#glossterm-trusted-third-party">Trusted Third Party</a>, <a href="#glossterm-credential">Credential</a>, <a href="#glossterm-claim">Claim</a></p>
</div>
</dd>
<dt><a id="glossterm-joiner-leaver"></a>Joiner-Leaver Processes</dt>
<dd>
<p>Joiner-Leaver are human resources (HR) process, handling employees joining the organization and leaving the organization. They are constrained versions of joiner-mover-leaver processes, not considering movement of employees in organizational structure.</p>
<div class="paragraph">
<p>Alternative terms: Joiners and Leavers</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-joiner-mover-leaver">Joiner-Mover-Leaver Processes</a>, <a href="#glossterm-onboarding">Onboarding</a>, <a href="#glossterm-offboarding">Offboarding</a></p>
</div>
</dd>
<dt><a id="glossterm-joiner-mover-leaver"></a>Joiner-Mover-Leaver Processes (JML)</dt>
<dd>
<p>Joiner-Mover-Leaver (JML) are human resources (HR) process, handling employees joining the organization, moving within organizational structure and leaving the organization. JML process can be understood as handling events of employee lifecycle from the point of view of organizational and business processes. Generally speaking, this process is not limited to employees. However, when similar processes are applied to other types of persons (students, contractors) they are often referred to as "on-boarding" and "off-boarding".</p>
<div class="paragraph">
<p>JML processes are (manual) business processes in their nature. Despite that, the JML processes are important for identity management, as they provide the contextual framework for identity management technology to fit in. Moreover, identity management deployments are usually automating some parts of the JML processes.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Joiners, Movers and Leavers</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-onboarding">Onboarding</a>, <a href="#glossterm-offboarding">Offboarding</a>, <a href="#glossterm-joiner-leaver">Joiner-Leaver Processes</a></p>
</div>
</dd>
<dt><a id="glossterm-ldap"></a>Lightweight Directory Access Protocol (LDAP)</dt>
<dd>
<p>Lightweight Directory Access Protocol (LDAP) is industry-standard protocol (RFC4510) for accessing directory services.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-directory-service">Directory Service</a>, <a href="#glossterm-identity-data-store">Identity Data Store</a></p>
</div>
</dd>
<dt><a id="glossterm-level-of-assurance"></a>Level of Assurance (LoA)</dt>
<dd>
<p>Measure of reliability of identity information. Information with low levels of assurance are usually user-provided information that were not verified in any significant way. Higher levels of assurance are usually achieved by identity proofing, a process of verifying the information. Level of assurance is usually stored as metadata, describing the specific value that was verified.</p>
<div class="paragraph">
<p>X.1252 term: assurance level</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a>, <a href="#glossterm-identity-proofing">Identity Proofing</a>, <a href="#glossterm-metadata">Metadata</a></p>
</div>
</dd>
<dt><a id="glossterm-least-privilege"></a>Least Privilege Principle</dt>
<dd>
<p>Principle of information security, stating that each user should have the least privilege necessary to carry out their activities. In other words, the principle states that there should be no over-provisioning (over-permissioning) of users. The principle is often implemented by "default deny" approach: everything is denied by default, every access has to be explicitly allowed.</p>
<div class="paragraph">
<p>Adherence to the principle of least privilege is generally accepted as best practice for information security, as it is minimizing overall risk by keeping the extent of privileges as low as possible. However, due to complexity, maintenance effort and other factors, strict adherence to the principle is surprisingly difficult to achieve.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Principle of Least Privilege, PoLP, Default deny</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-over-provisioning">Over-provisioning</a>, <a href="#glossterm-information-need">Information need</a></p>
</div>
</dd>
<dt><a id="glossterm-linkability"></a>Linkability</dt>
<dd>
<p>Ability to determine that two digital identities represent the same entity, or whether a digital identity represents a particular (real-life) subject. Linkability is usually deterministic, based on a reliable identifier. Identity proofing is a mechanism to reliably establish the link.</p>
<div class="paragraph">
<p>X.1252 term: linkability</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-correlation">Identity Correlation</a>, <a href="#glossterm-digital-identity">Digital Identity</a>, <a href="#glossterm-identity-proofing">Identity Proofing</a></p>
</div>
</dd>
<dt><a id="glossterm-management"></a>Management</dt>
<dd>
<p>Management is a broad set of systematic activities, methods and other means to direct and control activities in an organization, in order to achieve its objectives. It is meant to provide efficient, systematic method to achieve objectives, which can be controlled and monitored. Management operates within the constraints given by governance activities. While governance is a process of establishing policies and rules, management is concerned with efficient implementation of the activities within established rules.</p>
<div class="paragraph">
<p>Alternative terms: Management system</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-isms">Information security management system</a>, <a href="#glossterm-identity-management">Identity Management</a>, <a href="#glossterm-cybersecurity-governance">Cybersecurity governance</a></p>
</div>
</dd>
<dt><a id="glossterm-manual-fulfillment"></a>Manual Fulfillment</dt>
<dd>
<p>Manual process of creating, updating and deleting accounts, entitlements and similar objects, driven by identity management system, but exexcuted by human operator. Manual fulfillment is initiated by an identity management system, usually as a consequence of change in user privileges or policies. Identity management system creates a ticket for system administrators, containing instructions to create/modify/delete an acccount or entitlement in a specific information system. Actual action is executed manually, by the system administrator. Manual fulfillment is used for systems, for which automatic identity connector is not available.</p>
<div class="paragraph">
<p>Alternative terms: Manual Provisioning/deprovisioning, Manual resource, Manual connector</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-fulfillment">Fulfillment</a>, <a href="#glossterm-identity-provisioning">Identity Provisioning</a>, <a href="#glossterm-identity-deprovisioning">Identity Deprovisioning</a>, <a href="#glossterm-identity-connector">Identity Connector</a></p>
</div>
</dd>
<dt><a id="glossterm-memorized-secret-authenticator"></a>Memorized Secret Authenticator</dt>
<dd>
<p>Memorized secret authenticator is a secret value intended to be memorized by the user, used during authentication. Passwords and PINs are the most common type of memorized secret authenticators. Memorized secrets are used for "something you know" type of authentication.</p>
<div class="paragraph">
<p>Alternative terms: Something you know</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authenticator">Authenticator</a>, <a href="#glossterm-password">Password</a>, <a href="#glossterm-pin">Personal identification number</a></p>
</div>
</dd>
<dt><a id="glossterm-metadata"></a>Metadata</dt>
<dd>
<p>Data about data. Metadata describe properties of data, such as the method how the data were acquired (a.k.a. "provenance"), how reliable the data are (e.g. level of assurance) and so on.</p>
<div class="paragraph">
<p>Alternative terms: Meta-data, Meta data</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-data-origin">Data Origin</a>, <a href="#glossterm-data-provenance">Data Provenance</a>, <a href="#glossterm-level-of-assurance">Level of Assurance</a></p>
</div>
</dd>
<dt><a id="glossterm-mfa"></a>Multi-factor authentication (MFA)</dt>
<dd>
<p>Multi-factor authentication (MFA) is a composite mechanism, combining several independent authentication factors in a single authentication session. MFA is meant to counteract vulnerability of individual credential types. E.g. what-you-know credentials (such as passwords) are easily phished, while what-you-have credentials may be lost or stolen. Multi-factor authentication solves the problem by combining several credential types, making combined authentication stronger.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-authentication">Authentication</a>, <a href="#glossterm-credential">Credential</a></p>
</div>
</dd>
<dt><a id="glossterm-microcertification"></a>Microcertification</dt>
<dd>
<p>Microcertification is a form of access certification (access review), limited to a single user or privilege. The basic idea of micro-certification is to limit the huger effort associated with traditional certification campaigns. Microcertifications are usually automatically triggered by specific events, such as user re-assignment in organizational structure, or increase of user&#8217;s overall risk above tolerable threshold.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-access-certification">Access Certification</a>, <a href="#glossterm-least-privilege">Least Privilege Principle</a>, <a href="#glossterm-over-provisioning">Over-provisioning</a></p>
</div>
</dd>
<dt><a id="glossterm-minimal-disclosure"></a>Minimal Disclosure</dt>
<dd>
<p>A principle, stating that only the minimal amount of information is disclosed as is required to perform a specific function or provide a service. Minimal disclosure principle is often used in cross-domain data transfer, such as when using identity providers or identity federations. Only the information required to perform a service is disclosed to the other party, no extra information is provided.</p>
<div class="paragraph">
<p>Alternative terms: Minimal Disclosure of Personal Information</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: minimal disclosure</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity">Digital Identity</a>, <a href="#glossterm-personal-data-protection">Personal Data Protection</a>, <a href="#glossterm-privacy">Privacy</a>, <a href="#glossterm-identity-provider">Identity Provider</a>, <a href="#glossterm-identity-federation">Identity Federation</a>, <a href="#glossterm-selective-disclosure">Selective Disclosure</a></p>
</div>
</dd>
<dt><a id="glossterm-monitoring"></a>Monitoring</dt>
<dd>
<p>Systematic effort to continuously determine status of a process, system or activity.</p>
</dd>
<dt><a id="glossterm-mutual-authentication"></a>Mutual Authentication</dt>
<dd>
<p>Authentication process in which all involved parties authenticate to all other parties. Usually a two-sided process, where both sides of a connection authenticate to each other, i.e. server authenticates to client and client authenticates to server.</p>
<div class="paragraph">
<p>X.1252 term: mutual authentication</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-mutual-authentication">Mutual Authentication</a></p>
</div>
</dd>
<dt><a id="glossterm-near-miss"></a>Near miss</dt>
<dd>
<p>An event that could have compromised the security of systems, data or services that did not materialise.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-cyberattack">Cyberattack</a>, <a href="#glossterm-cybersecurity-incident">Cybersecurity incident</a></p>
</div>
</dd>
<dt><a id="glossterm-ngac"></a>Next Generation Access Control (NGAC)</dt>
<dd>
<p>A graph-based mechanism for managing of user access to information systems. NGAC specifies directed acyclic graph for user and concepts related to them (e.g. organizational units), and a separate directed acyclic graph for objects and and concepts related to them (e.g. folders). Access control decisions are reached by evaluating the two directed acyclic graphs with respect to policy classes, and operations specified as relations between the graphs. NGAC is specified in NIST publications (e.g. INCITS 499: Information technology - Next Generation Access Control - Functional Architecture)</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-rebac">Relationship-Based Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-non-compliance"></a>Non-compliance</dt>
<dd>
<p>State of non-fulfilment of a requirement, such as violation of a requirement stated in a policy, regulation or standard.</p>
<div class="paragraph">
<p>Alternative terms: Noncompliance, Nonconformity, Violation</p>
</div>
</dd>
<dt><a id="glossterm-non-repudiation"></a>Non-repudiation</dt>
<dd>
<p>Non-repudiation is an ability to prove that an event happened, including proof of the originating parties. Non-repudiation is a property of a system, protecting against denial from one of the parties. The involved parties cannot deny that an action took place.</p>
<div class="paragraph">
<p>X.1252 term: non-repudiation</p>
</div>
</dd>
<dt><a id="glossterm-objective"></a>Objective</dt>
<dd>
<p>Intended result of an activity or process.</p>
<div class="paragraph">
<p>Alternative terms: Goal</p>
</div>
</dd>
<dt><a id="glossterm-offboarding"></a>Offboarding</dt>
<dd>
<p>Business process that takes place when a person leaves an organization. The aim of offboarding is making sure that the person no longer has access to sensitive data and premises of the organization. From IT point of view, this often means identity de-provisioning, e.i. deactivation of user accounts in various applications, databases and identity data stores. This process is often automated using an identity management system. However, a complete offboarding process is usually more complex, including non-IT steps such as returning the provided equipment.</p>
<div class="paragraph">
<p>Alternative terms: Off-boarding</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-deprovisioning">Identity Deprovisioning</a>, <a href="#glossterm-joiner-mover-leaver">Joiner-Mover-Leaver Processes</a></p>
</div>
</dd>
<dt><a id="glossterm-onboarding"></a>Onboarding</dt>
<dd>
<p>Business process that takes place when a new person enters an organization. The aim of onboarding is making sure that the person is well-equipped for any tasks and activities within the organization. From IT point of view, this often means identity provisioning, e.i. creation of user accounts in various applications, databases and identity data stores. This process is often automated using an identity management system. However, a complete onboarding process is usually more complex, including non-IT steps such as providing the person with appropriate equipment and training.</p>
<div class="paragraph">
<p>The terms "enrollment", "registration" and "onboarding" are overlapping and they are often used as synonyms. Strictly speaking, "enrollment" is the verification process, "registration" is an act of recording information to data store, and "onboarding" is a complete business process making sure that a new person in an organization is well-equipped for activities within the organization.</p>
</div>
<div class="paragraph">
<p>Alternative terms: On-boarding</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-enrollment">Enrollment</a>, <a href="#glossterm-identity-registration">Identity Registration</a>, <a href="#glossterm-identity-provisioning">Identity Provisioning</a>, <a href="#glossterm-joiner-mover-leaver">Joiner-Mover-Leaver Processes</a></p>
</div>
</dd>
<dt><a id="glossterm-open-source"></a>Open Source (OSS)</dt>
<dd>
<p>The meaning of this term is very simple - it is something people can wilfully modify according to their own needs or wishes. Firstly, this term was known in the context of software, which code was publicly exposed and available for modification. Later open source spread widely. There are open source projects, products, participations and many others.</p>
<div class="paragraph">
<p>Many organizations and people choose open source software, hence it is considered to be more secured and grants people more control over it. This software can also be more stable as many other people may contribute their own ideas, correct it or improve it.</p>
</div>
<div class="paragraph">
<p>Open source products are free and the creators usually charge other organizations for support or software services as implementation or deployment.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Open Source Software, FOSS, Free and Open Source Software</p>
</div>
</dd>
<dt><a id="glossterm-org"></a>Org</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Org is a type of midPoint objects, object that represent various forms of organizational units and structures. Org can represent company, division, section, project, team, research group or any other grouping of identities. Orgs are not limited to grouping people, orgs can be used to group most midPoint objects (any assignment holder object).</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/reference/org/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-organization">Organization</a>, <a href="#glossterm-organizational-structure">Organizational Structure</a></p>
</div>
</dd>
<dt><a id="glossterm-organization"></a>Organization</dt>
<dd>
<p>Organization is an entity, usually representing a group of people, that has its objectives and methods to achieve them. Organizations may be or may not be legal entities.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-org">Org</a>, <a href="#glossterm-organizational-structure">Organizational Structure</a></p>
</div>
</dd>
<dt><a id="glossterm-organizational-structure"></a>Organizational Structure</dt>
<dd>
<p>A hierarchical arrangement of authority, rights or duties in an organization. It determines the assignment, control or coordination of roles, responsibilities and power. A character of the organizational structure is highly dependent on the organization&#8217;s strategy and goals.</p>
<div class="paragraph">
<p>The theme of organizational structure is closely linked to identity management. Organizing the company into this structure, assigning rights to individuals, working groups or project and controlling everything from one place â€“ that are advantages that any high quality IDM solution is supposed to provide.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-organization">Organization</a>, <a href="#glossterm-org">Org</a></p>
</div>
</dd>
<dt><a id="glossterm-orphan-account"></a>Orphan Account</dt>
<dd>
<p>An account without an owner, an account that does not seem to belong to anybody. In identity management, each account is supposed to have an owner, a user to whom the account belongs. An account without an owner is considered to be "orphaned", and it is usually deprovisioned (disabled or deleted).</p>
<div class="paragraph">
<p>Orphan accounts often originate as testing accounts that are not deleted after the testing is done. They may also belong to former users, but were not properly deleted or disabled. Orphan accounts are almost always a security risk, especially testing accounts with weak passwords. Most identity management systems have processes that scan systems for orphan accounts.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Orphan, Orphaned Account</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-account">Account</a>, <a href="#glossterm-user">User</a>, <a href="#glossterm-reconciliation">Reconciliation</a></p>
</div>
</dd>
<dt><a id="glossterm-outsourcing"></a>Outsourcing</dt>
<dd>
<p>Outsourcing is a practice of delegating functions, tasks and responsibilities to an external organization.</p>
</dd>
<dt><a id="glossterm-over-provisioning"></a>Over-provisioning</dt>
<dd>
<p>Situation when an identity has more privileges than are necessary for the tasks that the identity is supposed to carry out.</p>
<div class="paragraph">
<p>Over-provisioning is generally undesirable, as it is a violation of least privilege principle which is introducing unnecessary risk. However, over-provisioning is a common occurrence, mostly due to high complexity of access control models, limited visibility, huge privilege maintenance effort or lack of appropriate security management practices.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Over-permissioning, Over-privileged Access, Excessive Access, Excessive Privilege</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-provisioning">Identity Provisioning</a>, <a href="#glossterm-identity-deprovisioning">Identity Deprovisioning</a>, <a href="#glossterm-under-provisioning">Under-provisioning</a></p>
</div>
</dd>
<dt><a id="glossterm-pap"></a>Policy Administration Point (PAP)</dt>
<dd>
<p>Functional component with a responsibility to specify, manage and maintain the policy. The "policy" usually refers to access control and/or authorization policy. PAP is an administrative point, which is creating and managing the policy. The policy is then stored at policy retrieval point (PRP). Policy administration point (PAP) can be part of applications, or they may be provided by dedicated infrastructure components (identity management and governance components). PAP specifies the policy, usually as a result of interaction with an administrator by the means user interface. PAP does not make policy decisions or enforce them, that is a responsibility of policy decision point (PDP) and policy enforcement point (PEP) respectively.</p>
<div class="paragraph">
<p>Note: The acronym PAP may also refer to Policy Access Point, which is an alternative name for Policy Retrieval Point (PRP), making the terminology somehow confusing.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Policy Management Point</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authorization">Authorization</a>, <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-pep">Policy Enforcement Point</a>, <a href="#glossterm-pdp">Policy Decision Point</a>, <a href="#glossterm-pip">Policy Information Point</a>, <a href="#glossterm-prp">Policy Retrieval Point</a>, <a href="#glossterm-iga">Identity Governance and Administration</a></p>
</div>
</dd>
<dt><a id="glossterm-passkey"></a>Passkey</dt>
<dd>
<p>Passkey is a type of strong digital credential. They are used to authenticate a user to information systems, identity provides and applications. Passkeys are based on public key cryptography, making them relatively strong and secure. They may be provided in a hardware form (e.g. a small USB device), or managed entirely in software (e.g. mobile application). Passkeys are bound for each website or application, making them phishing-resistant.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-credential">Credential</a>, <a href="#glossterm-pin">Personal identification number</a></p>
</div>
</dd>
<dt><a id="glossterm-password"></a>Password</dt>
<dd>
<p>Password is a type of (usualy weak) digital credential, meant to be secret, known only to a single user. Passwords are memorized secret authenticators, usually selected by users, meant to be remembered. Therefore, they are often short strings in a human-friendly form, such as simple words or names. Simplicity of passwords makes them vulnerable to dictionary attacks. Recently, passwords are randomly generated, managed by password management applications. However, even randomly-generated passwords may still be vulnerable to phishing attacks. Therefore organizations are moving towards authentication methods that do not depend on passwords (e.g. passkeys), or enroll multi-factor authentication schemes.</p>
<div class="paragraph">
<p>Alternative terms: Passcode</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authenticator">Authenticator</a>, <a href="#glossterm-memorized-secret-authenticator">Memorized Secret Authenticator</a>, <a href="#glossterm-credential">Credential</a>, <a href="#glossterm-password-management">Password Management</a>, <a href="#glossterm-password-policy">Password policy</a>, <a href="#glossterm-passkey">Passkey</a></p>
</div>
</dd>
<dt><a id="glossterm-passwordless-authentication"></a>Passwordless authentication</dt>
<dd>
<p>Passwordless authentication is an authentication that does not use passwords, or similar knowledge-based credential. It is usually considered to be a stronger form of authentication that the usual password-based authentication. Password-less authentication mechanisms usually rely on public-key cryptography mechanisms.</p>
<div class="paragraph">
<p>Alternative terms: Passwordless</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authentication">Authentication</a>, <a href="#glossterm-password">Password</a>, <a href="#glossterm-passkey">Passkey</a>, <a href="#glossterm-mfa">Multi-factor authentication</a></p>
</div>
</dd>
<dt><a id="glossterm-password-policy"></a>Password policy</dt>
<dd>
<p>Password policy constraints the selection and use of passwords with an aim to make them more secure. It almost always sets requirements for password complexity, such as minimal length of passwords and characted classes used in the password (e.g. letters, numbers, punctuation). Password policies often specify constraints on password lifetime, such as password expiration intervals.</p>
<div class="paragraph">
<p>Alternative terms: Password complexity policy</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-password">Password</a>, <a href="#glossterm-password-management">Password Management</a></p>
</div>
</dd>
<dt><a id="glossterm-password-management"></a>Password Management</dt>
<dd>
<p>Gives the organization an opportunity to meet the highest security standards thanks to the ability of having access to business systems and networks under control. Most of the employees usually pick just simple passwords and use same ones in multiple systems or applications. Password management helps to compose strong and unique passwords for both users and resources and ideally takes care of them during the whole user life cycle.</p>
<div class="paragraph">
<p>The term "password management" may also mean management of password on the user side, such as generating and storing of random passwords.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Credential management</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-password">Password</a>, <a href="#glossterm-credential">Credential</a></p>
</div>
</dd>
<dt><a id="glossterm-pbac"></a>Policy-Based Access Control (PBAC)</dt>
<dd>
<p>A mechanism for managing of user access to information systems based on policy. In PBAC, authorizations are supposed to be dynamically evaluated, based on policy specified in a machine-processable form. PBAC policy is an abstract concept, it is not clearly defined how it is expressed or evaluated. PBAC is meant to solve problems of static access control models such as RBAC.</p>
<div class="paragraph">
<p>PBAC seems to be technically equivalent to ABAC. However, in contrast to ABAC, PBAC is supposed to contain "policy management" layer, which is not clearly defined either.</p>
</div>
<div class="paragraph">
<p>Overall, PBAC is an conceptual idea rather than a concrete access control model. It is still in early stages of development.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Dynamic Authorization Management, Policy as Code</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authorization">Authorization</a>, <a href="#glossterm-abac">Attribute-Based Access Control</a>, <a href="#glossterm-rbac">Role-Based Access Control</a>, <a href="#glossterm-pdrbac">Policy-Driven Role-Based Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-pep"></a>Policy Enforcement Point (PEP)</dt>
<dd>
<p>Functional component with a responsibility to enforce policy decisions. The "policy" usually refers to access control and/or authorization policy. Policy enforcement points are usually part of applications or infrastructure components, with an ability to analyze and intercept policed operation. Policy enforcement point only enforces the policy, it does not interpret or decides the policy. PEP depends on policy decision point (PDP) to interpret the policy and make a decision.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-authorization">Authorization</a>, <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-pdp">Policy Decision Point</a>, <a href="#glossterm-pap">Policy Administration Point</a></p>
</div>
</dd>
<dt><a id="glossterm-performance"></a>Performance</dt>
<dd>
<p>Performance is a measure of a result. In process management, it a measure of how well is a process or activity achieving its objectives. The term "performance" may also meat a measure of efficiency of a computer system, describing how quickly it can provide results and how much resources it needs to perform a task.</p>
</dd>
<dt><a id="glossterm-perimeter"></a>Perimeter</dt>
<dd>
<p>Security perimeter is a boundary that separates secure and insecure areas. In cybersecurity, "perimeter" separated insecure outer network (usually the Internet) and secure inner network (usually corporate network). The perimeter was usually implemented by physical protection of network devices and connections, inter-connecting networks by the means of dedicated security devices (firewalls, gateways). Security requirements were significantly reduced in the presumably-secure inner network, usually to the point of no tangible security at all. Access control inside the perimeter was often limited to access control based on network addresses (IP-based access control), or even no practical access control was implemented at all.</p>
<div class="paragraph">
<p>Reliance on cybersecurity perimeter was a very common occurrence in early years of inter-network computing. However, concept of cybersecurity perimeter is fundamentally flawed, as computer networks are no longer bound to their physical form. Existence of virtual networking technologies, wireless networks, covert network channels and other technologies made cybersecurity perimeter unsustainable. This effect is further emphasized by move towards cloud services, that are located outside of classic security perimeter by their very nature.</p>
</div>
<div class="paragraph">
<p>Overall, cybersecurity perimeter is considered flawed and insecure approach. Zero trust approach provides a broad conceptual movement to migrate from the concept of cybersecurity perimeter to more resilient and holistic cybersecurity approach that does not rely on concept of perimeter.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Security perimeter, Information security perimeter, Network perimeter, Cybersecurity perimeter</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-zero-trust">Zero trust</a></p>
</div>
</dd>
<dt><a id="glossterm-persistent-identifier"></a>Persistent Identifier</dt>
<dd>
<p>An identifier that cannot be changed or re-assigned to another identity. Once assigned, the identifier always references the same identity. Persistent identifiers are usually used as reference identifiers, and reference identifiers are usually persistent, resulting in "persistent reference identifiers".</p>
<div class="paragraph">
<p>Depending on a policy, persistent identifiers can be re-assign to another identity after the original identity was deleted (identifier re-use). However, there is usually relatively long interval during which the identifier cannot be re-assigned.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Non-reassignable identifier</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identifier">Identifier</a>, <a href="#glossterm-reference-identifier">Reference Identifier</a></p>
</div>
</dd>
<dt><a id="glossterm-personal-data"></a>Personal Data</dt>
<dd>
<p>Data about a person, usually processed in an information system. The definition of "personal data" slightly differ from case to case. For example, GDPR defines personal data as "any information which are related to an identified or identifiable natural person". However, the general understanding is that "personal data" are any data that relate to a natural person, that describe the person in some way. This is different from personally identifiable information (PII), as personal data may not uniquely identify a person. For example, person&#8217;s full name is considered personal data, however, a name such as "John Smith" is not entirely unique or identifiable in most contexts.</p>
<div class="paragraph">
<p>Alternative terms: Personal information, Identity data, Identity information, Personal profile</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-personal-data-protection">Personal Data Protection</a>, <a href="#glossterm-personally-identifiable-information">Personally Identifiable Information</a>, <a href="#glossterm-gdpr">General Data Protection Regulation</a></p>
</div>
</dd>
<dt><a id="glossterm-personal-data-erasure"></a>Personal Data Erasure</dt>
<dd>
<p>Erasure (deletion) of personal data, usually due to explicit request from user (e.g. "delete account" request), or due to lack of lawful basis for personal data processing.</p>
<div class="paragraph">
<p>Alternative terms: Erasure, Data erasure</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-personal-data-protection">Personal Data Protection</a>, <a href="#glossterm-personal-data">Personal Data</a>, <a href="#glossterm-personal-data-processing-basis">Personal Data Processing Basis</a>, <a href="#glossterm-gdpr">General Data Protection Regulation</a></p>
</div>
</dd>
<dt><a id="glossterm-personal-data-processing-basis"></a>Personal Data Processing Basis</dt>
<dd>
<p>Basis for processing of personal data. Legal data protection frameworks (such as GDPR) usually mandate that personal data cannot be processed unless there is a basis for that processing. The basis may be a contract, legal obligation, consent, or similar legitimate interest for processing of the data. Some frameworks (such as GDPR) are enumerating the available processing bases.</p>
<div class="paragraph">
<p>Alternative terms: Basis for processing, Legal basis, Lawful basis</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-personal-data-protection">Personal Data Protection</a>, <a href="#glossterm-personal-data">Personal Data</a>, <a href="#glossterm-gdpr">General Data Protection Regulation</a></p>
</div>
</dd>
<dt><a id="glossterm-personal-data-protection"></a>Personal Data Protection</dt>
<dd>
<p>Personal data protection is a field dealing with protection of personal information, rules for their processing, storage and erasure. It is closely related to privacy, as one of the main goals of personal data protection is to limit exposure of personal data, thus minimizing potential for their abuse.</p>
<div class="paragraph">
<p>Alternative terms: Data Protection, DP</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-personal-data">Personal Data</a>, <a href="#glossterm-gdpr">General Data Protection Regulation</a></p>
</div>
</dd>
<dt><a id="glossterm-personally-identifiable-information"></a>Personally Identifiable Information (PII)</dt>
<dd>
<p>Information that allows a person to be (directly or indirectly) identified. Obviously, government-issued identifiers, such as birth numbers, social security numbers or serial numbers of various identity documents are usually considered to be personally identifiable information. However, interpretation of what information is "personally identifiable" depends on the context. Even a simple full name of a person may be considered personally identifiable information in some contexts. Personally identifiable information usually require special protection or processing regime. Personally identifiable information should not be confused with personal data. PII are used as an identifier, pointing out a specific person in a group of other persons. Personal data describe certain person, there is no requirement for personal data to be "identifiable".</p>
<div class="paragraph">
<p>Alternative terms: Personal identifiers</p>
</div>
<div class="paragraph">
<p>X.1252 term: personally identifiable information</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-personal-data">Personal Data</a></p>
</div>
</dd>
<dt><a id="glossterm-pdp"></a>Policy Decision Point (PDP)</dt>
<dd>
<p>Functional component with a responsibility to interpret policy and make decisions. The "policy" usually refers to access control and/or authorization policy. Policy decision point (PDP) can be part of applications, or they may be provided by dedicated infrastructure components (authorization services). PDP interprets the policy and make a decision, which is usually allow/deny decision. PDP does not enforce the decision, it relies on policy enforcement point (PEP) to enforce it. PDP does not define or manage the policy either, it depends on policy administration point (PAP) to set the policy.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-authorization">Authorization</a>, <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-authorization-service">Authorization Service</a>, <a href="#glossterm-pep">Policy Enforcement Point</a>, <a href="#glossterm-pap">Policy Administration Point</a>, <a href="#glossterm-pip">Policy Information Point</a></p>
</div>
</dd>
<dt><a id="glossterm-pdrbac"></a>Policy-Driven Role-Based Access Control</dt>
<dd>
<p>A mechanism for managing of user access to information systems based on a concept of dynamic roles and policies. It is an extension of traditional Role-Based Access Control (RBAC), applying dynamic policies to govern behaviour and assignment of roles. In policy-driven RBAC, roles are no longer static, they contain logic that determines set of privileges given by the role. The user-role assignments are also dynamic, controlled by automatic role assignment policies.</p>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/reference/roles-policies/pdrbac/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>Alternative terms: PDRBAC</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-rbac">Role-Based Access Control</a>, <a href="#glossterm-role">Role</a>, <a href="#glossterm-entitlement">Entitlement</a>, <a href="#glossterm-role-management">Role Management</a>, <a href="#glossterm-access-control">Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-pin"></a>Personal identification number (PIN)</dt>
<dd>
<p>Personal identification number (PIN) is a type of authenticator, meant to be secret, known only to a single user. They are almost always in a form of short numbers (4-8 digits). PINs are memorized secret authenticators. Even though most PINs are randomly generated, they are meant to be remembered by the users. Simplicity of PINs makes them vulnerable to enumeration attacks when used on their own. Therefore PINs they are almost exclusively used in combination with other authenticators. E.g. PINs are often used to protect strong authenticators/credentials, such as passkeys or public key credentials stored on smart cards.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-authenticator">Authenticator</a>, <a href="#glossterm-memorized-secret-authenticator">Memorized Secret Authenticator</a>, <a href="#glossterm-credential">Credential</a>, <a href="#glossterm-passkey">Passkey</a></p>
</div>
</dd>
<dt><a id="glossterm-pip"></a>Policy Information Point (PIP)</dt>
<dd>
<p>Functional component with a responsibility to provide additional information for policy decision point (PDP). PIP is usually retrieving data from identity data stores, providing them to PDP in form of attributes.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-authorization">Authorization</a>, <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-pdp">Policy Decision Point</a>, <a href="#glossterm-pap">Policy Administration Point</a>, <a href="#glossterm-pep">Policy Enforcement Point</a>, <a href="#glossterm-identity-data-store">Identity Data Store</a>, <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a></p>
</div>
</dd>
<dt><a id="glossterm-policy"></a>Policy</dt>
<dd>
<p>Policy is a system of guidelines or rules used to reach an objective or a decision.</p>
<div class="paragraph">
<p>Unfortunately, "policy" is a heavily overloaded term with numerous of meanings. It may mean organizational policy, a set of high-level guidelines interpreted by people to guide their decisions. Policy may be formal, written down in a form that can be strictly followed, where compliance with a policy can be evaluated. It may also be informal, expressed in non-exact form, specifying a vague objective and methods. Policy may also mean machine-processable and executable code, used to quickly reach authorization decisions in run-time.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-policy-management">Policy Management</a>, <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-authorization">Authorization</a></p>
</div>
</dd>
<dt><a id="glossterm-policy-management"></a>Policy Management</dt>
<dd>
<p>Set of operations defining the authorization roles or policies, or assigning roles to the particular users. This is often manual or semi-manual operation performed in identity management system or identity data store. Policy management is implementing the functionality of Policy Administration Point (PAP).</p>
<div class="paragraph">
<p>This term is often confused with authorization itself. However, policy management aims at definition of the policy, while authorization is interpreting the policy.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/iam/iga/policy-and-role-management/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Management of Authorization Policies, Policy and Role Management</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-policy">Policy</a>, <a href="#glossterm-authorization">Authorization</a></p>
</div>
</dd>
<dt><a id="glossterm-polystring"></a>Polystring</dt>
<dd>
<p>A built-in data type for polymorphic string maintaining extra values in addition to its original value. The extra values are derived from the original value automatically using a normalization code. PolyString supports national characters in strings. It contains both the original value (with national characters) and normalized value (without national characters). This can be used for transliteration of national characters in usernames. All the values are stored in the repository, therefore they can be used to look for the object. Search ignoring the difference in diacritics or search by transliterated value can be used even if the repository itself does not support such feature explicitly.</p>
</dd>
<dt><a id="glossterm-principal"></a>Principal</dt>
<dd>
<p>An entity or identity, information about which is managed in an information system.</p>
<div class="paragraph">
<p>Usage of the term "principal" varies significantly. Depending on context, it may refer to entity (person), its identity or data structure describing parts of the identity (digital identity). In information security frameworks (such as X.509), "principal" usually refers to entity or identity, such as owner of credentials. In programming frameworks, "principal" usually refers to ephemeral information about user, maintained during user&#8217;s session. This is usually different from "account", as accounts are usually persistent (stored in database), while principal may be ephemeral, or may refer to entities that are not users of the system (may not be able to log in). In some contexts, "principal" is equivalent to "subject".</p>
</div>
<div class="paragraph">
<p>Alternative terms: Subject</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: principal</p>
</div>
<div class="paragraph">
<p>X.1252 term: principal</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-subject">Subject</a>, <a href="#glossterm-holder">Holder</a>, <a href="#glossterm-entity">Entity</a>, <a href="#glossterm-identity">Identity</a>, <a href="#glossterm-account">Account</a></p>
</div>
</dd>
<dt><a id="glossterm-prism"></a>Prism</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Prism is a name of a data representation library, which is used by midPoint to access data in its repository. The concepts of Prism permeates all of midPoint, giving structure to midPoint objects, and their representation in XML/JSON/YAML. Prism defines a concept of object, container, property, item, delta and many other useful concepts.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.comhttps://docs.evolveum.com/midpoint/devel/prism/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-delta">Delta</a></p>
</div>
</dd>
<dt><a id="glossterm-privacy"></a>Privacy</dt>
<dd>
<p>The right to be left alone. In IT context, privacy is an ability of individuals to control the information about themselves, to choose how the information is used to express their individuality. Technologies that support the concept of privacy are known as privacy-enhancing technologies (PET).</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-privacy-enhancing-technology">Privacy-Enhancing Technology</a>, <a href="#glossterm-personal-data-protection">Personal Data Protection</a></p>
</div>
</dd>
<dt><a id="glossterm-privacy-enhancing-technology"></a>Privacy-Enhancing Technology (PET)</dt>
<dd>
<p>Technologies that support and enhance privacy. This usually means technologies that give an individual an effective control over personal data, and the way how these data are used to express one&#8217;s individuality.</p>
<div class="paragraph">
<p>Most privacy-enhancing technologies are focused on limiting the spread of personal data, making sure that only a minimal amount of data is disclosed (minimal disclosure), making sure that user approves data transfer (consent), using pseudonyms and various anonymization techniques to limit data exposure.</p>
</div>
<div class="paragraph">
<p>Privacy-enhancing technologies are somewhat different from personal data protection technologies. While privacy-enhancing technologies are focused on limiting exposure of the data (secrecy), data protection technologies are focused on controlling the way how data are used.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-privacy">Privacy</a>, <a href="#glossterm-personal-data-protection">Personal Data Protection</a>, <a href="#glossterm-minimal-disclosure">Minimal Disclosure</a>, <a href="#glossterm-pseudonym">Pseudonym</a></p>
</div>
</dd>
<dt><a id="glossterm-privacy-policy"></a>Privacy Policy</dt>
<dd>
<p>A policy that sets rules for processing of personal data, respecting privacy of an individual.</p>
<div class="paragraph">
<p>X.1252 term: privacy policy</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-privacy">Privacy</a>, <a href="#glossterm-privacy-enhancing-technology">Privacy-Enhancing Technology</a></p>
</div>
</dd>
<dt><a id="glossterm-private-key"></a>Private Key</dt>
<dd>
<p>In an asymmetric cryptosystem (a.k.a. "public-key cryptosystem), a part of the key pair that is known only to the key owner.</p>
<div class="paragraph">
<p>X.1252 term: private key</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-public-key">Public Key</a></p>
</div>
</dd>
<dt><a id="glossterm-privileged-entitlement"></a>Privileged entitlement</dt>
<dd>
<p>Entitlement (access right, privilege) that allows the performance of activities that typical entities in the system cannot perform. User with privileged entitlement can usually perform activities that goes far beyond usual usage of the system. Privileged entitlements may allow unrestricted access to data, allow modification of entitlements of other users, and often include destructive operations such as deletion of data sets. System administration privileges are almost always considered privileged entitlements.</p>
<div class="paragraph">
<p>Alternative terms: Privileged access rights, Privileged access</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-entitlement">Entitlement</a></p>
</div>
</dd>
<dt><a id="glossterm-probability"></a>Probability</dt>
<dd>
<p>Measure of a chance of an event happening.</p>
<div class="paragraph">
<p>Alternative terms: Likelihood</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-level">Risk level</a></p>
</div>
</dd>
<dt><a id="glossterm-process"></a>Process</dt>
<dd>
<p>Process is a structured and repeatable activity. Process usually consists of a sequence of steps, which may be interrelated and interactive, involving several parties. Unlike one-off activities such as projects, processes are meant to be repeatable, conducting the same or similar activities more than once, delivering similar results.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-project">Project</a>, <a href="#glossterm-program">Program</a></p>
</div>
</dd>
<dt><a id="glossterm-product-architecture"></a>Product Architecture</dt>
<dd>
<p>Concept, design and description of the products part which are assigned into subsystems. It is also way how these subsystems interact with each other.</p>
</dd>
<dt><a id="glossterm-program"></a>Program</dt>
<dd>
<p>Program is a structured and continuous activity meant to maintain and improve a state. Programs are continuous, never-ending activities. They are often executed in cycles: analyzing situation, planning, implementing and validating the results. Programs are meant to continuously maintain and improve a certain state, such as appropriate level of cybersecurity.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-process">Process</a></p>
</div>
</dd>
<dt><a id="glossterm-project"></a>Project</dt>
<dd>
<p>Project is a structured and unique activity meant to reach specific objectives. Process usually consists of a sequence of steps, which may be interrelated and interactive, involving several parties. Unlike repeatable activities such as processes and programs, projects are not meant to be repeated. Projects are designed to deliver a specific outcome, and to deliver it only once.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-process">Process</a>, <a href="#glossterm-program">Program</a></p>
</div>
</dd>
<dt><a id="glossterm-projection"></a>Projection</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Projection is a part of midPoint computation that represents the objects in identity resources, usually accounts, entitlements or organizational units. Projection are the "spokes" in hub-and-spoke (star) data synchronization in midPoint. Projections are represented in the computation in a form of shadows (shadow objects), usually supplemented with real-time data from the resource objects.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/reference/schema/focus-and-projections/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-shadow">Shadow</a>, <a href="#glossterm-focus">Focus</a>, <a href="#glossterm-assignment">Assignment</a></p>
</div>
</dd>
<dt><a id="glossterm-prp"></a>Policy Retrieval Point (PRP)</dt>
<dd>
<p>Functional component with a responsibility to store and distribute policies for use by policy decision points (PDP). PRP acts as an repository for policy. The policy is usually stored persistently at PRP, e.g. in a form of a file or database. Primary responsibility of PRP is to make policy available to policy decision points (PDP), either by "pull" (PDP retrieving the policy from PRP) or by "push" (PRP sending the policy to PDP). PRP is instrumental in enabling distributed architecture with several PDPs.</p>
<div class="paragraph">
<p>Note: PRP is only storing and distributing the policy, it is not responsible for policy creation or management. Policy management is responsibility of policy administration point (PAP).</p>
</div>
<div class="paragraph">
<p>Alternative terms: Policy Access Point</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authorization">Authorization</a>, <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-pdp">Policy Decision Point</a>, <a href="#glossterm-pap">Policy Administration Point</a>, <a href="#glossterm-pep">Policy Enforcement Point</a>, <a href="#glossterm-pip">Policy Information Point</a></p>
</div>
</dd>
<dt><a id="glossterm-pseudonym"></a>Pseudonym</dt>
<dd>
<p>An identifier designed to avoid any inherent information about identity or entity. Pseudonyms are meant to hide or modify perception of the entity or identity, as presented to other parties.</p>
<div class="paragraph">
<p>In user experience sense, pseudonyms can be chosen by the user to hide or alter their real identity in information systems.</p>
</div>
<div class="paragraph">
<p>In implementation sense, pseudonym is often a randomly-generated identifier, used selectively for communication with specific domain or system. The pseudonym is used instead of other identifiers to avoid possibility of the other party to reveal parts of user&#8217;s identity or correlate user&#8217;s actions.</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: pseudonym</p>
</div>
<div class="paragraph">
<p>X.1252 term: pseudonym</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identifier">Identifier</a>, <a href="#glossterm-personal-data-protection">Personal Data Protection</a>, <a href="#glossterm-privacy">Privacy</a></p>
</div>
</dd>
<dt><a id="glossterm-public-key"></a>Public Key</dt>
<dd>
<p>In an asymmetric cryptosystem (a.k.a. "public-key cryptosystem), a part of the key pair that can be shared with other entities.</p>
<div class="paragraph">
<p>X.1252 term: public key</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-private-key">Private Key</a></p>
</div>
</dd>
<dt><a id="glossterm-rbac"></a>Role-Based Access Control (RBAC)</dt>
<dd>
<p>A mechanism for managing of user access to information systems based on a concept of roles. Role-Based Access Control (RBAC) is using roles to group permissions. Roles usually represent meaningful entities, such as job positions, organizational affiliations or similar business concepts. One of the basic assumptions of RBAC is that management of roles is much easier than management of individual permissions.</p>
<div class="paragraph">
<p>A form of RBAC is standardized in a series of NIST standards (ANSI/INCITS 359-2004, INCITS 359-2012).</p>
</div>
<div class="paragraph">
<p>RBAC is mostly concerned with using the roles to control user access to the system and other information assets. Role definitions are usually maintained using a somehow separate "Role Management" mechanisms.</p>
</div>
<div class="paragraph">
<p>Traditional RBAC models are static: user-role and role-permission relations are fixed, set up by system administrator. Newer RBAC models are dynamic (policy-driven): user-role and role-permission relations may be dynamic, determined by policy (algorithm).</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/iam/rbac/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-role">Role</a>, <a href="#glossterm-entitlement">Entitlement</a>, <a href="#glossterm-role-management">Role Management</a>, <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-role-explosion">Role Explosion</a>, <a href="#glossterm-pdrbac">Policy-Driven Role-Based Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-reconciliation"></a>Reconciliation</dt>
<dd>
<p>In identity management, reconciliation is a process of comparing recorded state od identity management system with a real state of identity resources. In the most common form, reconciliation is comparing user data stored in identity management database with account data stored in identity resource (source or target systems). Reconciliation is meant to detect differences in the data, including detection of orphaned accounts.</p>
<div class="paragraph">
<p>Reconciliation is usually quite heavyweight, yet very reliable mechanism of identity data synchronization.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-account">Account</a>, <a href="#glossterm-user">User</a>, <a href="#glossterm-orphan-account">Orphan Account</a></p>
</div>
</dd>
<dt><a id="glossterm-rebac"></a>Relationship-Based Access Control (ReBAC)</dt>
<dd>
<p>A mechanism for managing of user access to information systems based on a concept of relationship. Relationship-Based Access Control (ReBAC) is defined by presence of relationship between objects, such as "owner" or "editor". The relationships are interpreted by an access control policy to form access control decisions.</p>
<div class="paragraph">
<p>In midPoint terminology: MidPoint has a concept of "relation" that can be used together with assignment/inducement mechanism to implement ReBAC access control structures.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-relation">Relation</a>, <a href="#glossterm-ngac">Next Generation Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-reference-identifier"></a>Reference Identifier (RI)</dt>
<dd>
<p>An identifier that reliably references an identity in a particular scope. Once assigned, the identifier always references the same identity, it cannot be assigned to a different identity. Reference identifiers are often persistent, however, they can change, as long as the identifier is not re-assigned to other identity.</p>
<div class="paragraph">
<p>Depending on a policy, reference identifiers can be re-assign to another identity after the original identity was deleted (identifier re-use). However, there is usually relatively long interval during which the identifier cannot be re-assigned.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Non-reassignable identifier</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: reference identifier</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identifier">Identifier</a>, <a href="#glossterm-persistent-identifier">Persistent Identifier</a>, <a href="#glossterm-reference-identifier-generator">Reference Identifier Generator</a></p>
</div>
</dd>
<dt><a id="glossterm-reference-identifier-generator"></a>Reference Identifier Generator</dt>
<dd>
<p>ISO 24760 term, used to describe the tool that generates reference identifier, usually during an enrollment and registration.</p>
<div class="paragraph">
<p>ISO 24760 term: reference identifier generator</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-reference-identifier">Reference Identifier</a>, <a href="#glossterm-enrollment">Enrollment</a>, <a href="#glossterm-identity-registration">Identity Registration</a></p>
</div>
</dd>
<dt><a id="glossterm-referential-integrity"></a>Referential Integrity</dt>
<dd>
<p>Consistency constraint in a database, mandating that every reference points to a valid object. Simply speaking, when an identifier is used to reference another object, such objects should exist.</p>
<div class="paragraph">
<p>Referential integrity is often a concern in group management and directory services. Systems that provide referential integrity make sure that a group points to valid members (user that exist), or that a list of user groups points to valid groups. In case a user who is a member of a group is removed, a system with referential integrity will either automatically remove the user from the group, or it will deny the operation until user is explicitly removed from all groups first. Systems that do not provide referential integrity would allow such operation, leaving invalid identifier in the database, an identifier that does not point to any existing object.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-schema">Schema</a>, <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a>, <a href="#glossterm-verification">Verification</a></p>
</div>
</dd>
<dt><a id="glossterm-registration-authority"></a>Registration Authority (RA)</dt>
<dd>
<p>An entity that gathers and verifies identity information, for the purposes of enrollment and identity registration. Registration authority is usually the organization that carries out identity proofing by verifying identity evidence, such as national identity cards.</p>
<div class="paragraph">
<p>ISO 24760 term: registration authority</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-registration">Identity Registration</a>, <a href="#glossterm-enrollment">Enrollment</a>, <a href="#glossterm-identity-proofing">Identity Proofing</a>, <a href="#glossterm-identity-evidence">Identity Evidence</a></p>
</div>
</dd>
<dt><a id="glossterm-relation"></a>Relation</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: MidPoint concept of "relation" can parametrize a reference between two objects, further specifying the relation between them. It is usually used in assignment/inducement to provide details about the relationship of the holder and target objects. For example, relation is used to specify role owners, approvers and organizational unit managers. Relation can also be used to implement relationship-based access control (ReBAC) mechanism in midPoint.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.comhttps://docs.evolveum.com/midpoint/reference/concepts/relation/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-assignment">Assignment</a>, <a href="#glossterm-inducement">Inducement</a>, <a href="#glossterm-rebac">Relationship-Based Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-reliability"></a>Reliability</dt>
<dd>
<p>Property of a system to behave consistently and deliver expected results.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-availability">Availability</a></p>
</div>
</dd>
<dt><a id="glossterm-relying-party"></a>Relying Party (RP)</dt>
<dd>
<p>System that relies on other party (identity provider) to provide identity information. Relying party (also known as "service provider") usually relies on identity provider to authenticate the user, and relay the information to the relying party. Relying party has no access to credentials (e.g. passwords), it only knows that the authentication was successful. Identity provider may transfer identity attributes and additional information (such as authorization decisions) to the relying party. Relying party usually has a trust relationship with identity provider.</p>
<div class="paragraph">
<p>Alternative terms: Service Provider</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: relying party</p>
</div>
<div class="paragraph">
<p>X.1252 term: relying party</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-provider">Identity Provider</a>, <a href="#glossterm-sso">Single Sign-On</a>, <a href="#glossterm-identity-federation">Identity Federation</a></p>
</div>
</dd>
<dt><a id="glossterm-remediation"></a>Remediation</dt>
<dd>
<p>Remediation is an action to eliminate violation of a policy, or a non-compliance with regulation or a standard. Remediation is usually a manual action that is addressing the effects, specific cases of non-compliance. E.g. violation of segregation of duties can be remediated by removing one of the conflicting roles or responsibilities.</p>
<div class="paragraph">
<p>Alternative terms: Correction</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-compliance">Compliance</a>, <a href="#glossterm-corrective-action">Corrective action</a></p>
</div>
</dd>
<dt><a id="glossterm-repository"></a>Repository</dt>
<dd>
<p>A database, often a database of self-contained objects. In identity and access management context, it usually means a database of identity information.</p>
<div class="paragraph">
<p>In midPoint terminology: MidPoint internal database. It is used to store all internal midPoint data and the vast majority of midPoint configuration.</p>
</div>
<div class="paragraph">
<p>Alternative terms: MidPoint repository</p>
</div>
</dd>
<dt><a id="glossterm-requirement"></a>Requirement</dt>
<dd>
<p>Requirement is a need or expectation that is stated or implied. Requirements are usually specified by legislation, regulation or standards. Also, requirements are usual part of software specifications or contracts. Although most of the requirements are expected to be explicitly stated, there may be implied requirements, given by usual practice or common expectations.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-compliance">Compliance</a></p>
</div>
</dd>
<dt><a id="glossterm-residual-risk"></a>Residual risk</dt>
<dd>
<p>Residual risk is a risk that remains after risk treatment. It is a risk that was not eliminated during a cybersecurity activities. As it is practically impossible to eliminate risk completely, some residual risk has to be accepted, as part of the usual cybersecurity program.</p>
<div class="paragraph">
<p>Alternative terms: Retained risk</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-acceptance">Risk acceptance</a></p>
</div>
</dd>
<dt><a id="glossterm-resource"></a>Resource</dt>
<dd>
<p>In generic terms, a Resource is any information asset, system or a service that can be meaningfully used to obtain an information, or to initiate an action. Web resources are often used to access information across World Wide Web, e.g. in a form of RESTful interfaces. In IAM field, a Resource (Identity Resource) is usually a network-accessible asset capable of managing identity information.</p>
<div class="paragraph">
<p>In midPoint terminology: A Resource is a system that is either identity data source or provisioning target.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Information Resource, Data Resource</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-resource">Identity Resource</a></p>
</div>
</dd>
<dt><a id="glossterm-rest"></a>REST</dt>
<dd>
<p>Architectural style that describes fundamental principles of World Wide Web (WWW). REST architectural style was used to develop HTTP protocol, fundamental building block of WWW. REST specifies a concept of resource (web resource), identified by Unified Resource Locator (URL), access by unified interface. Although REST is designed for hypertext applications, some REST principles are used for general-purpose programming interfaces, known as "RESTful" services or APIs.</p>
<div class="paragraph">
<p>Alternative terms: Representational State Transfer</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-restful-service">RESTful Service</a>, <a href="#glossterm-api">Application Programming Interface</a>, <a href="#glossterm-resource">Resource</a></p>
</div>
</dd>
<dt><a id="glossterm-restful-service"></a>RESTful Service</dt>
<dd>
<p>Usually a general-purpose programming interface (API) or network service, exposed by one application to be used by another application. RESTful services are based on operations of HTTP protocols such as GET, PUT and POST. RESTful services are using Unifier Resource Locators (URLs) as addressing scheme, and also for the purposes of conveying some parameters. Despite the name, RESTful services actually do not strictly follow principles of REST architectural style. REST architectural style is designed for use in hypertext applications, while most RESTful services are procedural in nature. Therefore most RESTful services adapt and bind the REST principles for their purposes. Despite such deformations, RESTful services provide a very popular method for application-to-application interaction over the Internet.</p>
<div class="paragraph">
<p>Alternative terms: REST Service, REST API</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-rest">REST</a>, <a href="#glossterm-api">Application Programming Interface</a></p>
</div>
</dd>
<dt><a id="glossterm-review"></a>Review</dt>
<dd>
<p>Review is an activity that aims at evaluation whether certain subject matter is adequate to achieve its objectives. Review often evaluates performance of a process, program, project or policy.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-access-certification">Access Certification</a>, <a href="#glossterm-performance">Performance</a></p>
</div>
</dd>
<dt><a id="glossterm-review-object"></a>Review object</dt>
<dd>
<p>Review object is the subject matter reviewed by a review. It is usually a process, program, project or policy.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-review">Review</a></p>
</div>
</dd>
<dt><a id="glossterm-review-objective"></a>Review objective</dt>
<dd>
<p>Review objective is a statement describing the intended results of a review.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-review">Review</a></p>
</div>
</dd>
<dt><a id="glossterm-risk"></a>Risk</dt>
<dd>
<p>Effect of uncertain, unforeseen, unknown or unknowable effects on objectives. Risk may originate from the fact that the effects are inherently uncertain, such as short-term fluctuations of the markets. However, many forms of risk stem from lack of knowledge or understanding, such as lack of knowledge about capabilities of attackers. While risk includes both positive and negative uncertain effects, almost all activities in cybersecurity deal with negative effects of risk.</p>
<div class="paragraph">
<p>In cybersecurity risk assessment and modeling, risk is associated with the impact of threats, exploiting vulnerabilities of information assets.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk-level">Risk level</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-acceptance"></a>Risk acceptance</dt>
<dd>
<p>Risk acceptance is a decision to accept a particular (residual) risk. As it is practically impossible to eliminate risk completely, some residual risk has to be accepted, as part of the usual cybersecurity program. Risk acceptance is usual part of risk treatment process. Even though a risk is accepted, it does not mean it is forgotten. Accepted is should be subject to monitoring.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-residual-risk">Residual risk</a>, <a href="#glossterm-monitoring">Monitoring</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-analysis"></a>Risk analysis</dt>
<dd>
<p>Risk analysis is a systematic process to understand the nature and extent of risk, and to determine risk levels. It is a structured process, evaluating several aspects of risk. As risk is almost impossible to measure exactly, risk levels are often estimated during risk analysis.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-level">Risk level</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-assessment"></a>Risk assessment</dt>
<dd>
<p>Risk assessment is a comprehensive process consisting of risk identification, risk analysis and risk evaluation. Risk treatment is a necessary part of risk management process.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-analysis">Risk analysis</a>, <a href="#glossterm-risk-identification">Risk identification</a>, <a href="#glossterm-risk-evaluation">Risk evaluation</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-based-approach"></a>Risk-based approach</dt>
<dd>
<p>Risk-based approach is an approach to cybersecurity management based on systematic management of risk. It is based on controlled method to manage of risk in an organization. One of the primary principles of risk-based approach is an acceptance that risk cannot be completely eliminated. The risk has to be assessed, subjected to appropriate treatment, and residual risk has to be accepted.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-management">Risk management</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-communication"></a>Risk communication</dt>
<dd>
<p>Risk communication is a set of activities to communicate information about risk with interested parties (stakeholders). Communication may take form of consultation, communicating risk and risk-related information both ways. Purpose of risk communication is to improve decision processes related to risk and its impact on organization objectives.</p>
<div class="paragraph">
<p>Alternative terms: Risk communication and consultation</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-assessment">Risk assessment</a>, <a href="#glossterm-interested-party">Interested party</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-criteria"></a>Risk criteria</dt>
<dd>
<p>Specification of requirements and other criteria used to evaluate risk. Legislation, regulation, standards and best practice are the usual baseline for risk criteria. However, specific risk criteria are determine by character, objectives and methods of a particular organization.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-evaluation">Risk evaluation</a>, <a href="#glossterm-compliance">Compliance</a>, <a href="#glossterm-requirement">Requirement</a>, <a href="#glossterm-policy">Policy</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-evaluation"></a>Risk evaluation</dt>
<dd>
<p>Risk evaluation is a process of comparing results of risk analysis to risk criteria. Result of risk evaluation is a decision whether risk is acceptable, or it has to be treated (eliminated or mitigated).</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-assessment">Risk assessment</a>, <a href="#glossterm-risk-criteria">Risk criteria</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-identification"></a>Risk identification</dt>
<dd>
<p>Risk identification is a process of discovering and describing risks. It involves identification of risk sources and causes, which may be based on historical data or expertise.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-assessment">Risk assessment</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-level"></a>Risk level</dt>
<dd>
<p>Magnitude or measure of risk. Expression of risk level is heavily influenced by context. Risk levels can be quantitative, expressing risk level in a measurable and generally comparable quantities, such as perceptual probability or weighted monetary cost. Risk levels can also be qualitative, expressing risk level in a relative terms, such as "low", "medium" and "high". Risk levels may consider impact (consequence) or a risk, or it may be concerned solely with probability of a risk occurrence.</p>
<div class="paragraph">
<p>Alternative terms: Level of risk</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-probability">Probability</a>, <a href="#glossterm-risk-analysis">Risk analysis</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-management"></a>Risk management</dt>
<dd>
<p>Risk management is a broad set of coordinated activities aimed at control of risk in an organization. It includes formal risk management processes, as well as informal and implicit activities. Risk management is one of the basic mechanisms of cybersecurity.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-management-process">Risk management process</a>, <a href="#glossterm-risk-based-approach">Risk-based approach</a>, <a href="#glossterm-cybersecurity">Cybersecurity</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-management-process"></a>Risk management process</dt>
<dd>
<p>Risk management process is a systematic application of processes and methods for controlled management of risk in an organization. It is supposed to be based on formal specification of processes and policies. It is usually a circular, iterative process, going through analytical, implementation, monitoring and review phases. Risk management is one of the most important processes in cybersecurity.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-management">Risk management</a>, <a href="#glossterm-risk-based-approach">Risk-based approach</a>, <a href="#glossterm-policy">Policy</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-owner"></a>Risk owner</dt>
<dd>
<p>Risk owner is a person who is responsible for a particular risk. It may be an owner of the system, certain privilege in a system, or owner of business process that is a source of risk. Risk owner is supposed to have accountability as well as authority to properly manage the risk.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-management-process">Risk management process</a></p>
</div>
</dd>
<dt><a id="glossterm-risk-treatment"></a>Risk treatment</dt>
<dd>
<p>Risk treatment is an activity to address the risk. Ultimate goal of risk treatment is to lower overall risk to an acceptable level. Many methods can be used to treat the risk, including avoiding activities that are sources of risk, eliminating risk sources, lowering probability or impact of a risk, redirecting risk to another party, or accepting the risk. Risk treatment is a necessary part of risk management process.</p>
<div class="paragraph">
<p>Alternative terms: Risk mitigation, Risk elimination, Risk reduction, Risk prevention</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-risk-management-process">Risk management process</a>, <a href="#glossterm-risk-assessment">Risk assessment</a></p>
</div>
</dd>
<dt><a id="glossterm-role"></a>Role</dt>
<dd>
<p>Abstract concept that usually groups entitlements (privileges, access rights) in a single object. The purpose of grouping entitlements in roles is to make access control policies manageable, usually using Role-Based Access Control (RBAC) principles.</p>
<div class="paragraph">
<p>X.1252 term: role</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-entitlement">Entitlement</a>, <a href="#glossterm-rbac">Role-Based Access Control</a>, <a href="#glossterm-role-management">Role Management</a></p>
</div>
</dd>
<dt><a id="glossterm-role-explosion"></a>Role Explosion</dt>
<dd>
<p>Unreasonable multiplication of the number of roles in role-based access control (RBAC) systems. Role explosion occurs due to a combination of several causes, poor role management practices and cartesian product in role definitions are perhaps the most common. It occurs mostly in static RBAC models, dynamic RBAC models have methods to avoid role explosion.</p>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.comhttps://docs.evolveum.com/iam/role-explosion/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-rbac">Role-Based Access Control</a>, <a href="#glossterm-role-management">Role Management</a></p>
</div>
</dd>
<dt><a id="glossterm-role-management"></a>Role Management</dt>
<dd>
<p>A process of managing role definitions. It usually includes creating role definitions, maintenance of role definitions, adapting to changed environment and decommissioning role definitions. Role management is concerned with role definitions only, in contrast with Role-Based Access Control (RBAC), which is mostly concerned in using the definitions to control the access.</p>
<div class="paragraph">
<p>Alternative terms: Role Modeling, Role Engineering</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-role">Role</a>, <a href="#glossterm-rbac">Role-Based Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-schema"></a>Schema</dt>
<dd>
<p>Description of a structure of information, such as description of data types, attribute names and types, attribute structure and multiplicity, often supplemented by additional information such as documentation and presentation metadata.</p>
<div class="paragraph">
<p>In information systems designed to process identity information, the schema usually refers to structure of digital identity data, names of identity attributes, their types, multiplicity, optionality and similar properties.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Data model, Identity model</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a>, <a href="#glossterm-verification">Verification</a>, <a href="#glossterm-referential-integrity">Referential Integrity</a></p>
</div>
</dd>
<dt><a id="glossterm-secure-by-default"></a>Secure by Default</dt>
<dd>
<p>Software development principle, mandating that system or service should be secure from the moment of installation. Software and services should be distributed with a secure configuration.</p>
<div class="paragraph">
<p>Alternative terms: Security by Default</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-secure-by-design">Secure by Design</a>, <a href="#glossterm-secure-through-lifecycle">Secure Through Lifecycle</a></p>
</div>
</dd>
<dt><a id="glossterm-secure-by-design"></a>Secure by Design</dt>
<dd>
<p>Software development principle, mandating that security of software products and services should be built into the system from very early stages of design and development. Security should be an integral part of the design, rather than an after-thought. Functionalities of the system should be based well-established security practices and standards and reduced to the minimum required for operation.</p>
<div class="paragraph">
<p>Alternative terms: Security by Design</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-secure-by-default">Secure by Default</a>, <a href="#glossterm-secure-through-lifecycle">Secure Through Lifecycle</a></p>
</div>
</dd>
<dt><a id="glossterm-secure-through-lifecycle"></a>Secure Through Lifecycle</dt>
<dd>
<p>Software development principle, mandating that system should be secure from its inception, through all its life all the way to decommissioning. System should always be in a secure configuration, never opening any vulnerabilities, not even in emergency situations.</p>
<div class="paragraph">
<p>Alternative terms: Security Through Lifecycle</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-secure-by-design">Secure by Design</a>, <a href="#glossterm-secure-by-default">Secure by Default</a></p>
</div>
</dd>
<dt><a id="glossterm-security-audit"></a>Security Audit</dt>
<dd>
<p>Independent review of a system, in order to assess adequacy of security controls, evaluate compliance with policies, regulations and operational procedures.</p>
<div class="paragraph">
<p>X.1252 term: security audit</p>
</div>
</dd>
<dt><a id="glossterm-security-posture"></a>Security Posture</dt>
<dd>
<p>Security posture is the security status of an enterprise&#8217;s networks, information, and systems based on cybersecurity resources (e.g., people, hardware, software, policies) and capabilities in place to manage the defense of the enterprise and to react as the situation changes. It is a "big picture" of the state of cybersecurity in an organization.</p>
<div class="paragraph">
<p>Alternative terms: Cybersecurity posture</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity">Cybersecurity</a></p>
</div>
</dd>
<dt><a id="glossterm-selective-disclosure"></a>Selective Disclosure</dt>
<dd>
<p>A mechanism that gives person a control over the sharing of data, usually between domains. Selective disclosure is sometimes applied in cross-domain data transfer, such as when using identity providers or identity federations. In case of data transfer, the user is prompted to select that data that can be disclosed to the other domain. This process is sometimes automatic, governed by a pre-defined data disclosure policy.</p>
<div class="paragraph">
<p>Alternative terms: Selective Disclosure of Personal Information</p>
</div>
<div class="paragraph">
<p>ISO 24760 term: selective disclosure</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-digital-identity">Digital Identity</a>, <a href="#glossterm-personal-data-protection">Personal Data Protection</a>, <a href="#glossterm-privacy">Privacy</a>, <a href="#glossterm-identity-provider">Identity Provider</a>, <a href="#glossterm-identity-federation">Identity Federation</a>, <a href="#glossterm-minimal-disclosure">Minimal Disclosure</a></p>
</div>
</dd>
<dt><a id="glossterm-self-asserted"></a>Self-Asserted</dt>
<dd>
<p>An assertion (claim) made by an entity about itself. It usually means a claim that was not verified or certified by any other party.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-self-asserted-identity">Self-Asserted Identity</a></p>
</div>
</dd>
<dt><a id="glossterm-self-asserted-identity"></a>Self-Asserted Identity</dt>
<dd>
<p>An identity (usually a digital identity) that an entity declares about itself. It usually means a set of digital identity attributes that an entity claimed about itself, without being verified of certified by any other party.</p>
<div class="paragraph">
<p>X.1252 term: self-asserted identity</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-self-asserted">Self-Asserted</a>, <a href="#glossterm-decentralized-identifier">Decentralized Identifier</a>, <a href="#glossterm-identity-assertion">Identity Assertion</a></p>
</div>
</dd>
<dt><a id="glossterm-shadow"></a>Shadow</dt>
<dd>
<div class="paragraph">
<p>In midPoint terminology: Shadow objects are objects in midPoint repository representing objects in identity resources, such as accounts or groups. Shadow objects are used by midPoint as a proxy objects, or data adapters for real accounts, groups or organizational units in identity resources. MidPoint stores identifiers of resource objects in shadow objects, together with meta-data, policy-related information and operational data that relate to the resource object that the shadows represent. The identifiers stored in shadow objects are used to locate the correct resource object even in cases that is renamed or it moves. Shadow objects may contain copies of the data of real resource objects. However, in default configuration, only identifiers are stored in shadow objects.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://docs.evolveum.com/midpoint/reference/resources/shadow/">more information at docs.evolveum.com</a>.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Shadow Object</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-projection">Projection</a></p>
</div>
</dd>
<dt><a id="glossterm-self-sovereign-identity"></a>Self-Sovereign Identity (SSI)</dt>
<dd>
<p>Self-sovereign identity is an approach to digital identity that gives individual control over their identity data. Without self-sovereign identity, individuals need to rely on (usually big and influential) organizations to manage their identity data, acting as identity providers. SSI systems are often decentralized, based on verifiable credentials stored in digital wallet which are under user&#8217;s control.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-decentralized-identity">Decentralized Identity</a>, <a href="#glossterm-verifiable-credentials">Verifiable Credentials</a>, <a href="#glossterm-identity-provider">Identity Provider</a></p>
</div>
</dd>
<dt><a id="glossterm-sso"></a>Single Sign-On (SSO)</dt>
<dd>
<p>Single sign-on (SSO) is an authentication process based on user logging into multiple systems with single set of credentials (usually username and password)s. It is used for systems that require authentication for each application while using the same credentials. SSO works on central service from where the user gains access to different applications without logging in again.</p>
<div class="paragraph">
<p>Unlike identity providers, SSO systems usually operate within a single domain. Both the SSO server and the applications being controlled by the same organization. Implicit trust of such arrangement allows SSO systems to be much simpler than identity federation systems, albeit both classes of systems provide similar services and mechanisms.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Single Log-On</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-authentication">Authentication</a>, <a href="#glossterm-identity-provider">Identity Provider</a>, <a href="#glossterm-identity-federation">Identity Federation</a></p>
</div>
</dd>
<dt><a id="glossterm-standard"></a>Standard</dt>
<dd>
<p>Technical specification, adopted by a recognised standardisation body, for repeated or continuous application, with which compliance is not compulsory.</p>
<div class="paragraph">
<p>Alternative terms: Technical standard, Technology standard, Official standard</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-technical-specification">Technical specification</a></p>
</div>
</dd>
<dt><a id="glossterm-static-entitlement"></a>Static Entitlement</dt>
<dd>
<p>An entitlement that is statically assigned to a user or an account. The entitlement stays ("stands") assigned to a user indefinitely, until it is explicitly unassigned. Static entitlement is assigned to a user by an action of system administrator, by the means of access request process or by similar means.</p>
<div class="paragraph">
<p>Standing entitlement forms a basis of some access control models, most notably Role-Based Access Control (RBAC). Static nature of the entitlement assignment is often a target of critique, stating the lack of dynamics and flexibility of static entitlements. Policy-based access control models avoid use of standing entitlements in favor of entitlements that are determined dynamically in run-time.</p>
</div>
<div class="paragraph">
<p>While static entitlements may be necessary at higher levels (especially identity governance level), they may not necessarily be reflected to lower levels (e.g. directory services and operating systems). Eliminating low-level standing privilege has several advantages, including lower risk of misuse and less visibility for the attacker. Just-in-time or on-demand mechanisms for temporary assignment of privileged access provides a solution for bridging high-level and low-level static entitlements.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Standing Privilege, Standing Entitlement, Persistent Privileges</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-entitlement">Entitlement</a>, <a href="#glossterm-access-control">Access Control</a>, <a href="#glossterm-rbac">Role-Based Access Control</a>, <a href="#glossterm-pdrbac">Policy-Driven Role-Based Access Control</a>, <a href="#glossterm-abac">Attribute-Based Access Control</a>, <a href="#glossterm-pbac">Policy-Based Access Control</a></p>
</div>
</dd>
<dt><a id="glossterm-subject"></a>Subject</dt>
<dd>
<p>An entity or identity, which is active in information system, typically a user. It is assumed that subject has an agency, directly or indirectly. Subjects can represent organizations or similar "legal persons" that cannot act on their own, users have to act on their behalf. In this case the organization is the "subject", while the person that acts on organization behalf is the "user".</p>
<div class="paragraph">
<p>The term "subject" is often used in context of authorization, as part of subject-action-object triple. Subject is the active part, a user executing certain action on a specific object. In some contexts, "subject" is equivalent to "principal".</p>
</div>
<div class="paragraph">
<p>Alternative terms: Principal</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-principal">Principal</a>, <a href="#glossterm-user">User</a>, <a href="#glossterm-entity">Entity</a>, <a href="#glossterm-identity">Identity</a>, <a href="#glossterm-account">Account</a>, <a href="#glossterm-authorization">Authorization</a>, <a href="#glossterm-holder">Holder</a></p>
</div>
</dd>
<dt><a id="glossterm-target-system"></a>Target System</dt>
<dd>
<p>In IAM field, it is any system in which identity management (IDM) system is managing identity data. IDM system is usually using identity connectors to manage data in target systems.</p>
<div class="paragraph">
<p>Some target systems can also be (partial) identity data sources, IDM system both managing and reading the data.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-management-system">Identity Management System</a>, <a href="#glossterm-identity-connector">Identity Connector</a>, <a href="#glossterm-identity-data-source">Identity Data Source</a></p>
</div>
</dd>
<dt><a id="glossterm-technical-specification"></a>Technical specification</dt>
<dd>
<p>Document that prescribes technical requirements to be fulfilled by a product, process, service or system and which lays down characteristics, production methods or assessment criteria. Unlike standard, it is not required that technical specification is adopted by a recognized standardization body.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-standard">Standard</a></p>
</div>
</dd>
<dt><a id="glossterm-threat"></a>Threat</dt>
<dd>
<p>In cybersecurity, threat is a potential to cause harm or to endanger information assets or organization. Threats may be intentional, unintentional or completely natural. Many cybersecurity threats are materialized by motivated attackers, while other threats may be environmental (flooding, fire), or may be caused by a society or government actions.</p>
<div class="paragraph">
<p>Alternative terms: Cyber threat, Security threat</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-asset">Asset</a>, <a href="#glossterm-risk-assessment">Risk assessment</a>, <a href="#glossterm-cyberattack">Cyberattack</a></p>
</div>
</dd>
<dt><a id="glossterm-top-management"></a>Top management</dt>
<dd>
<p>Top management is a person or a group who controls the organization at the top level. Top management is ultimately responsible for allocation of resources, objectives and results of the organization.</p>
<div class="paragraph">
<p>Alternative terms: Executive management, Board, Board of directors</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-organization">Organization</a>, <a href="#glossterm-organizational-structure">Organizational Structure</a></p>
</div>
</dd>
<dt><a id="glossterm-triangle-of-trust"></a>Triangle Of Trust</dt>
<dd>
<p>Triangle of trust is a three-party relationship of issuer, holder and verifier. Issuer issues credential or claim to the holder. Holder presents the credential/claim to the verifier. Verifier verifies the credential/claim, using data provided by the issuer.</p>
<div class="paragraph">
<p>Triangle of trust is a frequently-used concept to support trust relationships in distributed information systems.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Trust Triangle</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-issuer">Issuer</a>, <a href="#glossterm-holder">Holder</a>, <a href="#glossterm-verifier">Verifier</a>, <a href="#glossterm-trusted-third-party">Trusted Third Party</a></p>
</div>
</dd>
<dt><a id="glossterm-trust"></a>Trust</dt>
<dd>
<p>Confidence in or reliance on some person or quality. In information technology world, it usually means a confidence in a correctness of an information. It is often a long-term relationship between entities, one of the entity trusting in correctness of a whole class of information claimed by other entity (trusted third party).</p>
<div class="paragraph">
<p>X.1252 term: trust</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-triangle-of-trust">Triangle Of Trust</a>, <a href="#glossterm-trusted-third-party">Trusted Third Party</a></p>
</div>
</dd>
<dt><a id="glossterm-trust-service"></a>Trust service</dt>
<dd>
<p>Electronic service that issues a digital credentials, acting as a trusted third party.</p>
<div class="paragraph">
<p>See also: <a href="#glossterm-trusted-third-party">Trusted Third Party</a>, <a href="#glossterm-certificate-authority">Certificate Authority</a></p>
</div>
</dd>
<dt><a id="glossterm-trusted-third-party"></a>Trusted Third Party</dt>
<dd>
<p>An entity which makes a claims, claims that are trusted by other parties. Usually a central entity in a system that is trusted by many entities. In scenarios involving Triangle of Trust, the issuer is considered to be trusted third party.</p>
<div class="paragraph">
<p>X.1252 term: trusted third party</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-trust">Trust</a>, <a href="#glossterm-triangle-of-trust">Triangle Of Trust</a>, <a href="#glossterm-issuer">Issuer</a>, <a href="#glossterm-trust-service">Trust service</a></p>
</div>
</dd>
<dt><a id="glossterm-under-provisioning"></a>Under-provisioning</dt>
<dd>
<p>Situation when an identity has less privileges than are necessary for the tasks that the identity is supposed to carry out. For example, a user does not have all the necessary permission to carry out his usual work tasks. Under-provisioning is an operational risk, leading to low workforce efficiency.</p>
<div class="paragraph">
<p>Ideally, under-provisioning should be addressed by automated provisioning mechanism of identity management systems, such as utilization of birthright provisioning. However, due to a lack of clear access control policy, under-provisioning is often addressed by access request processes.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Under-permissioning, Under-privileged Access</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-identity-provisioning">Identity Provisioning</a>, <a href="#glossterm-birthright">Birthright</a>, <a href="#glossterm-access-request">Access Request Process</a>, <a href="#glossterm-over-provisioning">Over-provisioning</a></p>
</div>
</dd>
<dt><a id="glossterm-user"></a>User</dt>
<dd>
<p>Generally speaking, a person that is using a computing system.</p>
<div class="paragraph">
<p>In midPoint terminology: A user means a data structure in midPoint that describes a person. Similar data structure in source/target system (identity resource) is called an "account".</p>
</div>
<div class="paragraph">
<p>Alternative terms: MidPoint User</p>
</div>
<div class="paragraph">
<p>X.1252 term: user</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-account">Account</a>, <a href="#glossterm-principal">Principal</a>, <a href="#glossterm-subject">Subject</a></p>
</div>
</dd>
<dt><a id="glossterm-user-centric"></a>User-Centric</dt>
<dd>
<p>A system that is oriented towards the user, having user in control. In identity and access management context it usually means a system, where users are in control of their data.</p>
<div class="paragraph">
<p>X.1252 term: user-centric</p>
</div>
</dd>
<dt><a id="glossterm-verifiable-credentials"></a>Verifiable Credentials (VC)</dt>
<dd>
<p>Credentials that can be presented by the holder to the verifier, and independently verified by the verifier, without cooperation of any third party. Verifiable credentials do not require verifier to cooperate with credential issuer to verify every single credential issued. Only the holder and the verifier are aware about the transaction, no other party has any data about the transaction. Some verifier-issuer communication may be necessary to establish or renew the trust. However, such communication is in no way related to the holder-verifier transaction.</p>
<div class="paragraph">
<p>Verifiable credentials are often based on public key cryptography techniques. Holders keep verifiable credentials in digital wallets.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-credential">Credential</a>, <a href="#glossterm-digital-wallet">Digital Wallet</a>, <a href="#glossterm-self-sovereign-identity">Self-Sovereign Identity</a>, <a href="#glossterm-decentralized-identity">Decentralized Identity</a>, <a href="#glossterm-triangle-of-trust">Triangle Of Trust</a></p>
</div>
</dd>
<dt><a id="glossterm-verification"></a>Verification</dt>
<dd>
<p>A process establishing that a particular information is correct, while the meaning of "information" and "correct" varies from context to context. When dealing with identity information, this usually means formal verification of identity attributes, checking the schema, identifier uniqueness and referential integrity. However, verification may mean deeper verification, such as checking that the information is true and up-to-date.</p>
<div class="paragraph">
<p>ISO 24760 term: verification</p>
</div>
<div class="paragraph">
<p>X.1252 term: verification</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-verifier">Verifier</a>, <a href="#glossterm-digital-identity-attribute">Digital Identity Attribute</a>, <a href="#glossterm-schema">Schema</a>, <a href="#glossterm-referential-integrity">Referential Integrity</a></p>
</div>
</dd>
<dt><a id="glossterm-verifier"></a>Verifier</dt>
<dd>
<p>Entity that performs verification, usually a verification of an credential or a claim. In Triangle of Trust scenarios, the verifier verifies credentials/claims provided by the holder. Verifier may need information provided by the issuer of credential/claim to be able to complete the verification process.</p>
<div class="paragraph">
<p>ISO 24760 term: verifier</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-verification">Verification</a>, <a href="#glossterm-triangle-of-trust">Triangle Of Trust</a>, <a href="#glossterm-issuer">Issuer</a>, <a href="#glossterm-holder">Holder</a>, <a href="#glossterm-trusted-third-party">Trusted Third Party</a>, <a href="#glossterm-credential">Credential</a>, <a href="#glossterm-claim">Claim</a></p>
</div>
</dd>
<dt><a id="glossterm-vulnerability"></a>Vulnerability</dt>
<dd>
<p>Vulnerability is an aspect of information asset that makes it vulnerable to damage or misuse. It is a weakness in the protection of an asset that can be exploited by a threat. In software development, vulnerability is a bug in software code that opens the software to cyberattacks.</p>
<div class="paragraph">
<p>Alternative terms: Weakness</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-risk">Risk</a>, <a href="#glossterm-threat">Threat</a>, <a href="#glossterm-asset">Asset</a>, <a href="#glossterm-risk-assessment">Risk assessment</a>, <a href="#glossterm-cyberattack">Cyberattack</a></p>
</div>
</dd>
<dt><a id="glossterm-zero-trust"></a>Zero trust (ZTA)</dt>
<dd>
<p>"Zero trust" is an approach to cybersecurity based on the concept of "never trust, always verify". The basic idea of the approach is to never trust any system or network implicitly, always verify that the request is authentic both with respect to the identity of the source and trustworthiness of network channels. Under zero trust, every request should be authenticated and authorized. For that approach to work, all relevant identities must be reliably known, especially non-human identities (NHI) representing communicating services and devices. Therefore, identity-based security is a fundamental foundation for zero trust approach.</p>
<div class="paragraph">
<p>Zero trust originated mostly as a reaction to flawed concept of cybersecurity perimeter, which was a common approach to cybersecurity in early years of inter-network computing. Cybersecurity perimeter approach allowed for existence of "perimeter" that separated insecure outer network (usually the Internet) and secure inner network (usually corporate network). Security requirements were significantly reduced in the presumably-secure inner network. In that respect, zero trust can be summarized as "no weak interior", an approach in which no assumption of secure inner network exists. Zero trust approach is operating under "assumption of breach", meaning that it is assumed that the attacker already has access to the network, devices or services.</p>
</div>
<div class="paragraph">
<p>Overall, "zero trust" is mostly a broad conceptual approach - a set of guiding principles, rather than a set of specific technologies and practices. It is currently used as a token of paradigm shift from perimeter-based approach to more resilient and holistic cybersecurity approach that does not rely on concept of perimeter.</p>
</div>
<div class="paragraph">
<p>Alternative terms: Zero-trust, Zero trust security model, Zero trust architecture, Zero trust approach, Perimeterless security, Defense in depth</p>
</div>
<div class="paragraph">
<p>See also: <a href="#glossterm-cybersecurity">Cybersecurity</a>, <a href="#glossterm-identity-based-security">Identity-based Security</a>, <a href="#glossterm-perimeter">Perimeter</a></p>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.3<br>
Last updated 2024-11-19 17:25:48 +0100
</div>
</div>
</body>
</html>