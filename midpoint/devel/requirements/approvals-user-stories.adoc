= Approvals - User Stories
:page-nav-title: Approvals user stories
:page-toc: top
:toclevels: 3
:sectnums:
:sectnumlevels: 3

This document contains user stories for upgrade of design of approvals.
It is prepared for planning of development of *midPoint version 4.9*. Some user stories described here may be already implemented.

This document will be tuned during summer 2023.


== User experience

=== Improving User Understanding of Approvals

Currently, our approval process includes too much midpoint-specific terminology, such as "delta," which may not be familiar or intuitive to our business users. To enhance the user experience, we should make the approvals more user-friendly and align them with concepts that business users are already familiar with, namely "requests" and "approvals."

In the context of midpoint, we can adopt the following naming convention:

* *Request:* This will replace the "Top level case" to represent the initial user request for approval.
* *Case:* This term will continue to be used in midpoint, representing the approval process for each request.
* *Workitem:* represents the individual tasks or items requiring approval within a case.

Furthermore, we should ensure that all user-facing pages hide the midpoint-specific terminology, presenting a more intuitive interface for business users. The goal is to provide approvers with a clear and straightforward view of the requests they are handling, enabling better communication and collaboration among all parties involved in the approval process.

User story::
AS a business manager who does not know midpoint terminology but needs to approve, +
I WANT TO have clear intuitive understanding what is request, case and who has to approve it and when, +
SO THAT I won't get lost in GUI without learning midpoint terminology. I want just to see and understand things I need to approve and use approvals to approve or reject the requests.

=== Attachment / link in the request
The attachment may be assigned by requestor or even by approver.

User story::
AS an end user requesting access +
I WANT TO be able to attach attachment to the request (e.g. email from some manager), or add a link to some other system (website) +
SO THAT I can prove reason of my request. +

User story::
AS an approver approving request +
I WANT TO be able to attach attachment to the request, or add a URL link +
SO THAT I can explain better my decision, or
THAT I can provide requestor or next approvers some additional information.

=== Send back to requestor

User Story::
AS an Approver +
I WANT the ability to send a request back to requestor for additional information +
SO THAT I can obtain the necessary details or clarifications required for a complete and accurate evaluation of the request.

Acceptance Criteria::
* When the request is sent back, the requestor should be notified.
* The status of the request should be appropriately updated to reflect the "information requested" state.
* Midpoint should allow the requestor to update and resubmit the request after providing the requested information or modify it.

=== Automatic approval if requestor = approver

AS an engineer configuring approvals, +
I WANT TO configure request to be approved automatically when requestor is the same as approver, +
SO THAT users don't experience unnecessary approvals.

Acceptance Criteria::
* The IAM engineer configuring approvals should have an option to enable such automatic approval.
* The automatic approval should be applied in any step of the approval.
* When the automatic approval feature is enabled, midPoint should check if the requestor is the same as the approver at any stage of the approval process.
* If the requestor is the same as the approver, the request should be automatically approved without any additional steps.
* The IAM engineer configuring approvals should be able to disable the automatic approval feature for specific types of requests or stages, providing flexibility in the approval setup.
* The automatic approval should be logged in the history of apprvovals with itentification of automatic approval.

=== NEXT Use-cases

#TODO# Approver must have better overview of what is he approving


=== Approve in behalf of

User Story::
AS a Deputy of an Approver +
I WANT TO be able to perform approvals on their behalf, +
SO THAT requests will not be delayed if the approver is unavailable.

Acceptance Criteria::

* I should have the authorization to act as a deputy approver for the specific approver.
* When the authorized approver is not available, I can perform approvals on their behalf.
* End user should see that the approval was performed by me as the deputy approver (on behalf of).
* Requests should continue to be processed and not wait for the approver's presence, ensuring timely approvals even in their absence.

=== Discussion chain from approval notes.

#TODO# Approval notes should be visible in some chain - that each approver will be able to read and understand.


== Big picture / reporting over requests and approvals

=== Request analysis
User Story::
AS a Role Manager / IAM Operations Manager / Security Officer +
I WANT TO obtain big picture information about requests and their approvals +
SO THAT I can effectively manage IAM operations and also processes related to it.

Particularly:

* I want to know which roles are most frequently requested for a given period, so that I can optimize rule configurations and automate assignments.
* I want to identify requests that required most approvers, so that I can address any inefficiencies or bottlenecks.
* I want to identify requests with the longest approval times, so that I can investigate and address any delays in the approval process within the organization.
* I want to track the total number of requests created and the average approval time for each request, including the time taken for 90% or 95% of the requests to be approved.
    ** Monitoring average is not enough. Managing 90% or 95% level is much better (90%: 9 of 10 requests will be processed withing this time iterval.)
* I want to perform these statistics separately for different types of requests, without mixing them together.

=== Manual request processing

User Story::
AS a Role Manager / IAM Operations Manager / Security Officer +
I WANT TO monitor not only apprroval phase but also provisioning as well +
SO THAT I can verify that request are fully fulfilled and they did not fail during provisioning.


=== Compare trends

User Story::
AS a Role Manager / IAM Operations Manager +
I WANT TO see statistics from specific request analysis for time periods +
SO THAT I can identify trends and manage processes.

=== Better overview of my requests in GUI

User story::
AS a user +
I WANT TO see my open requests and their status (who is currently approving them and since when) +
SO THAT I can contact the person and request approval, enabling a self-service approach for problem-solving.

User story::
AS a user +
I WANT TO know how long a specific person has had my request (whether they received it yesterday or if it's been a week) +
SO THAT I can be aware of the approval timeline and follow up if necessary.

User Story::
As a User +
I WANT TO see all my requests that I have created together with their status +
SO THAT I can see a list of all requests that I have created since I joined the system. For each request I want to be able to track its progress.

=== Better view of open requests in user (object)

User story::
AS business user +
I WANT TO see easier that user (myself) or other object has open requests/cases when I open the object +
SO THAT I won't miss that user (or myself) has something "in progress" and therefore may not be applied in his access yet.

The notification is already visible over the cases, but business user can miss it quite often. Something better visible, but not very aggressive - not necessary to click on it.


== REST interface

=== Approval via REST

Midpoint must have options to approve/reject requests via REST.

User story::
AS an IT manager+
I WANT TO all requests were approved in our internal tool +
SO THAT people (managers) can perform their basic daily approval tasks from one place - the same environment and see what they approved and when.

Acceptance criteria::
GIVEN company has its own application that is used for performing approve/reject operations. This application can connect to midpoint via REST. +
WHEN an approver has to approve request +
THEN the application is able to show request with basic information (what was requested, when, who, approval notes). User is able to approve, reject the request (together with writing the note). +
If the user needs more details, he is able to get directly to midpoint via link.

We need to resolve issue listed already in xref:../../guides/approvals-via-rest-howto/index.adoc[Approvals via REST howto]

See also: xref:https://jira.evolveum.com/browse/MID-6067[JIRA MID-6067]


The application may not necessarily mimic all the details provided in midpoint. If user needs more info, the link should be available to get to approval case in midpoint.


== IAM Engineer experience

The updates in 4.9 should provide better interface to engineer. It should provide easier configuration and better overview of what is already configured in the system. So the engineer is more efficient and inexperienced engineers can get into midPoint faster.

=== Default configuration of notifications

User Story::
AS an engineer configuring approvals and it's notifications, +
I WANT TO have default or initial configurations available that I can use as a starting point for my own configurations, +
SO THAT I can expedite the process of setting up approvals and notifications and deliver my results faster.


*Acceptance Criteria:*

Default configuration of notifications should provide following notifications:

Notifications to requestor:

* When the request is created: "Your request of assigning role XYZ was created."
    ** optionally, if requestee is not the same as requestor: "Request of assigning role XYZ to you was created by <requestors name>."
* At the end of the approval, when all approvals are done and the request is approved: "You request of assigning role XYZ was approved"
    ** alternatively, when the request is rejected: "Your request was rejected"

Notifications to approver:

* Notifications to approver: "Your approval is required for ..."

Optional notification to requestor:

* When the request is sent back to requestor, then the requestor should obtain notification: "Your request was returned to you by <name>"


=== Cover also manual tasks in the request workflow

#TODO# - when there are manual cases required in provisioning of the task, then


=== Workflow / lifecyle definition



#TODO# - engineer is able to define workflow using stages and transitions

User story::
#TODO# - AS an IAM engineer configuring approval workflows I

NOTE: #TODO# - lifecycle stages of the object can have different names


=== Performing actions using buttons

Approval steps in midpoint are initialized by identification of event which is not always intuitive for end user. The main point of starting action is sometimes "hidden in the code" - e.g. modification of role name requires approval of role owner, or moving object in its lifecycle. It is ok, just this is not visible.

It could be good if engineer can have option to provide a button to start some action. This button could e.g. move the object to next step in workflow. For this we have already xref:../../reference/admin-gui/admin-gui-config/admin-gui-configuration-4-0.adoc#_custom_actions_for_object_lists[custom actions for object lists]. Just it could be similar custom buttons for objects.

Additionaly (even better for users, but much more complex to implement) this button could open modal window with specific form where user can add some parameters and by saving it would start processing.

This concept could be used in following user stories:

User story::
AS a user creating an object in its lifecycle +
I WANT to have buttons <SAVE as DRAFT> for saving my modifications but not starting the approval and <SEND TO APPROVAL> for starting the approval of new object. +
SO THAT I can prepare object but not start approval directly when I don't have all information collected.

User story::
AS a user modifying lifecycle state of the object +
I WANT TO see buttons to understand to which lifecycle stage should I move the object +
SO THAT I am not confused and see directly what I can do with the object.

Example of workflow stages:
Naming is different from our lifecycle states, as the naming can be different - even for different archetypes.

* New object can be saved in ACTIVE state or in DRAFT. So the user in new object can see <SAVE AS DRAFT> and <ACTIVATE> buttons.
* Object in DRAFT can be moved only to ACTIVE or DECOMMISIONED stage. So the user can see buttons <ACTIVATE> and <DECOMMISION>
* Object in ACTIVE state can be moved to INACTIVE or DECOMMISIONED stage. So the user can see buttons <INACTIVATE> and <DECOMMISION>
* Object in DECOMMISIONED state can't be moved anywhere, so no buttons is displayed.


=== Synchronization of UI changes to GIT objects

The UI features for providing some configuration (e.g. resource wizard) should help inexperienced engineers to perform configuration easier than via direct XML files modification.

This user story covers whole midpoint configuration - not only approvals. When engineer utilizes UI features for configuration, then he must understand which objects were modified to be able to mimic the configuration in XML files in XML configuration files that are stored in GIT.

This is complicated process and engineer may not know which objects were modified (especially if multiple objects were modified). Additionaly, the objects contains additional operational elements. Inexperienced engineer may not fully understand which elements were added by his configuration and which by midPoint while operations.

User Story::
AS an IAM engineer who performed a configuration of midPoint feature via UI, +
I WANT TO have a feature in midPoint or in midPoint Studio which helps me to synchronize the modifications to my project files, +
SO THAT I can import the modification performed via GUI to my project easily and with full confidence that I didn't miss any modification.

NOTE: Midpoint Studio already provides features for cleanup of existing objects from operational attributes and comparing them with objects already present in repository. It helps skilled engineer and might be used for this, just it will not provide engineer full confidence of which objects were modified byt the operation.