= Import usernames from LDAP
:page-nav-title: Import usernames from LDAP
:page-display-order: 240
:page-toc: top
:experimental:
:icons: font

== Import usernames from LDAP

When setting up the HR resource, you used employee numbers (`empnum`) for account names in midPoint
because the HR system does not have any better unique identifier.

Now, however, you have the LDAP resource connected and with that, you gave midPoint access to much more human-friendly usernames that are in the LDAP system.
It is a good time now to adjust the HR and LDAP resource mappings so that account owner focal objects are named using the LDAP usernames.

Here's the outline of what you're going to do to achieve that:

. Set the _empnum-to-name_ inbound attribute mapping strength in the HR resource to to _weak_.
. Create a new inbound mapping for _name_ in the LDAP resource with an appropriate source attribute containing the usernames.
. Run a simulated reconciliation task to validate the new setup.
	.. Test on a single account.
	.. Simulate on all accounts.
. Reconcile the accounts again for real.

== Adjust the mappings to prepare for username import from LDAP

Firstly, adjust the HR resource _name_ mapping:

. In your HR resource, open inbound mapping settings.
. Locate the mapping populating the _name_ attribute with the value of the source _empnum_ attribute. +
	In this guide, it is called _empnum-to-name_.
. In advanced settings of the mapping, change its *strength* to _weak_.
    ** Refer to xref:/midpoint/reference/admin-gui/resource-wizard/object-type/mapping/advanced-mappings/[] for a guide on setting mapping strength.

Secondly, add a new inbound mapping for the _name_ attribute in the LDAP resource:

. Look into your LDAP data and locate the name of the attribute that holds usernames. They have to be unique across all accounts. +
	In the sample data used in this guide, the name of the attribute is _uid_.
. In your LDAP resource, open inbound mapping settings.
. Add a new mapping according to the table below. +
	Adjust the mapping name and the source attribute name according to your data.

[cols="6*"]
.Strong inbound mapping to copy _uid_ parameter with usernames to _name_ parameter
|====
| Name                         | Source | Expression | Target | Lifecycle state | Comments
| inbound-uid-username-to-name | uid    | As is      | name   | Proposed        | Keep the mapping *Strength* set to _Strong_ and the *Use for* option to _Undefined_.
|====

.LDAP resource inbound mappings, the last one being the one for importing usernames
image::../ldap-username-import-inbound-mapping.webp[LDAP resource inbound mappings]

== Test the configuration update

Before you take the leap, test the new configuration using a simulated import.

To check the behavior of your new configuration, use reconciliation tasks.
Since you have already reconciled the LDAP accounts earlier in this guide, you now have both simulation and production reconciliation tasks defined and available for reuse.

* Refer to the xref:/midpoint/methodology/first-steps/integrate-target-system/reconcile-ldap-accounts/[] module if you need a refresher on reconciliation tasks.
* Refer to xref:/midpoint/reference/tasks/synchronization-tasks/import-and-reconciliation/gui/[] for the guide on working with tasks in the graphical user interface.
* You can also use the xref:/midpoint/reference/tasks/synchronization-tasks/import-and-reconciliation/gui/#simulate-import-of-a-single-object[import preview] functionality to simulate the effects of your configuration changes on a single account.

[NOTE]
====
Make sure you are running the reconciliation tasks on the LDAP resource.
In this guide, LDAP is, in general, a target resource, but it acts as a source resource for the usernames.
====

When you view the results of the simulation, you should see the _focus renamed_ note.

image::../ldap-import-username-simulation-focus-renamed.webp[title="A single user import preview result showing that the username would be imported successfully and the focus object would be renamed"]

// TODO: is this safe to put to production if there is, e.g., Andreas Baker alongside Alice Baker? (abaker and abaker2 but we don't have the iterators yet)

== Rename users to LDAP usernames on production

Once you confirm the simulation yields expected results, run the real production reconciliation task which you used to reconcile the LDAP accounts in xref:/midpoint/methodology/first-steps/integrate-target-system/reconcile-ldap-accounts/[].

. In LDAP mappings, change the lifecycle state for the _inbound-uid-username-to-name_ mapping from _Proposed_ to _Active_.
. Use the reconciliation task with the _Production_ configuration (equals to _Undefined_) and leave the execution mode empty.

.List of midPoint users before and after the import of usernames from LDAP. Notice that their primary identifier `name` has changed to their respective LDAP usernames.
[cols=2]
|====
| Before | After
a| image::./ldap-username-import-before-rename.webp[]
a| image::./ldap-username-import-after-rename.webp[]
|====

== What is next

No incorrect data in your target LDAP system have been fixed yet because you have yet to configure the LDAP resource outbound operations.
So far, you've correlated (as in connected) the identities across your source and target systems.
That's not the end of the story, though: You'll see how to automatically remove unwanted accounts and fix incorrect data in further modules.

Proceed to the next module: xref:/midpoint/methodology/first-steps/integrate-target-system/ldap-delete-orphaned-accounts/[]