= Delete orphaned LDAP accounts
:page-nav-title: Delete orphaned LDAP accounts
:page-display-order: 250
:experimental:
:icons: font

When integrating the LDAP server into your new midPoint ecosystem, you found some accounts that are either leftovers from the past or even obviously malicious attack attempts.
Now is the time to clean such accounts from the LDAP server.
Deleting accounts is, however, not to be taken lightly.
Mistakes can happen and it is a good practice to avoid hard-deleting everything without any grace period.

In this module, you will add configurations to:

* Delay account deletion to provide limited grace period.
* Disable accounts prior to their (delayed) hard deletion.
* Activate the synchronization rule for deleting unmarked unmatched accounts.

Both delayed delete and disable instead of delete are *outbound activation mappings*.

* Refer to the following guide on working with activation mappings in GUI: xref:/midpoint/reference/admin-gui/resource-wizard/object-type/activation/[]
* Refer to xref:/midpoint/reference/concepts/activation/[] and xref:/midpoint/reference/concepts/activation/disable-instead-of-delete/[] for more conceptual details.

== Human errors happen. Give them a grace period

The first step to avoid irreversible mistakes is to disable accounts instead of deleting them right away.
The next step is to configure the length of the grace period, i.e., for how long midPoint needs to wait before actually deleting the orphaned or malicious accounts.

. In the target LDAP resource, go to [.nowrap]#icon:male[] *Accounts*#.
. Select [.nowrap]#icon:cog[] btn:[Configure]# > [.nowrap]#icon:toggle-off[] *Activation*#.
. Select the [.nowrap]#icon:arrow-right-from-bracket[] *Outbound*# tab and click [.nowrap]#icon:circle-plus[] btn:[Add outbound]#.
. In the *Activation rules* modal that appears, select *Disable instead of delete*.
. Repeat to add also the *Delayed delete* activation rule.
    ** This activation rules requires you to set the delay length.
        In production, sensible values could span between multiple days and one or two months.
        For testing, you can set it to as little as dozens of seconds.
. Use the _Proposed_ lifecycle state for both activation configurations.

.Outbound activation mappings for delayed delete and disable instead of delete
image::../ldap-outbound-activation-mappings-delayed-delete.webp[Outbound activation mappings for delayed delete and disable instead of delete]

== Activate the resource-side account deletion

In a previous module, you have created an xref:/midpoint/methodology/first-steps/integrate-target-system/define-rules-for-data-handling/#define-synchronization-rules[LDAP synchronization rule to delete unmatched accounts].
The rule is still in the _Draft_ lifecycle state because we did not want to delete accounts on the resource before we created the grace period configuration.
Now that the configuration is in place, you can safely activate the synchronization rule.

. In the target LDAP resource, go to [.nowrap]#icon:male[] *Accounts*#.
. Select [.nowrap]#icon:cog[] btn:[Configure]# > [.nowrap]#icon:arrows-rotatef[] *Synchronization*#.
. Set the lifecycle state of the _delete-unmatched-resource-object_ rule to _Proposed_.
    ** (the _Delete resource object_ reaction to the _Unmatched_ situation)
. Click [.nowrap]#icon:check[] btn:[Save synchronization settings]# to save the change.

.List of target LDAP resource synchronization rules with the delete-unmatched-resource-object now in the Proposed state
image::../ldap-delete-unmatched-account-proposed-synchro-rule.webp[List of target LDAP resource synchronization rules with the delete-unmatched-resource-object now in the Proposed state]

== Simulate behavior of the new configuration

You are now ready to simulate the updated configuration before you put it to production.

To check the behavior of your new configuration, use reconciliation tasks.
You already have both simulation and production reconciliation tasks defined.

Refer to the xref:/midpoint/methodology/first-steps/integrate-target-system/reconcile-ldap-accounts/[] module if you need to refresh your knowledge on working with reconciliation tasks.
In short:

* First run the task in preview mode with development configuration.
    Inspect the results to see if the configuration behaves as expected.

// The delayed deletion process is described in LAB-8-7