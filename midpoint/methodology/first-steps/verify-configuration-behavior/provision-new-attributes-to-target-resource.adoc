= Add new attribute provisioning from HRIS to AD
:page-nav-title: Provision new attributes to target
:page-display-order: 540
:page-toc: top
:experimental:
:icons: font
:page-description: Test how your midPoint configuration handles revised provisioning requirements and the resulting mapping changes in both the source and target resources

Test how your midPoint configuration handles revised provisioning requirements and the resulting mapping changes in both the source and target resources.

== What awaits you in this module

You will import a new user attribute from the HRIS and provision it to Active Directory.
You will create two new mappings: one inbound mapping to get the HRIS data to midPoint, and one outbound mapping to populate AD accounts with the data.

The attribute in question is the job title.
The employees have their job titles in the HRIS, but not in Active Directory.
Your goal is to propagate the job titles to AD as well and see if nothing in your midPoint configuration breaks with this change.

:sectnums:

== Create new HRIS mapping

In the HRIS resource in midPoint, create a new inbound mapping.

*Follow this guide: xref:/midpoint/reference/admin-gui/resource-wizard/object-type/mapping/#inbound_mappings[Create inbound mappings]*

** *Name*: e.g., _job-to-title_
** *From resource attribute*: _job_
** *Expression*: _As is_
** *Target*: _title_
** *Lifecycle state*: _Proposed_

The mapping is in the _Proposed_ lifecycle state, meaning the recurring HRIS reconciliation task cannot work with it yet and you can safely simulate.

.Inbound mapping to insert the job attribute value from the HRIS resource into the title attribute in midPoint
image::hris-inbound-mapping-job-to-title.webp["Inbound mapping to insert the job attribute value from the HRIS resource into the title attribute in midPoint"]

== Create new AD mapping

In the AD resource in midPoint, create a new outbound mapping.

[NOTE]
====
If you use the Docker image prepared for this guide, the mapping is already there preconfigured.
Just change its lifecycle state to _Proposed_.
====

*Follow this guide: xref:/midpoint/reference/admin-gui/resource-wizard/object-type/mapping/#outbound_mappings[Create outbound mappings]*

** *Name*: e.g., _mapping-title_
** *From resource attribute*: _title_
** *Expression*: _As is_
** *Target*: _title_
** *Lifecycle state*: _Proposed_

== Simulate import from HRIS

Your configuration is ready, it is time to verify what it does.
Go to the HRIS resource and run a simulated development import task.
You have them ready for use from the earlier module: xref:/midpoint/methodology/first-steps/connect-source-system/import-accounts-from-hris/#simulate-first[].

.Lifecycle states knowledge refresher
[NOTE]
====
Tasks in the _preview_ mode with the configuration set to _development_ evaluate all _active_ and _proposed_ configuration items but make no permanent changes.
====

After the task finishes, click btn:[Show simulation result].

The result should be that a resource object has been affected for all focal objects that have a projection to the AD resource.
Click [.nowrap]#*More info* icon:arrow-circle-right[]#, open an item in the list, and inspect the changes.
The only change should be the title being provisioned to AD.

Note that certain users on the AD resource already have the `title` attribute filled in.
Since the outbound mapping is _strong_, midPoint overwrites the existing value in AD.
That is desired as you cannot know whether the data in the non-authoritative Active Directory server are correct.

.HRIS import simulation result for Diane Davis showing the job title would be provisioned to and corrected in Active Directory
image::hris-import-simul-devel-provision-job-title.webp["HRIS import simulation result for Diane Davis showing the job title would be provisioned to and corrected in Active Directory"]

== Put the configuration to prodution

Once you have verified the configuration did not break anything and works as expected, put it to production.

. Change the lifecycle state of the HRIS inbound mapping to _Active_.
. Change the lifecycle state of the AD outbound mapping to _Active_.
. Wait for the recurring HRIS reconciliation task to pick up the changes and provision the job titles to all accounts in AD.

Once done, have a look at the *Projections* screen in user profiles in midPoint and look for the `title` attribute.
Similarly, open the link:http://localhost/phpldapadmin/[AD web administration UI] and see the account attributes there.

.The job title is now correct in Active Directory
image::ldap-corrected-job-title.webp["A user profile screen in LDAP showing user attributes, including the corrected value of the job title attribute"]

:sectnums!:

== Next steps

To be fair, the job title value does not look very nice because it contains the internal numeric code from the HRIS.
It is the job for the next module to fix that by amending the existing mapping to make the value more human friendly,
and to show that midPoint can cope just fine with changes made "on the fly".

[.nowrap]#icon:arrow-right[] *xref:/midpoint/methodology/first-steps/verify-configuration-behavior/update-existing-mapping/[]*#