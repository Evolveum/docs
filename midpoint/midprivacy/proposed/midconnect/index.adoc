= MidConnect
:page-visibility: hidden
:page-toc: top

.Proposed project
WARNING: This is a proposed project.
Only a preliminary design and architecture was done so far.
We are certain the project is feasible, and we are sure about general direction and big components in the project.
However, the details still need to be filled in.
There are research activities to be carried out, challenges and risks.
It is planned to add the details at the beginning of the project - and during the project.


== Executive Summary

MidConnect aims at automation of personal data portability between organizations, honoring data protection rules.
The idea is to use existing protocols such as OpenID Connect and SAML, utilizing extensible and configurable identity management engine to map the data.
Core of the solution is based on midPoint, comprehensive open source identity management and governance platform.
MidPoint is already capable of bridging the gaps between incompatible protocols and diverse data schemas, which will be necessary for practical data portability.
However, MidPoint was originally built for management of identities within a single organization.
MidConnect project aims at extending this functionality to reach out to the Internet, to connect midPoint to other organizations, facilitating controlled transfer of personal data.

The ultimate goal is to provide data sovereignty to organizations, such as universities, SMEs and government agencies.
The ambition is to allow management of personal data independent of social networks and cloud service providers.
Our focus is not just on the initial transfer of the data, as such approach does not guarantee that data are properly maintained.
We are focused on a long-term data "links" that can be used to maintain and update the data in a controlled long-term relationship.

Proposed solution is a part of xref:/midpoint/midprivacy[midPrivacy], a broader initiative to create an integrated solution that will be a fusion of identity management and data protection capabilities in one comprehensive open source platform.

== Motivation and Context

MidConnect aims at flow of personal data between organizations.

image::midconnect-context.png[Context]

The primary goal is an ordinary, self-sovereign organization.
As it is 21^st^ century, organizations are not isolated any more.
Typical organization will need to work with variety of _external identities_.
There may be cross-organizational teams, such as research teams typical for academia.
Organization may participate in an identity federation which provide technological and organizational measures to allow distributed teams.

Organizations often work with user communities, such as enthusiasts, interest groups, contributors and so on.
There is often an annoying procedure to register an account and even more troublesome procedure to maintain it.
Organizations try to make these processes easier to user, supporting "social login" to create an account based on social networks.
However, there are many identity sources, ranging from major social networks to a developer community hubs such as Github, each of them using their own set of protocols, protocol dialects and schemas.

Overall, management of external identities is much harder than it may seem.
The very nature of external identities mean there is an inherent need for data _transfer_ and _portability_.
Moreover, there is a need to adhere to data protection rules.
As it is very difficult to add data protection and privacy to an existing system, these aspects must be native part of the solution, observing the _privacy by design_ principle.

The aim of midConnect project is to make management of external user communities much easier, providing a seamless experience.
Core of the solution is based on https://midpoint.evolveum.com/[midPoint], an open source identity management and governance platform.
MidPoint has strong capabilities in identity integration, bridging incompatible protocols, mapping diverse schemas and aligning the policies.
Therefore midPoint is an ideal foundation for the solution.
However, even with midPoint at its core, the solution has to deal with several challenges:

* *Data portability*.
There are diverse protocols (OpenID Connect, OAuth2, SAML, SCIM), proprietary protocol extensions, schemas, with new protocols in development (GNAP).
Developing a solution that would provide satisfactory support for even the most popular protocols and their variants is likely to be a challenge on its own.
MidPoint provides a solid foundation for data transformation and mapping that can help bridging incompatible schemas.
However, even the capabilities of midPoint have to be extended to support full data portability.

* *Data maintenance*.
When data are transferred from one organization to another, that is not the end of the data portability problem.
It fact, it is just a beginning.
The data need to be _maintained_ during all of its lifetime.
The data need to be updated, merged with other data sources, the data may need to be validated, certified, the data may expire, there may need for the data to be refreshed.
The data may need to be expanded when new services ask for more data, the data need to be reduced when there is no need for the data.
Finally, at the end of the lifetime, the data need to be erased.
Management of the data during the lifecycle is at least as challenging as the data transfer event that starts the lifecycle.

* *Data protection and privacy*.
Personal data protection rules must be observed.
While this is the right thing to do, it complicates management of the data.
The implementation must make sure there is a valid _basis for data processing_ for every data item at all times.
This is an area where technology meets legislation and not all the details are clear yet, which makes the implementation quite challenging.

* *User experience*.
There are many complex concepts involved in data portability and data protection.
Yet, the system must interact with users that are not identity management and data protection experts.
Displaying the information in understandable and intuitive way is likely to be a major challenge.


== Project Goals

MidPoint has a significant potential for data and service portability.
Many of the basic building blocks of data portability are already part of midPoint: common data model, data mapping mechanisms and data synchronization processes.
MidPoint is also naturally designed to work with personal data, employing _privacy by design_ approach.
This was proven during several successful prototypes of data protection functionality.
We plan to take advantage of existing midPoint functionality and extend it to support personal data portability.

We plan to extend midPoint functionality in two ways (project outcomes):

. MidPoint will reach out to other organizations, providing _data portability_ mechanisms.
We plan to reuse existing IAM protocols such as OAuth2, OpenID Connect and SAML to facilitate data transfer.
Existing midPoint capabilities will be used to "integrate" the data: map data models, transform data to compatible formats, keep data up to date.
The plan is to create new "Inbound Data Transfer Components" (see the diagram) to facilitate the transfer.
We would like to make the implementation as protocol-agnostic as possible, as we expect that new protocols will be added in the future (e.g. GNAP).
As existing protocols are based on a diverse and often non-compatible set of technologies, this unification attempt may be a significant technological challenge.

. Keep users in control by providing integrated _data protection_ capabilities.
Processing of personal data cannot be done in any arbitrary way.
There needs to a valid _basis_ for data processing.
This principle applies to data transfer as well.
We have experimented with the concept of data processing _basis_ in a couple of previous projects.
Now we would like to apply the concepts to data portability mechanisms, utilizing the _privacy by design_ approach.
Although we have some idea how data protection concepts can be applied to data portability, actual implementation of the mechanisms will require significant research and innovation effort.
The mechanism will certainly include interaction with the user, making sure the user can make responsible and informed decisions about personal data.
As data protection is not a simple topic to understand, we expect user experience (UX) challenges during the project.

In addition to that, there are also secondary goals:

[start=3]
. Provide simple, intuitive user interface for end users to efficiently maintain their information.
Some concepts, especially data protection concepts, may be very difficult to manage in an understandable and intuitive way.
The goal of the project is to explore the possibilities of using some of these concepts in the context of an end-user interface for non-expert users.

. Explore possibilities of automatic data maintenance and updates.
This may be possible in the context of some protocols, such as using OpenID Connect refresh tokens, or combining identity federation protocols with provisionig protocols (e.g. SCIM).

. Provide rough design for future functionality, especially the development of data protection features, progressive user profile and more general user-user relationship management (e.g. friend-friend, student-parent, etc.)

== Solution Architecture Outline

MidPoint is a true foundation for this project.

image::midconnect-big-picture.png[Big picture]


Many existing midPoint features will be reused, most notably the mechanisms of inbound mappings and expressions.
However, there is a need for several new and significantly improved components:

* Inbound data transfer components, including user interaction components.
There are expected changes in several existing midPoint components, including midPoint administration user interface ("admin-gui") and midPoint authentication mechanism ("flexible authentication").
It is likely the existing code may need to be re-structured.

* Data protection policies, implemented in midPoint core.
Existing midPoint data model need to be extended to support concepts of _data requirement_ and _data release_.
The ideal place seems to be extension of existing concepts of _abstract role_ and _assignment_.

* Self-service user interface (prototype).
MidPoint already has some self-service functionality in its administration user interface.
However, that functionality is very "technological" and complex.
According to our feedback, existing functionality is too difficult to understand for non-expert users.
Existing self-service user interface is composed of administration user interface components, which means it is not easy to significantly change the design and behavior of the user interface.
Effort to adapt existing interface and effort needed to create a new user interface is comparable.
Therefore we have decided for a fresh start.
We plan to build a new self-service user interface, specifically aimed at non-expert end users.
Our plan is to employ user experience (UX) expertise to make the interface understandable and easy to use.

Results of this project are meant to seamlessly fit into midPoint, aligning with existing midPoint architecture and development process.
The results of first part of the project (prototype) is planned to be part of midPoint 4.4.
The results of second part of the project (product) is planned to be part of midPoint 4.5.

=== Inbound Data Transfer Components

TODO: Picture of "inbound data transfer" components

image::enrollment-components.png[Enrollment components]

Special front-end components, something like registration on steroids.

We think that registration will usually be interactive.
The component may need to:

* Handle data release (data protection), e.g. ask for consent for some attributes.
This may be already handled on the releasing side (Social network, IdP, maybe using UMA, ...).
We may still need to ask for some attributes, or maybe make sure the user is properly informed about personal data use.

* Correlate the identity.
The user may already exist in our system.
This may be semi-manual, e.g. asking the user to confirm (and prove) the match.


=== Data Requirement And Release

image::midconnect-data-release-inbound.png[Data release]

Basic ideas:

* Enrollment/registration is never done in a vacuum.
There is always some _basis_ for registration,
e.g. user becoming community member, registration for interest group, etc.

* The "basis" knows what attributes we need.
This also tells us when to delete the attributes.

* We can cache the original data in the shadow.
This may be an advantage when working with several data sources.
The shadow may act as a "lightweight persona".
However, this should be further explored.

* The shadow works as "data link" back to the original SocNet account.
We can update the information in the shadow if there is any way how to do in the protocol (e.g. OAuth/OIDC refresh token).

Considerations:

* Thought about some special data structure that would bind the "data release" to the shadow.
However, this data structure looks almost exactly like assignment.
It looks easier to use assignment, bound to the user.
The account is linked to the user.
However, we would probably need to refer to the shadow in the "basis/release" assignment, to make the data source explicit.


== Challenges, Questions and Ideas

* How to implement the "enrollment components"?
In midPoint admin GUI? How it aligns with flexible auth?
Or maybe implement it in the planned "midFront" end-user GUI?
How does it work with Angular?
Would we duplicate flexible auth there?


Ideas to explore:

* Slavek: We may want a special "self asserted" shadow, that would cache data entered by the user during registration flow - and even maybe during normal user profile edits.
In that case we do not lose the data if we ever have to delete/unlink source (e.g. SocNet) shadow.
This may also be easier for data merging and provenance.
This needs to be further explored.


== Future Potential

TODO

* "Basis" (role) and assignment can be reused for outbound processing and progressive user profile

The data requirement and release mechanism works well also on outbound side (and "focus policy" as well).

TODO

== See Also

* xref:/midpoint/midprivacy[MidPrivacy initiative]
