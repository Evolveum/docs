= Developing midPoint with Intellij IDEA
:page-toc: float-right
:link-mp-build: https://wiki.evolveum.com/display/midPoint/Building+MidPoint+From+Source+Code

This guide describes how to set up midPoint in https://www.jetbrains.com/idea/[IntelliJ IDEA].
IDEA impressed most of our development team members and makes out team much more productive.

This guide assumes you've cloned https://github.com/Evolveum/midpoint[the repository] and perhaps {link-mp-build}[built it] already.

== Install JAVA

JDK 11 (LTS) is supported for midPoint 4.0 and newer.
You can download from http://www.oracle.com/technetwork/java/javase/downloads/index.html[Oracle JDK], but you better check the license.
Or you can try more license-friendly releases like https://adoptopenjdk.net/[OpenJDK from AdoptOpenJDK]
or https://www.azul.com/downloads/zulu-community/?version=java-11-lts&architecture=x86-64-bit&package=jdk[Zulu JDK from Azul].

JDK (sometimes called SDK) is necessary for building - JRE (just the runtime) is not enough.

== Install IDEA

IDEA is provided in https://www.jetbrains.com/idea/features/editions_comparison_matrix.html[two editions].
You can use free _Community edition_ just fine, paid _Ultimate Edition_ offers advanced support for web development and frameworks.
Both editions allow building and running midPoint just fine.

* Download IDEA from http://www.jetbrains.com/idea/download/index.html[jetbrains.com].
* Select the version for your operating system and edition.
* Install IntelliJ IDEA on your computer.

Pictures in the guide are mix of both editions, but we will focus on the basics with the _Community Edition_.

== Import of midPoint into IDEA

Importing midPoint into IDEA can be smooth if you have already {link-mp-build}[built it] before.
It is recommended to first build the project which avoids a few hiccups during the first import.
We will show what happens if you don't and the project can be built from IDEA too and reimported.

image:mp-idea-import.png[]

Run the IDE and choose *Open or import* (1).
If IDEA opens with existing project use *File | Open* from the main menu.
Find the cloned `midpoint` directory, select it (2) and confirm (3).
You can also clone the project directly from IDEA if you haven't done so before.

Wait until the IDE settles and the progress bar at the bottom stops working.

=== Possible import problems before the first build

image:mp-idea-maven-import.png[]

If you haven't built the project before (or deleted `~/.m2/repository/com/evolveum`) IDEA can't
fully import the project, because Maven POMs reference midPoint plugins that are not built yet (1).
On Windows, it is recommended to exclude IDEA's working directory and project repository from
Windows Defender scanning - IDEA suggests that and offers an automatic fix (2).
Open the Maven panel on the right edge of the window (hidden behind contextual menu in the picture).
Normally the list of Maven projects is flat, if you prefer it to follow the directory structure,
click on the Maven Options menu (3) and choose *Group Modules* (4).

=== IDEA JDK setup

Before we continue we will check that we're using the right JDK in IDEA.
In the menu, choose *File | Project Structure...* to open the *Project Structure* window.

image:mp-idea-project-jdk.png[]

Here in the *Project* section (1) check that *Project SDK* shows JDK 11 (2).
If not, click *Edit* (3) or *SDKs* (4) and set JDK as described on https://www.jetbrains.com/help/idea/sdk.html[this help page].
Check also the *Project language level* - normally it would be fine to use the level for JDK 11,
but as of June 2020 we still secretly (but not officially anymore!) support JDK 8.

=== Setting Maven build

We may run the Maven build from IDEA, even the first before the project is synced properly.

image:mp-idea-maven-profile-and-build.png[]

We often want to *Toggle 'Skip Tests' Mode* (1) - icon has to be highlighted - to avoid very long full build.
It is also not necessary to build full distribution with IDEA, so you can uncheck *dist* in *Profiles*
(it's a bit laggy, be patient or try again).
Finally, run the *install* phase from under the *Lifecycle* under the root project.
It's easy to locate the project with modules grouped, in the plain list it's indicated with *(root)* after the name.
Without the tests and distribution the build can run for around 4-8 minutes.

[NOTE]
Phase *package* is not enough, we need to get midPoint plugins into the local repository under `~/.m2/repository`.

After this we can reimport the Maven project - (1) in the following picture:

image:mp-idea-maven-reimport.png[]

This time everything should be synchronized properly (2).
Project window (3) will show the project structure with recognized modules marked accordingly (blue squares).
When the project structure as defined in the POM files changes IDEA prompts us to reimport the project.
Alternatively, we can choose one of the *Auto-reload Mode*s (4).

== TODO

image:mp-idea-copyright-profile.png[]
image:mp-idea-unignore-maven-projects.png[]
image:mp-idea-running-test-dummy-connector-classpath.png[]
image:mp-idea-duplicate-dependencies.png[]
image:mp-idea-find-library-usage.png[]
